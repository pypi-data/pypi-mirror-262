$(document).ready(()=>{"use strict";$(".flexdatalist").flexdatalist({minLength:1,noResultsText:"",searchContain:!0});const e=$("input#id_pre_ping"),t=$("input#id_formup_now"),n=$("input#id_srp_link"),l=$("input#id_optimer"),s=$("input#id_srp"),i=$("select#id_ping_target"),a=$("select#id_ping_channel"),r=$("select#id_fleet_type"),p=$('input[name="csrfmiddlewaretoken"]'),o=$("input#id_fleet_commander"),c=$("input#id_fleet_name"),g=$("input#id_fleet_comms"),d=$("input#id_formup_time"),f=$("input#id_formup_timestamp"),m=$("input#id_formup_location"),u=$("input#id_fleet_doctrine"),h=$("input#id_fleet_doctrine_url"),k=$("input#id_webhook_embed_color"),b=(d.datetimepicker({lang:fleetpingsSettings.dateTimeLocale,maskInput:!0,format:"Y-m-d H:i",dayOfWeekStart:1,step:15}),async e=>{const t=await fetch(e);if(t.ok)return t.text();{const s="An error has occurred: "+t.status;throw new Error(s)}}),_=()=>{b(fleetpingsSettings.url.pingTargets).then(e=>{$(i).html(e)}),b(fleetpingsSettings.url.pingWebhooks).then(e=>{$(a).html(e)}),b(fleetpingsSettings.url.fleetTypes).then(e=>{$(r).html(e)}),b(fleetpingsSettings.url.formupLocations).then(e=>{$(m).after(e)}),b(fleetpingsSettings.url.fleetComms).then(e=>{$(g).after(e)}),b(fleetpingsSettings.url.fleetDoctrines).then(e=>{$(u).after(e)})},v=(e,t=10)=>{$(e).fadeTo(1e3*t,500).slideUp(500,()=>{$(e).remove()})},S=(e,t)=>{$(t).html(`<div class="alert alert-success alert-dismissible alert-message-success d-flex align-items-center fade show">${e}<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>`),v(".alert-message-success")},w=(e,t)=>{$(t).html(`<div class="alert alert-danger alert-dismissible alert-message-error d-flex align-items-center fade show">${e}<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>`),v(".alert-message-error",9999)},y=e=>e&&e.replace(/<(|\/|[^>/bi]|\/[^>bi]|[^/>][^>]+|\/[^>][^>]+)>/g,""),T=(t,s)=>{if(s=s||!1,t){let e=y(t).replace(/&/g,"&amp;");return!0===s&&(e=e.replace(/"/g,"&quot;")),e=!1===s?e.replace(/"/g,'\\"'):e}return t},x=e=>{const t=new Date(e);return(t.getTime()-60*t.getTimezoneOffset()*1e3)/1e3},A=()=>{const t=new ClipboardJS("button#copyFleetPing");t.on("success",e=>{S(fleetpingsTranslations.copyToClipboard.success,".aa-fleetpings-ping-copyresult"),e.clearSelection(),t.destroy()}),t.on("error",()=>{w(fleetpingsTranslations.copyToClipboard.error,".aa-fleetpings-ping-copyresult"),t.destroy()})};$(i).change(()=>{"@everyone"===i.val()?$(".hint-ping-everyone").show("fast"):$(".hint-ping-everyone").hide("fast")}),$(d).change(()=>{const e=x(y(d.val()));$(f).val(e)}),$(u).change(()=>{const e=y(u.val());let t=null;if(""!==e){const s=$('#fleetDoctrineList [value="'+T(e,!1)+'"]').data("doctrine-url");"undefined"!==s&&""!==s&&(t=s)}$(h).val(t)}),$(r).change(()=>{const e=$("option:selected",r);let t=null;""!==e&&(t=y(e.data("embed-color"))),$(k).val(t)}),!0===fleetpingsSettings.srpModuleAvailableToUser&&(s.is(":checked")&&t.is(":checked")?$(".fleetpings-create-srp-link").show("fast"):(n.prop("checked",!1),$(".fleetpings-create-srp-link").hide("fast")),s.change(()=>{s.is(":checked")&&t.is(":checked")?$(".fleetpings-create-srp-link").show("fast"):(n.prop("checked",!1),$(".fleetpings-create-srp-link").hide("fast"))})),e.on("change",()=>{e.is(":checked")?(t.prop("checked",!1),d.prop("disabled",!1),!0===fleetpingsSettings.optimerInstalled&&$(".fleetpings-create-optimer").show("fast"),!0===fleetpingsSettings.srpModuleAvailableToUser&&(n.prop("checked",!1),$(".fleetpings-create-srp-link").hide("fast"))):(t.prop("checked",!0),d.prop("disabled",!0),!0===fleetpingsSettings.optimerInstalled&&(l.prop("checked",!1),$(".fleetpings-create-optimer").hide("fast")),!0===fleetpingsSettings.srpModuleAvailableToUser&&s.is(":checked")&&$(".fleetpings-create-srp-link").show("fast"))}),t.on("change",()=>{t.is(":checked")?(e.prop("checked",!1),d.prop("disabled",!0),!0===fleetpingsSettings.optimerInstalled&&(l.prop("checked",!1),$(".fleetpings-create-optimer").hide("fast")),!0===fleetpingsSettings.srpModuleAvailableToUser&&s.is(":checked")&&$(".fleetpings-create-srp-link").show("fast")):(e.prop("checked",!0),d.prop("disabled",!1),!0===fleetpingsSettings.optimerInstalled&&$(".fleetpings-create-optimer").show("fast"),!0===fleetpingsSettings.srpModuleAvailableToUser&&(n.prop("checked",!1),$(".fleetpings-create-srp-link").hide("fast")))}),$("form").submit(e=>{if(e.preventDefault(),$(".fleetpings-form-message div").remove(),!0===fleetpingsSettings.srpModuleAvailableToUser&&n.is(":checked")){const s=[c.val(),u.val()];if(s.includes(""))return w(fleetpingsTranslations.srp.error.missingFields,".fleetpings-form-message"),!1}if(!0===fleetpingsSettings.optimerInstalled&&l.is(":checked")){const i=[c.val(),u.val(),m.val(),d.val(),o.val()];if(i.includes(""))return w(fleetpingsTranslations.optimer.error.missingFields,".fleetpings-form-message"),!1}const t=$("#aa-fleetping-form").serializeArray().reduce((e,t)=>(e[t.name]=t.value,e),{});$.ajax({url:fleetpingsSettings.url.fleetPing,type:"post",data:t,headers:{"X-CSRFToken":p.val()},success:e=>{!0===e.success?($(".aa-fleetpings-no-ping").hide("fast"),$(".aa-fleetpings-ping").show("fast"),$(".aa-fleetpings-ping-text").html(e.ping_context),e.message&&S(e.message,".fleetpings-form-message")):e.message?w(e.message,".fleetpings-form-message"):w("Something went wrong, no details given.",".fleetpings-form-message")}})}),$("button#copyFleetPing").on("click",()=>{A()}),_()});
//# sourceMappingURL=fleetpings.min.js.map