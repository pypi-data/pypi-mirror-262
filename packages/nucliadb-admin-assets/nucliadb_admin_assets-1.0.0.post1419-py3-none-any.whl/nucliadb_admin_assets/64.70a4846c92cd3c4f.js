"use strict";(self.webpackChunknucliadb_admin=self.webpackChunknucliadb_admin||[]).push([[64],{9064:(Qe,F,r)=>{r.r(F),r.d(F,{SyncModule:()=>Ne});var b=r(1368),y=r(2220),l=r(6504),_=r(4544),O=r(1828),u=r(3992),e=r(4496),k=r(4676),R=r(1632),M=r(4020),v=r(2064);const A=i=>({url:i});let X=(()=>{class i{constructor(t,n,s){this.sync=t,this.navigationService=n,this.router=s,this.localUrl=_.eA,this.serverUrl=new l.Ku(localStorage.getItem(_.uk)||"",{nonNullable:!0})}save(){this.sync.setSyncServer(this.serverUrl.value),this.back()}back(){this.navigationService.kbUrl.pipe((0,u.U)(1)).subscribe(t=>this.router.navigate([`${t}/upload`]))}static#e=this.\u0275fac=function(n){return new(n||i)(e.GI1(_.gH),e.GI1(O.wx),e.GI1(y.E5))};static#t=this.\u0275cmp=e.In1({type:i,selectors:[["nsy-server-setup"]],decls:18,vars:26,consts:[[1,"header"],["icon","chevron-left","aspect","basic",3,"paTooltip","click"],[1,"container"],[3,"innerHTML"],["placeholder","https://my.sync.server",3,"formControl","help"],["kind","primary",1,"save-button",3,"disabled","click"]],template:function(n,s){1&n&&(e.I0R(0,"div",0)(1,"pa-button",1),e.qCj("click",function(){return s.back()}),e.wVc(2,"translate"),e.OEk(3),e.wVc(4,"translate"),e.C$Y(),e.I0R(5,"h1"),e.OEk(6),e.wVc(7,"translate"),e.C$Y()(),e.I0R(8,"div",2),e.wR5(9,"p",3),e.wVc(10,"translate"),e.I0R(11,"pa-input",4),e.wVc(12,"translate"),e.OEk(13),e.wVc(14,"translate"),e.C$Y(),e.I0R(15,"pa-button",5),e.qCj("click",function(){return s.save()}),e.OEk(16),e.wVc(17,"translate"),e.C$Y()()),2&n&&(e.yG2(),e.E7m("paTooltip",e.kDX(2,9,"upload.server.back")),e.yG2(2),e.oRS(" ",e.kDX(4,11,"upload.server.back")," "),e.yG2(3),e.cNF(e.kDX(7,13,"upload.server.title")),e.yG2(3),e.E7m("innerHTML",e.kDX(10,15,"upload.server.description"),e.E3n),e.yG2(2),e.E7m("formControl",s.serverUrl)("help",e.g7$(12,17,"upload.server.help",e.S45(24,A,s.localUrl))),e.yG2(2),e.oRS(" ",e.kDX(14,20,"upload.server.url")," "),e.yG2(2),e.E7m("disabled",s.serverUrl.pristine),e.yG2(),e.oRS(" ",e.kDX(17,22,"generic.save")," "))},dependencies:[k.k,R.g,M.u,l.ue,l.ug,v.sD],styles:['@charset "UTF-8";.header[_ngcontent-%COMP%]{display:flex}p[_ngcontent-%COMP%]{margin-bottom:2rem}.container[_ngcontent-%COMP%]{max-width:40rem}.save-button[_ngcontent-%COMP%]{margin-top:1.5rem}'],changeDetection:0})}return i})();var h=r(7368),C=r(4704),w=r(5657),I=r(6684),V=r(3616),S=r(882),U=r(4555),P=r(6576),G=r(9212),N=r(5568),T=r(2700),Q=r(1056),Y=r(9144),j=r(5672),K=r(7360),L=r(9040),H=r(6832),W=r(4180),J=r(874);const q=(i,o)=>o.index;function z(i,o){1&i&&(e.I0R(0,"div",4),e.wR5(1,"pa-icon",5),e.I0R(2,"div",6),e.OEk(3),e.wVc(4,"translate"),e.C$Y()()),2&i&&(e.yG2(3),e.oRS(" ",e.kDX(4,1,"upload.activity.no-folders")," "))}function B(i,o){if(1&i&&(e.I0R(0,"pa-table-row")(1,"pa-table-cell"),e.wR5(2,"pa-icon",7),e.C$Y(),e.I0R(3,"pa-table-cell"),e.wR5(4,"pa-datetime",8),e.C$Y(),e.I0R(5,"pa-table-cell"),e.OEk(6),e.C$Y()()),2&i){const t=o.$implicit;e.yG2(2),e.E7m("name",t.icon),e.yG2(2),e.E7m("datetime",t.date),e.yG2(2),e.cNF(t.message)}}let Z=(()=>{class i{constructor(t,n,s,c){this.syncService=t,this.cdr=n,this.router=s,this.toast=c,this.unsubscribeAll=new w.E,this.since="",this.currentIndex=0,this.logs=[],this.syncing=!1,this.currentSync=this.syncService.getCurrentSync(),this.canSelectFiles=this.syncService.currentSourceId.pipe((0,C.k)(a=>this.syncService.canSelectFiles(a||""))),this.noFolderSelected=this.currentSync.pipe((0,C.k)(a=>!a.foldersToSync||0===a.foldersToSync.length))}ngOnInit(){this.router.events.pipe((0,I.I)(t=>t instanceof y.MT),(0,G.y)(()=>{this.since="",this.logs=[],this.cdr.markForCheck()}),(0,N.W)(null),(0,h.G)(()=>this.syncService.currentSourceId),(0,I.I)(t=>!!t),(0,h.G)(t=>(0,T.of)(t).pipe((0,Q.G)({delay:1e4}))),(0,h.G)(t=>this.syncService.getLogs(t,this.since).pipe((0,Y.a)(n=>(console.error("Error while fetching logs",n),(0,T.of)([]))))),(0,C.k)(t=>t.map((n,s)=>({index:s+this.currentIndex,date:n.createdAt,message:n.message,icon:"high"===n.level?"circle-cross":"medium"===n.level?"warning":"circle-check"}))),(0,V.a)(this.unsubscribeAll)).subscribe(t=>{this.since=t[0]?.date||this.since,this.currentIndex+=t.length,this.logs=t.concat(this.logs),this.cdr.markForCheck()})}ngOnDestroy(){this.unsubscribeAll.next(),this.unsubscribeAll.complete()}triggerSync(){this.syncing=!0,this.cdr.markForCheck(),this.syncService.triggerSyncs().subscribe({complete:()=>{this.syncing=!1,this.cdr.markForCheck()},error:()=>{this.toast.error("upload.activity.error"),this.syncing=!1,this.cdr.markForCheck()}})}static#e=this.\u0275fac=function(n){return new(n||i)(e.GI1(_.gH),e.GI1(e.kD9),e.GI1(y.E5),e.GI1(S.Q$))};static#t=this.\u0275cmp=e.In1({type:i,selectors:[["nsy-activity"]],decls:22,vars:22,consts:[["class","warning-container"],[3,"disabled","click"],["columns","48px 200px auto"],["header",""],[1,"warning-container"],["name","warning"],[1,"title-xxs"],[3,"name"],[3,"datetime"]],template:function(n,s){1&n&&(e.I0R(0,"p"),e.OEk(1),e.wVc(2,"translate"),e.C$Y(),e.yuY(3,z,5,3,"div",0),e.wVc(4,"async"),e.wVc(5,"async"),e.I0R(6,"pa-button",1),e.qCj("click",function(){return s.triggerSync()}),e.wVc(7,"async"),e.wVc(8,"async"),e.OEk(9),e.wVc(10,"translate"),e.C$Y(),e.I0R(11,"pa-table",2)(12,"pa-table-header"),e.wR5(13,"pa-table-cell",3),e.I0R(14,"pa-table-cell",3),e.OEk(15),e.wVc(16,"translate"),e.C$Y(),e.I0R(17,"pa-table-cell",3),e.OEk(18),e.wVc(19,"translate"),e.C$Y()(),e.c53(20,B,7,3,"pa-table-row",null,q),e.C$Y()),2&n&&(e.yG2(),e.cNF(e.kDX(2,6,"upload.activity.help")),e.yG2(2),e.C0Y(3,e.kDX(4,8,s.canSelectFiles)&&e.kDX(5,10,s.noFolderSelected)?3:-1),e.yG2(3),e.E7m("disabled",s.syncing||e.kDX(7,12,s.canSelectFiles)&&e.kDX(8,14,s.noFolderSelected)),e.yG2(3),e.oRS(" ",e.kDX(10,16,"upload.activity.sync-now"),"\n"),e.yG2(6),e.cNF(e.kDX(16,18,"upload.activity.date")),e.yG2(3),e.cNF(e.kDX(19,20,"upload.activity.event")),e.yG2(2),e.oho(s.logs))},dependencies:[k.k,j.g,K.o,L.q,H.K,W.oB,J._,b.a,v.sD],styles:['@charset "UTF-8";.warning-container[_ngcontent-%COMP%]{display:flex;align-items:center;background:#ffdd1a;color:#000;margin-bottom:1rem;padding:1rem;gap:1rem}'],changeDetection:0})}return i})();var $=r(1560);const ee=(i,o)=>o.id;function te(i,o){if(1&i&&(e.I0R(0,"pa-input",5),e.wVc(1,"translate"),e.OEk(2),e.wVc(3,"translate"),e.C$Y()),2&i){const t=e.GaO().$implicit;e.E7m("help",t.help?e.kDX(1,4,t.help):void 0)("placeholder",t.placeholder)("formControlName",t.id),e.yG2(2),e.oRS(" ",e.kDX(3,6,t.label)," ")}}function ne(i,o){if(1&i&&(e.I0R(0,"pa-textarea",6),e.wVc(1,"translate"),e.OEk(2),e.wVc(3,"translate"),e.C$Y()),2&i){const t=e.GaO().$implicit;e.E7m("help",t.help?e.kDX(1,3,t.help):void 0)("formControlName",t.id),e.yG2(2),e.oRS(" ",e.kDX(3,5,t.label)," ")}}function ie(i,o){if(1&i&&(e.I0R(0,"div",4),e.yuY(1,te,4,8,"pa-input",5)(2,ne,4,7,"pa-textarea",6),e.C$Y()),2&i){const t=o.$implicit;e.yG2(),e.C0Y(1,"text"===t.type?1:-1),e.yG2(),e.C0Y(2,"textarea"===t.type?2:-1)}}function se(i,o){if(1&i){const t=e.KQA();e.I0R(0,"form",1),e.qCj("ngSubmit",function(){e.usT(t);const s=e.GaO();return e.CGJ(s.save())}),e.I0R(1,"pa-input",2),e.OEk(2),e.wVc(3,"translate"),e.C$Y(),e.c53(4,ie,3,2,"div",7,ee),e.I0R(6,"pa-button",3),e.OEk(7),e.wVc(8,"translate"),e.C$Y()()}if(2&i){const t=e.GaO();e.E7m("formGroup",t.form),e.yG2(2),e.oRS(" ",e.kDX(3,4,"upload.source.name")," "),e.yG2(2),e.oho(t.fields),e.yG2(2),e.E7m("disabled",!t.form.valid),e.yG2(),e.oRS(" ",e.kDX(8,6,"action.save")," ")}}let oe=(()=>{class i{constructor(t,n,s,c){this.syncService=t,this.toast=n,this.formBuilder=s,this.cdr=c,this.done=new e._w7}ngOnInit(){this.syncService.getCurrentSync().pipe((0,I.I)(t=>!!t),(0,G.y)(t=>this.sync=t),(0,h.G)(t=>this.syncService.getConnector(t.connector.name,"").pipe((0,h.G)(n=>n.getParameters()),(0,C.k)(n=>({sync:t,fields:n}))))).subscribe(({sync:t,fields:n})=>this.showFields(t,n))}save(){this.sync&&this.syncService.updateSync(this.sync.id,{title:this.form?.value.title||"",connector:{...this.sync.connector,parameters:{...this.sync.connector.parameters,...this.form?.value.fields||{}}}}).subscribe({next:()=>{this.toast.success("upload.saved"),this.done.emit()},error:()=>{this.toast.error("upload.failed")}})}showFields(t,n){this.fields=n,this.form=this.formBuilder.group({title:["",l.AQ.required],fields:this.formBuilder.group(n.reduce((s,c)=>({...s,[c.id]:["",this.getFieldValidators(c)]}),{}))}),this.form.patchValue({fields:t.connector.parameters,title:t.title||t.id}),this.cdr.markForCheck()}getFieldValidators(t){const n=[];return t.required&&n.push(l.AQ.required),t.pattern&&n.push(l.AQ.pattern(t.pattern)),n}static#e=this.\u0275fac=function(n){return new(n||i)(e.GI1(_.gH),e.GI1(S.Q$),e.GI1(l.KE),e.GI1(e.kD9))};static#t=this.\u0275cmp=e.In1({type:i,selectors:[["nsy-edit-settings"]],outputs:{done:"done"},decls:1,vars:1,consts:[["qa","fields-form",3,"formGroup"],["qa","fields-form",3,"formGroup","ngSubmit"],["formControlName","title"],["qa","save-button","type","submit",3,"disabled"],["formGroupName","fields",1,"field"],[3,"help","placeholder","formControlName"],[3,"help","formControlName"],["formGroupName","fields","class","field"]],template:function(n,s){1&n&&e.yuY(0,se,9,8,"form",0),2&n&&e.C0Y(0,s.fields&&s.form?0:-1)},dependencies:[l.sz,l.ue,l.u,l.uW,l.Wo,l.Kh,R.g,$.a,k.k,v.sD],styles:['@charset "UTF-8";.field[_ngcontent-%COMP%]{margin:1rem 0}.field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem}pa-button[_ngcontent-%COMP%]{margin-top:1rem}'],changeDetection:0})}return i})();var ce=r(1112),re=r(7648),ae=r(9336);r(1116);class he{get selected(){return this._selected||(this._selected=Array.from(this._selection.values())),this._selected}constructor(o=!1,t,n=!0,s){this._multiple=o,this._emitChanges=n,this.compareWith=s,this._selection=new Set,this._deselectedToEmit=[],this._selectedToEmit=[],this.changed=new w.E,t&&t.length&&(o?t.forEach(c=>this._markSelected(c)):this._markSelected(t[0]),this._selectedToEmit.length=0)}select(...o){this._verifyValueAssignment(o),o.forEach(n=>this._markSelected(n));const t=this._hasQueuedChanges();return this._emitChangeEvent(),t}deselect(...o){this._verifyValueAssignment(o),o.forEach(n=>this._unmarkSelected(n));const t=this._hasQueuedChanges();return this._emitChangeEvent(),t}setSelection(...o){this._verifyValueAssignment(o);const t=this.selected,n=new Set(o);o.forEach(c=>this._markSelected(c)),t.filter(c=>!n.has(this._getConcreteValue(c,n))).forEach(c=>this._unmarkSelected(c));const s=this._hasQueuedChanges();return this._emitChangeEvent(),s}toggle(o){return this.isSelected(o)?this.deselect(o):this.select(o)}clear(o=!0){this._unmarkAll();const t=this._hasQueuedChanges();return o&&this._emitChangeEvent(),t}isSelected(o){return this._selection.has(this._getConcreteValue(o))}isEmpty(){return 0===this._selection.size}hasValue(){return!this.isEmpty()}sort(o){this._multiple&&this.selected&&this._selected.sort(o)}isMultipleSelection(){return this._multiple}_emitChangeEvent(){this._selected=null,(this._selectedToEmit.length||this._deselectedToEmit.length)&&(this.changed.next({source:this,added:this._selectedToEmit,removed:this._deselectedToEmit}),this._deselectedToEmit=[],this._selectedToEmit=[])}_markSelected(o){o=this._getConcreteValue(o),this.isSelected(o)||(this._multiple||this._unmarkAll(),this.isSelected(o)||this._selection.add(o),this._emitChanges&&this._selectedToEmit.push(o))}_unmarkSelected(o){o=this._getConcreteValue(o),this.isSelected(o)&&(this._selection.delete(o),this._emitChanges&&this._deselectedToEmit.push(o))}_unmarkAll(){this.isEmpty()||this._selection.forEach(o=>this._unmarkSelected(o))}_verifyValueAssignment(o){}_hasQueuedChanges(){return!(!this._deselectedToEmit.length&&!this._selectedToEmit.length)}_getConcreteValue(o,t){if(this.compareWith){t=t??this._selection;for(let n of t)if(this.compareWith(o,n))return n;return o}return o}}var x=r(3648),ue=r(6920);const pe=(i,o)=>o.uuid;function me(i,o){if(1&i){const t=e.KQA();e.I0R(0,"tr")(1,"td")(2,"pa-checkbox",3),e.qCj("valueChange",function(){const c=e.usT(t).$implicit,a=e.GaO();return e.CGJ(a.toggle(c))}),e.OEk(3),e.C$Y()()()}if(2&i){const t=o.$implicit,n=e.GaO();e.yG2(2),e.E7m("value",n.selection.isSelected(t)),e.yG2(),e.oRS(" ",t.title," ")}}function fe(i,o){1&i&&e.wR5(0,"nsi-spinner")}let ye=(()=>{class i{constructor(t,n,s){this.syncService=t,this.toast=n,this.cdr=s,this.done=new e._w7,this.loading=!1,this.query="",this.selection=new he(!0,[]),this.triggerSearch=new w.E,this.canSelectFiles=this.syncService.currentSourceId.pipe((0,C.k)(c=>this.syncService.canSelectFiles(c||""))),this.resources=this.triggerSearch.pipe((0,G.y)(()=>{this.loading=!0,this.cdr.markForCheck()}),(0,h.G)(()=>this.syncService.getFolders(this.query).pipe((0,Y.a)(c=>(c&&this.toast.error("string"==typeof c?c:c.error?.message||c.error||c.message||"An error occurred"),(0,T.of)({items:[],nextPage:void 0})))).pipe((0,G.y)(()=>{this.loading=!1,this.cdr.markForCheck()}),(0,ce.K)((c,a)=>c.concat(a.items),[]))),(0,re.o)())}ngOnInit(){(0,ae.y)([this.syncService.getCurrentSync().pipe((0,u.U)(1)),this.resources.pipe((0,u.U)(1))]).subscribe(([t,n])=>{t.foldersToSync?.forEach(s=>{const c=n.find(a=>a.uuid===s.uuid);c&&this.selection.select(c)}),this.cdr.detectChanges()})}ngAfterViewInit(){setTimeout(()=>{this.triggerSearch.next()},200)}save(){this.syncService.currentSourceId.pipe((0,u.U)(1),(0,h.G)(t=>this.syncService.updateSync(t||"",{foldersToSync:this.selection.selected},!0))).subscribe({next:()=>{this.toast.success("upload.saved"),this.done.emit()},error:()=>{this.toast.error("upload.failed")}})}toggle(t){this.selection.toggle(t),this.cdr.detectChanges()}static#e=this.\u0275fac=function(n){return new(n||i)(e.GI1(_.gH),e.GI1(S.Q$),e.GI1(e.kD9))};static#t=this.\u0275cmp=e.In1({type:i,selectors:[["nsy-edit-folders"]],outputs:{done:"done"},decls:10,vars:6,consts:[[1,"body"],[1,"actions"],["qa","save-button",3,"click"],[3,"value","valueChange"]],template:function(n,s){1&n&&(e.I0R(0,"div",0)(1,"table"),e.c53(2,me,4,2,"tr",null,pe),e.wVc(4,"async"),e.C$Y()(),e.yuY(5,fe,1,0,"nsi-spinner"),e.I0R(6,"div",1)(7,"pa-button",2),e.qCj("click",function(){return s.save()}),e.OEk(8),e.wVc(9,"translate"),e.C$Y()()),2&n&&(e.yG2(2),e.oho(e.kDX(4,2,s.resources)),e.yG2(3),e.C0Y(5,s.loading?5:-1),e.yG2(3),e.oRS(" ",e.kDX(9,4,"action.save")," "))},dependencies:[k.k,x.K,ue.i,b.a,v.sD],styles:['@charset "UTF-8";.body[_ngcontent-%COMP%]{overflow-y:auto}table[_ngcontent-%COMP%]{border-spacing:0;margin-top:.5rem;width:calc(100% - 1rem)}td[_ngcontent-%COMP%]{align-items:center;border-bottom:1px solid hsl(0,0%,44%);display:flex;height:2rem;transition:color .16s ease-in-out}td[_ngcontent-%COMP%]   .disabled[_ngcontent-%COMP%]{color:#c4c4c4;padding-left:1.75rem}.parameters[_ngcontent-%COMP%], .actions[_ngcontent-%COMP%]{margin-top:2rem}'],changeDetection:0})}return i})();var Ce=r(6936),Se=r(8532);function ge(i,o){if(1&i){const t=e.KQA();e.I0R(0,"label",0),e.OEk(1),e.wVc(2,"translate"),e.C$Y(),e.I0R(3,"div",1)(4,"nsi-labels-expander",2),e.qCj("updateSelection",function(s){e.usT(t);const c=e.GaO();return e.CGJ(c.updateLabelSelection(s))}),e.wVc(5,"async"),e.C$Y()(),e.I0R(6,"div",3)(7,"pa-button",4),e.qCj("click",function(){e.usT(t);const s=e.GaO();return e.CGJ(s.save())}),e.OEk(8),e.wVc(9,"translate"),e.C$Y()()}if(2&i){const t=e.GaO();e.yG2(),e.oRS(" ",e.kDX(2,4,"upload.labels")," "),e.yG2(3),e.E7m("labelSets",e.kDX(5,6,t.labelSets))("currentSelection",t.currentSelection),e.yG2(4),e.oRS(" ",e.kDX(9,8,"action.save")," ")}}function _e(i,o){1&i&&(e.I0R(0,"div",5),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&i&&(e.yG2(),e.oRS(" ",e.kDX(2,1,"upload.no-labels")," "))}let ve=(()=>{class i{constructor(t,n,s,c){this.syncService=t,this.sdk=n,this.toast=s,this.cdr=c,this.done=new e._w7,this.labelSets=this.sdk.currentKb.pipe((0,u.U)(1),(0,h.G)(a=>a.getLabels()),(0,C.k)(a=>Object.entries(a).filter(([,d])=>0===d.kind.length||d.kind.includes(Ce.MI.RESOURCES)).reduce((d,[m,p])=>({...d,[m]:p}),{}))),this.hasLabelSets=this.labelSets.pipe((0,C.k)(a=>Object.keys(a||{}).length>0)),this.currentSelection={},this.selectedLabels=[]}ngOnInit(){this.syncService.getCurrentSync().pipe((0,u.U)(1)).subscribe(t=>this.updateLabelSelection((t.labels||[]).reduce((n,s)=>({...n,[(0,S.gn)(s.labelset,s.label)]:!0}),{})))}save(){this.syncService.currentSourceId.pipe((0,u.U)(1),(0,h.G)(t=>this.syncService.updateSync(t||"",{labels:this.selectedLabels}))).subscribe({next:()=>{this.toast.success("upload.saved"),this.done.emit()},error:()=>{this.toast.error("upload.failed")}})}updateLabelSelection(t){this.currentSelection=t,this.selectedLabels=(0,S.OS)(t),this.cdr.detectChanges()}static#e=this.\u0275fac=function(n){return new(n||i)(e.GI1(_.gH),e.GI1(O.E3),e.GI1(S.Q$),e.GI1(e.kD9))};static#t=this.\u0275cmp=e.In1({type:i,selectors:[["nsy-edit-labels"]],outputs:{done:"done"},decls:3,vars:3,consts:[["for","label-expander",1,"body-m"],[1,"labels-container"],["id","label-expander",3,"labelSets","currentSelection","updateSelection"],[1,"actions"],["qa","save-button",3,"click"],[1,"body-m"]],template:function(n,s){1&n&&(e.yuY(0,ge,10,10),e.wVc(1,"async"),e.yuY(2,_e,3,3)),2&n&&e.C0Y(0,e.kDX(1,1,s.hasLabelSets)?0:2)},dependencies:[k.k,Se.l,b.a,v.sD],styles:['@charset "UTF-8";.actions[_ngcontent-%COMP%]{margin-top:2rem}'],changeDetection:0})}return i})();var be=r(5116);let ke=(()=>{class i{constructor(t,n,s){this.syncService=t,this.toast=n,this.cdr=s,this.done=new e._w7,this.filtersForm=new l.WC({fileExtensions:new l.Ku(""),exclude:new l.Ku(!1),fromDate:new l.Ku(""),toDate:new l.Ku("")})}ngOnInit(){this.syncService.getCurrentSync().pipe((0,u.U)(1)).subscribe(t=>{this.filtersForm.setValue({fileExtensions:t.filters?.fileExtensions?.extensions||"",exclude:t.filters?.fileExtensions?.exclude||!1,fromDate:t.filters?.modified?.from||"",toDate:t.filters?.modified?.to||""}),this.cdr.markForCheck()})}save(){const t={};this.filtersForm.value.fileExtensions&&(t.fileExtensions={extensions:this.filtersForm.value.fileExtensions,exclude:!!this.filtersForm.value.exclude}),(this.filtersForm.value.fromDate||this.filtersForm.value.toDate)&&(t.modified={from:this.filtersForm.value.fromDate||void 0,to:this.filtersForm.value.toDate||void 0}),this.syncService.currentSourceId.pipe((0,u.U)(1),(0,h.G)(n=>this.syncService.updateSync(n||"",{filters:t},!0))).subscribe({next:()=>{this.toast.success("upload.saved"),this.done.emit()},error:()=>{this.toast.error("upload.failed")}})}static#e=this.\u0275fac=function(n){return new(n||i)(e.GI1(_.gH),e.GI1(S.Q$),e.GI1(e.kD9))};static#t=this.\u0275cmp=e.In1({type:i,selectors:[["nsy-edit-filters"]],outputs:{done:"done"},decls:24,vars:19,consts:[[3,"formGroup","ngSubmit"],[1,"title-m"],[1,"field"],["formControlName","fileExtensions","help","upload.filters.extensions-help",3,"placeholder"],["help","upload.filters.exclude-help","formControlName","exclude"],["formControlName","fromDate","label","upload.filters.modified-from"],["formControlName","toDate","label","upload.filters.modified-to"],[1,"actions"],["qa","save-button",3,"click"]],template:function(n,s){1&n&&(e.I0R(0,"form",0),e.qCj("ngSubmit",function(){return s.save()}),e.I0R(1,"h3",1),e.OEk(2),e.wVc(3,"translate"),e.C$Y(),e.I0R(4,"div",2)(5,"pa-input",3),e.wVc(6,"translate"),e.OEk(7),e.wVc(8,"translate"),e.C$Y()(),e.I0R(9,"div",2)(10,"pa-checkbox",4),e.OEk(11),e.wVc(12,"translate"),e.C$Y()(),e.I0R(13,"div",2)(14,"h3",1),e.OEk(15),e.wVc(16,"translate"),e.C$Y(),e.wR5(17,"pa-date-picker",5),e.C$Y(),e.I0R(18,"div",2),e.wR5(19,"pa-date-picker",6),e.C$Y(),e.I0R(20,"div",7)(21,"pa-button",8),e.qCj("click",function(){return s.save()}),e.OEk(22),e.wVc(23,"translate"),e.C$Y()()()),2&n&&(e.E7m("formGroup",s.filtersForm),e.yG2(2),e.cNF(e.kDX(3,7,"upload.filters.extensions")),e.yG2(3),e.E7m("placeholder",e.kDX(6,9,"upload.filters.extensions-placeholder")),e.yG2(2),e.oRS(" ",e.kDX(8,11,"upload.filters.extensions")," "),e.yG2(4),e.oRS(" ",e.kDX(12,13,"upload.filters.exclude")," "),e.yG2(4),e.cNF(e.kDX(16,15,"upload.filters.modified")),e.yG2(7),e.oRS(" ",e.kDX(23,17,"action.save")," "))},dependencies:[l.sz,l.ue,l.u,l.uW,l.Wo,R.g,k.k,x.K,be.C,v.sD],styles:['@charset "UTF-8";h3[_ngcontent-%COMP%], .actions[_ngcontent-%COMP%]{margin-top:2rem}.field[_ngcontent-%COMP%]{margin:1rem 0}'],changeDetection:0})}return i})();function Ee(i,o){if(1&i){const t=e.KQA();e.I0R(0,"pa-tab",4),e.qCj("click",function(){e.usT(t);const s=e.GaO();return e.CGJ(s.selectedTab="folders")}),e.OEk(1),e.wVc(2,"translate"),e.C$Y()}if(2&i){const t=e.GaO();e.E7m("active","folders"===t.selectedTab),e.yG2(),e.oRS(" ",e.kDX(2,2,"upload.tabs.folders")," ")}}function Ge(i,o){1&i&&(e.I0R(0,"section"),e.wR5(1,"nsy-activity"),e.C$Y())}function Ie(i,o){if(1&i){const t=e.KQA();e.I0R(0,"section")(1,"nsy-edit-folders",6),e.qCj("done",function(){e.usT(t);const s=e.GaO();return e.CGJ(s.done())}),e.C$Y()()}}function Te(i,o){if(1&i){const t=e.KQA();e.I0R(0,"section")(1,"nsy-edit-filters",6),e.qCj("done",function(){e.usT(t);const s=e.GaO();return e.CGJ(s.done())}),e.C$Y()()}}function De(i,o){if(1&i){const t=e.KQA();e.I0R(0,"section")(1,"nsy-edit-labels",6),e.qCj("done",function(){e.usT(t);const s=e.GaO();return e.CGJ(s.done())}),e.C$Y()()}}function Oe(i,o){if(1&i){const t=e.KQA();e.I0R(0,"section")(1,"nsy-edit-settings",6),e.qCj("done",function(){e.usT(t);const s=e.GaO();return e.CGJ(s.done())}),e.C$Y()()}}let Re=(()=>{class i{constructor(t,n,s,c,a){this.syncService=t,this.router=n,this.toast=s,this.cdr=c,this.route=a,this.currentSync=this.syncService.getCurrentSync(),this.connector=this.currentSync.pipe((0,h.G)(d=>this.syncService.connectorsObs.pipe((0,C.k)(m=>m.find(p=>p.id===d.connector.name))))),this.canSelectFiles=this.syncService.getCurrentSync().pipe((0,C.k)(d=>this.syncService.canSelectFiles(d.id||""))),this.selectedTab="activity",this.unsubscribeAll=new w.E}ngOnInit(){this.route.paramMap.subscribe(t=>{this.syncService.setCurrentSourceId(t.get("id")||"")}),this.router.events.pipe((0,I.I)(t=>t instanceof y.MT),(0,C.k)(t=>t.url.split("/upload/sync/")[1]?.split("/")[0]),(0,V.a)(this.unsubscribeAll)).subscribe(t=>{this.syncService.setCurrentSourceId(t),this.selectedTab="activity",this.cdr.markForCheck()}),this.currentSync.pipe((0,u.U)(1),(0,h.G)(t=>this.syncService.hasCurrentSourceAuth().pipe((0,I.I)(n=>!n),(0,h.G)(()=>this.syncService.getConnector(t.connector.name,t.id)),(0,h.G)(n=>this.syncService.authenticateToConnector(t.connector.name,n))))).subscribe({next:()=>{this.toast.success("upload.authentication.success"),this.router.navigate([],{queryParams:{}})},error:()=>this.toast.error("upload.authentication.failed")})}ngOnDestroy(){this.unsubscribeAll.next(),this.unsubscribeAll.complete()}delete(){this.syncService.currentSourceId.pipe((0,u.U)(1),(0,h.G)(t=>this.syncService.deleteSync(t||""))).subscribe({next:()=>{const t=this.router.url.split("/upload/")[0];this.router.navigate([`${t}/upload`])},error:()=>{this.toast.error("upload.deletion-failed")}})}done(){this.selectedTab="activity",this.cdr.markForCheck()}static#e=this.\u0275fac=function(n){return new(n||i)(e.GI1(_.gH),e.GI1(y.E5),e.GI1(S.Q$),e.GI1(e.kD9),e.GI1(y.gV))};static#t=this.\u0275cmp=e.In1({type:i,selectors:[["ng-component"]],decls:29,vars:33,consts:[[1,"header"],[3,"src","alt"],[1,"actions"],["icon","trash","aspect","basic",3,"click"],[3,"active","click"],[3,"active"],[3,"done"]],template:function(n,s){if(1&n&&(e.I0R(0,"div",0)(1,"h2"),e.wR5(2,"img",1),e.wVc(3,"async"),e.wVc(4,"async"),e.OEk(5),e.wVc(6,"async"),e.C$Y(),e.I0R(7,"div",2)(8,"pa-button",3),e.qCj("click",function(){return s.delete()}),e.C$Y()()(),e.I0R(9,"pa-tabs")(10,"pa-tab",4),e.qCj("click",function(){return s.selectedTab="activity"}),e.OEk(11),e.wVc(12,"translate"),e.C$Y(),e.yuY(13,Ee,3,4,"pa-tab",5),e.wVc(14,"async"),e.I0R(15,"pa-tab",4),e.qCj("click",function(){return s.selectedTab="filters"}),e.OEk(16),e.wVc(17,"translate"),e.C$Y(),e.I0R(18,"pa-tab",4),e.qCj("click",function(){return s.selectedTab="labels"}),e.OEk(19),e.wVc(20,"translate"),e.C$Y(),e.I0R(21,"pa-tab",4),e.qCj("click",function(){return s.selectedTab="settings"}),e.OEk(22),e.wVc(23,"translate"),e.C$Y()(),e.yuY(24,Ge,2,0,"section")(25,Ie,2,0,"section")(26,Te,2,0,"section")(27,De,2,0,"section")(28,Oe,2,0,"section")),2&n){let c,a,d;e.yG2(2),e.E7m("src",null==(c=e.kDX(3,17,s.connector))?null:c.logo,e.K6U)("alt",(null==(a=e.kDX(4,19,s.connector))?null:a.title)+" logo"),e.yG2(3),e.oRS(" ",null==(d=e.kDX(6,21,s.currentSync))?null:d.title," "),e.yG2(5),e.E7m("active","activity"===s.selectedTab),e.yG2(),e.oRS(" ",e.kDX(12,23,"upload.tabs.activity")," "),e.yG2(2),e.C0Y(13,e.kDX(14,25,s.canSelectFiles)?13:-1),e.yG2(2),e.E7m("active","filters"===s.selectedTab),e.yG2(),e.oRS(" ",e.kDX(17,27,"upload.tabs.filters")," "),e.yG2(2),e.E7m("active","labels"===s.selectedTab),e.yG2(),e.oRS(" ",e.kDX(20,29,"upload.tabs.labels")," "),e.yG2(2),e.E7m("active","settings"===s.selectedTab),e.yG2(),e.oRS(" ",e.kDX(23,31,"upload.tabs.settings")," "),e.yG2(2),e.C0Y(24,"activity"===s.selectedTab?24:-1),e.yG2(),e.C0Y(25,"folders"===s.selectedTab?25:-1),e.yG2(),e.C0Y(26,"filters"===s.selectedTab?26:-1),e.yG2(),e.C0Y(27,"labels"===s.selectedTab?27:-1),e.yG2(),e.C0Y(28,"settings"===s.selectedTab?28:-1)}},dependencies:[k.k,U.U,P.Y,Z,oe,ye,ve,ke,b.a,v.sD],styles:['@charset "UTF-8";.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:1rem}h2[_ngcontent-%COMP%]{display:flex}h2[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:2rem;margin-right:1rem}section[_ngcontent-%COMP%]{margin-top:2rem}'],changeDetection:0})}return i})();const we=(i,o)=>o.id;function Fe(i,o){if(1&i&&(e.I0R(0,"pa-input",7),e.wVc(1,"translate"),e.OEk(2),e.wVc(3,"translate"),e.C$Y()),2&i){const t=e.GaO().$implicit;e.E7m("help",t.help?e.kDX(1,4,t.help):void 0)("placeholder",t.placeholder)("formControlName",t.id),e.yG2(2),e.oRS(" ",e.kDX(3,6,t.label)," ")}}function Ve(i,o){if(1&i&&(e.I0R(0,"pa-textarea",8),e.wVc(1,"translate"),e.OEk(2),e.wVc(3,"translate"),e.C$Y()),2&i){const t=e.GaO().$implicit;e.E7m("help",t.help?e.kDX(1,3,t.help):void 0)("formControlName",t.id),e.yG2(2),e.oRS(" ",e.kDX(3,5,t.label)," ")}}function Ye(i,o){if(1&i&&(e.I0R(0,"div",6),e.yuY(1,Fe,4,8,"pa-input",7)(2,Ve,4,7,"pa-textarea",8),e.C$Y()),2&i){const t=o.$implicit;e.yG2(),e.C0Y(1,"text"===t.type?1:-1),e.yG2(),e.C0Y(2,"textarea"===t.type?2:-1)}}function $e(i,o){if(1&i){const t=e.KQA();e.I0R(0,"form",2),e.qCj("ngSubmit",function(){e.usT(t);const s=e.GaO();return e.CGJ(s.save())}),e.I0R(1,"div",3)(2,"pa-input",4),e.OEk(3),e.wVc(4,"translate"),e.C$Y()(),e.c53(5,Ye,3,2,"div",9,we),e.I0R(7,"pa-button",5),e.OEk(8),e.wVc(9,"translate"),e.C$Y()()}if(2&i){const t=e.GaO();e.E7m("formGroup",t.form),e.yG2(3),e.oRS(" ",e.kDX(4,4,"upload.source.name")," "),e.yG2(2),e.oho(t.fields),e.yG2(2),e.E7m("disabled",!t.form.valid),e.yG2(),e.oRS(" ",e.kDX(9,6,"action.save")," ")}}const xe=new RegExp(/[^a-z0-9_-]/g),Me=[{path:"",children:[{path:"setup/server",component:X},{path:"add/:connector",component:(()=>{class i{constructor(t,n,s,c,a,d,m){this.syncService=t,this.toast=n,this.formBuilder=s,this.cdr=c,this.router=a,this.route=d,this.sdk=m,this.connectorId=(this.sdk.nuclia.options.standalone?location.hash:location.pathname).split("/upload/sync/add/")[1]||"",this.connector=this.syncService.connectorsObs.pipe((0,C.k)(p=>p.find(g=>g.id===this.connectorId)))}ngOnInit(){this.syncService.getConnector(this.connectorId,"").pipe((0,u.U)(1),(0,h.G)(t=>t.getParameters())).subscribe(t=>this.showFields(t))}save(){const t=this.form?.value.title,n=this.form?.value.fields;let s=t?.toLowerCase().replace(xe,"-");this.sdk.currentKb.pipe((0,u.U)(1),(0,h.G)(c=>(s=`${c.id}-${s}`,this.syncService.addSync({id:s,connector:{name:this.connectorId||"",parameters:n},title:t}))),(0,G.y)(()=>this.syncService.setCurrentSourceId(s)),(0,h.G)(()=>this.syncService.getConnector(this.connectorId,s).pipe((0,u.U)(1))),(0,h.G)(c=>c.allowToSelectFolders?(0,T.of)(c):("function"==typeof c.handleParameters&&c.handleParameters(n),this.syncService.updateSync(s,{foldersToSync:c.getStaticFolders()}).pipe((0,h.G)(()=>this.syncService.getConnector(this.connectorId,s).pipe((0,u.U)(1)))))),(0,G.y)(c=>{if(c.hasServerSideAuth){let a=location.href.split("/upload/sync/add/")[0];this.sdk.nuclia.options.standalone&&(a=a.replace("#/","")),c.goToOAuth(`${a}/upload/sync/${s}`,!0)}else this.router.navigate([`../../${s}`],{relativeTo:this.route})})).subscribe({next:()=>{this.toast.success("upload.saved")},error:c=>{console.warn(c),this.toast.error("upload.failed")}})}showFields(t){this.fields=t,this.form=this.formBuilder.group({title:["",[l.AQ.required]],fields:this.formBuilder.group(t.reduce((n,s)=>({...n,[s.id]:["",this.getFieldValidators(s)]}),{}))}),this.cdr.markForCheck()}getFieldValidators(t){const n=[];return t.required&&n.push(l.AQ.required),t.pattern&&n.push(l.AQ.pattern(t.pattern)),n}static#e=this.\u0275fac=function(n){return new(n||i)(e.GI1(_.gH),e.GI1(S.Q$),e.GI1(l.KE),e.GI1(e.kD9),e.GI1(y.E5),e.GI1(y.gV),e.GI1(O.E3))};static#t=this.\u0275cmp=e.In1({type:i,selectors:[["ng-component"]],decls:7,vars:10,consts:[[3,"src","alt"],["qa","fields-form",3,"formGroup"],["qa","fields-form",3,"formGroup","ngSubmit"],[1,"field"],["formControlName","title"],["qa","save-button","type","submit",3,"disabled"],["formGroupName","fields",1,"field"],[3,"help","placeholder","formControlName"],[3,"help","formControlName"],["formGroupName","fields","class","field"]],template:function(n,s){if(1&n&&(e.I0R(0,"h2"),e.wR5(1,"img",0),e.wVc(2,"async"),e.wVc(3,"async"),e.OEk(4),e.wVc(5,"async"),e.C$Y(),e.yuY(6,$e,10,8,"form",1)),2&n){let c,a,d;e.yG2(),e.E7m("src",null==(c=e.kDX(2,4,s.connector))?null:c.logo,e.K6U)("alt",(null==(a=e.kDX(3,6,s.connector))?null:a.title)+" logo"),e.yG2(3),e.oRS(" ",null==(d=e.kDX(5,8,s.connector))?null:d.title,"\n"),e.yG2(2),e.C0Y(6,s.fields&&s.form?6:-1)}},dependencies:[l.sz,l.ue,l.u,l.uW,l.Wo,l.Kh,R.g,$.a,k.k,b.a,v.sD],styles:['@charset "UTF-8";h2[_ngcontent-%COMP%]{display:flex}h2[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:2rem;margin-right:1rem}.field[_ngcontent-%COMP%]{margin:1rem 0}.field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem}'],changeDetection:0})}return i})()},{path:":id",component:Re}]}];let Ae=(()=>{class i{static#e=this.\u0275fac=function(n){return new(n||i)};static#t=this.\u0275mod=e.a4G({type:i});static#n=this.\u0275inj=e.s3X({imports:[y.qQ.forChild(Me),y.qQ]})}return i})();var Xe=r(9132),f=r(6696);let Ue=(()=>{class i{static#e=this.\u0275fac=function(n){return new(n||i)};static#t=this.\u0275mod=e.a4G({type:i});static#n=this.\u0275inj=e.s3X({imports:[y.qQ,b.MD,v.O0,Xe.Y,l.y,l.sl,f.HV,f.qC,f.AL,f.Yh,f.aU,S.In,O.Cc,S.l2,f.Zj,f.sL,f.ek,f.I7]})}return i})(),Pe=(()=>{class i{static#e=this.\u0275fac=function(n){return new(n||i)};static#t=this.\u0275mod=e.a4G({type:i});static#n=this.\u0275inj=e.s3X({imports:[b.MD,v.O0,f.qC,f.HV,f.Yh,l.sl]})}return i})(),Ne=(()=>{class i{static#e=this.\u0275fac=function(n){return new(n||i)};static#t=this.\u0275mod=e.a4G({type:i});static#n=this.\u0275inj=e.s3X({imports:[b.MD,Ae,Ue,Pe]})}return i})()}}]);