"use strict";(self.webpackChunk_secretflow_secretnote=self.webpackChunk_secretflow_secretnote||[]).push([[47],{25069:function(_i,cn,m){m.r(cn),m.d(cn,{default:function(){return qi}});var eo=m(83109),$r=m(43256),Ar=m(45362),ze=m(20904),Rr=m(31300),dn=m(40256),w=m(58601),Se=m(84880),Zr=m(90819),f=m.n(Zr),Dr=m(89933),y=m.n(Dr),zr=m(78796),R=m.n(zr),Vr=m(4977),Z=m.n(Vr),Hr=m(10154),h=m.n(Hr),j=m(47302),Te=Symbol("SQLCellModelFactory"),Wr=m(73193),N=m.n(Wr),xr=m(26336),_=m.n(xr),Qr=m(41553),C=m.n(Qr),Br=m(78846),fn=m.n(Br),Jr=m(54088),mn=m.n(Jr),Yr=m(49488),oe=m.n(Yr),Gr=m(84047),ue=m.n(Gr),Kr=m(62055),ee=m.n(Kr),no=m(23202),$=m(38168),me=m(91798),K=m(53353),Ve=m(7317),ge=m(17313),ne=m(58757),Ur=m(31025),Xr=m(92416),vn=m(79239),He=m(28582),D=m(23574),I=m(95881),qr=m(98612),_r=m(86919),M=m(17),je=null,Ne={},pn=function(){var e=location.pathname.split("/");return e[e.length-1]},hn=function(){var o=y()(f()().mark(function e(){return f()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!je){r.next=4;break}return r.next=3,je;case 3:return r.abrupt("return",r.sent);case 4:return je=new Promise(function(n,i){(0,I.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"getDataTables",project_id:pn()})}).then(function(a){var s=a.map(function(c){return{name:c.table_name,owner:c.table_owner,columns:c.columns}});n(s)}).catch(function(a){i(a)})}),r.next=7,je;case 7:return r.abrupt("return",r.sent);case 8:case"end":return r.stop()}},e)}));return function(){return o.apply(this,arguments)}}(),We=function(){var o=y()(f()().mark(function e(t){return f()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!Ne[t]){n.next=4;break}return n.next=3,Ne[t];case 3:return n.abrupt("return",n.sent);case 4:return Ne[t]=new Promise(function(i,a){(0,I.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"getTableCCL",project_id:pn(),table_name:t})}).then(function(s){var c=[];s.forEach(function(l){var p=l.col.column_name,d=l.party_code,b=l.constraint,v=c.find(function(T){return T.column===p});v?v[d]=b:c.push(h()({column:p},d,b))}),i(c)}).catch(function(s){a(s)})}),n.next=7,Ne[t];case 7:return n.abrupt("return",n.sent);case 8:case"end":return n.stop()}},e)}));return function(t){return o.apply(this,arguments)}}(),xe=function(e){return e.length<1?"":`
  <table border="1" class="dataframe">
    <thead>
      <tr>
        `.concat(Object.keys(e[0]).map(function(t){return"<th>".concat(t,"</th>")}).join(`
`),`
      </tr>
    </thead>
    <tbody>
      `).concat(e.map(function(t){return`<tr>
              `.concat(Object.keys(t).map(function(r){return"<td>".concat(t[r],"</td>")}).join(`
`),`
            </tr>`)}).join(`
`),`
    </tbody>
  </table>
  `)},ea=function(){var o=y()(f()().mark(function e(){var t;return f()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,hn();case 2:return t=n.sent,n.abrupt("return",t.map(function(i){return{label:i.name,insertText:i.name,sortText:"A".concat(i.name),kind:D.Mj.CompletionItemKind.Folder,detail:i.owner}}));case 4:case"end":return n.stop()}},e)}));return function(){return o.apply(this,arguments)}}(),Oe=function(){var o=y()(f()().mark(function e(t){var r,n;return f()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return r=M.Z(t,"tableName.value",""),a.next=3,hn();case 3:if(n=a.sent.find(function(s){return s.name===r}),n){a.next=6;break}return a.abrupt("return",[]);case 6:return a.abrupt("return",n.columns.map(function(s){return{label:s.name,insertText:s.name,sortText:"B".concat(s.name),kind:D.Mj.CompletionItemKind.Field,detail:s.dtype}}));case 7:case"end":return a.stop()}},e)}));return function(t){return o.apply(this,arguments)}}(),gn=function(e){return Promise.resolve(["SUM","COUNT","AVG"].map(function(t){return{label:t,insertText:t,sortText:"C".concat(t),kind:D.Mj.CompletionItemKind.Function}}))},na=function(e){return{label:e,insertText:e,sortText:"D".concat(e),kind:D.Mj.CompletionItemKind.Folder}},ta=function(){var o=y()(f()().mark(function e(){var t,r,n,i,a,s=arguments;return f()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:for(t=s.length,r=new Array(t),n=0;n<t;n++)r[n]=s[n];if(i=M.Z(r,"[0].tableInfo.tableName.value",""),i){l.next=4;break}return l.abrupt("return",[]);case 4:return l.next=6,We(i);case 6:if(a=l.sent,a&&a.length){l.next=9;break}return l.abrupt("return",[]);case 9:return l.abrupt("return",[{value:xe(a),supportHtml:!0,isTrusted:!0}]);case 10:case"end":return l.stop()}},e)}));return function(){return o.apply(this,arguments)}}(),bn=function(){var o=y()(f()().mark(function e(){var t,r,n,i,a,s=arguments;return f()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(s.length!==2){l.next=23;break}if(t=s.length<=0?void 0:s[0],r=s.length<=1?void 0:s[1],!t){l.next=23;break}if(r!==null){l.next=13;break}return l.next=7,We(t);case 7:if(n=l.sent,n&&n.length){l.next=10;break}return l.abrupt("return",[]);case 10:return l.abrupt("return",[{value:xe(n),supportHtml:!0,isTrusted:!0}]);case 13:if(!(r&&r.groupPickerName)){l.next=23;break}return l.next=16,We(r.groupPickerName);case 16:if(i=l.sent,i&&i.length){l.next=19;break}return l.abrupt("return",[]);case 19:if(a=i.find(function(p){return p.column===t}),a){l.next=22;break}return l.abrupt("return",[]);case 22:return l.abrupt("return",[{value:xe([a]),supportHtml:!0,isTrusted:!0}]);case 23:return l.abrupt("return",[]);case 24:case"end":return l.stop()}},e)}));return function(){return o.apply(this,arguments)}}(),ra=function(){return Promise.resolve([])},aa=m(12689),ia=m(83788),oa=m(67876);function Qe(o,e){return Be.apply(this,arguments)}function Be(){return Be=y()(f()().mark(function o(e,t){var r,n,i;return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(e){s.next=2;break}return s.abrupt("return",null);case 2:if(r=M.Z(e,t),n=t.slice().pop(),i=M.Z(e,t.slice(0,t.length-1)),i){s.next=7;break}return s.abrupt("return",null);case 7:return s.next=9,yn(i,function(){var c=y()(f()().mark(function l(p){return f()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:b.t0=p,b.next=b.t0==="identifier.tableName"?3:b.t0==="identifier.column"?4:b.t0==="identifier.columnAfterGroup"?7:b.t0==="function"?8:9;break;case 3:return b.abrupt("return",{type:"tableName",variant:n,token:r,tableInfo:i});case 4:if(n!=="name"){b.next=6;break}return b.abrupt("return",{type:"tableField",token:r});case 6:return b.abrupt("return",null);case 7:return b.abrupt("return",{type:"tableFieldAfterGroup",token:r,groupName:i.groupName.value});case 8:return b.abrupt("return",{type:"functionName",token:r});case 9:case"end":return b.stop()}},l)}));return function(l){return c.apply(this,arguments)}}());case 9:return s.abrupt("return",s.sent);case 10:case"end":return s.stop()}},o)})),Be.apply(this,arguments)}function Je(o,e,t){if(!o||e.length===0)return null;var r=M.Z(o,e);if(!r)throw Error("Path not found from ast!");if(!r.token&&r.type==="statement")if(t){if(t(r)===!0)return r}else return r;return e.length>1?Je(o,e.slice(0,e.length-1),t):null}function Ye(o,e,t){return Ge.apply(this,arguments)}function Ge(){return Ge=y()(f()().mark(function o(e,t,r){var n,i,a,s;return f()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,Qe(e,t);case 2:if(n=l.sent,i=Je(e,t),!(!n||!i)){l.next=6;break}return l.abrupt("return",[]);case 6:l.t0=i.variant,l.next=l.t0==="select"?9:l.t0==="join"?10:16;break;case 9:return l.abrupt("return",Fe(i,M.Z(i,"from.sources",[]),n,r));case 10:if(a=t.slice(),a.pop(),s=Je(e,a,function(p){return p.variant==="select"}),s){l.next=15;break}return l.abrupt("return",[]);case 15:return l.abrupt("return",Fe(s,M.Z(s,"from.sources",[]),n,r));case 16:return l.abrupt("return",[]);case 17:case"end":return l.stop()}},o)})),Ge.apply(this,arguments)}function Fe(o,e,t,r){return Ke.apply(this,arguments)}function Ke(){return Ke=y()(f()().mark(function o(e,t,r,n){var i;return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,Promise.all(t.map(function(c){return Ue(e,c,r,n)}));case 2:return i=s.sent,s.abrupt("return",aa.Z(i).filter(function(c){return!!c}));case 4:case"end":return s.stop()}},o)})),Ke.apply(this,arguments)}function Ue(o,e,t,r){return Xe.apply(this,arguments)}function Xe(){return Xe=y()(f()().mark(function o(e,t,r,n){return f()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",yn(t,function(){var s=y()(f()().mark(function c(l){var p,d,b,v,T,E,S,x,A,Q,he;return f()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:k.t0=l,k.next=k.t0==="statement.tableSource"?3:k.t0==="statement.join"?15:k.t0==="identifier.table"?16:k.t0==="statement.select"?26:34;break;case 3:return k.next=5,Ue(e,t.source,r,n);case 5:if(p=k.sent,!ia.Z(t.joins)){k.next=12;break}return k.next=9,Fe(e,M.Z(t,"joins",[]),r,n);case 9:k.t1=k.sent,k.next=13;break;case 12:k.t1=[];case 13:return d=k.t1,k.abrupt("return",p.concat(d));case 15:return k.abrupt("return",Ue(e,t.join,r,n));case 16:return b=t,k.next=19,n(b.name,r.token.value,e);case 19:return v=k.sent,T=M.Z(b,"name.tableNames",[]),E=null,S=M.Z(b,"alias.value"),S?E=S:(x=0,T.forEach(function(P){var F=M.Z(b,"name.".concat(P,".value"));F&&(x++,E=F)}),x>1&&(E=null)),v=v.map(function(P){return N()(N()({},P),{},{tableInfo:b.name,groupPickerName:E||"",originFieldName:P.label})}),k.abrupt("return",v);case 26:return A=t,Q=[],k.next=30,Fe(A,A.from.sources,r,n);case 30:return he=k.sent,A.result.length===1&&A.result[0].name.value==="*"?Q=he.slice():Q=he.map(function(P){var F=A.result.find(function(H){return M.Z(H.name,"token")===!0?H.name.value===P.label:M.Z(H.name,"type")==="identifier"&&M.Z(H.name,"variant")==="columnAfterGroup"?M.Z(H.name,"name.value")===P.label:M.Z(H.name,"type")==="identifier"&&M.Z(H.name,"variant")==="groupAll"?M.Z(H.name,"groupName.value")===P.groupPickerName:!1});return F?F.alias?N()(N()({},P),{},{label:F.alias.value}):P:null}).filter(function(P){return P!==null}).slice(),oa.Z(A,"alias.value")&&(Q=Q.map(function(P){return N()(N()({},P),{},{groupPickerName:M.Z(A,"alias.value")})})),k.abrupt("return",Q);case 34:return k.abrupt("return",null);case 35:case"end":return k.stop()}},c)}));return function(c){return s.apply(this,arguments)}}()));case 1:case"end":return a.stop()}},o)})),Xe.apply(this,arguments)}function yn(o,e){return qe.apply(this,arguments)}function qe(){return qe=y()(f()().mark(function o(e,t){return f()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(e){n.next=2;break}return n.abrupt("return",null);case 2:if(!e.variant){n.next=4;break}return n.abrupt("return",t("".concat(e.type,".").concat(e.variant)));case 4:return n.abrupt("return",t(e.type));case 5:case"end":return n.stop()}},o)})),qe.apply(this,arguments)}function Cn(o,e,t,r){return _e.apply(this,arguments)}function _e(){return _e=y()(f()().mark(function o(e,t,r,n){var i,a;return f()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,Ye(e,n,r);case 2:if(i=c.sent,a=i.find(function(l){return l.label===t.token.value}),a){c.next=6;break}return c.abrupt("return",null);case 6:return c.abrupt("return",a);case 7:case"end":return c.stop()}},o)})),_e.apply(this,arguments)}var u=m(23298),ua=(0,u.createLexer)([{type:"whitespace",regexes:[/^(\s+)/],ignore:!0},{type:"comment",regexes:[/^((?:#|--).*?(?:\n|$))/,/^(\/\*[^]*?(?:\*\/|$))/],ignore:!0},{type:"number",regexes:[/^([0-9]+(\.[0-9]+)?|0x[0-9a-fA-F]+|0b[01]+)\b/]},{type:"word",regexes:[/^([a-zA-Z0-9_]+)/,/^(\$\{[a-zA-Z0-9_]+\})/]},{type:"string",regexes:[/^((?=")(?:"[^"\\]*(?:\\[\s\S][^"\\]*)*"))/,/^((?=')(?:'[^'\\]*(?:\\[\s\S][^'\\]*)*'))/,/^((?=`)(?:`[^`\\]*(?:\\[\s\S][^`\\]*)*`))/]},{type:"special",regexes:[/^(\(|\))/,/^(!=|<>|==|<=|>=|!<|!>|\|\||::|->>|->|~~\*|~~|!~~\*|!~~|~\*|!~\*|!~|.)/]}]);function sa(o){var e=function(){return(0,u.chain)(r,t)(function(l){return l[0]})},t=function c(){return(0,u.chain)((0,u.optional)(a,r,c))()},r=function(){return(0,u.chain)(s,n)(function(l){return l[0]})},n=function c(){return(0,u.chain)((0,u.optional)(i,s,c))()},i=function(){return(0,u.chain)(["*","/","%"])(function(l){return l[0]})},a=function(){return(0,u.chain)(["+","-"])(function(l){return l[0]})},s=function(){return(0,u.chain)([(0,u.chain)("(",e,")")(function(l){return l[1]}),o])(function(l){return l[0]})};return e}var la=["select","create","insert","from","where","order","limit","by","sounds","like","is","in","between","regexp","isnull","lateral","left","right","inner","outer","join"],Sn=function(){return(0,u.chain)([(0,u.chain)(["char","varchar","tinytext","text","mediumtext","longtext"])(function(e){return e[0]}),(0,u.chain)(["tinyint","smallint","mediumint","int","integer","bigint"])(function(e){return e[0]}),(0,u.chain)(["real","double","float"])(function(e){return e[0]}),(0,u.chain)(["decimal","numberic"])(function(e){return e[0]}),(0,u.chain)(["date","tinyblob","blob","mediumblob","longblob","bool","boolean"])(function(e){return e[0]}),(0,u.chain)(["bit","time","timestamp","datetime","binary","varbinary","year"])(function(e){return e[0]}),(0,u.chain)(["enum","set"])(function(e){return e[0]}),(0,u.chain)("geometrycollection","linestring","multilinestring","multipoint","multipolygon","point","polygon")(function(e){return e[0]})])(function(e){return e[0]})},wn=function(){return(0,u.chain)(W,"=",[Y,te])()},ca=function(){return(0,u.chain)(wn,(0,u.many)(",",wn))()},W=function(){return(0,u.chain)([(0,u.matchTokenType)("cursor"),(0,u.matchTokenType)("word",{excludes:la})])(function(e){return e[0]})},Y=function(){return(0,u.chain)((0,u.matchTokenType)("string"))(function(e){return e[0]})},te=function(){return(0,u.chain)((0,u.matchTokenType)("number"))(function(e){return e[0]})},ve=function(){return(0,u.chain)([W,Y])(function(e){return e[0]})},da=function(){return(0,u.chain)([W,Y,fa])(function(e){return e[0]})},fa=function(){return(0,u.chain)((0,u.optional)(["-","+"]),te)()},ma=function(){return(0,u.chain)(["and","&&","xor","or","||"])(function(e){return e[0]})},va=function(){return(0,u.chain)(["&&","||"])(function(e){return e[0]})},pa=function(){return(0,u.chain)(["=",">","<","<=",">=","<>","!=","<=>"])(function(e){return e[0]})},ha=function(){return(0,u.chain)(["not","!"])(function(e){return e[0]})},ga=function(){return(0,u.chain)(["all","distinct","distinctrow","high_priority","straight_join","sql_small_result","sql_big_result","sql_buffer_result","sql_cache","sql_no_cache","sql_calc_found_rows"])(function(e){return e[0]})};function ba(o){return o!=null}function we(o){return o.filter(function(e){return ba(e)}).reduce(function(e,t){return e.concat(t)},[])}function En(o){var e={type:"identifier",variant:"tableName"};return Object.keys(o).forEach(function(t){e[t]=o[t]}),e.tableNames=Object.keys(o),e}var ya=function(){return(0,u.chain)(Ca,(0,u.optional)(";"))(function(e){return e[0]})},Ca=function(){return(0,u.chain)(kn,(0,u.many)((0,u.chain)(";",kn)(function(e){return e[1]})))(we)},kn=function(){return(0,u.chain)([be,Na,La,Ia,Ya,ei,ai,ii])(function(e){return e[0]})},be=function o(){return(0,u.chain)("select",Ea,(0,u.optional)(wa),(0,u.optional)(Mn),(0,u.optional)(Ha),(0,u.optional)(Sa,o))(function(e){var t={type:"statement",variant:"select",result:e[1],from:e[2]};return e[5]&&(t.union=e[5]),t})},Sa=function(){return(0,u.chain)("union",["all","distinct"])()},wa=function(){return(0,u.chain)("from",Ta,(0,u.optional)(Pe),(0,u.optional)(Ra),(0,u.optional)(Ma))(function(e){return{sources:e[1],where:e[2],group:e[3],having:e[4]}})},Ea=function(){return(0,u.chain)(Tn,(0,u.many)(ka))(we)},ka=function(){return(0,u.chain)(",",Tn)(function(e){return e[1]})},Tn=function(){return(0,u.chain)([(0,u.chain)((0,u.many)("not"),[(0,u.chain)(G,(0,u.optional)(za))(function(e){return e[0]}),(0,u.chain)("(",G,")")()],(0,u.optional)(nn))(function(e){return{type:"identifier",variant:"column",name:e[1],alias:e[2]}}),"*"])(function(e){return e[0]})},Pe=function(){return(0,u.chain)("where",se)(function(e){return e[1]})},jn=function(){return(0,u.chain)(le,(0,u.many)(",",le))()},Ta=function(){return(0,u.chain)(Nn,(0,u.many)((0,u.chain)(",",Nn)(function(e){return e[1]})))(we)},Nn=function(){return(0,u.chain)(en,(0,u.many)(ja))(function(e){return{source:e[0],joins:e[1],type:"statement",variant:"tableSource"}})},en=function(){return(0,u.chain)([(0,u.chain)(Pn,(0,u.optional)(nn))(function(e){return{type:"identifier",variant:"table",name:e[0],alias:e[1]}}),(0,u.chain)([be,(0,u.chain)("(",be,")")(function(e){return e[1]})],nn)(function(e){return N()(N()({},e[0]),{},{alias:e[1]})})])(function(e){return e[0]})},ja=function(){return(0,u.chain)(["join","straight_join",(0,u.chain)(["inner","cross","full"],"join")(),(0,u.chain)(["left","right"],(0,u.optional)("outer"),"join")(),(0,u.chain)("natural",(0,u.optional)(["left","right"],(0,u.optional)("outer")),"join")()],en,(0,u.optional)("on",se))(function(e){return{type:"statement",variant:"join",join:e[1],conditions:e[2]}})},nn=function(){return(0,u.chain)([(0,u.chain)("as",ve)(function(e){return e[1]}),ve])(function(e){return e[0]})},Na=function(){return(0,u.chain)("create","table",ve,"(",Pa,")",(0,u.optional)(Oa))()},Oa=function(){return(0,u.chain)("with","(",Fa,")")()},Fa=function(){return(0,u.chain)(On,(0,u.many)(",",On))()},On=function(){return(0,u.chain)(W,"=",Y)()},Pa=function(){return(0,u.chain)(Fn,(0,u.many)(",",Fn))()},Fn=function(){return(0,u.chain)(ve,Sn)()},to=function o(){return chain(wordSym,optional(",",o))()},Pn=function(){return(0,u.chain)([(0,u.chain)(ve)(),(0,u.chain)(ve,".",ve)(function(e){return[e[0],e[2]]})])(function(e){if(e[0].length===1)return En({namespace:"",tableName:e[0][0]});if(e[0].length===2)return En({namespace:e[0][0],tableName:e[0][1]})})},Ma=function(){return(0,u.chain)("having",se)()},Ia=function(){return(0,u.chain)("create","view",W,"as",be)()},La=function(){return(0,u.chain)("insert",(0,u.optional)("ignore"),"into",Pn,(0,u.optional)($a),[be])(function(e){return{type:"statement",variant:"insert",into:{type:"indentifier",variant:"table",name:e[3]},result:e[5]}})},$a=function(){return(0,u.chain)("(",Aa,")")()},Aa=function(){return(0,u.chain)(W,(0,u.many)(",",W))()},Ra=function(){return(0,u.chain)("group","by",jn)()},Mn=function(){return(0,u.chain)("order","by",Za)()},Za=function(){return(0,u.chain)(In,(0,u.many)(",",In))()},In=function(){return(0,u.chain)(se,(0,u.optional)(["asc","desc"]))()},Da=function(){return(0,u.chain)([W,(0,u.chain)("partition","by",se)()])(function(e){return e})},za=function(){return(0,u.chain)("over","(",Va,")")()},Va=function o(){return(0,u.chain)([Da,(0,u.chain)(G,Mn)()],(0,u.many)(",",o))()},Ha=function(){return(0,u.chain)("limit",[te,(0,u.chain)(te,",",te)(),(0,u.chain)(te,"offset",te)()])()},Wa=function(){return(0,u.chain)([Qa,Ln,xa])(function(e){return e[0]})},xa=function(){return(0,u.chain)("if","(",Me,",",G,",",G,")")(function(e){return{type:"function",name:"if",args:[e[2],e[4],e[6]]}})},Qa=function(){return(0,u.chain)("cast","(",G,"as",Sn,")")(function(e){return{type:"function",name:"cast",args:[e[2],e[4]]}})},Ln=function(){return(0,u.chain)(W,"(",(0,u.optional)(Ba),")",(0,u.optional)("filter","(",Pe,")"))(function(e){return{type:"function",name:e[0],args:e[2]}})},Ba=function(){return(0,u.chain)($n,(0,u.many)(",",$n))()},$n=function(){return(0,u.chain)((0,u.many)(ga),[le,An])(function(e){return e})},An=function(){return(0,u.chain)("case",(0,u.plus)(Ja),(0,u.optional)("else",[le,"null"]),["end",(0,u.chain)("end","as",W)()])()},Ja=function(){return(0,u.chain)("when",se,"then",Dn)()},Ya=function(){return(0,u.chain)("set",Ga)()},Ga=function(){return(0,u.chain)(Rn,(0,u.many)(",",Rn))()},Rn=function(){return(0,u.chain)(Ka,"=",["true","false",Y,te])()},Ka=function(){return(0,u.chain)(W,(0,u.many)(".",W))()},se=function o(){return(0,u.chain)(Ua,(0,u.many)(ma,o))(we)},Ua=function(){return(0,u.chain)([(0,u.chain)("(",se,")")(),(0,u.chain)(ha,se)(),(0,u.chain)(Xa)],(0,u.optional)((0,u.chain)("is",(0,u.optional)("not"),["true","false","unknown"])()))(function(e){return e[0]})},Xa=function(){return(0,u.chain)(Me,(0,u.many)(["isnull",(0,u.chain)([(0,u.chain)("is","not")(),"is","not"],["null",le])()]))(we)},Me=function o(){return(0,u.chain)([(0,u.chain)(le,Zn)(),(0,u.chain)("(",o,")",Zn)()])()},Zn=function(){return(0,u.chain)((0,u.optional)([(0,u.chain)(pa,le)(),(0,u.chain)("sounds","like",le)(),qa]),(0,u.optional)(["or",Me]))()},le=function(){return(0,u.chain)(G)(function(e){return{type:"identifier",variant:"column",name:e[0]}})},qa=function(){return(0,u.chain)((0,u.optional)("is"),(0,u.optional)("not"),[(0,u.chain)("in","(",[be,jn],")")(),(0,u.chain)("between",G,"and",Me)(),(0,u.chain)("like",G,(0,u.optional)("escape",G))(),(0,u.chain)("regexp",G)(),"null"])()},Dn=function(){return(0,u.chain)(zn,(0,u.many)(va,zn))(function(e){return e[1]?[e[0],e[1]]:e[0]})},zn=function(){return(0,u.chain)([Wa,An,(0,u.chain)(da,(0,u.optional)([(0,u.chain)(".","*")(function(e){return{type:"identifier",variant:"groupAll"}}),(0,u.chain)(":",Ln)(),_a]))(function(e){return e[1]?N()(N()({},e[1]),{},{groupName:e[0]}):e[0]}),"*"])(function(e){return e[0]})},_a=function(){return(0,u.chain)(".",[Y,te,(0,u.chain)(W)(function(e){return{type:"identifier",variant:"columnAfterGroup",name:e[0]}})])(function(e){return e[1]})},G=function(){return sa(Dn)()},ei=function(){return(0,u.chain)("create","index",ni,ti,Pe)()},ni=function(){return(0,u.chain)(Y,(0,u.many)(".",Y))()},ti=function(){return(0,u.chain)("ON",Y,"(",ri,")")()},Vn=function(){return(0,u.chain)(Y,(0,u.optional)(["ASC","DESC"]))()},ri=function(){return(0,u.chain)(Vn,(0,u.many)(",",Vn))()},ai=function(){return(0,u.chain)("create","function",W,"as",Y)()},ii=function(){return(0,u.chain)("UPDATE",en,"SET",ca,(0,u.optional)(Pe))()},oi=(0,u.createParser)(ya,ua,{cursorTokenExcludes:function(e){return(e==null?void 0:e.value)==="."||(e==null?void 0:e.value)===":"}}),Hn="sql",ui=" $.:{}=abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),tn=function(e,t){return oi(e.getValue(),e.getOffsetAt(t))},si=function(){return{suggestions:[]}},li=function(e){return e.filter(function(t){return t.type==="string"}).map(function(t){var r=/[a-zA-Z]+/.test(t.value.toString())?qr.Z(t.value.toString()):t.value.toString();return{label:r,insertText:r,documentation:"documentation",detail:"detail",kind:D.Mj.CompletionItemKind.Keyword,sortText:"W".concat(t.value)}})};D.Mj.registerCompletionItemProvider(Hn,{triggerCharacters:ui,provideCompletionItems:function(){var o=y()(f()().mark(function e(t,r){var n,i,a,s,c,l,p,d;return f()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(n=tn(t,r),n){v.next=3;break}return v.abrupt("return",si());case 3:return v.next=5,Qe(n.ast,n.cursorKeyPath);case 5:if(i=v.sent,a=li(n.nextMatchings),i){v.next=9;break}return v.abrupt("return",{suggestions:a});case 9:v.t0=i.type,v.next=v.t0==="tableField"?12:v.t0==="tableFieldAfterGroup"?20:v.t0==="tableName"?24:v.t0==="functionName"?28:29;break;case 12:return v.next=14,Ye(n.ast,n.cursorKeyPath,Oe);case 14:return s=v.sent,c=_r.Z(s.filter(function(T){return T.groupPickerName!==null}),"groupPickerName"),v.next=18,gn(i.token.value);case 18:return l=v.sent,v.abrupt("return",{suggestions:s.concat(a).concat(l).concat(c?Object.keys(c).map(function(T){return na(T)}):[])});case 20:return v.next=22,Ye(n.ast,n.cursorKeyPath,Oe);case 22:return p=v.sent,v.abrupt("return",{suggestions:p.filter(function(T){return T.groupPickerName===i.groupName}).concat(a)});case 24:return v.next=26,ea(i);case 26:return d=v.sent,v.abrupt("return",{suggestions:d.concat(a)});case 28:return v.abrupt("return",{suggestions:gn(i.token.value)});case 29:return v.abrupt("return",{suggestions:a});case 30:case"end":return v.stop()}},e)}));return function(t,r){return o.apply(this,arguments)}}()}),D.Mj.registerHoverProvider(Hn,{provideHover:function(){var o=y()(f()().mark(function t(r,n){var i,a,s,c,l;return f()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(i=tn(r,n),i){d.next=3;break}return d.abrupt("return",null);case 3:return d.next=5,Qe(i.ast,i.cursorKeyPath);case 5:if(a=d.sent,a){d.next=8;break}return d.abrupt("return",null);case 8:s=[],d.t0=a.type,d.next=d.t0==="tableField"?12:d.t0==="tableFieldAfterGroup"?19:d.t0==="tableName"?26:d.t0==="functionName"?30:34;break;case 12:return d.next=14,Cn(i.ast,a,Oe,i.cursorKeyPath);case 14:return c=d.sent,d.next=17,bn(a.token.value,c);case 17:return s=d.sent,d.abrupt("break",34);case 19:return d.next=21,Cn(i.ast,a,Oe,i.cursorKeyPath);case 21:return l=d.sent,d.next=24,bn(a.token.value,l);case 24:return s=d.sent,d.abrupt("break",34);case 26:return d.next=28,ta(a);case 28:return s=d.sent,d.abrupt("break",34);case 30:return d.next=32,ra(a.token.value);case 32:return s=d.sent,d.abrupt("break",34);case 34:return d.abrupt("return",{range:D.e6.fromPositions(r.getPositionAt(a.token.position[0]),r.getPositionAt(a.token.position[1]+1)),contents:s});case 35:case"end":return d.stop()}},t)}));function e(t,r){return o.apply(this,arguments)}return e}()});var Wn=m(94582);D.Mj.registerDocumentFormattingEditProvider("sql",{provideDocumentFormattingEdits:function(e){var t=(0,Wn.WU)(e.getValue());return[{range:e.getFullModelRange(),text:t}]}}),D.Mj.registerDocumentRangeFormattingEditProvider("sql",{provideDocumentRangeFormattingEdits:function(e,t){var r=(0,Wn.WU)(e.getValueInRange(t));return[{range:t,text:r}]}});var ci=function(){function o(e){var t=this;R()(this,o),h()(this,"editorReadyDeferred",new Ur.B),h()(this,"editorReady",this.editorReadyDeferred.promise),h()(this,"editorHost",void 0),h()(this,"_model",void 0),h()(this,"_uuid",""),h()(this,"_config",void 0),h()(this,"_isDisposed",!1),h()(this,"toDispose",new Xr.K),h()(this,"oldDeltaDecorations",[]),h()(this,"modalChangeEmitter",new vn.Q5),h()(this,"monacoEditor",void 0),h()(this,"host",void 0),h()(this,"editorState",void 0),h()(this,"setOption",function(r,n){if(n!=null){var i=["fontFamily","fontSize","lineHeight","wordWrapColumn","lineWrap"],a=i.concat(["readOnly","insertSpaces","tabSize"]);if(a.includes(r)){var s;t._config=N()(N()({},t._config),{},h()({},r,n)),(s=t.monacoEditor)===null||s===void 0||s.updateOptions(t.toMonacoOptions(t._config))}i.includes(r)&&t.updateEditorSize()}}),h()(this,"getLine",function(r){var n;return(n=t.monacoEditor)===null||n===void 0||(n=n.getModel())===null||n===void 0?void 0:n.getLineContent(r)}),h()(this,"getOffsetAt",function(r){var n;return((n=t.monacoEditor)===null||n===void 0||(n=n.getModel())===null||n===void 0?void 0:n.getOffsetAt({lineNumber:r.line,column:r.column}))||0}),h()(this,"undo",function(){var r;(r=t.monacoEditor)===null||r===void 0||r.trigger("source","undo",{})}),h()(this,"redo",function(){var r;(r=t.monacoEditor)===null||r===void 0||r.trigger("source","redo",{})}),h()(this,"focus",function(){var r;(r=t.monacoEditor)===null||r===void 0||r.focus()}),h()(this,"hasFocus",function(){var r,n;return(r=(n=t.monacoEditor)===null||n===void 0?void 0:n.hasWidgetFocus())!==null&&r!==void 0?r:!1}),h()(this,"blur",function(){document.documentElement.focus()}),h()(this,"resizeToFit",function(){var r;(r=t.monacoEditor)===null||r===void 0||r.layout()}),h()(this,"getPositionForCoordinate",function(r){return null}),h()(this,"getCursorPosition",function(){var r,n,i={line:((r=t.monacoEditor)===null||r===void 0||(r=r.getPosition())===null||r===void 0?void 0:r.lineNumber)||1,column:((n=t.monacoEditor)===null||n===void 0||(n=n.getPosition())===null||n===void 0?void 0:n.column)||1};return i}),h()(this,"setCursorPosition",function(r){var n;(n=t.monacoEditor)===null||n===void 0||n.setPosition({column:r.column,lineNumber:r.line})}),h()(this,"getSelection",function(){var r,n,i,a,s={start:{line:((r=t.monacoEditor)===null||r===void 0||(r=r.getSelection())===null||r===void 0?void 0:r.startLineNumber)||1,column:((n=t.monacoEditor)===null||n===void 0||(n=n.getSelection())===null||n===void 0?void 0:n.startColumn)||1},end:{line:((i=t.monacoEditor)===null||i===void 0||(i=i.getSelection())===null||i===void 0?void 0:i.endLineNumber)||1,column:((a=t.monacoEditor)===null||a===void 0||(a=a.getSelection())===null||a===void 0?void 0:a.endColumn)||1}};return s}),h()(this,"setSelection",function(r){var n;(n=t.monacoEditor)===null||n===void 0||n.setSelection(t.toMonacoRange(r))}),h()(this,"getSelections",function(){var r,n=[];return(r=t.monacoEditor)===null||r===void 0||(r=r.getSelections())===null||r===void 0||r.map(function(i){return n.push({start:{line:i.startLineNumber||1,column:i.startColumn||1},end:{line:i.endLineNumber||1,column:i.endColumn||1}})}),n}),h()(this,"setSelections",function(r){var n;(n=t.monacoEditor)===null||n===void 0||n.setSelections(r.map(function(i){return new D.Y1(i.start.line,i.start.column,i.end.line,i.end.column)}))}),h()(this,"revealSelection",function(r){var n;(n=t.monacoEditor)===null||n===void 0||n.revealRange(t.toMonacoRange(r))}),h()(this,"getSelectionValue",function(r){var n,i=r!=null?r:t.getSelection();return(n=t.monacoEditor)===null||n===void 0||(n=n.getModel())===null||n===void 0?void 0:n.getValueInRange(t.toMonacoRange(i))}),h()(this,"replaceSelection",function(r,n){var i,a;(i=t.monacoEditor)===null||i===void 0||i.executeEdits(void 0,[{range:t.toMonacoRange(n),text:r}]),(a=t.monacoEditor)===null||a===void 0||a.pushUndoStop()}),h()(this,"replaceSelections",function(r){var n,i;(n=t.monacoEditor)===null||n===void 0||n.executeEdits(void 0,r.map(function(a){return{range:t.toMonacoRange(a.range),text:a.text}})),(i=t.monacoEditor)===null||i===void 0||i.pushUndoStop()}),h()(this,"getPositionAt",function(r){var n,i=(n=t.monacoEditor)===null||n===void 0||(n=n.getModel())===null||n===void 0?void 0:n.getPositionAt(r);return i&&{line:i.lineNumber,column:i.column}}),h()(this,"highlightMatches",function(r,n){var i,a,s=r.map(function(p,d){return d===n?(a=p,{range:p,options:{className:"currentFindMatch"}}):{range:p,options:{className:"findMatch"}}}).map(function(p){return N()(N()({},p),{},{range:t.toMonacoMatch(p.range).range})});if(t.oldDeltaDecorations=((i=t.monacoEditor)===null||i===void 0?void 0:i.deltaDecorations(t.oldDeltaDecorations,s))||[],a){var c=t.getPositionAt(a.position),l=t.getPositionAt(a.position+a.text.length);c&&l&&t.revealSelection({end:l,start:c})}}),this.host=e.host,this._model=e.model,this._uuid=e.uuid||(0,I.Vj)(),this._config=N()({},e.config),this.editorHost=document.createElement("div"),this.host.append(this.editorHost),this.createEditor(this.editorHost),this.checkSyntaxError(),this.toDispose.push((0,$.YP)(this._model,"selections",this.onSelectionChange))}return Z()(o,[{key:"uuid",get:function(){return this._uuid},set:function(t){this._uuid=t}},{key:"model",get:function(){return this._model}},{key:"config",get:function(){return this._config}},{key:"lineCount",get:function(){var t;return((t=this.monacoEditor)===null||t===void 0||(t=t.getModel())===null||t===void 0?void 0:t.getLineCount())||0}},{key:"disposed",get:function(){return this._isDisposed}},{key:"onModalChange",get:function(){return this.modalChangeEmitter.event}},{key:"createEditor",value:function(){var e=y()(f()().mark(function r(n){var i,a,s=this,c,l,p,d;return f()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:this.monacoEditor=D.j6.create(n,N()({value:this.model.value,language:"sql"},this.toMonacoOptions(this._config))),this.toDispose.push((i=(a=this.monacoEditor)===null||a===void 0?void 0:a.onDidChangeModelContent(function(){var T,E=(T=s.monacoEditor)===null||T===void 0?void 0:T.getValue();E&&(s.model.value=E,s.updateEditorSize())}))!==null&&i!==void 0?i:He.J.NONE),this.toDispose.push((c=(l=this.monacoEditor)===null||l===void 0?void 0:l.onDidContentSizeChange(function(){s.updateEditorSize()}))!==null&&c!==void 0?c:He.J.NONE),this.toDispose.push((p=(d=this.monacoEditor)===null||d===void 0?void 0:d.onDidBlurEditorText(function(){s.blur()}))!==null&&p!==void 0?p:He.J.NONE),this.updateEditorSize(),this.editorReadyDeferred.resolve();case 6:case"end":return v.stop()}},r,this)}));function t(r){return e.apply(this,arguments)}return t}()},{key:"checkSyntaxError",value:function(){var t,r=this;(t=this.monacoEditor)===null||t===void 0||t.onDidChangeModelContent(function(){var n,i,a=(n=r.monacoEditor)===null||n===void 0?void 0:n.getModel(),s=(i=r.monacoEditor)===null||i===void 0?void 0:i.getPosition();if(!(!a||!s)){var c=tn(a,s);if(c)if(c.error){var l=c.error.reason==="incomplete"?`Incomplete, expect next input: 
`.concat(c.error.suggestions.map(function(d){return d.value}).join(`
`)):`Wrong input, expect: 
`.concat(c.error.suggestions.map(function(d){return d.value}).join(`
`)),p=c.error.token?{startLineNumber:a.getPositionAt(c.error.token.position[0]).lineNumber,startColumn:a.getPositionAt(c.error.token.position[0]).column,endLineNumber:a.getPositionAt(c.error.token.position[1]).lineNumber,endColumn:a.getPositionAt(c.error.token.position[1]).column+1}:{startLineNumber:0,startColumn:0,endLineNumber:0,endColumn:0};D.j6.setModelMarkers(a,"sql",[N()(N()({},p),{},{message:l,severity:D.ZL.Error})])}else D.j6.setModelMarkers(a,"sql",[])}})}},{key:"toMonacoOptions",value:function(t){var r,n,i,a,s,c,l;return{minimap:{enabled:!1},lineHeight:(r=t.lineHeight)!==null&&r!==void 0?r:20,fontSize:(n=t.fontSize)!==null&&n!==void 0?n:13,lineNumbers:t.lineNumbers?"on":"off",folding:(i=t.codeFolding)!==null&&i!==void 0?i:!0,wordWrap:(a=t.lineWrap)!==null&&a!==void 0?a:"off",lineDecorationsWidth:15,lineNumbersMinChars:3,suggestSelection:"first",wordBasedSuggestions:"currentDocument",scrollBeyondLastLine:!1,fixedOverflowWidgets:!0,suggest:{snippetsPreventQuickSuggestions:!1},autoClosingQuotes:t.autoClosingBrackets?"always":"never",autoDetectHighContrast:!1,scrollbar:{alwaysConsumeMouseWheel:!1,verticalScrollbarSize:0},extraEditorClassName:"sql-editor",renderLineHighlight:"all",renderLineHighlightOnlyWhenFocus:!0,readOnly:t.readOnly,cursorWidth:1,tabSize:(s=t.tabSize)!==null&&s!==void 0?s:4,insertSpaces:(c=t.insertSpaces)!==null&&c!==void 0?c:!0,matchBrackets:t.matchBrackets?"always":"never",rulers:(l=t.rulers)!==null&&l!==void 0?l:[],wordWrapColumn:t.wordWrapColumn||80}}},{key:"getState",value:function(){var t=this.getCursorPosition(),r=this.getSelections();return N()(N()({},this.editorState),{},{cursorPosition:t,selections:r})}},{key:"updateEditorSize",value:function(){var t,r,n=(t=(r=this.monacoEditor)===null||r===void 0?void 0:r.getContentHeight())!==null&&t!==void 0?t:20;this.host.style.height="".concat(n+30,"px");try{var i;(i=this.monacoEditor)===null||i===void 0||i.layout({width:this.host.offsetWidth,height:n})}catch(a){}}},{key:"toMonacoRange",value:function(t){var r=t!=null?t:this.getSelection(),n={startLineNumber:r.start.line||1,startColumn:r.start.column||1,endLineNumber:r.end.line||1,endColumn:r.end.column||1};return n}},{key:"onSelectionChange",value:function(){this.setSelections(this.model.selections)}},{key:"toMonacoMatch",value:function(t){var r,n,i,a,s=this.getPositionAt(t.position),c=this.getPositionAt(t.position+t.text.length);return{range:new D.e6((r=s==null?void 0:s.line)!==null&&r!==void 0?r:1,(n=s==null?void 0:s.column)!==null&&n!==void 0?n:1,(i=c==null?void 0:c.line)!==null&&i!==void 0?i:1,(a=c==null?void 0:c.column)!==null&&a!==void 0?a:1),matches:[t.text],_findMatchBrand:void 0}}},{key:"getOption",value:function(t){return this._config[t]}},{key:"dispose",value:function(){this.disposed||(this.toDispose.dispose(),this._isDisposed=!0)}}]),o}(),xn,Qn,Bn,Jn,Yn,U,Gn=(xn=(0,j.H3)(),Qn=(0,K.ei)("libro-sql-output-area"),Bn=function(e,t){return(0,j.f3)(me.Hj)(e,void 0,0)},Jn=Reflect.metadata("design:type",Function),Yn=Reflect.metadata("design:paramtypes",[typeof IOutputAreaOption=="undefined"?Object:IOutputAreaOption]),xn(U=Qn(U=Bn(U=Jn(U=Yn(U=function(o){oe()(t,o);var e=ue()(t);function t(r){var n;return R()(this,t),n=e.call(this,r),n.handleMsg(),n}return Z()(t,[{key:"handleMsg",value:function(){var n=this,i=this.cell.model;i.msgChange(function(a){if(a.header.msg_type!=="status"&&((0,w.t3d)(a)||(0,w.HXF)(a)||(0,w.aL4)(a)||(0,w.fkE)(a))){var s=N()(N()({},a.content),{},{output_type:a.header.msg_type});n.add(s)}})}}]),t}(w.fZS))||U)||U)||U)||U)||U),g=m(35667),di=function(e){var t=e.model,r=t.data["application/vnd.libro.sql+json"];return r?(0,g.jsxs)("div",{className:"sql-output-render libro-html-common-render",children:[(0,g.jsxs)("table",{border:1,className:"dataframe",children:[(0,g.jsx)("thead",{children:(0,g.jsxs)("tr",{style:{textAlign:"right"},children:[(0,g.jsx)("th",{}),r.columns.map(function(n){return(0,g.jsx)("th",{children:n},n)})]})}),(0,g.jsx)("tbody",{children:r.rows.map(function(n,i){return(0,g.jsxs)("tr",{children:[(0,g.jsx)("td",{children:i}),n.map(function(a){return(0,g.jsx)("td",{children:a},a)})]},i)})})]}),(0,g.jsxs)("p",{children:[r.rows.length," rows \xD7 ",r.columns.length," columns"]})]}):null},Kn,Un,fi=(Kn=(0,j.ri)({contrib:w.VCh}),Kn(Un=Z()(function o(){R()(this,o),h()(this,"canHandle",function(){return 100}),h()(this,"renderType","SQLOutputRender"),h()(this,"safe",!0),h()(this,"mimeTypes",["application/vnd.libro.sql+json"]),h()(this,"render",di)}))||Un),Ie=m(72202),Xn,qn,Le=(Xn=(0,j.ri)(),Xn(qn=function(){function o(){R()(this,o)}return Z()(o,[{key:"query",value:function(){var e=y()(f()().mark(function r(n){var i=this,a,s,c;return f()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,(0,I.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"query",project_id:this.getProjectId(),query:n})});case 2:if(a=p.sent,s=[],c=[],!a){p.next=8;break}return a.forEach(function(d){s.push(d.name),c.push(i.getRowValue(d))}),p.abrupt("return",{columns:s,rows:(0,I.p4)(c)});case 8:return p.abrupt("return",{columns:s,rows:c});case 9:case"end":return p.stop()}},r,this)}));function t(r){return e.apply(this,arguments)}return t}()},{key:"getRowValue",value:function(t){for(var r=["int32_data","int64_data","float_data","double_data","bool_data","string_data"],n=0;n<r.length;n++){var i=r[n];if(t[i]&&t[i].length>0)return t[i]}return[]}},{key:"getProjectId",value:function(){var t=Ie.m8.location.pathname.split("/");return t[t.length-1]}}]),o}())||qn),_n,et,nt,tt,rt,at,it,ot,ut,st,lt,ct,dt,L,$e,ft,mt,vt=(0,ne.forwardRef)(function(o,e){var t=(0,$.oC)(me.yd);return(0,g.jsx)("div",{tabIndex:10,ref:e,className:t.className,onFocus:function(){t.focus(!0)},onBlur:function(n){var i;typeof e!="function"&&!(e!=null&&(i=e.current)!==null&&i!==void 0&&i.contains(n.relatedTarget))&&t.blur()},children:(0,g.jsx)(w.sUT,{})})});vt.displayName="SqlCellComponent";var pt=(_n=(0,j.H3)(),et=(0,K.ei)("sql-cell-view"),nt=function(e,t){return(0,j.f3)(me.Hj)(e,void 0,0)},tt=function(e,t){return(0,j.f3)(w.xxA)(e,void 0,1)},rt=function(e,t){return(0,j.f3)(Ve.v)(e,void 0,2)},at=function(e,t){return(0,j.f3)(Le)(e,void 0,3)},it=function(e,t){return(0,j.f3)(ge.H)(e,void 0,4)},ot=Reflect.metadata("design:type",Function),ut=Reflect.metadata("design:paramtypes",[typeof CellViewOptions=="undefined"?Object:CellViewOptions,typeof w.xxA=="undefined"?Object:w.xxA,typeof Ve.v=="undefined"?Object:Ve.v,typeof Le=="undefined"?Object:Le,typeof ge.H=="undefined"?Object:ge.H]),st=(0,$.vg)(),lt=Reflect.metadata("design:type",Array),ct=(0,$.vg)(),dt=Reflect.metadata("design:type",typeof w.a7s=="undefined"?Object:w.a7s),_n(L=et(L=nt(L=tt(L=rt(L=at(L=it(L=ot(L=ut(L=($e=function(o){oe()(t,o);var e=ue()(t);function t(r,n,i,a,s){var c,l;return R()(this,t),l=e.call(this,r,n),h()(C()(l),"view",vt),h()(C()(l),"queryService",void 0),h()(C()(l),"viewManager",void 0),h()(C()(l),"commandRegistry",void 0),_()(C()(l),"outputs",ft,C()(l)),_()(C()(l),"editorView",mt,C()(l)),h()(C()(l),"onViewMount",y()(f()().mark(function p(){return f()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,l.createEditor();case 2:case"end":return b.stop()}},p)}))),h()(C()(l),"clearExecution",function(){l.cellModel.clearExecution(),Promise.resolve().then(function(){l.outputArea.clear()}).catch(console.error)}),l.options=r,l.queryService=a,l.viewManager=i,l.commandRegistry=s,l.outputs=((c=r.cell)===null||c===void 0?void 0:c.outputs)||[],l.className=l.className+" sql-editor-container",l.viewManager.getOrCreateView(Gn,{outputAreaId:l.id,cellId:l.id,cell:C()(l)}).then(function(){var p=y()(f()().mark(function d(b){var v;return f()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(l.outputArea=b,v=l.outputs,!(0,w.RWJ)(v)){E.next=5;break}return E.next=5,l.outputArea.fromJSON(v);case 5:return l.outputWatch(),E.abrupt("return");case 7:case"end":return E.stop()}},d)}));return function(d){return p.apply(this,arguments)}}()).catch(function(){}),l}return Z()(t,[{key:"cellModel",get:function(){return this.model}},{key:"toJSON",value:function(){var n,i,a=fn()(mn()(t.prototype),"toJSON",this).call(this);return N()(N()({},a),{},{outputs:(n=(i=this.outputArea)===null||i===void 0?void 0:i.toJSON())!==null&&n!==void 0?n:this.outputs})}},{key:"createEditor",value:function(){var n=this,i={uuid:this.options.uuid,factory:function(s){return new ci(s)},model:this.cellModel,config:{readOnly:this.parent.model.readOnly,editable:!this.parent.model.readOnly}};return this.viewManager.getOrCreateView(w.a7s,i).then(function(){var a=y()(f()().mark(function s(c){return f()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return n.editorView=c,p.next=3,c.editor.editorReady;case 3:return n.handleCommand(),p.abrupt("return");case 5:case"end":return p.stop()}},s)}));return function(s){return a.apply(this,arguments)}}()).catch(function(){})}},{key:"handleCommand",value:function(){var n,i=this,a=(n=this.editorView)===null||n===void 0||(n=n.editor)===null||n===void 0?void 0:n.monacoEditor;a&&(a.addCommand(9,function(){i.commandRegistry.executeCommand(w.NzD.EnterCommandMode.id)},"!editorHasSelection && !editorHasSelection && !editorHasMultipleSelections"),a.addCommand(2051,function(){i.commandRegistry.executeCommand(w.NzD.RunCell.id)},"!findWidgetVisible && !referenceSearchVisible"),a.addCommand(1027,function(){i.commandRegistry.executeCommand(w.NzD.RunCellAndSelectNext.id)},"!findInputFocussed"),a.addCommand(515,function(){i.commandRegistry.executeCommand(w.NzD.RunCellAndInsertBelow.id)},"!findWidgetVisible"),a.addCommand(3155,function(){i.commandRegistry.executeCommand(w.NzD.SplitCellAntCursor.id)}),a.addCommand(2084,function(){i.commandRegistry.executeCommand("libro-search:toggle")}))}},{key:"run",value:function(){var r=y()(f()().mark(function i(){var a,s,c,l,p,d;return f()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return a=new Date().toISOString(),this.clearExecution(),this.setExecutionStatus(!0,!0),this.setExecutionTime(a,""),this.cellModel.executeCount=1,v.prev=5,v.next=8,this.queryService.query(this.cellModel.value);case 8:s=v.sent,c={header:{msg_type:"execute_result",date:"",msg_id:"",session:"",username:"",version:""},metadata:{},content:{data:{"application/vnd.libro.sql+json":s},metadata:{},execution_count:1},buffers:[],channel:"iopub",parent_header:{}},this.cellModel.msgChangeEmitter.fire(c),v.next=16;break;case 13:v.prev=13,v.t0=v.catch(5),v.t0 instanceof Error&&(l=v.t0.message,p=l.split(`
`),p.length>0&&(d={header:{msg_type:"error",date:"",msg_id:"",session:"",username:"",version:""},metadata:{},content:{traceback:p.slice(1),ename:"ExecuteQueryException",evalue:p[0]},buffers:[],channel:"iopub",parent_header:{}},this.cellModel.msgChangeEmitter.fire(d)));case 16:return this.setExecutionStatus(!1,!1),this.setExecutionTime(a,new Date().toISOString()),v.abrupt("return",!0);case 19:case"end":return v.stop()}},i,this,[[5,13]])}));function n(){return r.apply(this,arguments)}return n}()},{key:"setExecutionStatus",value:function(n,i){this.cellModel.executing=n,this.cellModel.kernelExecuting=i}},{key:"setExecutionTime",value:function(n,i){var a=this.cellModel.metadata.execution;a&&(a["shell.execute_reply.started"]=n,a.to_execute=n,a["shell.execute_reply.end"]=i)}},{key:"calcEditorAreaHeight",value:function(){return 0}},{key:"focus",value:function(n){n&&(this.cellModel.isEdit=!0)}},{key:"blur",value:function(){this.cellModel.isEdit=!1}},{key:"shouldEnterEditorMode",value:function(){return this.cellModel.isEdit}}]),t}(w.XCr),ft=ee()($e.prototype,"outputs",[st,lt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),mt=ee()($e.prototype,"editorView",[ct,dt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$e))||L)||L)||L)||L)||L)||L)||L)||L)||L),ht,gt,bt,yt,ce,mi=(ht=(0,j.ri)({contrib:[w.SqL,w.GDy]}),gt=function(e,t){return(0,j.f3)(Te)(e,void 0,0)},bt=Reflect.metadata("design:type",Function),yt=Reflect.metadata("design:paramtypes",[typeof Te=="undefined"?Object:Te]),ht(ce=gt(ce=bt(ce=yt(ce=function(){function o(e){R()(this,o),h()(this,"modelFactory",void 0),h()(this,"cellMeta",{type:"code",name:"SQL",nbformatType:"code",order:"a"}),h()(this,"view",pt),this.modelFactory=e}return Z()(o,[{key:"canHandle",value:function(t,r){return r===this.cellMeta.type?3e3:-1}},{key:"createModel",value:function(){var e=y()(f()().mark(function r(n){var i;return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return i=this.modelFactory(n),s.abrupt("return",i);case 2:case"end":return s.stop()}},r,this)}));function t(r){return e.apply(this,arguments)}return t}()}]),o}())||ce)||ce)||ce)||ce),Ct,St,wt,Et,kt,Tt,jt,Nt,Ot,Ft,Pt,de,pe,Mt,It,Lt,$t,At,Rt=(Ct=(0,j.H3)(),St=function(e,t){return(0,j.f3)(w.seq)(e,void 0,0)},wt=Reflect.metadata("design:type",Function),Et=Reflect.metadata("design:paramtypes",[typeof w.seq=="undefined"?Object:w.seq]),kt=(0,$.vg)(),Tt=Reflect.metadata("design:type",typeof Partial=="undefined"?Object:Partial),jt=(0,$.vg)(),Nt=(0,$.vg)(),Ot=(0,$.vg)(),Ft=Reflect.metadata("design:type",typeof ExecutionCount=="undefined"?Object:ExecutionCount),Pt=(0,$.vg)(),Ct(de=St(de=wt(de=Et(de=(pe=function(o){oe()(t,o);var e=ue()(t);function t(r){var n;return R()(this,t),n=e.call(this,r),h()(C()(n),"mimeType","application/vnd.libro.sql+json"),h()(C()(n),"hasOutputHidden",!1),h()(C()(n),"hasOutputsScrolled",!1),_()(C()(n),"metadata",Mt,C()(n)),_()(C()(n),"executing",It,C()(n)),_()(C()(n),"kernelExecuting",Lt,C()(n)),_()(C()(n),"executeCount",$t,C()(n)),_()(C()(n),"isEdit",At,C()(n)),h()(C()(n),"msgChangeEmitter",new vn.Q5),h()(C()(n),"msgChange",n.msgChangeEmitter.event),h()(C()(n),"clearExecution",function(){n.executeCount=null,n.executing=!1,n.kernelExecuting=!1,n.clearExecutionMetadata()}),h()(C()(n),"clearExecutionMetadata",function(){n.metadata.execution={"shell.execute_reply.started":"","shell.execute_reply.end":"",to_execute:""}}),n.metadata=r.cell.metadata||{},n}return Z()(t,[{key:"dispose",value:function(){fn()(mn()(t.prototype),"dispose",this).call(this),this.msgChangeEmitter.dispose()}}]),t}(w.KZ9),Mt=ee()(pe.prototype,"metadata",[kt,Tt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),It=ee()(pe.prototype,"executing",[jt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Lt=ee()(pe.prototype,"kernelExecuting",[Nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),$t=ee()(pe.prototype,"executeCount",[Ot,Ft],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),At=ee()(pe.prototype,"isEdit",[Pt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),pe))||de)||de)||de)||de),vi=m(74799),Zt,Dt,pi=(Zt=(0,j.ri)({contrib:w.Vij}),Zt(Dt=function(){function o(){R()(this,o),h()(this,"canHandle",function(){return 3})}return Z()(o,[{key:"loadContent",value:function(){var e=y()(f()().mark(function r(n,i){var a,s,c,l;return f()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return a=i,s=new vi.o(n.resource),c=s.path.toString(),d.next=5,a.contentsManager.get(c);case 5:if(l=d.sent,!l){d.next=10;break}return l.content.nbformat_minor=5,a.currentFileContents=l,d.abrupt("return",a.currentFileContents.content);case 10:case"end":return d.stop()}},r)}));function t(r,n){return e.apply(this,arguments)}return t}()}]),o}())||Dt),ye=m(72085),hi=m(7146),zt,Vt,Ht,Wt,xt,Qt,B,gi=(zt=(0,j.H3)(),Vt=function(e,t){return(0,j.f3)(w.QY6)(e,void 0,0)},Ht=function(e,t){return(0,j.f3)(ye.Z)(e,void 0,1)},Wt=function(e,t){return(0,j.f3)(ge.H)(e,void 0,2)},xt=Reflect.metadata("design:type",Function),Qt=Reflect.metadata("design:paramtypes",[typeof w.QY6=="undefined"?Object:w.QY6,typeof ye.Z=="undefined"?Object:ye.Z,typeof ge.H=="undefined"?Object:ge.H]),zt(B=Vt(B=Ht(B=Wt(B=xt(B=Qt(B=function(o){oe()(t,o);var e=ue()(t);function t(r,n,i){var a;return R()(this,t),a=e.call(this),h()(C()(a),"modalService",void 0),h()(C()(a),"commandRegistry",void 0),h()(C()(a),"currentFileContents",void 0),h()(C()(a),"contentsManager",void 0),h()(C()(a),"kernelConnection",!0),h()(C()(a),"kernelConnecting",!1),h()(C()(a),"lspEnabled",!1),h()(C()(a),"autoSave",(0,hi.Z)(function(){a.commandRegistry.executeCommand(w.Xa6.Save.id)},500)),a.contentsManager=r,a.modalService=n,a.commandRegistry=i,a.onSourceChanged(a.autoSave.bind(C()(a))),a}return Z()(t,[{key:"isKernelIdle",get:function(){return!0}},{key:"saveNotebookContent",value:function(){var r=y()(f()().mark(function i(){var a,s,c,l;return f()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(a=this.toJSON(),this.currentFileContents){d.next=3;break}throw new Error("currentFileContents is undefined");case 3:return d.prev=3,d.next=6,this.contentsManager.save(this.currentFileContents.path,{type:this.currentFileContents.type,content:a,format:this.currentFileContents.format});case 6:if(s=d.sent,s){d.next=9;break}return d.abrupt("return");case 9:if(!(s.last_modified===this.currentFileContents.last_modified||s.size===0)){d.next=13;break}throw l="File Save Error: ".concat((c=s)===null||c===void 0?void 0:c.message),this.modalService.openModal(w.l6J),new Error(l);case 13:d.next=21;break;case 15:if(d.prev=15,d.t0=d.catch(3),s){d.next=19;break}return d.abrupt("return");case 19:throw this.modalService.openModal(w.l6J),new Error("File Save Error");case 21:return d.next=23,this.createCheckpoint();case 23:case"end":return d.stop()}},i,this,[[3,15]])}));function n(){return r.apply(this,arguments)}return n}()},{key:"canRun",value:function(){return!0}},{key:"interrupt",value:function(){var r=y()(f()().mark(function i(){return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:case"end":return s.stop()}},i)}));function n(){return r.apply(this,arguments)}return n}()},{key:"shutdown",value:function(){var r=y()(f()().mark(function i(){return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:case"end":return s.stop()}},i)}));function n(){return r.apply(this,arguments)}return n}()},{key:"restart",value:function(){var r=y()(f()().mark(function i(){return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:case"end":return s.stop()}},i)}));function n(){return r.apply(this,arguments)}return n}()},{key:"reconnect",value:function(){var r=y()(f()().mark(function i(){return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:case"end":return s.stop()}},i)}));function n(){return r.apply(this,arguments)}return n}()},{key:"findRunningCell",value:function(){var n=this.cells.findIndex(function(i){return w.lPh.is(i.model)?i.model.kernelExecuting===!0:!1});n>-1&&(this.selectCell(this.cells[n]),this.scrollToView(this.cells[n]))}},{key:"createCheckpoint",value:function(){var r=y()(f()().mark(function i(){return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!this.currentFileContents){s.next=3;break}return s.next=3,this.contentsManager.createCheckpoint(this.currentFileContents.path);case 3:case"end":return s.stop()}},i,this)}));function n(){return r.apply(this,arguments)}return n}()},{key:"listCheckpoints",value:function(){var r=y()(f()().mark(function i(){return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!this.currentFileContents){s.next=3;break}return s.next=3,this.contentsManager.listCheckpoints(this.currentFileContents.path);case 3:case"end":return s.stop()}},i,this)}));function n(){return r.apply(this,arguments)}return n}()},{key:"restoreCheckpoint",value:function(){var r=y()(f()().mark(function i(a){return f()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(!this.currentFileContents){c.next=3;break}return c.next=3,this.contentsManager.restoreCheckpoint(this.currentFileContents.path,a);case 3:case"end":return c.stop()}},i,this)}));function n(i){return r.apply(this,arguments)}return n}()},{key:"deleteCheckpoint",value:function(){var r=y()(f()().mark(function i(a){return f()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(!this.currentFileContents){c.next=3;break}return c.next=3,this.contentsManager.deleteCheckpoint(this.currentFileContents.path,a);case 3:case"end":return c.stop()}},i,this)}));function n(i){return r.apply(this,arguments)}return n}()}]),t}(w.ero))||B)||B)||B)||B)||B)||B),bi=Se.R.create().register(pi,mi,pt,Rt,Gn,Le,fi,{token:w.ero,useClass:gi},{token:Te,useFactory:function(e){return function(t){var r=e.container.createChild();r.register({token:w.seq,useValue:t});var n=r.get(Rt);return n}}}).dependOn(w.MDs),Bt,Jt,Yt,Gt,rn,Kt,Ae=(Bt=(0,j.ri)(),Jt=(0,$.vg)(),Yt=Reflect.metadata("design:type",Array),Bt(Gt=(rn=function(){function o(){R()(this,o),_()(this,"members",Kt,this)}return Z()(o,[{key:"getMemberList",value:function(){var e=y()(f()().mark(function r(){var n,i,a;return f()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.getPlatformInfo();case 2:return n=c.sent,i=n.party,c.next=6,(0,I.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"getProjectInfo",project_id:this.getProjectId()})});case 6:return a=c.sent,a&&(this.members=a.members.map(function(l){return{name:l===i?"".concat(l," (you)"):l,creator:l===a.creator,color:(0,I.Q4)()}})),c.abrupt("return",this.members);case 9:case"end":return c.stop()}},r,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"inviteMember",value:function(){var e=y()(f()().mark(function r(n){return f()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,I.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"inviteMember",project_id:this.getProjectId(),invitee:n})});case 2:case"end":return a.stop()}},r,this)}));function t(r){return e.apply(this,arguments)}return t}()},{key:"getPlatformInfo",value:function(){var e=y()(f()().mark(function r(){var n;return f()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,I.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"getPlatformInfo"})});case 2:return n=a.sent,a.abrupt("return",n);case 4:case"end":return a.stop()}},r)}));function t(){return e.apply(this,arguments)}return t}()},{key:"getProjectId",value:function(){var t=Ie.m8.location.pathname.split("/");return t[t.length-1]}}]),o}(),Kt=ee()(rn.prototype,"members",[Jt,Yt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),rn))||Gt),yi=m(45332),fe=m.n(yi),Re=m(99138),Ee=m(64495),V=m(38644),re=m(20376),ke=m(64940),an=m(44549),on=m(35198),Ut=m(32368),Xt=m(84743),qt=m(36756),_t=m(99997),er,nr,tr,rr,ar,X,Ci=function(){var e=V.Z.useForm(),t=fe()(e,1),r=t[0],n=(0,ne.useState)(!1),i=fe()(n,2),a=i[0],s=i[1],c=(0,ne.useState)(!1),l=fe()(c,2),p=l[0],d=l[1],b=(0,$.oC)(me.yd),v=V.Z.useWatch([],r),T=function(){r.validateFields().then(function(){var x=y()(f()().mark(function A(Q){return f()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return d(!0),O.prev=1,O.next=4,b.service.inviteMember(Q.name);case 4:s(!1),r.resetFields(),re.ZP.success("Invitations have been sent out."),O.next=12;break;case 9:O.prev=9,O.t0=O.catch(1),O.t0 instanceof Error&&re.ZP.error(O.t0.message);case 12:return O.prev=12,d(!1),O.finish(12);case 15:return O.abrupt("return");case 16:case"end":return O.stop()}},A,null,[[1,9,12,15]])}));return function(A){return x.apply(this,arguments)}}()).catch(function(){})},E=(0,g.jsx)("div",{className:"secretnote-add-member",children:(0,g.jsxs)(V.Z,{form:r,autoComplete:"off",requiredMark:!1,labelCol:{span:4},wrapperCol:{span:20},style:{display:"flex"},children:[(0,g.jsx)(V.Z.Item,{label:"",name:"name",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u9080\u8BF7\u8005\u540D\u79F0"},{max:16,message:Ee.U6.t("\u540D\u79F0\u8FC7\u957F")}],children:(0,g.jsx)(ke.Z,{style:{width:256},maxLength:16,placeholder:"Add name to add member"})}),(0,g.jsx)(V.Z.Item,{wrapperCol:{offset:4,span:20},style:{marginBottom:0},children:(0,g.jsx)(an.Z,{children:(0,g.jsx)(on.ZP,{htmlType:"submit",onClick:function(){T()},disabled:v&&!v.name,loading:p,children:"Invite"})})})]})});return(0,g.jsxs)("div",{className:"secretnote-scql-member",children:[(0,g.jsx)(Ut.C.Group,{children:b.service.members.map(function(S){return(0,g.jsx)(Xt.Z,{title:"".concat(S.name),children:(0,g.jsx)(Ut.C,{shape:"square",style:{backgroundColor:S.color,cursor:"pointer"},children:(0,g.jsx)("span",{style:{color:(0,I.U_)(S.color)},children:S.name.slice(0,1).toUpperCase()})})},S.name)})}),(0,g.jsx)(qt.Z,{content:E,title:"",overlayStyle:{width:372},trigger:"click",placement:"bottomLeft",open:a,onOpenChange:function(x){r.resetFields(),s(x)},arrow:!1,children:(0,g.jsx)(on.ZP,{icon:(0,g.jsx)(_t.Z,{size:16}),className:"btn",onClick:function(){return s(!0)}})})]})},ir=(er=(0,j.ri)(),nr=(0,K.ei)("secretnote-scql-member-view"),tr=function(e,t){return(0,j.f3)(Ae)(e,void 0,0)},rr=Reflect.metadata("design:type",Function),ar=Reflect.metadata("design:paramtypes",[typeof Ae=="undefined"?Object:Ae]),er(X=nr(X=tr(X=rr(X=ar(X=function(o){oe()(t,o);var e=ue()(t);function t(r){var n;return R()(this,t),n=e.call(this),h()(C()(n),"view",Ci),h()(C()(n),"service",void 0),n.service=r,n}return Z()(t,[{key:"onViewMount",value:function(){this.service.getMemberList()}}]),t}(Re.P))||X)||X)||X)||X)||X),Si=Se.R.create().register(ir,Ae,(0,K.bQ)({slot:ze.Mx.right,view:ir,autoCreate:!0})),wi=m(42356),Ze=m(8328),or,ur,sr,lr,un,cr,ae=function(o){return o.UNDEFINED="",o.UNKNOWN="UNKNOWN",o.PLAINTEXT="PLAINTEXT",o.ENCRYPTED_ONLY="ENCRYPTED_ONLY",o.PLAINTEXT_AFTER_JOIN="PLAINTEXT_AFTER_JOIN",o.PLAINTEXT_AFTER_GROUP_BY="PLAINTEXT_AFTER_GROUP_BY",o.PLAINTEXT_AFTER_COMPARE="PLAINTEXT_AFTER_COMPARE",o.PLAINTEXT_AFTER_AGGREGATE="PLAINTEXT_AFTER_AGGREGATE",o}({}),Ei=[ae.UNKNOWN,ae.PLAINTEXT,ae.ENCRYPTED_ONLY,ae.PLAINTEXT_AFTER_JOIN,ae.PLAINTEXT_AFTER_GROUP_BY,ae.PLAINTEXT_AFTER_COMPARE,ae.PLAINTEXT_AFTER_AGGREGATE],ie=(or=(0,j.ri)(),ur=(0,$.vg)(),sr=Reflect.metadata("design:type",Array),or(lr=(un=function(){function o(){R()(this,o),_()(this,"dataTables",cr,this)}return Z()(o,[{key:"getDataTables",value:function(){var e=y()(f()().mark(function r(){var n,i,a,s,c,l;return f()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return n=[],d.next=3,this.getProjectInfo();case 3:if(i=d.sent,i){d.next=6;break}return d.abrupt("return");case 6:return d.next=8,this.getPlatformInfo();case 8:if(a=d.sent,a){d.next=11;break}return d.abrupt("return");case 11:return d.next=13,(0,I.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"getDataTables",project_id:this.getProjectId()})});case 13:s=d.sent,c=i.members,l=a.party,s&&c.forEach(function(b){var v=l===b,T={key:b,title:b,isLeaf:!1,belongToMe:v,children:[]};s.forEach(function(E){E.table_owner===b&&T.children.push({key:E.table_name,title:E.table_name,isLeaf:!0,data:{tableName:E.table_name,refTable:E.ref_table,dbType:E.db_type,tableOwner:E.table_owner,columns:E.columns},children:[],belongToMe:v})}),n.push(T)}),this.dataTables=n;case 18:case"end":return d.stop()}},r,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"addDataTable",value:function(){var e=y()(f()().mark(function r(n){return f()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,I.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"createTable",project_id:this.getProjectId(),table_name:n.tableName,ref_table:n.refTable,db_type:n.dbType,columns:n.columns})});case 2:this.getDataTables();case 3:case"end":return a.stop()}},r,this)}));function t(r){return e.apply(this,arguments)}return t}()},{key:"deleteDataTable",value:function(){var e=y()(f()().mark(function r(n){return f()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(n.isLeaf){a.next=2;break}return a.abrupt("return");case 2:return a.next=4,(0,I.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"deleteTable",project_id:this.getProjectId(),table_name:n.title})});case 4:this.getDataTables();case 5:case"end":return a.stop()}},r,this)}));function t(r){return e.apply(this,arguments)}return t}()},{key:"getTableCCL",value:function(){var e=y()(f()().mark(function r(n){var i,a,s,c,l;return f()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return i={owner:"",ccl:[]},d.next=3,this.getTableInfo(n);case 3:if(a=d.sent,a){d.next=6;break}return d.abrupt("return",i);case 6:return i.owner=a.table_owner,d.next=9,this.getProjectInfo();case 9:if(s=d.sent,s){d.next=12;break}return d.abrupt("return",i);case 12:return d.next=14,(0,I.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"getTableCCL",project_id:this.getProjectId(),table_name:n})});case 14:if(c=d.sent,c){d.next=17;break}return d.abrupt("return",i);case 17:return l=s.members,a.columns.forEach(function(b){var v={column:b.name};l.forEach(function(T){v[T]=ae.UNDEFINED}),c.forEach(function(T){var E=T.col,S=E.column_name,x=E.table_name;S===b.name&&x===n&&(v[T.party_code]=T.constraint)}),i.ccl.push(v)}),d.abrupt("return",i);case 20:case"end":return d.stop()}},r,this)}));function t(r){return e.apply(this,arguments)}return t}()},{key:"grantTableCCL",value:function(){var e=y()(f()().mark(function r(n,i){var a;return f()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return a=[],i.forEach(function(l){Object.keys(l).forEach(function(p){p!=="column"&&l[p]!==ae.UNDEFINED&&a.push({col:{column_name:l.column,table_name:n},party_code:p,constraint:l[p]})})}),c.next=4,(0,I.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"grantCCL",project_id:this.getProjectId(),ccl_list:a})});case 4:case"end":return c.stop()}},r,this)}));function t(r,n){return e.apply(this,arguments)}return t}()},{key:"getPlatformInfo",value:function(){var e=y()(f()().mark(function r(){var n;return f()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,I.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"getPlatformInfo"})});case 2:return n=a.sent,a.abrupt("return",n);case 4:case"end":return a.stop()}},r)}));function t(){return e.apply(this,arguments)}return t}()},{key:"getProjectInfo",value:function(){var e=y()(f()().mark(function r(){var n;return f()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,I.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"getProjectInfo",project_id:this.getProjectId()})});case 2:if(n=a.sent,n){a.next=6;break}return Ze.Z.info({title:"Info",content:"You were not involved in the project.",okText:"Back to project list",onOk:function(){Ie.m8.push("/scql/project")}}),a.abrupt("return");case 6:return a.abrupt("return",n);case 7:case"end":return a.stop()}},r,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"getTableInfo",value:function(){var e=y()(f()().mark(function r(n){var i;return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,(0,I.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"getTableInfo",project_id:this.getProjectId(),table_name:n})});case 2:return i=s.sent,s.abrupt("return",i);case 4:case"end":return s.stop()}},r,this)}));function t(r){return e.apply(this,arguments)}return t}()},{key:"getProjectId",value:function(){var t=Ie.m8.location.pathname.split("/");return t[t.length-1]}}]),o}(),cr=ee()(un.prototype,"dataTables",[ur,sr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),un))||lr),dr,fr,mr,vr,pr,q,ki=function(){var e=(0,$.oC)(me.yd);return(0,g.jsx)(Xt.Z,{title:Ee.U6.t("\u5237\u65B0"),children:(0,g.jsx)(wi.Z,{size:14,onClick:function(r){r.stopPropagation(),e.service.getDataTables(),re.ZP.success(Ee.U6.t("\u6570\u636E\u8868\u5DF2\u5237\u65B0"))}})})},hr=(dr=(0,j.ri)(),fr=(0,K.ei)("data-table-extra-view"),mr=function(e,t){return(0,j.f3)(ie)(e,void 0,0)},vr=Reflect.metadata("design:type",Function),pr=Reflect.metadata("design:paramtypes",[typeof ie=="undefined"?Object:ie]),dr(q=fr(q=mr(q=vr(q=pr(q=function(o){oe()(t,o);var e=ue()(t);function t(r){var n;return R()(this,t),n=e.call(this),h()(C()(n),"service",void 0),h()(C()(n),"view",ki),n.service=r,n}return Z()(t)}(Re.P))||q)||q)||q)||q)||q),Ti=m(19689),ji=m(42151),Ce=m(34011),gr=m(34186),Ni=m(49546),Oi=m(83869),Fi=m(80808),Pi=m(95004),Mi=m(68625),Ii=m(16108),Li=m(84176),$i=m.n(Li),br=m(58678),Ai=m(24943),Ri=["key","name"],Zi=function(e){var t=e.visible,r=e.close,n=e.data,i=V.Z.useForm(),a=fe()(i,1),s=a[0],c=(0,$.oC)(ie),l=!!(n&&n.tableName);(0,ne.useEffect)(function(){s&&n&&s.setFieldsValue(n)},[n,s]);var p=function(){s.validateFields().then(function(){var b=y()(f()().mark(function v(T){return f()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.prev=0,S.next=3,c.addDataTable(T);case 3:re.ZP.success("Add table successfully."),r(),S.next=10;break;case 7:S.prev=7,S.t0=S.catch(0),S.t0 instanceof Error&&re.ZP.error(S.t0.message);case 10:return S.abrupt("return");case 11:case"end":return S.stop()}},v,null,[[0,7]])}));return function(v){return b.apply(this,arguments)}}()).catch(function(){})};return(0,g.jsx)(Ze.Z,{open:t,destroyOnClose:!0,title:"New Table",onOk:function(){return p()},onCancel:function(){r()},children:(0,g.jsxs)(V.Z,{form:s,autoComplete:"off",requiredMark:!0,labelCol:{span:6},wrapperCol:{span:18},style:{marginTop:24,maxHeight:500,overflowY:"auto"},initialValues:{dbType:"mysql"},children:[(0,g.jsx)(V.Z.Item,{label:"\u6570\u636E\u5E93\u7C7B\u578B",name:"dbType",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6570\u636E\u5E93\u7C7B\u578B"}],children:(0,g.jsx)(ke.Z,{maxLength:16,disabled:l,placeholder:"mysql"})}),(0,g.jsx)(V.Z.Item,{label:"\u8868\u540D\u79F0",name:"tableName",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u8868\u540D\u79F0"}],children:(0,g.jsx)(ke.Z,{maxLength:16,disabled:l})}),(0,g.jsx)(V.Z.Item,{label:"\u5173\u8054\u8868",name:"refTable",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5173\u8054\u8868"}],children:(0,g.jsx)(ke.Z,{maxLength:32,disabled:l})}),(0,g.jsx)(V.Z.Item,{label:"\u6570\u636E\u5217",className:"secretnote-table-columns",required:!0,children:(0,g.jsx)(V.Z.List,{name:"columns",children:function(b,v){var T=v.add,E=v.remove;return(0,g.jsxs)(g.Fragment,{children:[b.map(function(S){var x=S.key,A=S.name,Q=$i()(S,Ri);return(0,g.jsxs)(an.Z,{style:{display:"flex",marginBottom:8},align:"baseline",children:[(0,g.jsx)(V.Z.Item,N()(N()({},Q),{},{name:[A,"name"],rules:[{required:!0,message:""}],children:(0,g.jsx)(ke.Z,{placeholder:"Column Name"})})),(0,g.jsx)(V.Z.Item,N()(N()({},Q),{},{name:[A,"dtype"],rules:[{required:!0,message:""}],children:(0,g.jsx)(br.Z,{style:{width:140},placeholder:"Data Type",options:[{label:"int",value:"int"},{label:"string",value:"string"},{label:"double",value:"double"}]})})),(0,g.jsx)(Ai.Z,{size:14,color:"#182431",cursor:"pointer",onClick:function(){return E(A)}})]},x)}),(0,g.jsx)(V.Z.Item,{children:(0,g.jsx)(on.ZP,{type:"dashed",onClick:function(){return T()},block:!0,icon:(0,g.jsx)(_t.Z,{size:16,color:"#182431"}),children:"Add Columns"})})]})}})})]})})},yr={id:"data-table-config-modal",component:Zi},Di=function(e){var t=e.visible,r=e.close,n=e.data,i=(0,ne.useState)([]),a=fe()(i,2),s=a[0],c=a[1],l=(0,ne.useState)(!1),p=fe()(l,2),d=p[0],b=p[1],v=(0,$.oC)(ie),T=(0,ne.useState)(""),E=fe()(T,2),S=E[0],x=E[1],A=function(){var O=y()(f()().mark(function k(){var P,F,H;return f()().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return z.prev=0,b(!0),z.next=4,v.getTableCCL(n.tableName);case 4:P=z.sent,F=P.ccl,H=P.owner,x(H),c(F),z.next=14;break;case 11:z.prev=11,z.t0=z.catch(0),z.t0 instanceof Error&&re.ZP.error(z.t0.message);case 14:return z.prev=14,b(!1),z.finish(14);case 17:case"end":return z.stop()}},k,null,[[0,11,14,17]])}));return function(){return O.apply(this,arguments)}}(),Q=function(){var O=y()(f()().mark(function k(){return f()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return F.prev=0,F.next=3,v.grantTableCCL(n.tableName,s);case 3:re.ZP.success("Ccl config successfully."),r(),F.next=10;break;case 7:F.prev=7,F.t0=F.catch(0),F.t0 instanceof Error&&re.ZP.error(F.t0.message);case 10:case"end":return F.stop()}},k,null,[[0,7]])}));return function(){return O.apply(this,arguments)}}(),he=s.length>0?Object.keys(s[0]).map(function(O){return O==="column"?{title:"Column",dataIndex:"column",key:"column"}:{title:"Grant to ".concat(O===S?O+"(you)":O),dataIndex:O,key:O,render:function(P,F){return(0,g.jsx)(br.Z,{options:Ei.map(function(H){return{label:H,value:H}}),value:P,size:"small",style:{width:260},popupClassName:"secret-note-ccl-select",onChange:function(Lr){var z=s.map(function(ln){return ln.column===F.column?N()(N()({},ln),{},h()({},O,Lr)):ln});c(z)}})}}}):[];return(0,g.jsxs)(Ze.Z,{width:720,open:t,destroyOnClose:!0,title:"CCL Config",onOk:function(){return Q()},onCancel:function(){r()},afterOpenChange:function(k){k&&A()},children:[(0,g.jsx)("a",{className:"secretnote-ccl-doc-link",href:"https://www.secretflow.org.cn/docs/scql/latest/zh-Hans/topics/ccl/intro",target:"_blank",rel:"noreferrer",children:"CCL configuration Guide"}),(0,g.jsx)(gr.Z,{className:"secretnote-ccl-table",dataSource:s,rowKey:"column",pagination:!1,columns:he,size:"small",loading:d})]})},Cr={id:"data-table-ccl-modal",component:Di},Sr,wr,Er,kr,Tr,jr,J,zi=ji.Z.DirectoryTree,Vi=function(e){var t=e.data,r=(0,ne.useState)([]),n=fe()(r,2),i=n[0],a=n[1],s=(0,$.oC)(me.yd),c=function(){var p=y()(f()().mark(function d(b){var v,T;return f()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.next=2,s.service.getTableCCL(b);case 2:v=S.sent,T=v.ccl,a(T);case 5:case"end":return S.stop()}},d)}));return function(b){return p.apply(this,arguments)}}();if((0,ne.useEffect)(function(){t&&c(t.tableName)},[t]),!t)return null;var l=i.length>0?Object.keys(i[0]).map(function(p){return p==="column"?{title:"Column",dataIndex:"column",key:"column"}:{title:"Grant to ".concat(p),dataIndex:p,key:p,render:function(b){return b||"-"}}}):[];return(0,g.jsx)("div",{className:"secretnote-node-description",children:(0,g.jsxs)(Ce.Z,{title:"\u8868\u4FE1\u606F",column:1,children:[(0,g.jsx)(Ce.Z.Item,{label:"\u6570\u636E\u5E93\u7C7B\u578B",children:t.dbType}),(0,g.jsx)(Ce.Z.Item,{label:"\u8868\u540D\u79F0",children:t.tableName}),(0,g.jsx)(Ce.Z.Item,{label:"\u5173\u8054\u8868",children:t.refTable}),(0,g.jsx)(Ce.Z.Item,{label:"\u6570\u636E\u5217",children:t.columns.map(function(p){return p.name}).join(", ")}),(0,g.jsx)(Ce.Z.Item,{label:"CCL",children:(0,g.jsx)(gr.Z,{className:"secretnote-ccl-view-table",dataSource:i,rowKey:"column",pagination:!1,columns:l,size:"small"})})]})})},Hi=function(){var e=(0,$.oC)(me.yd),t=e.service,r=function(a,s){switch(a){case"add":e.modalService.openModal(yr);break;case"configCCL":e.modalService.openModal(Cr,s.data);break;case"delete":Ze.Z.confirm({title:"\u5220\u9664\u6570\u636E\u8868",centered:!0,content:"\u6570\u636E\u8868 ".concat(s.title," \u5C06\u88AB\u5220\u9664"),okText:"\u5220\u9664\u6570\u636E\u8868",cancelText:Ee.U6.t("\u53D6\u6D88"),okType:"danger",onOk:function(l){return y()(f()().mark(function p(){return f()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,t.deleteDataTable(s);case 2:return re.ZP.success("\u6570\u636E\u8868\u5DF2\u5220\u9664"),b.abrupt("return",l(Promise.resolve));case 4:case"end":return b.stop()}},p)}))()}});break;default:break}},n=function(a){var s=a.isLeaf,c=a.belongToMe,l=c?[{key:"add",label:"\u6DFB\u52A0\u6570\u636E\u8868",icon:(0,g.jsx)(Ni.Z,{size:12})}]:[],p=c?[{key:"configCCL",label:"\u914D\u7F6E CCL",icon:(0,g.jsx)(Oi.Z,{size:12})},{type:"divider"},{key:"delete",label:Ee.U6.t("\u5220\u9664"),icon:(0,g.jsx)(Fi.Z,{size:12}),danger:!0}]:[],d=(0,g.jsxs)("div",{className:"ant-tree-title-content",children:[(0,g.jsx)("span",{className:"title",children:(0,g.jsxs)(an.Z,{children:[s&&(0,g.jsx)(Pi.Z,{size:16}),(0,g.jsx)("span",{children:a.title})]})}),(0,g.jsx)(Ii.h,{items:s?p:l,onClick:function(v){r(v,a)}})]});return s?(0,g.jsx)(qt.Z,{placement:"rightTop",align:{offset:[10,0]},arrow:!1,overlayStyle:{maxWidth:520},content:(0,g.jsx)(Vi,{data:a.data}),trigger:"hover",destroyTooltipOnHide:!0,children:d}):d};return(0,g.jsx)(zi,{blockNode:!0,onSelect:function(){},treeData:t.dataTables,className:"secretnote-data-table-tree",switcherIcon:(0,g.jsx)(Mi.Z,{size:12}),icon:null,titleRender:n})},sn="data-table",Nr=(Sr=(0,j.ri)({contrib:[ze.cI,Ti.l]}),wr=(0,K.ei)("secretnote-data-table-view"),Er=function(e,t){return(0,j.f3)(ie)(e,void 0,0)},kr=function(e,t){return(0,j.f3)(ye.Z)(e,void 0,1)},Tr=Reflect.metadata("design:type",Function),jr=Reflect.metadata("design:paramtypes",[typeof ie=="undefined"?Object:ie,typeof ye.Z=="undefined"?Object:ye.Z]),Sr(J=wr(J=Er(J=kr(J=Tr(J=jr(J=function(o){oe()(t,o);var e=ue()(t);function t(r,n){var i;return R()(this,t),i=e.call(this),h()(C()(i),"service",void 0),h()(C()(i),"modalService",void 0),h()(C()(i),"key",sn),h()(C()(i),"label","\u6570\u636E\u8868"),h()(C()(i),"order",2),h()(C()(i),"defaultOpen",!0),h()(C()(i),"view",Hi),i.service=r,i.modalService=n,i}return Z()(t,[{key:"onViewMount",value:function(){this.service.getDataTables()}},{key:"registerModals",value:function(){return[yr,Cr]}}]),t}(Re.P))||J)||J)||J)||J)||J)||J),Wi=Se.R.create().register(ie,Nr,hr,(0,K.bQ)({slot:sn,view:Nr,autoCreate:!0}),(0,K.bQ)({slot:"".concat(sn,"Extra"),view:hr,autoCreate:!0})),xi=m(62402),Or,Fr,Qi=(Or=(0,j.ri)({contrib:xi.H}),Or(Fr=function(){function o(){R()(this,o)}return Z()(o,[{key:"registerToolbarItems",value:function(t){t.unregisterItem(w.NzD.Interrupt.id),t.unregisterItem(w.NzD.RestartClearOutput.id)}}]),o}())||Fr),Bi=Se.R.create().register(Qi),Pr,Mr,De,Ji=function(){return(0,g.jsx)("div",{className:"secretnote-welcome-page",children:"Welcome to SecretNote."})},Ir=(Pr=(0,j.ri)(),Mr=(0,K.ei)("secretnote-welcome-view"),Pr(De=Mr(De=function(o){oe()(t,o);var e=ue()(t);function t(){var r;R()(this,t);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return r=e.call.apply(e,[this].concat(i)),h()(C()(r),"view",Ji),r}return Z()(t)}(Re.P))||De)||De),Yi=Se.R.create().register(Ir,(0,K.bQ)({slot:dn.ux.welcome,view:Ir,autoCreate:!0})),Gi=m(20252),Ki=m(97341),Ui=m(352),Xi=function(){return(0,g.jsx)($r.rF.Application,{asChild:!0,modules:[Ar.n6L,ze.xu,Ki.O,Gi.F,dn.qi,Si,Wi,bi,Ui.V,Rr.p,Yi,Bi]},"libro-app")},qi=Xi}}]);
