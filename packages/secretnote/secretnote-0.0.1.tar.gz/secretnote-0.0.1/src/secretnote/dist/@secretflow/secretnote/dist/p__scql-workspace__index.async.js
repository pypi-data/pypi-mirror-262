"use strict";(self.webpackChunk_secretflow_secretnote=self.webpackChunk_secretflow_secretnote||[]).push([[47],{25069:function(Gi,sn,m){m.r(sn),m.d(sn,{default:function(){return Yi}});var Ki=m(83109),Pr=m(43256),Fr=m(45362),De=m(20904),Mr=m(31300),ln=m(40256),S=m(58601),Ce=m(84880),Ir=m(90819),f=m.n(Ir),Lr=m(89933),y=m.n(Lr),$r=m(78796),R=m.n($r),Ar=m(4977),Z=m.n(Ar),Rr=m(10154),h=m.n(Rr),j=m(47302),ke=Symbol("SQLCellModelFactory"),Zr=m(73193),N=m.n(Zr),Dr=m(26336),te=m.n(Dr),zr=m(41553),C=m.n(zr),Vr=m(78846),cn=m.n(Vr),Hr=m(54088),dn=m.n(Hr),Wr=m(49488),re=m.n(Wr),xr=m(84047),ae=m.n(xr),Qr=m(62055),ie=m.n(Qr),Ui=m(23202),D=m(38168),fe=m(91798),Y=m(53353),ze=m(7317),pe=m(17313),oe=m(58757),Br=m(31025),Jr=m(92416),fn=m(79239),Ve=m(28582),z=m(23574),L=m(95881),Yr=m(98612),Gr=m(86919),I=m(17),Te=null,je={},mn=function(){var e=location.pathname.split("/");return e[e.length-1]},vn=function(){var o=y()(f()().mark(function e(){return f()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!Te){r.next=4;break}return r.next=3,Te;case 3:return r.abrupt("return",r.sent);case 4:return Te=new Promise(function(n,i){(0,L.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"getDataTables",project_id:mn()})}).then(function(a){var s=a.map(function(c){return{name:c.table_name,owner:c.table_owner,columns:c.columns}});n(s)}).catch(function(a){i(a)})}),r.next=7,Te;case 7:return r.abrupt("return",r.sent);case 8:case"end":return r.stop()}},e)}));return function(){return o.apply(this,arguments)}}(),He=function(){var o=y()(f()().mark(function e(t){return f()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!je[t]){n.next=4;break}return n.next=3,je[t];case 3:return n.abrupt("return",n.sent);case 4:return je[t]=new Promise(function(i,a){(0,L.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"getTableCCL",project_id:mn(),table_name:t})}).then(function(s){var c=[];s.forEach(function(l){var p=l.col.column_name,d=l.party_code,b=l.constraint,v=c.find(function(T){return T.column===p});v?v[d]=b:c.push(h()({column:p},d,b))}),i(c)}).catch(function(s){a(s)})}),n.next=7,je[t];case 7:return n.abrupt("return",n.sent);case 8:case"end":return n.stop()}},e)}));return function(t){return o.apply(this,arguments)}}(),We=function(e){return e.length<1?"":`
  <table border="1" class="dataframe">
    <thead>
      <tr>
        `.concat(Object.keys(e[0]).map(function(t){return"<th>".concat(t,"</th>")}).join(`
`),`
      </tr>
    </thead>
    <tbody>
      `).concat(e.map(function(t){return`<tr>
              `.concat(Object.keys(t).map(function(r){return"<td>".concat(t[r],"</td>")}).join(`
`),`
            </tr>`)}).join(`
`),`
    </tbody>
  </table>
  `)},Kr=function(){var o=y()(f()().mark(function e(){var t;return f()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,vn();case 2:return t=n.sent,n.abrupt("return",t.map(function(i){return{label:i.name,insertText:i.name,sortText:"A".concat(i.name),kind:z.Mj.CompletionItemKind.Folder,detail:i.owner}}));case 4:case"end":return n.stop()}},e)}));return function(){return o.apply(this,arguments)}}(),Ne=function(){var o=y()(f()().mark(function e(t){var r,n;return f()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return r=I.Z(t,"tableName.value",""),a.next=3,vn();case 3:if(n=a.sent.find(function(s){return s.name===r}),n){a.next=6;break}return a.abrupt("return",[]);case 6:return a.abrupt("return",n.columns.map(function(s){return{label:s.name,insertText:s.name,sortText:"B".concat(s.name),kind:z.Mj.CompletionItemKind.Field,detail:s.dtype}}));case 7:case"end":return a.stop()}},e)}));return function(t){return o.apply(this,arguments)}}(),pn=function(e){return Promise.resolve(["SUM","COUNT","AVG"].map(function(t){return{label:t,insertText:t,sortText:"C".concat(t),kind:z.Mj.CompletionItemKind.Function}}))},Ur=function(e){return{label:e,insertText:e,sortText:"D".concat(e),kind:z.Mj.CompletionItemKind.Folder}},Xr=function(){var o=y()(f()().mark(function e(){var t,r,n,i,a,s=arguments;return f()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:for(t=s.length,r=new Array(t),n=0;n<t;n++)r[n]=s[n];if(i=I.Z(r,"[0].tableInfo.tableName.value",""),i){l.next=4;break}return l.abrupt("return",[]);case 4:return l.next=6,He(i);case 6:if(a=l.sent,a&&a.length){l.next=9;break}return l.abrupt("return",[]);case 9:return l.abrupt("return",[{value:We(a),supportHtml:!0,isTrusted:!0}]);case 10:case"end":return l.stop()}},e)}));return function(){return o.apply(this,arguments)}}(),hn=function(){var o=y()(f()().mark(function e(){var t,r,n,i,a,s=arguments;return f()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(s.length!==2){l.next=23;break}if(t=s.length<=0?void 0:s[0],r=s.length<=1?void 0:s[1],!t){l.next=23;break}if(r!==null){l.next=13;break}return l.next=7,He(t);case 7:if(n=l.sent,n&&n.length){l.next=10;break}return l.abrupt("return",[]);case 10:return l.abrupt("return",[{value:We(n),supportHtml:!0,isTrusted:!0}]);case 13:if(!(r&&r.groupPickerName)){l.next=23;break}return l.next=16,He(r.groupPickerName);case 16:if(i=l.sent,i&&i.length){l.next=19;break}return l.abrupt("return",[]);case 19:if(a=i.find(function(p){return p.column===t}),a){l.next=22;break}return l.abrupt("return",[]);case 22:return l.abrupt("return",[{value:We([a]),supportHtml:!0,isTrusted:!0}]);case 23:return l.abrupt("return",[]);case 24:case"end":return l.stop()}},e)}));return function(){return o.apply(this,arguments)}}(),qr=function(){return Promise.resolve([])},_r=m(12689),ea=m(83788),na=m(67876);function xe(o,e){return Qe.apply(this,arguments)}function Qe(){return Qe=y()(f()().mark(function o(e,t){var r,n,i;return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(e){s.next=2;break}return s.abrupt("return",null);case 2:if(r=I.Z(e,t),n=t.slice().pop(),i=I.Z(e,t.slice(0,t.length-1)),i){s.next=7;break}return s.abrupt("return",null);case 7:return s.next=9,gn(i,function(){var c=y()(f()().mark(function l(p){return f()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:b.t0=p,b.next=b.t0==="identifier.tableName"?3:b.t0==="identifier.column"?4:b.t0==="identifier.columnAfterGroup"?7:b.t0==="function"?8:9;break;case 3:return b.abrupt("return",{type:"tableName",variant:n,token:r,tableInfo:i});case 4:if(n!=="name"){b.next=6;break}return b.abrupt("return",{type:"tableField",token:r});case 6:return b.abrupt("return",null);case 7:return b.abrupt("return",{type:"tableFieldAfterGroup",token:r,groupName:i.groupName.value});case 8:return b.abrupt("return",{type:"functionName",token:r});case 9:case"end":return b.stop()}},l)}));return function(l){return c.apply(this,arguments)}}());case 9:return s.abrupt("return",s.sent);case 10:case"end":return s.stop()}},o)})),Qe.apply(this,arguments)}function Be(o,e,t){if(!o||e.length===0)return null;var r=I.Z(o,e);if(!r)throw Error("Path not found from ast!");if(!r.token&&r.type==="statement")if(t){if(t(r)===!0)return r}else return r;return e.length>1?Be(o,e.slice(0,e.length-1),t):null}function Je(o,e,t){return Ye.apply(this,arguments)}function Ye(){return Ye=y()(f()().mark(function o(e,t,r){var n,i,a,s;return f()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,xe(e,t);case 2:if(n=l.sent,i=Be(e,t),!(!n||!i)){l.next=6;break}return l.abrupt("return",[]);case 6:l.t0=i.variant,l.next=l.t0==="select"?9:l.t0==="join"?10:16;break;case 9:return l.abrupt("return",Oe(i,I.Z(i,"from.sources",[]),n,r));case 10:if(a=t.slice(),a.pop(),s=Be(e,a,function(p){return p.variant==="select"}),s){l.next=15;break}return l.abrupt("return",[]);case 15:return l.abrupt("return",Oe(s,I.Z(s,"from.sources",[]),n,r));case 16:return l.abrupt("return",[]);case 17:case"end":return l.stop()}},o)})),Ye.apply(this,arguments)}function Oe(o,e,t,r){return Ge.apply(this,arguments)}function Ge(){return Ge=y()(f()().mark(function o(e,t,r,n){var i;return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,Promise.all(t.map(function(c){return Ke(e,c,r,n)}));case 2:return i=s.sent,s.abrupt("return",_r.Z(i).filter(function(c){return!!c}));case 4:case"end":return s.stop()}},o)})),Ge.apply(this,arguments)}function Ke(o,e,t,r){return Ue.apply(this,arguments)}function Ue(){return Ue=y()(f()().mark(function o(e,t,r,n){return f()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",gn(t,function(){var s=y()(f()().mark(function c(l){var p,d,b,v,T,w,E,P,F,A,M;return f()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:O.t0=l,O.next=O.t0==="statement.tableSource"?3:O.t0==="statement.join"?15:O.t0==="identifier.table"?16:O.t0==="statement.select"?26:34;break;case 3:return O.next=5,Ke(e,t.source,r,n);case 5:if(p=O.sent,!ea.Z(t.joins)){O.next=12;break}return O.next=9,Oe(e,I.Z(t,"joins",[]),r,n);case 9:O.t1=O.sent,O.next=13;break;case 12:O.t1=[];case 13:return d=O.t1,O.abrupt("return",p.concat(d));case 15:return O.abrupt("return",Ke(e,t.join,r,n));case 16:return b=t,O.next=19,n(b.name,r.token.value,e);case 19:return v=O.sent,T=I.Z(b,"name.tableNames",[]),w=null,E=I.Z(b,"alias.value"),E?w=E:(P=0,T.forEach(function(V){var X=I.Z(b,"name.".concat(V,".value"));X&&(P++,w=X)}),P>1&&(w=null)),v=v.map(function(V){return N()(N()({},V),{},{tableInfo:b.name,groupPickerName:w||"",originFieldName:V.label})}),O.abrupt("return",v);case 26:return F=t,A=[],O.next=30,Oe(F,F.from.sources,r,n);case 30:return M=O.sent,F.result.length===1&&F.result[0].name.value==="*"?A=M.slice():A=M.map(function(V){var X=F.result.find(function(de){return I.Z(de.name,"token")===!0?de.name.value===V.label:I.Z(de.name,"type")==="identifier"&&I.Z(de.name,"variant")==="columnAfterGroup"?I.Z(de.name,"name.value")===V.label:I.Z(de.name,"type")==="identifier"&&I.Z(de.name,"variant")==="groupAll"?I.Z(de.name,"groupName.value")===V.groupPickerName:!1});return X?X.alias?N()(N()({},V),{},{label:X.alias.value}):V:null}).filter(function(V){return V!==null}).slice(),na.Z(F,"alias.value")&&(A=A.map(function(V){return N()(N()({},V),{},{groupPickerName:I.Z(F,"alias.value")})})),O.abrupt("return",A);case 34:return O.abrupt("return",null);case 35:case"end":return O.stop()}},c)}));return function(c){return s.apply(this,arguments)}}()));case 1:case"end":return a.stop()}},o)})),Ue.apply(this,arguments)}function gn(o,e){return Xe.apply(this,arguments)}function Xe(){return Xe=y()(f()().mark(function o(e,t){return f()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(e){n.next=2;break}return n.abrupt("return",null);case 2:if(!e.variant){n.next=4;break}return n.abrupt("return",t("".concat(e.type,".").concat(e.variant)));case 4:return n.abrupt("return",t(e.type));case 5:case"end":return n.stop()}},o)})),Xe.apply(this,arguments)}function bn(o,e,t,r){return qe.apply(this,arguments)}function qe(){return qe=y()(f()().mark(function o(e,t,r,n){var i,a;return f()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,Je(e,n,r);case 2:if(i=c.sent,a=i.find(function(l){return l.label===t.token.value}),a){c.next=6;break}return c.abrupt("return",null);case 6:return c.abrupt("return",a);case 7:case"end":return c.stop()}},o)})),qe.apply(this,arguments)}var u=m(23298),ta=(0,u.createLexer)([{type:"whitespace",regexes:[/^(\s+)/],ignore:!0},{type:"comment",regexes:[/^((?:#|--).*?(?:\n|$))/,/^(\/\*[^]*?(?:\*\/|$))/],ignore:!0},{type:"number",regexes:[/^([0-9]+(\.[0-9]+)?|0x[0-9a-fA-F]+|0b[01]+)\b/]},{type:"word",regexes:[/^([a-zA-Z0-9_]+)/,/^(\$\{[a-zA-Z0-9_]+\})/]},{type:"string",regexes:[/^((?=")(?:"[^"\\]*(?:\\[\s\S][^"\\]*)*"))/,/^((?=')(?:'[^'\\]*(?:\\[\s\S][^'\\]*)*'))/,/^((?=`)(?:`[^`\\]*(?:\\[\s\S][^`\\]*)*`))/]},{type:"special",regexes:[/^(\(|\))/,/^(!=|<>|==|<=|>=|!<|!>|\|\||::|->>|->|~~\*|~~|!~~\*|!~~|~\*|!~\*|!~|.)/]}]);function ra(o){var e=function(){return(0,u.chain)(r,t)(function(l){return l[0]})},t=function c(){return(0,u.chain)((0,u.optional)(a,r,c))()},r=function(){return(0,u.chain)(s,n)(function(l){return l[0]})},n=function c(){return(0,u.chain)((0,u.optional)(i,s,c))()},i=function(){return(0,u.chain)(["*","/","%"])(function(l){return l[0]})},a=function(){return(0,u.chain)(["+","-"])(function(l){return l[0]})},s=function(){return(0,u.chain)([(0,u.chain)("(",e,")")(function(l){return l[1]}),o])(function(l){return l[0]})};return e}var aa=["select","create","insert","from","where","order","limit","by","sounds","like","is","in","between","regexp","isnull","lateral","left","right","inner","outer","join"],yn=function(){return(0,u.chain)([(0,u.chain)(["char","varchar","tinytext","text","mediumtext","longtext"])(function(e){return e[0]}),(0,u.chain)(["tinyint","smallint","mediumint","int","integer","bigint"])(function(e){return e[0]}),(0,u.chain)(["real","double","float"])(function(e){return e[0]}),(0,u.chain)(["decimal","numberic"])(function(e){return e[0]}),(0,u.chain)(["date","tinyblob","blob","mediumblob","longblob","bool","boolean"])(function(e){return e[0]}),(0,u.chain)(["bit","time","timestamp","datetime","binary","varbinary","year"])(function(e){return e[0]}),(0,u.chain)(["enum","set"])(function(e){return e[0]}),(0,u.chain)("geometrycollection","linestring","multilinestring","multipoint","multipolygon","point","polygon")(function(e){return e[0]})])(function(e){return e[0]})},Cn=function(){return(0,u.chain)(W,"=",[B,q])()},ia=function(){return(0,u.chain)(Cn,(0,u.many)(",",Cn))()},W=function(){return(0,u.chain)([(0,u.matchTokenType)("cursor"),(0,u.matchTokenType)("word",{excludes:aa})])(function(e){return e[0]})},B=function(){return(0,u.chain)((0,u.matchTokenType)("string"))(function(e){return e[0]})},q=function(){return(0,u.chain)((0,u.matchTokenType)("number"))(function(e){return e[0]})},me=function(){return(0,u.chain)([W,B])(function(e){return e[0]})},oa=function(){return(0,u.chain)([W,B,ua])(function(e){return e[0]})},ua=function(){return(0,u.chain)((0,u.optional)(["-","+"]),q)()},sa=function(){return(0,u.chain)(["and","&&","xor","or","||"])(function(e){return e[0]})},la=function(){return(0,u.chain)(["&&","||"])(function(e){return e[0]})},ca=function(){return(0,u.chain)(["=",">","<","<=",">=","<>","!=","<=>"])(function(e){return e[0]})},da=function(){return(0,u.chain)(["not","!"])(function(e){return e[0]})},fa=function(){return(0,u.chain)(["all","distinct","distinctrow","high_priority","straight_join","sql_small_result","sql_big_result","sql_buffer_result","sql_cache","sql_no_cache","sql_calc_found_rows"])(function(e){return e[0]})};function ma(o){return o!=null}function Se(o){return o.filter(function(e){return ma(e)}).reduce(function(e,t){return e.concat(t)},[])}function Sn(o){var e={type:"identifier",variant:"tableName"};return Object.keys(o).forEach(function(t){e[t]=o[t]}),e.tableNames=Object.keys(o),e}var va=function(){return(0,u.chain)(pa,(0,u.optional)(";"))(function(e){return e[0]})},pa=function(){return(0,u.chain)(wn,(0,u.many)((0,u.chain)(";",wn)(function(e){return e[1]})))(Se)},wn=function(){return(0,u.chain)([he,wa,Oa,Na,Wa,Ka,_a,ei])(function(e){return e[0]})},he=function o(){return(0,u.chain)("select",ba,(0,u.optional)(ga),(0,u.optional)(Pn),(0,u.optional)(Ra),(0,u.optional)(ha,o))(function(e){var t={type:"statement",variant:"select",result:e[1],from:e[2]};return e[5]&&(t.union=e[5]),t})},ha=function(){return(0,u.chain)("union",["all","distinct"])()},ga=function(){return(0,u.chain)("from",Ca,(0,u.optional)(Pe),(0,u.optional)(Ma),(0,u.optional)(ja))(function(e){return{sources:e[1],where:e[2],group:e[3],having:e[4]}})},ba=function(){return(0,u.chain)(En,(0,u.many)(ya))(Se)},ya=function(){return(0,u.chain)(",",En)(function(e){return e[1]})},En=function(){return(0,u.chain)([(0,u.chain)((0,u.many)("not"),[(0,u.chain)(J,(0,u.optional)($a))(function(e){return e[0]}),(0,u.chain)("(",J,")")()],(0,u.optional)(en))(function(e){return{type:"identifier",variant:"column",name:e[1],alias:e[2]}}),"*"])(function(e){return e[0]})},Pe=function(){return(0,u.chain)("where",ue)(function(e){return e[1]})},kn=function(){return(0,u.chain)(se,(0,u.many)(",",se))()},Ca=function(){return(0,u.chain)(Tn,(0,u.many)((0,u.chain)(",",Tn)(function(e){return e[1]})))(Se)},Tn=function(){return(0,u.chain)(_e,(0,u.many)(Sa))(function(e){return{source:e[0],joins:e[1],type:"statement",variant:"tableSource"}})},_e=function(){return(0,u.chain)([(0,u.chain)(On,(0,u.optional)(en))(function(e){return{type:"identifier",variant:"table",name:e[0],alias:e[1]}}),(0,u.chain)([he,(0,u.chain)("(",he,")")(function(e){return e[1]})],en)(function(e){return N()(N()({},e[0]),{},{alias:e[1]})})])(function(e){return e[0]})},Sa=function(){return(0,u.chain)(["join","straight_join",(0,u.chain)(["inner","cross","full"],"join")(),(0,u.chain)(["left","right"],(0,u.optional)("outer"),"join")(),(0,u.chain)("natural",(0,u.optional)(["left","right"],(0,u.optional)("outer")),"join")()],_e,(0,u.optional)("on",ue))(function(e){return{type:"statement",variant:"join",join:e[1],conditions:e[2]}})},en=function(){return(0,u.chain)([(0,u.chain)("as",me)(function(e){return e[1]}),me])(function(e){return e[0]})},wa=function(){return(0,u.chain)("create","table",me,"(",Ta,")",(0,u.optional)(Ea))()},Ea=function(){return(0,u.chain)("with","(",ka,")")()},ka=function(){return(0,u.chain)(jn,(0,u.many)(",",jn))()},jn=function(){return(0,u.chain)(W,"=",B)()},Ta=function(){return(0,u.chain)(Nn,(0,u.many)(",",Nn))()},Nn=function(){return(0,u.chain)(me,yn)()},Xi=function o(){return chain(wordSym,optional(",",o))()},On=function(){return(0,u.chain)([(0,u.chain)(me)(),(0,u.chain)(me,".",me)(function(e){return[e[0],e[2]]})])(function(e){if(e[0].length===1)return Sn({namespace:"",tableName:e[0][0]});if(e[0].length===2)return Sn({namespace:e[0][0],tableName:e[0][1]})})},ja=function(){return(0,u.chain)("having",ue)()},Na=function(){return(0,u.chain)("create","view",W,"as",he)()},Oa=function(){return(0,u.chain)("insert",(0,u.optional)("ignore"),"into",On,(0,u.optional)(Pa),[he])(function(e){return{type:"statement",variant:"insert",into:{type:"indentifier",variant:"table",name:e[3]},result:e[5]}})},Pa=function(){return(0,u.chain)("(",Fa,")")()},Fa=function(){return(0,u.chain)(W,(0,u.many)(",",W))()},Ma=function(){return(0,u.chain)("group","by",kn)()},Pn=function(){return(0,u.chain)("order","by",Ia)()},Ia=function(){return(0,u.chain)(Fn,(0,u.many)(",",Fn))()},Fn=function(){return(0,u.chain)(ue,(0,u.optional)(["asc","desc"]))()},La=function(){return(0,u.chain)([W,(0,u.chain)("partition","by",ue)()])(function(e){return e})},$a=function(){return(0,u.chain)("over","(",Aa,")")()},Aa=function o(){return(0,u.chain)([La,(0,u.chain)(J,Pn)()],(0,u.many)(",",o))()},Ra=function(){return(0,u.chain)("limit",[q,(0,u.chain)(q,",",q)(),(0,u.chain)(q,"offset",q)()])()},Za=function(){return(0,u.chain)([za,Mn,Da])(function(e){return e[0]})},Da=function(){return(0,u.chain)("if","(",Fe,",",J,",",J,")")(function(e){return{type:"function",name:"if",args:[e[2],e[4],e[6]]}})},za=function(){return(0,u.chain)("cast","(",J,"as",yn,")")(function(e){return{type:"function",name:"cast",args:[e[2],e[4]]}})},Mn=function(){return(0,u.chain)(W,"(",(0,u.optional)(Va),")",(0,u.optional)("filter","(",Pe,")"))(function(e){return{type:"function",name:e[0],args:e[2]}})},Va=function(){return(0,u.chain)(In,(0,u.many)(",",In))()},In=function(){return(0,u.chain)((0,u.many)(fa),[se,Ln])(function(e){return e})},Ln=function(){return(0,u.chain)("case",(0,u.plus)(Ha),(0,u.optional)("else",[se,"null"]),["end",(0,u.chain)("end","as",W)()])()},Ha=function(){return(0,u.chain)("when",ue,"then",Rn)()},Wa=function(){return(0,u.chain)("set",xa)()},xa=function(){return(0,u.chain)($n,(0,u.many)(",",$n))()},$n=function(){return(0,u.chain)(Qa,"=",["true","false",B,q])()},Qa=function(){return(0,u.chain)(W,(0,u.many)(".",W))()},ue=function o(){return(0,u.chain)(Ba,(0,u.many)(sa,o))(Se)},Ba=function(){return(0,u.chain)([(0,u.chain)("(",ue,")")(),(0,u.chain)(da,ue)(),(0,u.chain)(Ja)],(0,u.optional)((0,u.chain)("is",(0,u.optional)("not"),["true","false","unknown"])()))(function(e){return e[0]})},Ja=function(){return(0,u.chain)(Fe,(0,u.many)(["isnull",(0,u.chain)([(0,u.chain)("is","not")(),"is","not"],["null",se])()]))(Se)},Fe=function o(){return(0,u.chain)([(0,u.chain)(se,An)(),(0,u.chain)("(",o,")",An)()])()},An=function(){return(0,u.chain)((0,u.optional)([(0,u.chain)(ca,se)(),(0,u.chain)("sounds","like",se)(),Ya]),(0,u.optional)(["or",Fe]))()},se=function(){return(0,u.chain)(J)(function(e){return{type:"identifier",variant:"column",name:e[0]}})},Ya=function(){return(0,u.chain)((0,u.optional)("is"),(0,u.optional)("not"),[(0,u.chain)("in","(",[he,kn],")")(),(0,u.chain)("between",J,"and",Fe)(),(0,u.chain)("like",J,(0,u.optional)("escape",J))(),(0,u.chain)("regexp",J)(),"null"])()},Rn=function(){return(0,u.chain)(Zn,(0,u.many)(la,Zn))(function(e){return e[1]?[e[0],e[1]]:e[0]})},Zn=function(){return(0,u.chain)([Za,Ln,(0,u.chain)(oa,(0,u.optional)([(0,u.chain)(".","*")(function(e){return{type:"identifier",variant:"groupAll"}}),(0,u.chain)(":",Mn)(),Ga]))(function(e){return e[1]?N()(N()({},e[1]),{},{groupName:e[0]}):e[0]}),"*"])(function(e){return e[0]})},Ga=function(){return(0,u.chain)(".",[B,q,(0,u.chain)(W)(function(e){return{type:"identifier",variant:"columnAfterGroup",name:e[0]}})])(function(e){return e[1]})},J=function(){return ra(Rn)()},Ka=function(){return(0,u.chain)("create","index",Ua,Xa,Pe)()},Ua=function(){return(0,u.chain)(B,(0,u.many)(".",B))()},Xa=function(){return(0,u.chain)("ON",B,"(",qa,")")()},Dn=function(){return(0,u.chain)(B,(0,u.optional)(["ASC","DESC"]))()},qa=function(){return(0,u.chain)(Dn,(0,u.many)(",",Dn))()},_a=function(){return(0,u.chain)("create","function",W,"as",B)()},ei=function(){return(0,u.chain)("UPDATE",_e,"SET",ia,(0,u.optional)(Pe))()},ni=(0,u.createParser)(va,ta,{cursorTokenExcludes:function(e){return(e==null?void 0:e.value)==="."||(e==null?void 0:e.value)===":"}}),zn="sql",ti=" $.:{}=abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),nn=function(e,t){return ni(e.getValue(),e.getOffsetAt(t))},ri=function(){return{suggestions:[]}},ai=function(e){return e.filter(function(t){return t.type==="string"}).map(function(t){var r=/[a-zA-Z]+/.test(t.value.toString())?Yr.Z(t.value.toString()):t.value.toString();return{label:r,insertText:r,documentation:"documentation",detail:"detail",kind:z.Mj.CompletionItemKind.Keyword,sortText:"W".concat(t.value)}})};z.Mj.registerCompletionItemProvider(zn,{triggerCharacters:ti,provideCompletionItems:function(){var o=y()(f()().mark(function e(t,r){var n,i,a,s,c,l,p,d;return f()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(n=nn(t,r),n){v.next=3;break}return v.abrupt("return",ri());case 3:return v.next=5,xe(n.ast,n.cursorKeyPath);case 5:if(i=v.sent,a=ai(n.nextMatchings),i){v.next=9;break}return v.abrupt("return",{suggestions:a});case 9:v.t0=i.type,v.next=v.t0==="tableField"?12:v.t0==="tableFieldAfterGroup"?20:v.t0==="tableName"?24:v.t0==="functionName"?28:29;break;case 12:return v.next=14,Je(n.ast,n.cursorKeyPath,Ne);case 14:return s=v.sent,c=Gr.Z(s.filter(function(T){return T.groupPickerName!==null}),"groupPickerName"),v.next=18,pn(i.token.value);case 18:return l=v.sent,v.abrupt("return",{suggestions:s.concat(a).concat(l).concat(c?Object.keys(c).map(function(T){return Ur(T)}):[])});case 20:return v.next=22,Je(n.ast,n.cursorKeyPath,Ne);case 22:return p=v.sent,v.abrupt("return",{suggestions:p.filter(function(T){return T.groupPickerName===i.groupName}).concat(a)});case 24:return v.next=26,Kr(i);case 26:return d=v.sent,v.abrupt("return",{suggestions:d.concat(a)});case 28:return v.abrupt("return",{suggestions:pn(i.token.value)});case 29:return v.abrupt("return",{suggestions:a});case 30:case"end":return v.stop()}},e)}));return function(t,r){return o.apply(this,arguments)}}()}),z.Mj.registerHoverProvider(zn,{provideHover:function(){var o=y()(f()().mark(function t(r,n){var i,a,s,c,l;return f()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(i=nn(r,n),i){d.next=3;break}return d.abrupt("return",null);case 3:return d.next=5,xe(i.ast,i.cursorKeyPath);case 5:if(a=d.sent,a){d.next=8;break}return d.abrupt("return",null);case 8:s=[],d.t0=a.type,d.next=d.t0==="tableField"?12:d.t0==="tableFieldAfterGroup"?19:d.t0==="tableName"?26:d.t0==="functionName"?30:34;break;case 12:return d.next=14,bn(i.ast,a,Ne,i.cursorKeyPath);case 14:return c=d.sent,d.next=17,hn(a.token.value,c);case 17:return s=d.sent,d.abrupt("break",34);case 19:return d.next=21,bn(i.ast,a,Ne,i.cursorKeyPath);case 21:return l=d.sent,d.next=24,hn(a.token.value,l);case 24:return s=d.sent,d.abrupt("break",34);case 26:return d.next=28,Xr(a);case 28:return s=d.sent,d.abrupt("break",34);case 30:return d.next=32,qr(a.token.value);case 32:return s=d.sent,d.abrupt("break",34);case 34:return d.abrupt("return",{range:z.e6.fromPositions(r.getPositionAt(a.token.position[0]),r.getPositionAt(a.token.position[1]+1)),contents:s});case 35:case"end":return d.stop()}},t)}));function e(t,r){return o.apply(this,arguments)}return e}()});var Vn=m(94582);z.Mj.registerDocumentFormattingEditProvider("sql",{provideDocumentFormattingEdits:function(e){var t=(0,Vn.WU)(e.getValue());return[{range:e.getFullModelRange(),text:t}]}}),z.Mj.registerDocumentRangeFormattingEditProvider("sql",{provideDocumentRangeFormattingEdits:function(e,t){var r=(0,Vn.WU)(e.getValueInRange(t));return[{range:t,text:r}]}});var ii=function(){function o(e){var t=this;R()(this,o),h()(this,"editorReadyDeferred",new Br.B),h()(this,"editorReady",this.editorReadyDeferred.promise),h()(this,"editorHost",void 0),h()(this,"_model",void 0),h()(this,"_uuid",""),h()(this,"_config",void 0),h()(this,"_isDisposed",!1),h()(this,"toDispose",new Jr.K),h()(this,"oldDeltaDecorations",[]),h()(this,"modalChangeEmitter",new fn.Q5),h()(this,"monacoEditor",void 0),h()(this,"host",void 0),h()(this,"editorState",void 0),h()(this,"setOption",function(r,n){if(n!=null){var i=["fontFamily","fontSize","lineHeight","wordWrapColumn","lineWrap"],a=i.concat(["readOnly","insertSpaces","tabSize"]);if(a.includes(r)){var s;t._config=N()(N()({},t._config),{},h()({},r,n)),(s=t.monacoEditor)===null||s===void 0||s.updateOptions(t.toMonacoOptions(t._config))}i.includes(r)&&t.updateEditorSize()}}),h()(this,"getLine",function(r){var n;return(n=t.monacoEditor)===null||n===void 0||(n=n.getModel())===null||n===void 0?void 0:n.getLineContent(r)}),h()(this,"getOffsetAt",function(r){var n;return((n=t.monacoEditor)===null||n===void 0||(n=n.getModel())===null||n===void 0?void 0:n.getOffsetAt({lineNumber:r.line,column:r.column}))||0}),h()(this,"undo",function(){var r;(r=t.monacoEditor)===null||r===void 0||r.trigger("source","undo",{})}),h()(this,"redo",function(){var r;(r=t.monacoEditor)===null||r===void 0||r.trigger("source","redo",{})}),h()(this,"focus",function(){var r;(r=t.monacoEditor)===null||r===void 0||r.focus()}),h()(this,"hasFocus",function(){var r,n;return(r=(n=t.monacoEditor)===null||n===void 0?void 0:n.hasWidgetFocus())!==null&&r!==void 0?r:!1}),h()(this,"blur",function(){document.documentElement.focus()}),h()(this,"resizeToFit",function(){var r;(r=t.monacoEditor)===null||r===void 0||r.layout()}),h()(this,"getPositionForCoordinate",function(r){return null}),h()(this,"getCursorPosition",function(){var r,n,i={line:((r=t.monacoEditor)===null||r===void 0||(r=r.getPosition())===null||r===void 0?void 0:r.lineNumber)||1,column:((n=t.monacoEditor)===null||n===void 0||(n=n.getPosition())===null||n===void 0?void 0:n.column)||1};return i}),h()(this,"setCursorPosition",function(r){var n;(n=t.monacoEditor)===null||n===void 0||n.setPosition({column:r.column,lineNumber:r.line})}),h()(this,"getSelection",function(){var r,n,i,a,s={start:{line:((r=t.monacoEditor)===null||r===void 0||(r=r.getSelection())===null||r===void 0?void 0:r.startLineNumber)||1,column:((n=t.monacoEditor)===null||n===void 0||(n=n.getSelection())===null||n===void 0?void 0:n.startColumn)||1},end:{line:((i=t.monacoEditor)===null||i===void 0||(i=i.getSelection())===null||i===void 0?void 0:i.endLineNumber)||1,column:((a=t.monacoEditor)===null||a===void 0||(a=a.getSelection())===null||a===void 0?void 0:a.endColumn)||1}};return s}),h()(this,"setSelection",function(r){var n;(n=t.monacoEditor)===null||n===void 0||n.setSelection(t.toMonacoRange(r))}),h()(this,"getSelections",function(){var r,n=[];return(r=t.monacoEditor)===null||r===void 0||(r=r.getSelections())===null||r===void 0||r.map(function(i){return n.push({start:{line:i.startLineNumber||1,column:i.startColumn||1},end:{line:i.endLineNumber||1,column:i.endColumn||1}})}),n}),h()(this,"setSelections",function(r){var n;(n=t.monacoEditor)===null||n===void 0||n.setSelections(r.map(function(i){return new z.Y1(i.start.line,i.start.column,i.end.line,i.end.column)}))}),h()(this,"revealSelection",function(r){var n;(n=t.monacoEditor)===null||n===void 0||n.revealRange(t.toMonacoRange(r))}),h()(this,"getSelectionValue",function(r){var n,i=r!=null?r:t.getSelection();return(n=t.monacoEditor)===null||n===void 0||(n=n.getModel())===null||n===void 0?void 0:n.getValueInRange(t.toMonacoRange(i))}),h()(this,"replaceSelection",function(r,n){var i,a;(i=t.monacoEditor)===null||i===void 0||i.executeEdits(void 0,[{range:t.toMonacoRange(n),text:r}]),(a=t.monacoEditor)===null||a===void 0||a.pushUndoStop()}),h()(this,"replaceSelections",function(r){var n,i;(n=t.monacoEditor)===null||n===void 0||n.executeEdits(void 0,r.map(function(a){return{range:t.toMonacoRange(a.range),text:a.text}})),(i=t.monacoEditor)===null||i===void 0||i.pushUndoStop()}),h()(this,"getPositionAt",function(r){var n,i=(n=t.monacoEditor)===null||n===void 0||(n=n.getModel())===null||n===void 0?void 0:n.getPositionAt(r);return i&&{line:i.lineNumber,column:i.column}}),h()(this,"highlightMatches",function(r,n){var i,a,s=r.map(function(p,d){return d===n?(a=p,{range:p,options:{className:"currentFindMatch"}}):{range:p,options:{className:"findMatch"}}}).map(function(p){return N()(N()({},p),{},{range:t.toMonacoMatch(p.range).range})});if(t.oldDeltaDecorations=((i=t.monacoEditor)===null||i===void 0?void 0:i.deltaDecorations(t.oldDeltaDecorations,s))||[],a){var c=t.getPositionAt(a.position),l=t.getPositionAt(a.position+a.text.length);c&&l&&t.revealSelection({end:l,start:c})}}),this.host=e.host,this._model=e.model,this._uuid=e.uuid||(0,L.Vj)(),this._config=N()({},e.config),this.editorHost=document.createElement("div"),this.host.append(this.editorHost),this.createEditor(this.editorHost),this.checkSyntaxError(),this.toDispose.push((0,D.YP)(this._model,"selections",this.onSelectionChange))}return Z()(o,[{key:"uuid",get:function(){return this._uuid},set:function(t){this._uuid=t}},{key:"model",get:function(){return this._model}},{key:"config",get:function(){return this._config}},{key:"lineCount",get:function(){var t;return((t=this.monacoEditor)===null||t===void 0||(t=t.getModel())===null||t===void 0?void 0:t.getLineCount())||0}},{key:"disposed",get:function(){return this._isDisposed}},{key:"onModalChange",get:function(){return this.modalChangeEmitter.event}},{key:"createEditor",value:function(){var e=y()(f()().mark(function r(n){var i,a,s=this,c,l,p,d;return f()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:this.monacoEditor=z.j6.create(n,N()({value:this.model.value,language:"sql"},this.toMonacoOptions(this._config))),this.toDispose.push((i=(a=this.monacoEditor)===null||a===void 0?void 0:a.onDidChangeModelContent(function(){var T,w=(T=s.monacoEditor)===null||T===void 0?void 0:T.getValue();w&&(s.model.value=w,s.updateEditorSize())}))!==null&&i!==void 0?i:Ve.J.NONE),this.toDispose.push((c=(l=this.monacoEditor)===null||l===void 0?void 0:l.onDidContentSizeChange(function(){s.updateEditorSize()}))!==null&&c!==void 0?c:Ve.J.NONE),this.toDispose.push((p=(d=this.monacoEditor)===null||d===void 0?void 0:d.onDidBlurEditorText(function(){s.blur()}))!==null&&p!==void 0?p:Ve.J.NONE),this.updateEditorSize(),this.editorReadyDeferred.resolve();case 6:case"end":return v.stop()}},r,this)}));function t(r){return e.apply(this,arguments)}return t}()},{key:"checkSyntaxError",value:function(){var t,r=this;(t=this.monacoEditor)===null||t===void 0||t.onDidChangeModelContent(function(){var n,i,a=(n=r.monacoEditor)===null||n===void 0?void 0:n.getModel(),s=(i=r.monacoEditor)===null||i===void 0?void 0:i.getPosition();if(!(!a||!s)){var c=nn(a,s);if(c)if(c.error){var l=c.error.reason==="incomplete"?`Incomplete, expect next input: 
`.concat(c.error.suggestions.map(function(d){return d.value}).join(`
`)):`Wrong input, expect: 
`.concat(c.error.suggestions.map(function(d){return d.value}).join(`
`)),p=c.error.token?{startLineNumber:a.getPositionAt(c.error.token.position[0]).lineNumber,startColumn:a.getPositionAt(c.error.token.position[0]).column,endLineNumber:a.getPositionAt(c.error.token.position[1]).lineNumber,endColumn:a.getPositionAt(c.error.token.position[1]).column+1}:{startLineNumber:0,startColumn:0,endLineNumber:0,endColumn:0};z.j6.setModelMarkers(a,"sql",[N()(N()({},p),{},{message:l,severity:z.ZL.Error})])}else z.j6.setModelMarkers(a,"sql",[])}})}},{key:"toMonacoOptions",value:function(t){var r,n,i,a,s,c,l;return{minimap:{enabled:!1},lineHeight:(r=t.lineHeight)!==null&&r!==void 0?r:20,fontSize:(n=t.fontSize)!==null&&n!==void 0?n:13,lineNumbers:t.lineNumbers?"on":"off",folding:(i=t.codeFolding)!==null&&i!==void 0?i:!0,wordWrap:(a=t.lineWrap)!==null&&a!==void 0?a:"off",lineDecorationsWidth:15,lineNumbersMinChars:3,suggestSelection:"first",wordBasedSuggestions:"currentDocument",scrollBeyondLastLine:!1,fixedOverflowWidgets:!0,suggest:{snippetsPreventQuickSuggestions:!1},autoClosingQuotes:t.autoClosingBrackets?"always":"never",autoDetectHighContrast:!1,scrollbar:{alwaysConsumeMouseWheel:!1,verticalScrollbarSize:0},extraEditorClassName:"sql-editor",renderLineHighlight:"all",renderLineHighlightOnlyWhenFocus:!0,readOnly:t.readOnly,cursorWidth:1,tabSize:(s=t.tabSize)!==null&&s!==void 0?s:4,insertSpaces:(c=t.insertSpaces)!==null&&c!==void 0?c:!0,matchBrackets:t.matchBrackets?"always":"never",rulers:(l=t.rulers)!==null&&l!==void 0?l:[],wordWrapColumn:t.wordWrapColumn||80}}},{key:"getState",value:function(){var t=this.getCursorPosition(),r=this.getSelections();return N()(N()({},this.editorState),{},{cursorPosition:t,selections:r})}},{key:"updateEditorSize",value:function(){var t,r,n=(t=(r=this.monacoEditor)===null||r===void 0?void 0:r.getContentHeight())!==null&&t!==void 0?t:20;this.host.style.height="".concat(n+30,"px");try{var i;(i=this.monacoEditor)===null||i===void 0||i.layout({width:this.host.offsetWidth,height:n})}catch(a){}}},{key:"toMonacoRange",value:function(t){var r=t!=null?t:this.getSelection(),n={startLineNumber:r.start.line||1,startColumn:r.start.column||1,endLineNumber:r.end.line||1,endColumn:r.end.column||1};return n}},{key:"onSelectionChange",value:function(){this.setSelections(this.model.selections)}},{key:"toMonacoMatch",value:function(t){var r,n,i,a,s=this.getPositionAt(t.position),c=this.getPositionAt(t.position+t.text.length);return{range:new z.e6((r=s==null?void 0:s.line)!==null&&r!==void 0?r:1,(n=s==null?void 0:s.column)!==null&&n!==void 0?n:1,(i=c==null?void 0:c.line)!==null&&i!==void 0?i:1,(a=c==null?void 0:c.column)!==null&&a!==void 0?a:1),matches:[t.text],_findMatchBrand:void 0}}},{key:"getOption",value:function(t){return this._config[t]}},{key:"dispose",value:function(){this.disposed||(this.toDispose.dispose(),this._isDisposed=!0)}}]),o}(),Hn,Wn,xn,Qn,Bn,G,Jn=(Hn=(0,j.H3)(),Wn=(0,Y.ei)("libro-sql-output-area"),xn=function(e,t){return(0,j.f3)(fe.Hj)(e,void 0,0)},Qn=Reflect.metadata("design:type",Function),Bn=Reflect.metadata("design:paramtypes",[typeof IOutputAreaOption=="undefined"?Object:IOutputAreaOption]),Hn(G=Wn(G=xn(G=Qn(G=Bn(G=function(o){re()(t,o);var e=ae()(t);function t(r){var n;return R()(this,t),n=e.call(this,r),n.handleMsg(),n}return Z()(t,[{key:"handleMsg",value:function(){var n=this,i=this.cell.model;i.msgChange(function(a){if(a.header.msg_type!=="status"&&((0,S.t3d)(a)||(0,S.HXF)(a)||(0,S.aL4)(a)||(0,S.fkE)(a))){var s=N()(N()({},a.content),{},{output_type:a.header.msg_type});n.add(s)}})}}]),t}(S.fZS))||G)||G)||G)||G)||G),g=m(35667),oi=function(e){var t=e.model,r=t.data["application/vnd.libro.sql+json"];return r?(0,g.jsxs)("div",{className:"sql-output-render libro-html-common-render",children:[(0,g.jsxs)("table",{border:1,className:"dataframe",children:[(0,g.jsx)("thead",{children:(0,g.jsxs)("tr",{style:{textAlign:"right"},children:[(0,g.jsx)("th",{}),r.columns.map(function(n){return(0,g.jsx)("th",{children:n},n)})]})}),(0,g.jsx)("tbody",{children:r.rows.map(function(n,i){return(0,g.jsxs)("tr",{children:[(0,g.jsx)("td",{children:i}),n.map(function(a){return(0,g.jsx)("td",{children:a},a)})]},i)})})]}),(0,g.jsxs)("p",{children:[r.rows.length," rows \xD7 ",r.columns.length," columns"]})]}):null},Yn,Gn,ui=(Yn=(0,j.ri)({contrib:S.VCh}),Yn(Gn=Z()(function o(){R()(this,o),h()(this,"canHandle",function(){return 100}),h()(this,"renderType","SQLOutputRender"),h()(this,"safe",!0),h()(this,"mimeTypes",["application/vnd.libro.sql+json"]),h()(this,"render",oi)}))||Gn),Me=m(72202),Kn,Un,Ie=(Kn=(0,j.ri)(),Kn(Un=function(){function o(){R()(this,o)}return Z()(o,[{key:"query",value:function(){var e=y()(f()().mark(function r(n){var i=this,a,s,c;return f()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,(0,L.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"query",project_id:this.getProjectId(),query:n})});case 2:if(a=p.sent,s=[],c=[],!a){p.next=8;break}return a.forEach(function(d){s.push(d.name),c.push(i.getRowValue(d))}),p.abrupt("return",{columns:s,rows:(0,L.p4)(c)});case 8:return p.abrupt("return",{columns:s,rows:c});case 9:case"end":return p.stop()}},r,this)}));function t(r){return e.apply(this,arguments)}return t}()},{key:"getRowValue",value:function(t){for(var r=["int32_data","int64_data","float_data","double_data","bool_data","string_data"],n=0;n<r.length;n++){var i=r[n];if(t[i]&&t[i].length>0)return t[i]}return[]}},{key:"getProjectId",value:function(){var t=Me.m8.location.pathname.split("/");return t[t.length-1]}}]),o}())||Un),Xn,qn,_n,et,nt,tt,rt,at,it,ot,ut,st,lt,$,Le,ct,dt,ft=(0,oe.forwardRef)(function(o,e){var t=(0,D.oC)(fe.yd);return(0,g.jsx)("div",{tabIndex:10,ref:e,className:t.className,onBlur:t.blur,children:(0,g.jsx)(S.sUT,{})})});ft.displayName="SqlCellComponent";var mt=(Xn=(0,j.H3)(),qn=(0,Y.ei)("sql-cell-view"),_n=function(e,t){return(0,j.f3)(fe.Hj)(e,void 0,0)},et=function(e,t){return(0,j.f3)(S.xxA)(e,void 0,1)},nt=function(e,t){return(0,j.f3)(ze.v)(e,void 0,2)},tt=function(e,t){return(0,j.f3)(Ie)(e,void 0,3)},rt=function(e,t){return(0,j.f3)(pe.H)(e,void 0,4)},at=Reflect.metadata("design:type",Function),it=Reflect.metadata("design:paramtypes",[typeof CellViewOptions=="undefined"?Object:CellViewOptions,typeof S.xxA=="undefined"?Object:S.xxA,typeof ze.v=="undefined"?Object:ze.v,typeof Ie=="undefined"?Object:Ie,typeof pe.H=="undefined"?Object:pe.H]),ot=(0,D.vg)(),ut=Reflect.metadata("design:type",Array),st=(0,D.vg)(),lt=Reflect.metadata("design:type",typeof S.a7s=="undefined"?Object:S.a7s),Xn($=qn($=_n($=et($=nt($=tt($=rt($=at($=it($=(Le=function(o){re()(t,o);var e=ae()(t);function t(r,n,i,a,s){var c,l;return R()(this,t),l=e.call(this,r,n),h()(C()(l),"view",ft),h()(C()(l),"queryService",void 0),h()(C()(l),"viewManager",void 0),h()(C()(l),"commandRegistry",void 0),te()(C()(l),"outputs",ct,C()(l)),te()(C()(l),"editorView",dt,C()(l)),h()(C()(l),"onViewMount",y()(f()().mark(function p(){return f()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,l.createEditor();case 2:case"end":return b.stop()}},p)}))),h()(C()(l),"clearExecution",function(){l.cellModel.clearExecution(),Promise.resolve().then(function(){l.outputArea.clear()}).catch(console.error)}),l.options=r,l.queryService=a,l.viewManager=i,l.commandRegistry=s,l.outputs=((c=r.cell)===null||c===void 0?void 0:c.outputs)||[],l.className=l.className+" sql-editor-container",l.viewManager.getOrCreateView(Jn,{outputAreaId:l.id,cellId:l.id,cell:C()(l)}).then(function(){var p=y()(f()().mark(function d(b){var v;return f()().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(l.outputArea=b,v=l.outputs,!(0,S.RWJ)(v)){w.next=5;break}return w.next=5,l.outputArea.fromJSON(v);case 5:return l.outputWatch(),w.abrupt("return");case 7:case"end":return w.stop()}},d)}));return function(d){return p.apply(this,arguments)}}()).catch(function(){}),l}return Z()(t,[{key:"cellModel",get:function(){return this.model}},{key:"toJSON",value:function(){var n,i,a=cn()(dn()(t.prototype),"toJSON",this).call(this);return N()(N()({},a),{},{outputs:(n=(i=this.outputArea)===null||i===void 0?void 0:i.toJSON())!==null&&n!==void 0?n:this.outputs})}},{key:"createEditor",value:function(){var n=this,i={uuid:this.options.uuid,factory:function(s){return new ii(s)},model:this.cellModel,config:{readOnly:this.parent.model.readOnly,editable:!this.parent.model.readOnly}};return this.viewManager.getOrCreateView(S.a7s,i).then(function(){var a=y()(f()().mark(function s(c){return f()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return n.editorView=c,p.next=3,c.editor.editorReady;case 3:return n.handleCommand(),p.abrupt("return");case 5:case"end":return p.stop()}},s)}));return function(s){return a.apply(this,arguments)}}()).catch(function(){})}},{key:"handleCommand",value:function(){var n,i=this,a=(n=this.editorView)===null||n===void 0||(n=n.editor)===null||n===void 0?void 0:n.monacoEditor;a&&(a.addCommand(9,function(){i.commandRegistry.executeCommand(S.NzD.EnterCommandMode.id)},"!editorHasSelection && !editorHasSelection && !editorHasMultipleSelections"),a.addCommand(2051,function(){i.commandRegistry.executeCommand(S.NzD.RunCell.id)},"!findWidgetVisible && !referenceSearchVisible"),a.addCommand(1027,function(){i.commandRegistry.executeCommand(S.NzD.RunCellAndSelectNext.id)},"!findInputFocussed"),a.addCommand(515,function(){i.commandRegistry.executeCommand(S.NzD.RunCellAndInsertBelow.id)},"!findWidgetVisible"),a.addCommand(3155,function(){i.commandRegistry.executeCommand(S.NzD.SplitCellAntCursor.id)}),a.addCommand(2084,function(){i.commandRegistry.executeCommand("libro-search:toggle")}))}},{key:"run",value:function(){var r=y()(f()().mark(function i(){var a,s,c,l,p,d;return f()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return a=new Date().toISOString(),this.clearExecution(),this.setExecutionStatus(!0,!0),this.setExecutionTime(a,""),this.cellModel.executeCount=1,v.prev=5,v.next=8,this.queryService.query(this.cellModel.value);case 8:s=v.sent,c={header:{msg_type:"execute_result",date:"",msg_id:"",session:"",username:"",version:""},metadata:{},content:{data:{"application/vnd.libro.sql+json":s},metadata:{},execution_count:1},buffers:[],channel:"iopub",parent_header:{}},this.cellModel.msgChangeEmitter.fire(c),v.next=16;break;case 13:v.prev=13,v.t0=v.catch(5),v.t0 instanceof Error&&(l=v.t0.message,p=l.split(`
`),p.length>0&&(d={header:{msg_type:"error",date:"",msg_id:"",session:"",username:"",version:""},metadata:{},content:{traceback:p.slice(1),ename:"ExecuteQueryException",evalue:p[0]},buffers:[],channel:"iopub",parent_header:{}},this.cellModel.msgChangeEmitter.fire(d)));case 16:return this.setExecutionStatus(!1,!1),this.setExecutionTime(a,new Date().toISOString()),v.abrupt("return",!0);case 19:case"end":return v.stop()}},i,this,[[5,13]])}));function n(){return r.apply(this,arguments)}return n}()},{key:"setExecutionStatus",value:function(n,i){this.cellModel.executing=n,this.cellModel.kernelExecuting=i}},{key:"setExecutionTime",value:function(n,i){var a=this.cellModel.metadata.execution;a&&(a["shell.execute_reply.started"]=n,a.to_execute=n,a["shell.execute_reply.end"]=i)}},{key:"calcEditorAreaHeight",value:function(){return 0}}]),t}(S.XCr),ct=ie()(Le.prototype,"outputs",[ot,ut],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),dt=ie()(Le.prototype,"editorView",[st,lt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Le))||$)||$)||$)||$)||$)||$)||$)||$)||$),vt,pt,ht,gt,le,si=(vt=(0,j.ri)({contrib:[S.SqL,S.GDy]}),pt=function(e,t){return(0,j.f3)(ke)(e,void 0,0)},ht=Reflect.metadata("design:type",Function),gt=Reflect.metadata("design:paramtypes",[typeof ke=="undefined"?Object:ke]),vt(le=pt(le=ht(le=gt(le=function(){function o(e){R()(this,o),h()(this,"modelFactory",void 0),h()(this,"cellMeta",{type:"code",name:"SQL",nbformatType:"code",order:"a"}),h()(this,"view",mt),this.modelFactory=e}return Z()(o,[{key:"canHandle",value:function(t,r){return r===this.cellMeta.type?3e3:-1}},{key:"createModel",value:function(){var e=y()(f()().mark(function r(n){var i;return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return i=this.modelFactory(n),s.abrupt("return",i);case 2:case"end":return s.stop()}},r,this)}));function t(r){return e.apply(this,arguments)}return t}()}]),o}())||le)||le)||le)||le),bt,yt,Ct,St,wt,Et,kt,Tt,jt,Nt,ce,ge,Ot,Pt,Ft,Mt,It=(bt=(0,j.H3)(),yt=function(e,t){return(0,j.f3)(S.seq)(e,void 0,0)},Ct=Reflect.metadata("design:type",Function),St=Reflect.metadata("design:paramtypes",[typeof S.seq=="undefined"?Object:S.seq]),wt=(0,D.vg)(),Et=Reflect.metadata("design:type",typeof Partial=="undefined"?Object:Partial),kt=(0,D.vg)(),Tt=(0,D.vg)(),jt=(0,D.vg)(),Nt=Reflect.metadata("design:type",typeof ExecutionCount=="undefined"?Object:ExecutionCount),bt(ce=yt(ce=Ct(ce=St(ce=(ge=function(o){re()(t,o);var e=ae()(t);function t(r){var n;return R()(this,t),n=e.call(this,r),h()(C()(n),"mimeType","application/vnd.libro.sql+json"),h()(C()(n),"hasOutputHidden",!1),h()(C()(n),"hasOutputsScrolled",!1),te()(C()(n),"metadata",Ot,C()(n)),te()(C()(n),"executing",Pt,C()(n)),te()(C()(n),"kernelExecuting",Ft,C()(n)),te()(C()(n),"executeCount",Mt,C()(n)),h()(C()(n),"msgChangeEmitter",new fn.Q5),h()(C()(n),"msgChange",n.msgChangeEmitter.event),h()(C()(n),"clearExecution",function(){n.executeCount=null,n.executing=!1,n.kernelExecuting=!1,n.clearExecutionMetadata()}),h()(C()(n),"clearExecutionMetadata",function(){n.metadata.execution={"shell.execute_reply.started":"","shell.execute_reply.end":"",to_execute:""}}),n.metadata=r.cell.metadata||{},n}return Z()(t,[{key:"dispose",value:function(){cn()(dn()(t.prototype),"dispose",this).call(this),this.msgChangeEmitter.dispose()}}]),t}(S.KZ9),Ot=ie()(ge.prototype,"metadata",[wt,Et],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pt=ie()(ge.prototype,"executing",[kt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Ft=ie()(ge.prototype,"kernelExecuting",[Tt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Mt=ie()(ge.prototype,"executeCount",[jt,Nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ge))||ce)||ce)||ce)||ce),li=m(74799),Lt,$t,ci=(Lt=(0,j.ri)({contrib:S.Vij}),Lt($t=function(){function o(){R()(this,o),h()(this,"canHandle",function(){return 3})}return Z()(o,[{key:"loadContent",value:function(){var e=y()(f()().mark(function r(n,i){var a,s,c,l;return f()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return a=i,s=new li.o(n.resource),c=s.path.toString(),d.next=5,a.contentsManager.get(c);case 5:if(l=d.sent,!l){d.next=10;break}return l.content.nbformat_minor=5,a.currentFileContents=l,d.abrupt("return",a.currentFileContents.content);case 10:case"end":return d.stop()}},r)}));function t(r,n){return e.apply(this,arguments)}return t}()}]),o}())||$t),be=m(72085),di=m(7146),At,Rt,Zt,Dt,zt,Vt,x,fi=(At=(0,j.H3)(),Rt=function(e,t){return(0,j.f3)(S.QY6)(e,void 0,0)},Zt=function(e,t){return(0,j.f3)(be.Z)(e,void 0,1)},Dt=function(e,t){return(0,j.f3)(pe.H)(e,void 0,2)},zt=Reflect.metadata("design:type",Function),Vt=Reflect.metadata("design:paramtypes",[typeof S.QY6=="undefined"?Object:S.QY6,typeof be.Z=="undefined"?Object:be.Z,typeof pe.H=="undefined"?Object:pe.H]),At(x=Rt(x=Zt(x=Dt(x=zt(x=Vt(x=function(o){re()(t,o);var e=ae()(t);function t(r,n,i){var a;return R()(this,t),a=e.call(this),h()(C()(a),"modalService",void 0),h()(C()(a),"commandRegistry",void 0),h()(C()(a),"currentFileContents",void 0),h()(C()(a),"contentsManager",void 0),h()(C()(a),"kernelConnection",!0),h()(C()(a),"kernelConnecting",!1),h()(C()(a),"lspEnabled",!1),h()(C()(a),"autoSave",(0,di.Z)(function(){a.commandRegistry.executeCommand(S.Xa6.Save.id)},500)),a.contentsManager=r,a.modalService=n,a.commandRegistry=i,a.onSourceChanged(a.autoSave.bind(C()(a))),a}return Z()(t,[{key:"isKernelIdle",get:function(){return!0}},{key:"saveNotebookContent",value:function(){var r=y()(f()().mark(function i(){var a,s,c,l;return f()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(a=this.toJSON(),this.currentFileContents){d.next=3;break}throw new Error("currentFileContents is undefined");case 3:return d.prev=3,d.next=6,this.contentsManager.save(this.currentFileContents.path,{type:this.currentFileContents.type,content:a,format:this.currentFileContents.format});case 6:if(s=d.sent,s){d.next=9;break}return d.abrupt("return");case 9:if(!(s.last_modified===this.currentFileContents.last_modified||s.size===0)){d.next=13;break}throw l="File Save Error: ".concat((c=s)===null||c===void 0?void 0:c.message),this.modalService.openModal(S.l6J),new Error(l);case 13:d.next=21;break;case 15:if(d.prev=15,d.t0=d.catch(3),s){d.next=19;break}return d.abrupt("return");case 19:throw this.modalService.openModal(S.l6J),new Error("File Save Error");case 21:return d.next=23,this.createCheckpoint();case 23:case"end":return d.stop()}},i,this,[[3,15]])}));function n(){return r.apply(this,arguments)}return n}()},{key:"canRun",value:function(){return!0}},{key:"interrupt",value:function(){var r=y()(f()().mark(function i(){return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:case"end":return s.stop()}},i)}));function n(){return r.apply(this,arguments)}return n}()},{key:"shutdown",value:function(){var r=y()(f()().mark(function i(){return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:case"end":return s.stop()}},i)}));function n(){return r.apply(this,arguments)}return n}()},{key:"restart",value:function(){var r=y()(f()().mark(function i(){return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:case"end":return s.stop()}},i)}));function n(){return r.apply(this,arguments)}return n}()},{key:"reconnect",value:function(){var r=y()(f()().mark(function i(){return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:case"end":return s.stop()}},i)}));function n(){return r.apply(this,arguments)}return n}()},{key:"findRunningCell",value:function(){var n=this.cells.findIndex(function(i){return S.lPh.is(i.model)?i.model.kernelExecuting===!0:!1});n>-1&&(this.selectCell(this.cells[n]),this.scrollToView(this.cells[n]))}},{key:"createCheckpoint",value:function(){var r=y()(f()().mark(function i(){return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!this.currentFileContents){s.next=3;break}return s.next=3,this.contentsManager.createCheckpoint(this.currentFileContents.path);case 3:case"end":return s.stop()}},i,this)}));function n(){return r.apply(this,arguments)}return n}()},{key:"listCheckpoints",value:function(){var r=y()(f()().mark(function i(){return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!this.currentFileContents){s.next=3;break}return s.next=3,this.contentsManager.listCheckpoints(this.currentFileContents.path);case 3:case"end":return s.stop()}},i,this)}));function n(){return r.apply(this,arguments)}return n}()},{key:"restoreCheckpoint",value:function(){var r=y()(f()().mark(function i(a){return f()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(!this.currentFileContents){c.next=3;break}return c.next=3,this.contentsManager.restoreCheckpoint(this.currentFileContents.path,a);case 3:case"end":return c.stop()}},i,this)}));function n(i){return r.apply(this,arguments)}return n}()},{key:"deleteCheckpoint",value:function(){var r=y()(f()().mark(function i(a){return f()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(!this.currentFileContents){c.next=3;break}return c.next=3,this.contentsManager.deleteCheckpoint(this.currentFileContents.path,a);case 3:case"end":return c.stop()}},i,this)}));function n(i){return r.apply(this,arguments)}return n}()}]),t}(S.ero))||x)||x)||x)||x)||x)||x),mi=Ce.R.create().register(ci,si,mt,It,Jn,Ie,ui,{token:S.ero,useClass:fi},{token:ke,useFactory:function(e){return function(t){var r=e.container.createChild();r.register({token:S.seq,useValue:t});var n=r.get(It);return n}}}).dependOn(S.MDs),Ht,Wt,xt,Qt,tn,Bt,$e=(Ht=(0,j.ri)(),Wt=(0,D.vg)(),xt=Reflect.metadata("design:type",Array),Ht(Qt=(tn=function(){function o(){R()(this,o),te()(this,"members",Bt,this)}return Z()(o,[{key:"getMemberList",value:function(){var e=y()(f()().mark(function r(){var n,i,a;return f()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.getPlatformInfo();case 2:return n=c.sent,i=n.party,c.next=6,(0,L.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"getProjectInfo",project_id:this.getProjectId()})});case 6:return a=c.sent,a&&(this.members=a.members.map(function(l){return{name:l===i?"".concat(l," (you)"):l,creator:l===a.creator,color:(0,L.Q4)()}})),c.abrupt("return",this.members);case 9:case"end":return c.stop()}},r,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"inviteMember",value:function(){var e=y()(f()().mark(function r(n){return f()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,L.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"inviteMember",project_id:this.getProjectId(),invitee:n})});case 2:case"end":return a.stop()}},r,this)}));function t(r){return e.apply(this,arguments)}return t}()},{key:"getPlatformInfo",value:function(){var e=y()(f()().mark(function r(){var n;return f()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,L.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"getPlatformInfo"})});case 2:return n=a.sent,a.abrupt("return",n);case 4:case"end":return a.stop()}},r)}));function t(){return e.apply(this,arguments)}return t}()},{key:"getProjectId",value:function(){var t=Me.m8.location.pathname.split("/");return t[t.length-1]}}]),o}(),Bt=ie()(tn.prototype,"members",[Wt,xt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),tn))||Qt),vi=m(45332),ve=m.n(vi),Ae=m(99138),we=m(64495),H=m(38644),_=m(20376),Ee=m(64940),rn=m(44549),an=m(35198),Jt=m(32368),Yt=m(84743),Gt=m(36756),Kt=m(99997),Ut,Xt,qt,_t,er,K,pi=function(){var e=H.Z.useForm(),t=ve()(e,1),r=t[0],n=(0,oe.useState)(!1),i=ve()(n,2),a=i[0],s=i[1],c=(0,oe.useState)(!1),l=ve()(c,2),p=l[0],d=l[1],b=(0,D.oC)(fe.yd),v=H.Z.useWatch([],r),T=function(){r.validateFields().then(function(){var P=y()(f()().mark(function F(A){return f()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return d(!0),k.prev=1,k.next=4,b.service.inviteMember(A.name);case 4:s(!1),r.resetFields(),_.ZP.success("Invitations have been sent out."),k.next=12;break;case 9:k.prev=9,k.t0=k.catch(1),k.t0 instanceof Error&&_.ZP.error(k.t0.message);case 12:return k.prev=12,d(!1),k.finish(12);case 15:return k.abrupt("return");case 16:case"end":return k.stop()}},F,null,[[1,9,12,15]])}));return function(F){return P.apply(this,arguments)}}()).catch(function(){})},w=(0,g.jsx)("div",{className:"secretnote-add-member",children:(0,g.jsxs)(H.Z,{form:r,autoComplete:"off",requiredMark:!1,labelCol:{span:4},wrapperCol:{span:20},style:{display:"flex"},children:[(0,g.jsx)(H.Z.Item,{label:"",name:"name",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u9080\u8BF7\u8005\u540D\u79F0"},{max:16,message:we.U6.t("\u540D\u79F0\u8FC7\u957F")}],children:(0,g.jsx)(Ee.Z,{style:{width:256},maxLength:16,placeholder:"Add name to add member"})}),(0,g.jsx)(H.Z.Item,{wrapperCol:{offset:4,span:20},style:{marginBottom:0},children:(0,g.jsx)(rn.Z,{children:(0,g.jsx)(an.ZP,{htmlType:"submit",onClick:function(){T()},disabled:v&&!v.name,loading:p,children:"Invite"})})})]})});return(0,g.jsxs)("div",{className:"secretnote-scql-member",children:[(0,g.jsx)(Jt.C.Group,{children:b.service.members.map(function(E){return(0,g.jsx)(Yt.Z,{title:"".concat(E.name),children:(0,g.jsx)(Jt.C,{shape:"square",style:{backgroundColor:E.color,cursor:"pointer"},children:(0,g.jsx)("span",{style:{color:(0,L.U_)(E.color)},children:E.name.slice(0,1).toUpperCase()})})},E.name)})}),(0,g.jsx)(Gt.Z,{content:w,title:"",overlayStyle:{width:372},trigger:"click",placement:"bottomLeft",open:a,onOpenChange:function(P){r.resetFields(),s(P)},arrow:!1,children:(0,g.jsx)(an.ZP,{icon:(0,g.jsx)(Kt.Z,{size:16}),className:"btn",onClick:function(){return s(!0)}})})]})},nr=(Ut=(0,j.ri)(),Xt=(0,Y.ei)("secretnote-scql-member-view"),qt=function(e,t){return(0,j.f3)($e)(e,void 0,0)},_t=Reflect.metadata("design:type",Function),er=Reflect.metadata("design:paramtypes",[typeof $e=="undefined"?Object:$e]),Ut(K=Xt(K=qt(K=_t(K=er(K=function(o){re()(t,o);var e=ae()(t);function t(r){var n;return R()(this,t),n=e.call(this),h()(C()(n),"view",pi),h()(C()(n),"service",void 0),n.service=r,n}return Z()(t,[{key:"onViewMount",value:function(){this.service.getMemberList()}}]),t}(Ae.P))||K)||K)||K)||K)||K),hi=Ce.R.create().register(nr,$e,(0,Y.bQ)({slot:De.Mx.right,view:nr,autoCreate:!0})),gi=m(42356),Re=m(8328),tr,rr,ar,ir,on,or,ee=function(o){return o.UNDEFINED="",o.UNKNOWN="UNKNOWN",o.PLAINTEXT="PLAINTEXT",o.ENCRYPTED_ONLY="ENCRYPTED_ONLY",o.PLAINTEXT_AFTER_JOIN="PLAINTEXT_AFTER_JOIN",o.PLAINTEXT_AFTER_GROUP_BY="PLAINTEXT_AFTER_GROUP_BY",o.PLAINTEXT_AFTER_COMPARE="PLAINTEXT_AFTER_COMPARE",o.PLAINTEXT_AFTER_AGGREGATE="PLAINTEXT_AFTER_AGGREGATE",o}({}),bi=[ee.UNKNOWN,ee.PLAINTEXT,ee.ENCRYPTED_ONLY,ee.PLAINTEXT_AFTER_JOIN,ee.PLAINTEXT_AFTER_GROUP_BY,ee.PLAINTEXT_AFTER_COMPARE,ee.PLAINTEXT_AFTER_AGGREGATE],ne=(tr=(0,j.ri)(),rr=(0,D.vg)(),ar=Reflect.metadata("design:type",Array),tr(ir=(on=function(){function o(){R()(this,o),te()(this,"dataTables",or,this)}return Z()(o,[{key:"getDataTables",value:function(){var e=y()(f()().mark(function r(){var n,i,a,s,c,l;return f()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return n=[],d.next=3,this.getProjectInfo();case 3:if(i=d.sent,i){d.next=6;break}return d.abrupt("return");case 6:return d.next=8,this.getPlatformInfo();case 8:if(a=d.sent,a){d.next=11;break}return d.abrupt("return");case 11:return d.next=13,(0,L.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"getDataTables",project_id:this.getProjectId()})});case 13:s=d.sent,c=i.members,l=a.party,s&&c.forEach(function(b){var v=l===b,T={key:b,title:b,isLeaf:!1,belongToMe:v,children:[]};s.forEach(function(w){w.table_owner===b&&T.children.push({key:w.table_name,title:w.table_name,isLeaf:!0,data:{tableName:w.table_name,refTable:w.ref_table,dbType:w.db_type,tableOwner:w.table_owner,columns:w.columns},children:[],belongToMe:v})}),n.push(T)}),this.dataTables=n;case 18:case"end":return d.stop()}},r,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"addDataTable",value:function(){var e=y()(f()().mark(function r(n){return f()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,L.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"createTable",project_id:this.getProjectId(),table_name:n.tableName,ref_table:n.refTable,db_type:n.dbType,columns:n.columns})});case 2:this.getDataTables();case 3:case"end":return a.stop()}},r,this)}));function t(r){return e.apply(this,arguments)}return t}()},{key:"deleteDataTable",value:function(){var e=y()(f()().mark(function r(n){return f()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(n.isLeaf){a.next=2;break}return a.abrupt("return");case 2:return a.next=4,(0,L.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"deleteTable",project_id:this.getProjectId(),table_name:n.title})});case 4:this.getDataTables();case 5:case"end":return a.stop()}},r,this)}));function t(r){return e.apply(this,arguments)}return t}()},{key:"getTableCCL",value:function(){var e=y()(f()().mark(function r(n){var i,a,s,c,l;return f()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return i=[],d.next=3,this.getTableInfo(n);case 3:if(a=d.sent,a){d.next=6;break}return d.abrupt("return",i);case 6:return d.next=8,this.getProjectInfo();case 8:if(s=d.sent,s){d.next=11;break}return d.abrupt("return",i);case 11:return d.next=13,(0,L.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"getTableCCL",project_id:this.getProjectId(),table_name:n})});case 13:if(c=d.sent,c){d.next=16;break}return d.abrupt("return",i);case 16:return l=s.members,a.columns.forEach(function(b){var v={column:b.name};l.forEach(function(T){v[T]=ee.UNDEFINED}),c.forEach(function(T){var w=T.col,E=w.column_name,P=w.table_name;E===b.name&&P===n&&(v[T.party_code]=T.constraint)}),i.push(v)}),d.abrupt("return",i);case 19:case"end":return d.stop()}},r,this)}));function t(r){return e.apply(this,arguments)}return t}()},{key:"grantTableCCL",value:function(){var e=y()(f()().mark(function r(n,i){var a;return f()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return a=[],i.forEach(function(l){Object.keys(l).forEach(function(p){p!=="column"&&l[p]!==ee.UNDEFINED&&a.push({col:{column_name:l.column,table_name:n},party_code:p,constraint:l[p]})})}),c.next=4,(0,L.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"grantCCL",project_id:this.getProjectId(),ccl_list:a})});case 4:case"end":return c.stop()}},r,this)}));function t(r,n){return e.apply(this,arguments)}return t}()},{key:"getPlatformInfo",value:function(){var e=y()(f()().mark(function r(){var n;return f()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,L.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"getPlatformInfo"})});case 2:return n=a.sent,a.abrupt("return",n);case 4:case"end":return a.stop()}},r)}));function t(){return e.apply(this,arguments)}return t}()},{key:"getProjectInfo",value:function(){var e=y()(f()().mark(function r(){var n;return f()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,L.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"getProjectInfo",project_id:this.getProjectId()})});case 2:if(n=a.sent,n){a.next=6;break}return Re.Z.info({title:"Info",content:"You were not involved in the project.",okText:"Back to project list",onOk:function(){Me.m8.push("/scql/project")}}),a.abrupt("return");case 6:return a.abrupt("return",n);case 7:case"end":return a.stop()}},r,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"getTableInfo",value:function(){var e=y()(f()().mark(function r(n){var i;return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,(0,L.WY)("api/broker",{method:"POST",body:JSON.stringify({action:"getTableInfo",project_id:this.getProjectId(),table_name:n})});case 2:return i=s.sent,s.abrupt("return",i);case 4:case"end":return s.stop()}},r,this)}));function t(r){return e.apply(this,arguments)}return t}()},{key:"getProjectId",value:function(){var t=Me.m8.location.pathname.split("/");return t[t.length-1]}}]),o}(),or=ie()(on.prototype,"dataTables",[rr,ar],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),on))||ir),ur,sr,lr,cr,dr,U,yi=function(){var e=(0,D.oC)(fe.yd);return(0,g.jsx)(Yt.Z,{title:we.U6.t("\u5237\u65B0"),children:(0,g.jsx)(gi.Z,{size:14,onClick:function(r){r.stopPropagation(),e.service.getDataTables(),_.ZP.success(we.U6.t("\u6570\u636E\u8868\u5DF2\u5237\u65B0"))}})})},fr=(ur=(0,j.ri)(),sr=(0,Y.ei)("data-table-extra-view"),lr=function(e,t){return(0,j.f3)(ne)(e,void 0,0)},cr=Reflect.metadata("design:type",Function),dr=Reflect.metadata("design:paramtypes",[typeof ne=="undefined"?Object:ne]),ur(U=sr(U=lr(U=cr(U=dr(U=function(o){re()(t,o);var e=ae()(t);function t(r){var n;return R()(this,t),n=e.call(this),h()(C()(n),"service",void 0),h()(C()(n),"view",yi),n.service=r,n}return Z()(t)}(Ae.P))||U)||U)||U)||U)||U),Ci=m(19689),Si=m(42151),ye=m(34011),mr=m(34186),wi=m(49546),Ei=m(83869),ki=m(80808),Ti=m(95004),ji=m(68625),Ni=m(16108),Oi=m(84176),Pi=m.n(Oi),vr=m(58678),Fi=m(24943),Mi=["key","name"],Ii=function(e){var t=e.visible,r=e.close,n=e.data,i=H.Z.useForm(),a=ve()(i,1),s=a[0],c=(0,D.oC)(ne),l=!!(n&&n.tableName);(0,oe.useEffect)(function(){s&&n&&s.setFieldsValue(n)},[n,s]);var p=function(){s.validateFields().then(function(){var b=y()(f()().mark(function v(T){return f()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return E.prev=0,E.next=3,c.addDataTable(T);case 3:_.ZP.success("Add table successfully."),r(),E.next=10;break;case 7:E.prev=7,E.t0=E.catch(0),E.t0 instanceof Error&&_.ZP.error(E.t0.message);case 10:return E.abrupt("return");case 11:case"end":return E.stop()}},v,null,[[0,7]])}));return function(v){return b.apply(this,arguments)}}()).catch(function(){})};return(0,g.jsx)(Re.Z,{open:t,destroyOnClose:!0,title:"New Table",onOk:function(){return p()},onCancel:function(){r()},children:(0,g.jsxs)(H.Z,{form:s,autoComplete:"off",requiredMark:!0,labelCol:{span:6},wrapperCol:{span:18},style:{marginTop:24,maxHeight:500,overflowY:"auto"},initialValues:{dbType:"mysql"},children:[(0,g.jsx)(H.Z.Item,{label:"\u6570\u636E\u5E93\u7C7B\u578B",name:"dbType",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6570\u636E\u5E93\u7C7B\u578B"}],children:(0,g.jsx)(Ee.Z,{maxLength:16,disabled:l,placeholder:"mysql"})}),(0,g.jsx)(H.Z.Item,{label:"\u8868\u540D\u79F0",name:"tableName",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u8868\u540D\u79F0"}],children:(0,g.jsx)(Ee.Z,{maxLength:16,disabled:l})}),(0,g.jsx)(H.Z.Item,{label:"\u5173\u8054\u8868",name:"refTable",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5173\u8054\u8868"}],children:(0,g.jsx)(Ee.Z,{maxLength:32,disabled:l})}),(0,g.jsx)(H.Z.Item,{label:"\u6570\u636E\u5217",className:"secretnote-table-columns",required:!0,children:(0,g.jsx)(H.Z.List,{name:"columns",children:function(b,v){var T=v.add,w=v.remove;return(0,g.jsxs)(g.Fragment,{children:[b.map(function(E){var P=E.key,F=E.name,A=Pi()(E,Mi);return(0,g.jsxs)(rn.Z,{style:{display:"flex",marginBottom:8},align:"baseline",children:[(0,g.jsx)(H.Z.Item,N()(N()({},A),{},{name:[F,"name"],rules:[{required:!0,message:""}],children:(0,g.jsx)(Ee.Z,{placeholder:"Column Name"})})),(0,g.jsx)(H.Z.Item,N()(N()({},A),{},{name:[F,"dtype"],rules:[{required:!0,message:""}],children:(0,g.jsx)(vr.Z,{style:{width:140},placeholder:"Data Type",options:[{label:"int",value:"int"},{label:"string",value:"string"},{label:"double",value:"double"}]})})),(0,g.jsx)(Fi.Z,{size:14,color:"#182431",cursor:"pointer",onClick:function(){return w(F)}})]},P)}),(0,g.jsx)(H.Z.Item,{children:(0,g.jsx)(an.ZP,{type:"dashed",onClick:function(){return T()},block:!0,icon:(0,g.jsx)(Kt.Z,{size:16,color:"#182431"}),children:"Add Columns"})})]})}})})]})})},pr={id:"data-table-config-modal",component:Ii},Li=function(e){var t=e.visible,r=e.close,n=e.data,i=(0,oe.useState)([]),a=ve()(i,2),s=a[0],c=a[1],l=(0,oe.useState)(!1),p=ve()(l,2),d=p[0],b=p[1],v=(0,D.oC)(ne),T=function(){var P=y()(f()().mark(function F(){var A;return f()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return k.prev=0,b(!0),k.next=4,v.getTableCCL(n.tableName);case 4:A=k.sent,c(A),k.next=11;break;case 8:k.prev=8,k.t0=k.catch(0),k.t0 instanceof Error&&_.ZP.error(k.t0.message);case 11:return k.prev=11,b(!1),k.finish(11);case 14:case"end":return k.stop()}},F,null,[[0,8,11,14]])}));return function(){return P.apply(this,arguments)}}(),w=function(){var P=y()(f()().mark(function F(){return f()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.prev=0,M.next=3,v.grantTableCCL(n.tableName,s);case 3:_.ZP.success("Ccl config successfully."),r(),M.next=10;break;case 7:M.prev=7,M.t0=M.catch(0),M.t0 instanceof Error&&_.ZP.error(M.t0.message);case 10:case"end":return M.stop()}},F,null,[[0,7]])}));return function(){return P.apply(this,arguments)}}(),E=s.length>0?Object.keys(s[0]).map(function(P){return P==="column"?{title:"Column",dataIndex:"column",key:"column"}:{title:"Grant to ".concat(P),dataIndex:P,key:P,render:function(A,M){return(0,g.jsx)(vr.Z,{options:bi.map(function(k){return{label:k,value:k}}),value:A,size:"small",style:{width:260},popupClassName:"secret-note-ccl-select",onChange:function(O){var V=s.map(function(X){return X.column===M.column?N()(N()({},X),{},h()({},P,O)):X});c(V)}})}}}):[];return(0,g.jsxs)(Re.Z,{width:720,open:t,destroyOnClose:!0,title:"CCL Config",onOk:function(){return w()},onCancel:function(){r()},afterOpenChange:function(F){F&&T()},children:[(0,g.jsx)("a",{className:"secretnote-ccl-doc-link",href:"https://www.secretflow.org.cn/docs/scql/latest/zh-Hans/topics/ccl/intro",target:"_blank",rel:"noreferrer",children:"CCL configuration Guide"}),(0,g.jsx)(mr.Z,{className:"secretnote-ccl-table",dataSource:s,rowKey:"column",pagination:!1,columns:E,size:"small",loading:d})]})},hr={id:"data-table-ccl-modal",component:Li},gr,br,yr,Cr,Sr,wr,Q,$i=Si.Z.DirectoryTree,Ai=function(e){var t=e.data,r=(0,oe.useState)([]),n=ve()(r,2),i=n[0],a=n[1],s=(0,D.oC)(fe.yd),c=function(){var p=y()(f()().mark(function d(b){var v;return f()().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,s.service.getTableCCL(b);case 2:v=w.sent,a(v);case 4:case"end":return w.stop()}},d)}));return function(b){return p.apply(this,arguments)}}();if((0,oe.useEffect)(function(){t&&c(t.tableName)},[t]),!t)return null;var l=i.length>0?Object.keys(i[0]).map(function(p){return p==="column"?{title:"Column",dataIndex:"column",key:"column"}:{title:"Grant to ".concat(p),dataIndex:p,key:p,render:function(b){return b||"-"}}}):[];return(0,g.jsx)("div",{className:"secretnote-node-description",children:(0,g.jsxs)(ye.Z,{title:"\u8868\u4FE1\u606F",column:1,children:[(0,g.jsx)(ye.Z.Item,{label:"\u6570\u636E\u5E93\u7C7B\u578B",children:t.dbType}),(0,g.jsx)(ye.Z.Item,{label:"\u8868\u540D\u79F0",children:t.tableName}),(0,g.jsx)(ye.Z.Item,{label:"\u5173\u8054\u8868",children:t.refTable}),(0,g.jsx)(ye.Z.Item,{label:"\u6570\u636E\u5217",children:t.columns.map(function(p){return p.name}).join(", ")}),(0,g.jsx)(ye.Z.Item,{label:"CCL",children:(0,g.jsx)(mr.Z,{className:"secretnote-ccl-view-table",dataSource:i,rowKey:"column",pagination:!1,columns:l,size:"small"})})]})})},Ri=function(){var e=(0,D.oC)(fe.yd),t=e.service,r=function(a,s){switch(a){case"add":e.modalService.openModal(pr);break;case"configCCL":e.modalService.openModal(hr,s.data);break;case"delete":Re.Z.confirm({title:"\u5220\u9664\u6570\u636E\u8868",centered:!0,content:"\u6570\u636E\u8868 ".concat(s.title," \u5C06\u88AB\u5220\u9664"),okText:"\u5220\u9664\u6570\u636E\u8868",cancelText:we.U6.t("\u53D6\u6D88"),okType:"danger",onOk:function(l){return y()(f()().mark(function p(){return f()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,t.deleteDataTable(s);case 2:return _.ZP.success("\u6570\u636E\u8868\u5DF2\u5220\u9664"),b.abrupt("return",l(Promise.resolve));case 4:case"end":return b.stop()}},p)}))()}});break;default:break}},n=function(a){var s=a.isLeaf,c=a.belongToMe,l=c?[{key:"add",label:"\u6DFB\u52A0\u6570\u636E\u8868",icon:(0,g.jsx)(wi.Z,{size:12})}]:[],p=c?[{key:"configCCL",label:"\u914D\u7F6E CCL",icon:(0,g.jsx)(Ei.Z,{size:12})},{type:"divider"},{key:"delete",label:we.U6.t("\u5220\u9664"),icon:(0,g.jsx)(ki.Z,{size:12}),danger:!0}]:[],d=(0,g.jsxs)("div",{className:"ant-tree-title-content",children:[(0,g.jsx)("span",{className:"title",children:(0,g.jsxs)(rn.Z,{children:[s&&(0,g.jsx)(Ti.Z,{size:16}),(0,g.jsx)("span",{children:a.title})]})}),(0,g.jsx)(Ni.h,{items:s?p:l,onClick:function(v){r(v,a)}})]});return s?(0,g.jsx)(Gt.Z,{placement:"rightTop",align:{offset:[10,0]},arrow:!1,overlayStyle:{maxWidth:520},content:(0,g.jsx)(Ai,{data:a.data}),trigger:"hover",destroyTooltipOnHide:!0,children:d}):d};return(0,g.jsx)($i,{blockNode:!0,onSelect:function(){},treeData:t.dataTables,className:"secretnote-data-table-tree",switcherIcon:(0,g.jsx)(ji.Z,{size:12}),icon:null,titleRender:n})},un="data-table",Er=(gr=(0,j.ri)({contrib:[De.cI,Ci.l]}),br=(0,Y.ei)("secretnote-data-table-view"),yr=function(e,t){return(0,j.f3)(ne)(e,void 0,0)},Cr=function(e,t){return(0,j.f3)(be.Z)(e,void 0,1)},Sr=Reflect.metadata("design:type",Function),wr=Reflect.metadata("design:paramtypes",[typeof ne=="undefined"?Object:ne,typeof be.Z=="undefined"?Object:be.Z]),gr(Q=br(Q=yr(Q=Cr(Q=Sr(Q=wr(Q=function(o){re()(t,o);var e=ae()(t);function t(r,n){var i;return R()(this,t),i=e.call(this),h()(C()(i),"service",void 0),h()(C()(i),"modalService",void 0),h()(C()(i),"key",un),h()(C()(i),"label","\u6570\u636E\u8868"),h()(C()(i),"order",2),h()(C()(i),"defaultOpen",!0),h()(C()(i),"view",Ri),i.service=r,i.modalService=n,i}return Z()(t,[{key:"onViewMount",value:function(){this.service.getDataTables()}},{key:"registerModals",value:function(){return[pr,hr]}}]),t}(Ae.P))||Q)||Q)||Q)||Q)||Q)||Q),Zi=Ce.R.create().register(ne,Er,fr,(0,Y.bQ)({slot:un,view:Er,autoCreate:!0}),(0,Y.bQ)({slot:"".concat(un,"Extra"),view:fr,autoCreate:!0})),Di=m(62402),kr,Tr,zi=(kr=(0,j.ri)({contrib:Di.H}),kr(Tr=function(){function o(){R()(this,o)}return Z()(o,[{key:"registerToolbarItems",value:function(t){t.unregisterItem(S.NzD.Interrupt.id),t.unregisterItem(S.NzD.RestartClearOutput.id)}}]),o}())||Tr),Vi=Ce.R.create().register(zi),jr,Nr,Ze,Hi=function(){return(0,g.jsx)("div",{className:"secretnote-welcome-page",children:"Welcome to SecretNote."})},Or=(jr=(0,j.ri)(),Nr=(0,Y.ei)("secretnote-welcome-view"),jr(Ze=Nr(Ze=function(o){re()(t,o);var e=ae()(t);function t(){var r;R()(this,t);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return r=e.call.apply(e,[this].concat(i)),h()(C()(r),"view",Hi),r}return Z()(t)}(Ae.P))||Ze)||Ze),Wi=Ce.R.create().register(Or,(0,Y.bQ)({slot:ln.ux.welcome,view:Or,autoCreate:!0})),xi=m(20252),Qi=m(97341),Bi=m(352),Ji=function(){return(0,g.jsx)(Pr.rF.Application,{asChild:!0,modules:[Fr.n6L,De.xu,Qi.O,xi.F,ln.qi,hi,Zi,mi,Bi.V,Mr.p,Wi,Vi]},"libro-app")},Yi=Ji}}]);
