"use strict";(self.webpackChunk_datalayer_jupyter_kernels=self.webpackChunk_datalayer_jupyter_kernels||[]).push([[9324,442],{61295:(e,t,n)=>{n.d(t,{Z:()=>i});var s=n(66029);const r={small:16,medium:32,large:64},i=s.forwardRef((function({title:e,titleId:t,size:n,colored:i,...a},o){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",className:"icon",viewBox:"0 0 1024 1024",fill:i?"currentColor":["#fff","#fffff","white","#FFF","#FFFFFF"].includes("currentColor")?"white":"currentColor",width:n?"string"==typeof n?r[n]:n:"16px","aria-hidden":"true",ref:o,"aria-labelledby":t},a),e?s.createElement("title",{id:t},e):null,s.createElement("path",{d:"M518.3 459a8 8 0 00-12.6 0l-112 141.7a7.98 7.98 0 006.3 12.9h73.9V856c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V613.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 459z"}),s.createElement("path",{d:"M811.4 366.7C765.6 245.9 648.9 160 512.2 160S258.8 245.8 213 366.6C127.3 389.1 64 467.2 64 560c0 110.5 89.5 200 199.9 200H304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8h-40.1c-33.7 0-65.4-13.4-89-37.7-23.5-24.2-36-56.8-34.9-90.6.9-26.4 9.9-51.2 26.2-72.1 16.7-21.3 40.1-36.8 66.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10C846.1 454.5 884 503.8 884 560c0 33.1-12.9 64.3-36.3 87.7a123.07 123.07 0 01-87.6 36.3H720c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h40.1C870.5 760 960 670.5 960 560c0-92.7-63.1-170.7-148.6-193.3z"}))}))},9009:(e,t,n)=>{n.d(t,{Z:()=>i});var s=n(66029);const r={small:16,medium:32,large:64},i=s.forwardRef((function({title:e,titleId:t,size:n,colored:i,...a},o){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:i?"none":["#fff","#fffff","white","#FFF","#FFFFFF"].includes("none")?"white":"currentColor",viewBox:"0 0 21 21","aria-hidden":"true",width:n?"string"==typeof n?r[n]:n:"16px",ref:o,"aria-labelledby":t},a),e?s.createElement("title",{id:t},e):null,s.createElement("path",{fill:i?"#767677":["#fff","#fffff","white","#FFF","#FFFFFF"].includes("#767677")?"white":"currentColor",d:"M17.734 1.61A1.207 1.207 0 1116.477.478a1.193 1.193 0 011.257 1.132z"}),s.createElement("path",{fill:i?"#F37726":["#fff","#fffff","white","#FFF","#FFFFFF"].includes("#F37726")?"white":"currentColor",d:"M10.693 15.555c-3.205 0-6.021-1.15-7.478-2.848a7.973 7.973 0 0014.956 0c-1.453 1.698-4.259 2.848-7.478 2.848zM10.693 4.51c3.205 0 6.021 1.15 7.478 2.849a7.973 7.973 0 00-14.956 0c1.457-1.702 4.26-2.849 7.478-2.849z"}),s.createElement("path",{fill:i?"#9E9E9E":["#fff","#fffff","white","#FFF","#FFFFFF"].includes("#9E9E9E")?"white":"currentColor",d:"M6.281 18.86a1.52 1.52 0 11-1.584-1.424 1.505 1.505 0 011.584 1.425z"}),s.createElement("path",{fill:i?"#616262":["#fff","#fffff","white","#FFF","#FFFFFF"].includes("#616262")?"white":"currentColor",d:"M3.58 4.123a.876.876 0 11.85-.911.887.887 0 01-.85.911z"}))}))},27546:(e,t,n)=>{n.d(t,{Z:()=>i});var s=n(66029);const r={small:16,medium:32,large:64},i=s.forwardRef((function({title:e,titleId:t,size:n,...i},a){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 72 72",fill:"currentColor","aria-hidden":"true",ref:a,width:n?"string"==typeof n?r[n]:n:"16px","aria-labelledby":t},i),e?s.createElement("title",{id:t},e):null,s.createElement("path",{fill:"#ea5a47",d:"M58.14 21.78l-7.76-8.013-14.29 14.22-14.22-14.22-8.013 8.013L28.217 36l-14.36 14.22 8.014 8.013 14.22-14.22 14.29 14.22 7.76-8.013L43.921 36z"}),s.createElement("path",{fill:"none",stroke:"#000",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:10,strokeWidth:2,d:"M58.14 21.78l-7.76-8.013-14.29 14.22-14.22-14.22-8.013 8.013L28.207 36l-14.35 14.22 8.014 8.013 14.22-14.22 14.29 14.22 7.76-8.013L43.921 36z"}))}))},30882:(e,t,n)=>{n.d(t,{Z:()=>i});var s=n(66029);const r={small:16,medium:32,large:64},i=s.forwardRef((function({title:e,titleId:t,size:n,...i},a){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 72 72",fill:"currentColor","aria-hidden":"true",ref:a,width:n?"string"==typeof n?r[n]:n:"16px","aria-labelledby":t},i),e?s.createElement("title",{id:t},e):null,s.createElement("path",{fill:"#FFF",d:"M11 57.697h49V11.909H15.998l-4 4z"}),s.createElement("path",{fill:"#9b9b9a",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:10,strokeWidth:2,d:"M55.002 60.91H11.998a.999.999 0 01-.998-1V16.909c0-.552.447-.999.999-.999H55c.552 0 .999.447.999.999V59.91a.999.999 0 01-.998.998z"}),s.createElement("g",{fill:"none",stroke:"#000",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:10,strokeWidth:2},s.createElement("path",{d:"M11 16.91l4.998-5h43.004c.55 0 .998.446.998.998V55.91a.999.999 0 01-.999.998"}),s.createElement("path",{d:"M55.002 60.91H11.998a.999.999 0 01-.998-1V16.909c0-.552.447-.999.999-.999H55c.552 0 .999.447.999.999V59.91a.999.999 0 01-.998.998z"}),s.createElement("path",{d:"M47.358 29.799h-4v7h4M43.358 33.298h3M19.642 36.798v-7l5 7v-7M30.858 36.798h0a2.5 2.5 0 01-2.5-2.5v-2a2.5 2.5 0 012.5-2.5h0a2.5 2.5 0 012.5 2.5v2a2.5 2.5 0 01-2.5 2.5zM36.358 29.829h4M38.358 29.829v7"})))}))},29482:(e,t,n)=>{n.d(t,{Z:()=>f});var s=n(74512),r=n(4539),i=n(57531),a=n(67048),o=n(66029),l=n(64309),c=n(19342),d=n(41264),h=n(96560);const u=n.n(h)().div`
  position: fixed;
  display: flex;
  justify-content: center;
  align-items: center;
  background-color: rgba(0, 0, 0, 0.3);
  height: 100vh;
  width: 100vw;
  right: 0;
  top: 0;
  z-index: 1000000000;
`,p=function({open:e,element:t}){return e?(0,s.jsx)(u,{children:t}):(0,s.jsx)(s.Fragment,{})},m=(0,o.createContext)({openBackdrop:e=>{},closeBackdrop:()=>{}}),g=({children:e})=>{const[t,n]=(0,o.useState)(!1),[r,i]=(0,o.useState)();return(0,s.jsxs)(m.Provider,{value:{openBackdrop:e=>{i(e),n(!0)},closeBackdrop:()=>{i(void 0),n(!1)}},children:[(0,s.jsx)(p,{open:t,element:r}),e]})},f=e=>{const{loadConfig:t}=e,[n,h]=(0,o.useState)(),{configuration:u}=(0,r.useDatalayerStore)();return(0,o.useEffect)((()=>{t&&(0,i.loadIAMConfig)(),h((0,a.loadJupyterConfig)({}))}),[]),(0,o.useEffect)((()=>{t&&u?.apiServerUrl&&(0,i.setIAMServerUrl)(u.apiServerUrl)}),[u?.apiServerUrl]),(0,s.jsx)(g,{children:n&&(n.insideJupyterLab?(0,s.jsx)(l.MemoryRouter,{initialEntries:["/jupyter/kernels"],children:(0,s.jsx)(d.Z,{embeddedInJupyter:!0})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.BrowserRouter,{children:(0,s.jsx)(d.Z,{})}),(0,s.jsx)(c.ToastContainer,{})]}))})}},41264:(e,t,n)=>{n.d(t,{r:()=>Ve,Z:()=>We});var s=n(74512),r=n(4539),i=n(57531),a=n(67048),o=n(89010),l=n(86497),c=n(59689),d=n(35105),h=n(59606),u=n(66029),p=n(64309),m=n(56542),g=n(83895),f=n(32126),_=n(83284);const w=()=>{const e=(0,p.useNavigate)();return(t,n=null,s=!0)=>{n&&n.preventDefault(),window.scrollTo(0,0),document.body.scrollTop=0,e(t)}};var y=n(94156),v=n(19118),x=n(68148),k=n(53646);const b={small:16,medium:32,large:64},j=u.forwardRef((function({title:e,titleId:t,size:n,colored:s,...r},i){return u.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",className:"icon",viewBox:"0 0 896 896",fill:s?"currentColor":["#fff","#fffff","white","#FFF","#FFFFFF"].includes("currentColor")?"white":"currentColor",width:n?"string"==typeof n?b[n]:n:"16px","aria-hidden":"true",ref:i,"aria-labelledby":t},r),e?u.createElement("title",{id:t},e):null,u.createElement("path",{d:"M747.4 354.7C701.6 233.9 584.9 148 448.2 148S194.8 233.8 149 354.6C63.3 377.1 0 455.1 0 548c0 110.5 89.5 200 199.9 200h496.2C806.5 748 896 658.5 896 548c0-92.7-63.1-170.7-148.6-193.3zm36.3 281a123.07 123.07 0 01-87.6 36.3H199.9c-33.1 0-64.2-12.9-87.6-36.3A123.3 123.3 0 0176 548c0-28 9.1-54.3 26.2-76.3a125.7 125.7 0 0166.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10c54.3 14.5 92.1 63.8 92.1 120 0 33.1-12.9 64.3-36.3 87.7z"}))})),C={small:16,medium:32,large:64},S=u.forwardRef((function({title:e,titleId:t,size:n,colored:s,...r},i){return u.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:s?"none":["#fff","#fffff","white","#FFF","#FFFFFF"].includes("none")?"white":"currentColor",viewBox:"0 0 18 18","aria-hidden":"true",width:n?"string"==typeof n?C[n]:n:"16px",ref:i,"aria-labelledby":t},r),e?u.createElement("title",{id:t},e):null,u.createElement("path",{fill:s?"#757575":["#fff","#fffff","white","#FFF","#FFFFFF"].includes("#757575")?"white":"currentColor",d:"M3.643 11.143H1.5V16.5h5.357v-2.143H3.643v-3.214zM1.5 6.857h2.143V3.643h3.214V1.5H1.5v5.357zm12.857 7.5h-3.214V16.5H16.5v-5.357h-2.143v3.214zM11.143 1.5v2.143h3.214v3.214H16.5V1.5h-5.357z"}))})),M={small:16,medium:32,large:64},E=u.forwardRef((function({title:e,titleId:t,size:n,colored:s,...r},i){return u.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:s?"currentColor":["#fff","#fffff","white","#FFF","#FFFFFF"].includes("currentColor")?"white":"currentColor",viewBox:"0 0 20 20","aria-hidden":"true",width:n?"string"==typeof n?M[n]:n:"16px",ref:i,"aria-labelledby":t},r),e?u.createElement("title",{id:t},e):null,u.createElement("path",{d:"M10 0c.293 0 .585.013.876.039.929.08 1.612.767 1.824 1.573l.36 1.384c.022.083.099.198.265.28.289.143.568.304.835.483.154.102.291.112.374.089l1.378-.38c.806-.22 1.74.027 2.275.788.338.481.633.99.88 1.523.394.843.14 1.777-.454 2.364L17.595 9.15c-.061.06-.122.184-.11.367.02.322.02.644 0 .966-.012.183.047.307.11.367l1.018 1.008c.593.586.848 1.52.454 2.363a9.967 9.967 0 01-.88 1.521c-.535.763-1.47 1.01-2.275.788l-1.377-.378c-.084-.023-.221-.013-.375.09-.268.178-.546.34-.835.482-.166.082-.242.197-.264.28l-.362 1.382c-.21.808-.894 1.495-1.823 1.575a9.998 9.998 0 01-1.752 0c-.929-.08-1.611-.767-1.823-1.575l-.361-1.382c-.022-.083-.099-.198-.265-.28a7.181 7.181 0 01-.835-.483c-.154-.102-.291-.112-.374-.088l-1.378.378c-.805.22-1.74-.026-2.275-.787-.337-.481-.632-.99-.88-1.523-.394-.844-.14-1.777.453-2.364l1.019-1.007c.063-.06.123-.184.11-.367a7.768 7.768 0 010-.966c.013-.183-.047-.307-.11-.367L1.386 8.142C.794 7.556.54 6.623.933 5.78a9.9 9.9 0 01.88-1.521c.535-.763 1.47-1.01 2.275-.788l1.377.377c.084.024.221.014.375-.088.268-.179.546-.34.835-.483.166-.082.243-.197.264-.28L7.3 1.614C7.511.806 8.195.119 9.124.037 9.413.014 9.705 0 10 0zm-.714 1.906c-.045.004-.135.045-.171.183L8.754 3.47c-.184.701-.686 1.209-1.248 1.486a5.644 5.644 0 00-.625.363c-.521.347-1.212.529-1.911.337l-1.379-.378c-.136-.038-.218.02-.243.056-.275.39-.515.805-.717 1.237-.017.039-.026.138.074.238l1.019 1.007c.514.508.702 1.196.662 1.82a5.887 5.887 0 000 .728c.04.623-.148 1.312-.662 1.82L2.705 13.19c-.101.1-.091.199-.074.238.203.432.442.846.717 1.236.025.038.106.095.243.058l1.378-.38c.7-.19 1.391-.01 1.912.338.202.134.41.255.627.363.558.277 1.062.786 1.246 1.486l.361 1.381c.036.136.126.179.171.183a8.26 8.26 0 001.428 0c.045-.004.135-.045.171-.183l.361-1.381c.184-.701.686-1.209 1.248-1.486.216-.108.425-.229.625-.363.521-.347 1.212-.528 1.911-.337l1.379.379c.136.036.219-.02.244-.057.274-.391.513-.805.716-1.237.017-.039.026-.138-.074-.238l-1.019-1.007c-.514-.508-.702-1.196-.662-1.82a5.887 5.887 0 000-.728c-.04-.623.148-1.312.662-1.82l1.019-1.007c.101-.1.091-.199.074-.238a8.082 8.082 0 00-.716-1.236c-.025-.037-.107-.095-.244-.058l-1.378.38c-.7.19-1.391.01-1.912-.338-.2-.135-.41-.256-.627-.363-.558-.277-1.062-.786-1.246-1.486l-.361-1.381c-.036-.138-.126-.179-.171-.183a8.251 8.251 0 00-1.428 0zM13.75 10a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zm-1.875 0a1.875 1.875 0 10-3.75 0 1.875 1.875 0 003.75 0z"}))})),F={small:16,medium:32,large:64},D=u.forwardRef((function({title:e,titleId:t,size:n,colored:s,...r},i){return u.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:s?"none":["#fff","#fffff","white","#FFF","#FFFFFF"].includes("none")?"white":"currentColor","aria-hidden":"true",viewBox:"0 0 50 50",width:n?"string"==typeof n?F[n]:n:"16px",ref:i,"aria-labelledby":t},r),e?u.createElement("title",{id:t},e):null,u.createElement("path",{fill:s?"#e26d6d":["#fff","#fffff","white","#FFF","#FFFFFF"].includes("#e26d6d")?"white":"currentColor",strokeWidth:2.5,d:"M0 0h50v10H0zm0 0"}),u.createElement("path",{fill:s?"#f9cb07":["#fff","#fffff","white","#FFF","#FFFFFF"].includes("#f9cb07")?"white":"currentColor",strokeWidth:2.5,d:"M0 20h50v10H0zm0 0"}),u.createElement("path",{fill:s?"#49b3d9":["#fff","#fffff","white","#FFF","#FFFFFF"].includes("#49b3d9")?"white":"currentColor",strokeWidth:2.5,d:"M0 40h50v10H0zm0 0"}))})),R={small:16,medium:32,large:64},N=u.forwardRef((function({title:e,titleId:t,size:n,...s},r){return u.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",width:n?"string"==typeof n?R[n]:n:"16px",strokeWidth:2,className:"feather feather-log-out",viewBox:"0 0 24 24","aria-hidden":"true",ref:r,"aria-labelledby":t},s),e?u.createElement("title",{id:t},e):null,u.createElement("path",{d:"M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4M16 17l5-5-5-5M21 12H9"}))})),I=()=>{const{configuration:e}=(0,r.useDatalayerStore)(),t=w();return(0,s.jsxs)(y.P,{children:[(0,s.jsx)(y.P.Anchor,{children:(0,s.jsx)(v.h,{icon:k.Ui8,variant:"invisible","aria-label":"jupyter-kernels-more"})}),(0,s.jsx)(y.P.Overlay,{width:"medium",children:(0,s.jsxs)(x.S,{children:[(0,s.jsxs)(x.S.Group,{title:"More...",children:[(0,s.jsxs)(x.S.Item,{onSelect:()=>t("/jupyter/kernels/usage"),children:[(0,s.jsx)(x.S.LeadingVisual,{children:(0,s.jsx)(j,{})}),"Usage",(0,s.jsx)(x.S.Description,{variant:"block",children:"Monitor CPU/GPU/Memory usage of your Kernels."})]}),(0,s.jsxs)(x.S.Item,{onSelect:()=>t("/jupyter/kernels/credits"),children:[(0,s.jsx)(x.S.LeadingVisual,{children:(0,s.jsx)(S,{})}),"Credits",(0,s.jsx)(x.S.Description,{variant:"block",children:"Add more credits and access your credits history."})]}),(0,s.jsxs)(x.S.Item,{onSelect:()=>t("/jupyter/kernels/settings"),children:[(0,s.jsx)(x.S.LeadingVisual,{children:(0,s.jsx)(E,{})}),"Settings",(0,s.jsx)(x.S.Description,{variant:"block",children:"Configure your personal settings."})]}),!e?.whiteLabel&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(x.S.Item,{onSelect:()=>t("/jupyter/kernels/billing"),children:[(0,s.jsx)(x.S.LeadingVisual,{children:(0,s.jsx)(k.vJ3,{})}),"Billing",(0,s.jsx)(x.S.Description,{variant:"block",children:"Billing history."})]}),(0,s.jsxs)(x.S.Item,{onSelect:()=>t("/jupyter/kernels/docs"),children:[(0,s.jsx)(x.S.LeadingVisual,{children:(0,s.jsx)(k.vJ3,{})}),"Documentation",(0,s.jsx)(x.S.Description,{variant:"block",children:"Documentation to help you use Datalayer."})]}),(0,s.jsxs)(x.S.Item,{onSelect:()=>t("/jupyter/kernels/about"),children:[(0,s.jsx)(x.S.LeadingVisual,{children:(0,s.jsx)(D,{})}),"About",(0,s.jsx)(x.S.Description,{variant:"block",children:"Learn how to scale you local JupyterLab with remote kernels with Datalayer."})]})]})]}),!e?.whiteLabel&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.S.Divider,{}),(0,s.jsxs)(x.S.Item,{variant:"danger",onSelect:e=>t("/jupyter/kernels/logout"),children:[(0,s.jsx)(x.S.LeadingVisual,{children:(0,s.jsx)(N,{})}),"Logout"]})]})]})})]})},P=()=>{const{configuration:e}=(0,r.useDatalayerStore)(),{user:t}=(0,i.useStore)(),n=w();return(0,s.jsx)(_.Z,{sx:{backgroundColor:"canvas.subtle",color:"fg.default",paddingTop:0,height:45,paddingBottom:0},children:t?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(_.Z.Item,{full:!!t,children:(0,s.jsx)(_.Z.Link,{sx:{color:"fg.default",":focus":{color:"fg.subtle"},":hover":{color:"fg.subtle"}},href:"#",onClick:e=>{e.preventDefault(),n("/jupyter/kernels")},children:"Home"})}),!e?.whiteLabel&&(0,s.jsx)(_.Z.Item,{children:(0,s.jsx)(_.Z.Link,{sx:{color:"fg.default",":focus":{color:"fg.subtle"},":hover":{color:"fg.subtle"}},href:"#",onClick:e=>{e.preventDefault(),n("/jupyter/kernels/profile")},children:"Profile"})}),(0,s.jsx)(_.Z.Item,{children:(0,s.jsx)(I,{})})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(_.Z.Item,{children:(0,s.jsx)(_.Z.Link,{sx:{color:"fg.default",":focus":{color:"fg.subtle"},":hover":{color:"fg.subtle"}},href:"#",onClick:e=>{e.preventDefault(),n("/jupyter/kernels/login")},children:"Login"})}),!e?.whiteLabel&&(0,s.jsx)(_.Z.Item,{children:(0,s.jsx)(_.Z.Link,{sx:{color:"fg.default",":focus":{color:"fg.subtle"},":hover":{color:"fg.subtle"}},href:"#",onClick:e=>{e.preventDefault(),n("/jupyter/kernels/join")},children:"Join"})})]})})},T=e=>{const{children:t}=e;return(0,s.jsxs)(f.Z,{sx:{fontFamily:"normal",color:"fg.default"},children:[(0,s.jsx)(P,{}),t]})};var O=n(83513);const L={small:16,medium:32,large:64},Z=u.forwardRef((function({title:e,titleId:t,size:n,colored:s,...r},i){return u.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:s?"currentColor":["#fff","#fffff","white","#FFF","#FFFFFF"].includes("currentColor")?"white":"currentColor","aria-hidden":"true",width:n?"string"==typeof n?L[n]:n:"16px",ref:i,"aria-labelledby":t},r),e?u.createElement("title",{id:t},e):null,u.createElement("path",{d:"M24 10H14V0h-4v10H0v4h10v10h4V14h10z"}))})),A={small:16,medium:32,large:64},z=u.forwardRef((function({title:e,titleId:t,size:n,colored:s,...r},i){return u.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",fill:s?"currentColor":["#fff","#fffff","white","#FFF","#FFFFFF"].includes("currentColor")?"white":"currentColor","aria-hidden":"true",width:n?"string"==typeof n?A[n]:n:"16px",ref:i,"aria-labelledby":t},r),e?u.createElement("title",{id:t},e):null,u.createElement("path",{fill:s?"currentColor":["#fff","#fffff","white","#FFF","#FFFFFF"].includes("currentColor")?"white":"currentColor",d:"M14 10h-2v12h2V10zm6 0h-2v12h2V10z"}),u.createElement("path",{fill:s?"currentColor":["#fff","#fffff","white","#FFF","#FFFFFF"].includes("currentColor")?"white":"currentColor",d:"M16 4A12 12 0 114 16 12 12 0 0116 4m0-2a14 14 0 1014 14A14 14 0 0016 2z"}))}));var K=n(30882),V=n(9009),W=n(27546),H=n(7821),$=n(12221),B=n(11048),U=n(5917),J=n(62005),q=n(18310),X=n(19893),G=n(28977),Y=n(61295),Q=n(57687),ee=n(52746),te=n(16419),ne=n(14675),se=n(42913),re=n(62248),ie=n(96129),ae=n(19342);const oe=ae.toast.POSITION.TOP_CENTER,{insideJupyterLab:le}=(0,a.loadJupyterConfig)({}),ce=()=>({enqueueToast:(e,t)=>{switch(t.variant){case"info":le?ie.Notification.info(e,{autoClose:5e3}):ae.toast.info(e,{position:oe});break;case"success":le?ie.Notification.success(e,{autoClose:5e3}):ae.toast.success(e,{position:oe});break;case"warning":le?ie.Notification.warning(e,{autoClose:5e3}):ae.toast.warning(e,{position:oe});break;case"error":le?ie.Notification.error(e,{autoClose:5e3}):ae.toast.error(e,{position:oe})}}});var de=n(1865),he=n(66274);async function ue(e="",t={}){const n=he.ServerConnection.makeSettings(),s=de.URLExt.join(n.baseUrl,"jupyter_kernels",e);let r;try{r=await he.ServerConnection.makeRequest(s,t,n)}catch(e){throw new he.ServerConnection.NetworkError(e)}let i=await r.text();if(i.length>0)try{i=JSON.parse(i)}catch(e){console.log("Not a JSON response body.",r)}if(!r.ok)throw new he.ServerConnection.ResponseError(r,i.message||i);return i}var pe=n(65693);const me=()=>{const{configuration:e}=(0,r.useDatalayerStore)(),{enqueueToast:t}=ce(),{mountLocalFolder:n,unmountLocalFolder:a}=(()=>{const{apiRequest:e}=(0,i.useApi)({loginRoute:"/jupyter/kernels/login"});return{apiRequest:e,mountLocalFolder:e=>{ue(`jump/${e}`).then((e=>{console.log("--- mountLocalFolder",e)})).catch((e=>{console.error(`Error while accessing the jupyter server jupyter_kernels extension.\n${e}`)}))},unmountLocalFolder:e=>{ue(`jump/${e}`,{method:"DELETE"}).then((e=>{console.log("--- unmountLocalFolder",e)})).catch((e=>{console.error(`Error while accessing the jupyter server jupyter_kernels extension.\n${e}`)}))}}})(),{jupyterLabAdapter:o,serviceManager:l,showDisclaimer:c,setShowDisclaimer:d}=(0,O.ZP)(),[h,p]=(0,u.useState)(null),[m,g]=(0,u.useState)(null),[_,w]=(0,u.useState)(l?.remote?.servers.get()??null),[y,x]=(0,u.useState)(),[k,b]=(0,u.useState)((l?.remote?.environments.get().length??0)>0),[j,C]=(0,u.useState)(!1),S=(0,u.useCallback)((async e=>{await e.servers.refresh(),w(e.servers.get())}),[]),M=(0,u.useCallback)((async e=>{l?.remote&&(await l.remote.servers.shutdown(e),S(l.remote))}),[l?.remote]);(0,se.useInterval)((()=>{if(l){const e=l.remote.environments.get();b(!!e.length),l.remote&&w(l.remote.servers.get()),g(Array.from(l.local.kernels.running())),l.browser&&p(Array.from(l.browser.kernels.running()))}}),5e3);const E=(0,u.useCallback)((()=>{C(!0)}),[]),F=(0,u.useCallback)((()=>{l?.remote&&S(l.remote),C(!1)}),[]);return(0,s.jsxs)($.X,{containerWidth:"xlarge",padding:"normal",sx:{overflow:"visible",minHeight:"calc(100vh - 45px)"},children:[(0,s.jsxs)($.X.Header,{children:[!1===e?.whiteLabel&&c&&(0,s.jsxs)(H.CloseableFlash,{onClose:()=>d(!1),children:["Jupyter Kernels is released in ",(0,s.jsx)(B.Z,{children:"PREVIEW"})," mode. This means that the account you have created will not stay and can be removed at any time based on Datalayer's new releases. Read the"," ",(0,s.jsx)(U.Z,{href:"https://jupyter-kernels.datalayer.tech",target:"_blank",children:"documentation"})," ","for usage and support."]}),(0,s.jsx)(Q.m,{sx:{marginTop:1},children:(0,s.jsxs)(Q.m.TitleArea,{variant:"large",children:[(0,s.jsx)(Q.m.Title,{children:"Jupyter Kernels"}),(0,s.jsx)(Q.m.Description,{children:"PREVIEW"})]})})]}),(0,s.jsxs)($.X.Content,{children:[(0,s.jsxs)(f.Z,{mt:3,children:[_?.length?(0,s.jsxs)(ee.i.Container,{children:[(0,s.jsx)(ee.i.Title,{as:"h2",id:"remote-kernels",children:"Remote Kernels"}),(0,s.jsx)(ee.i.Actions,{children:(0,s.jsx)(v.h,{disabled:!k,variant:"invisible","aria-label":"Launch a Remote Kernel",title:"Launch a Remote Kernel",icon:Z,onClick:E})}),(0,s.jsx)(te.w,{"aria-labelledby":"remote-kernels",data:_,columns:[{header:"Name",field:"name",renderCell:e=>(0,s.jsx)(J.Z,{children:e.environment_name}),maxWidth:"200px"},{header:"Description",id:"description",width:"growCollapse",renderCell:e=>{const t=l?.remote?.environments.get().find((t=>t.name===e.environment_name));return(0,s.jsx)(J.Z,{sx:{overflowX:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t?.description??""})}},{header:"State",field:"execution_state",width:"100px",renderCell:e=>(0,s.jsx)(J.Z,{children:e.execution_state})},{header:"Start / Pause",id:"start-pause-action",width:"100px",renderCell:e=>(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(v.h,{"aria-label":`Pause the kernel with id ${e.id}`,icon:z,size:"small",onClick:()=>t("The Start/Pause feature is not yet implemented... Checkout out the next release 🎉, it is going to be awesome.",{variant:"warning"})})})},{header:"Example",id:"example-action",width:"100px",renderCell:e=>{const n=l?.remote?.environments.get().find((t=>t.name===e.environment_name)),r=n?.example;return r&&(0,s.jsx)(v.h,{disabled:!r,"aria-label":`Create an example notebook for kernel ${e.environment_name}`,icon:K.Z,size:"small",onClick:()=>{(0,pe.l)({app:o.jupyterLab,name:e.environment_name,url:r}),t(`An example notebook is created for kernel ${e.name}.`,{variant:"info"})}})}},{header:"Mount local folder",id:"mount-local-folder",width:"135px",renderCell:e=>(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(q.Z,{size:"small",checked:y===e.name,onClick:()=>{y===e.name?(a(e.id),x(void 0),t(`You local folder is not more accessible from ${e.name} kernel.`,{variant:"info"})):(n(e.id),x(e.name),t(`You local folder should be accessible from a Notebook connected to the ${e.name} kernel.`,{variant:"info"}))},disabled:void 0!==y&&y!==e.name})})})},{header:"Delete",id:"delete-action",width:"100px",renderCell:e=>(0,s.jsx)(fe,{deleteKernel:()=>M(e.id),model:e})}]})]}):(0,s.jsx)(f.Z,{children:(0,s.jsxs)(ne.Z,{border:!0,spacious:!0,children:[_?(0,s.jsx)(ne.Z.Visual,{children:(0,s.jsx)(V.Z,{size:"medium"})}):(0,s.jsx)(f.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"40px"},children:(0,s.jsx)(X.Z,{})}),(0,s.jsx)(ne.Z.Heading,{children:"Remote Kernels"}),_&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ne.Z.Description,{children:(0,s.jsx)(f.Z,{sx:{textAlign:"center"},children:(0,s.jsx)(f.Z,{children:"No Remote Kernels found."})})}),(0,s.jsx)(G.r,{leadingVisual:()=>(0,s.jsx)(Y.Z,{color:"white"}),disabled:!k,variant:"primary",size:"small",onClick:E,children:"Launch a Remote Kernel"})]})]})}),l?.remote&&j&&(0,s.jsx)(re.p,{manager:l.remote,onSubmit:F})]}),!1===e?.whiteLabel&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ge,{kernels:m,location:"local"}),l?.browser&&(0,s.jsx)(ge,{kernels:h,location:"browser"})]})]})]})};function ge({kernels:e,location:t}){const n=`${t.charAt(0).toLocaleUpperCase()}${t.slice(1)}`;return(0,s.jsx)(f.Z,{mt:3,children:e?.length?(0,s.jsxs)(ee.i.Container,{children:[(0,s.jsx)(ee.i.Title,{as:"h2",id:`${t}-kernels`,children:`${n} Kernels`}),(0,s.jsx)(te.w,{"aria-labelledby":`${t}-kernels`,data:e,columns:[{header:"Name",field:"name",renderCell:e=>(0,s.jsx)(J.Z,{children:e.name}),maxWidth:"200px"},{header:"ID",field:"id",width:"growCollapse",renderCell:e=>(0,s.jsx)(J.Z,{sx:{overflowX:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.id})},{header:"State",field:"execution_state",width:"100px",renderCell:e=>(0,s.jsx)(J.Z,{children:e.execution_state})}]})]}):(0,s.jsx)(f.Z,{children:(0,s.jsxs)(ne.Z,{border:!0,spacious:!0,children:[e?(0,s.jsx)(ne.Z.Visual,{children:(0,s.jsx)(V.Z,{size:"medium"})}):(0,s.jsx)(f.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"40px"},children:(0,s.jsx)(X.Z,{})}),(0,s.jsx)(ne.Z.Heading,{children:`${n} Kernels`}),e&&(0,s.jsx)(ne.Z.Description,{children:(0,s.jsx)(f.Z,{sx:{textAlign:"center"},children:(0,s.jsx)(f.Z,{children:`No ${n} Kernels found.`})})})]})})})}function fe({model:e,deleteKernel:t}){const[n,r]=(0,u.useState)(!1),i=(0,u.useCallback)((async()=>{r(!0);try{await t()}finally{r(!1)}}),[t,r]);return(0,s.jsx)(v.h,{"aria-label":`Delete the kernel ${e.name}`,disabled:n,icon:n?()=>(0,s.jsx)(X.Z,{size:"small"}):W.Z,size:"small",onClick:i})}const _e={small:16,medium:32,large:64},we=u.forwardRef((function({title:e,titleId:t,size:n,colored:s,...r},i){return u.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 243.75 243.75",fill:s?"currentColor":["#fff","#fffff","white","#FFF","#FFFFFF"].includes("currentColor")?"white":"currentColor","aria-hidden":"true",width:n?"string"==typeof n?_e[n]:n:"16px",ref:i,"aria-labelledby":t},r),e?u.createElement("title",{id:t},e):null,u.createElement("g",{fill:s?"#fff":["#fff","#fffff","white","#FFF","#FFFFFF"].includes("#fff")?"white":"currentColor",strokeWidth:2.928,transform:"translate(0 -308.268)"},u.createElement("circle",{cx:121.875,cy:430.143,r:120.411,stroke:"#000"}),u.createElement("path",{fillRule:"evenodd",stroke:"#000",strokeLinecap:"round",strokeLinejoin:"round",d:"M119.675 477.588l.253-140.166c-73.532 5.11-86.696 84.242-28.25 114.7l.61 25.34z"}),u.createElement("path",{fillRule:"evenodd",stroke:"#000",d:"M120.07 482.652H93.813c-2.945 4.667-3.575 8.04 2.748 13.127-6.62.865-6.378 8.548-2.9 10.686-4.242 1.556-5.282 8.727 6.869 7.937l1.625 5.486c.733 2.113 1.746 2.545 2.76 2.973l10.458-.086c1.992-.72 4.299-2.105 4.39-5.015z"}),u.createElement("path",{fillRule:"evenodd",stroke:"#f75c59",strokeLinecap:"round",strokeLinejoin:"round",d:"M124.291 477.462l-.469-139.95c73.532 5.11 86.696 84.458 28.25 114.916l-.61 25.34z"}),u.createElement("path",{fillRule:"evenodd",stroke:"#f75c59",d:"M125.32 482.957l-.306 32.361c1.317 11.059 11.072 8.629 10.99-.61v-31.751zM139.957 482.957l-.305 32.361c1.317 11.059 11.072 8.629 10.99-.61v-31.751z"}),u.createElement("path",{fillRule:"evenodd",stroke:"#f8d05b",d:"M112.412 477.238l-16.948-73.934c-4.23-19.168-16.974-14.783-11.444-.557 6.267 10.896 28.39 21.763 33.582 6.106-4.523-5.743-6.628-12.59 1.333-16.65"}),u.createElement("path",{fillRule:"evenodd",stroke:"#f75c59",strokeLinejoin:"round",d:"M131.627 399.814c1.778-4.471 12.628-9.482 19.487-14.062 7.117 3.213 17.741 13.145 12.804 25.555-1.265 4.901-28.05 4.544-30.224 2.137-4.481-4.606-3.115-10.024-2.067-13.63zM128.198 428.251c-.91 7.576-.577 13.909-.763 20.76 3.425.788 7.262.337 11.082-.062-2.75-6.95-5.704-13.748-10.319-20.698z"})))})),ye=e=>{const{version:t}=e,[n,r]=(0,u.useState)(!1);return(0,s.jsxs)($.X,{containerWidth:"xlarge",padding:"normal",sx:{overflow:"visible",minHeight:"calc(100vh - 45px)"},children:[(0,s.jsx)($.X.Header,{children:(0,s.jsx)(Q.m,{children:(0,s.jsxs)(Q.m.TitleArea,{variant:"large",children:[(0,s.jsxs)(Q.m.Title,{children:["🪐 ⚪ Jupyter Kernels",(0,s.jsx)(B.Z,{sx:{marginLeft:1},children:t})]}),(0,s.jsx)(Q.m.Description,{children:"PREVIEW"})]})})}),(0,s.jsxs)($.X.Content,{children:[(0,s.jsx)(f.Z,{children:(0,s.jsx)(J.Z,{children:"Jupyter Kernels scales your JupyterLab in the cloud with remote Kernels and local files."})}),(0,s.jsx)(f.Z,{mt:3,children:n?(0,s.jsx)(we,{size:300,onClick:e=>r(!1)}):(0,s.jsx)("img",{src:"https://assets.datalayer.tech/releases/datalayer-0.3.0-black-snake_1024.png",onClick:e=>r(!0),style:{width:"100%"}})}),(0,s.jsx)(f.Z,{children:(0,s.jsx)(U.Z,{href:"https://datalayer.tech/docs/releases/0.3.0-black-snake",target:"_blank",children:(0,s.jsx)(J.Z,{as:"h4",children:"Datalayer 0.3.0 Black Snake Release"})})}),(0,s.jsx)(f.Z,{children:(0,s.jsx)(U.Z,{href:"https://github.com/datalayer/datalayer-iam",target:"_blank",children:(0,s.jsx)(J.Z,{as:"h4",children:"Source code"})})})]})]})};var ve=n(46722);const xe={small:16,medium:32,large:64},ke=u.forwardRef((function({title:e,titleId:t,size:n,...s},r){return u.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 72 72",fill:"currentColor","aria-hidden":"true",ref:r,width:n?"string"==typeof n?xe[n]:n:"16px","aria-labelledby":t},s),e?u.createElement("title",{id:t},e):null,u.createElement("path",{fill:"#fff",d:"M15.35 59.08h-1.779c-.684 0-1.238-.578-1.238-1.291v-34.83c0-.713.554-1.291 1.238-1.291h1.779c.684 0 1.238.578 1.238 1.291v34.83c0 .713-.554 1.291-1.238 1.291zM58.46 59.08h-1.779c-.684 0-1.238-.713-1.238-1.593v-32.97c0-.88.554-1.593 1.238-1.593h1.779c.684 0 1.238.713 1.238 1.593v32.97c0 .88-.555 1.593-1.238 1.593z"}),u.createElement("path",{fill:"#fcea2b",d:"M7.45 43.47h7.743L7.45 51.213z"}),u.createElement("path",{fill:"#3F3F3F",d:"M15.19 43.47h12.34l-7.743 7.743-12.34-.058z"}),u.createElement("path",{fill:"#fcea2b",d:"M27.48 43.47h12.34l-7.743 7.743h-12.29z"}),u.createElement("path",{fill:"#3F3F3F",d:"M39.82 43.47h12.34l-7.743 7.743h-12.34z"}),u.createElement("path",{fill:"#fcea2b",d:"M52.16 43.47l11.89-.184-7.612 7.612h-11.7z"}),u.createElement("path",{fill:"#3F3F3F",d:"M64.05 43.29v7.612h-7.612z"}),u.createElement("path",{fill:"#fcea2b",d:"M7.95 28.33l7.646-.034-7.646 7.646z"}),u.createElement("path",{fill:"#3F3F3F",d:"M15.6 28.3h11.94l-7.695 7.646H7.955z"}),u.createElement("path",{fill:"#fcea2b",d:"M27.48 28.3h12.34l-7.743 7.743h-12.29z"}),u.createElement("path",{fill:"#3F3F3F",d:"M39.82 28.3h12.34l-7.743 7.743h-12.34z"}),u.createElement("path",{fill:"#fcea2b",d:"M52.16 28.3H64.5l-8.062 7.646-12.02.098z"}),u.createElement("path",{fill:"#3F3F3F",d:"M64.05 28.33v7.612h-7.612z"}),u.createElement("g",{fill:"none",stroke:"#000",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:10,strokeWidth:2},u.createElement("path",{d:"M12.74 42.72v-6.348M16.92 50.9v6.509c0 .672-.545 1.217-1.217 1.217h-1.748a1.217 1.217 0 01-1.217-1.217v-6.071M16.92 36.37v6.348M12.74 28.24v-5.907m4.181 0v5.812M55.1 43.29v-6.921M59.28 51.34v6.071c0 .672-.545 1.217-1.217 1.217h-1.748a1.217 1.217 0 01-1.217-1.217V51.34M59.28 36.37v5.969M55.1 28.03v-5.891m4.181 0v5.796M7.95 28.33h56.1v7.612H7.95z"}),u.createElement("path",{d:"M7.95 43.29h56.1v7.612H7.95z"}),u.createElement("ellipse",{cx:14.83,cy:17.97,rx:4.594,ry:4.596}),u.createElement("ellipse",{cx:57.19,cy:17.97,rx:4.594,ry:4.596})),u.createElement("g",{fill:"#f4aa41",fillRule:"evenodd",stroke:"#e27022",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:10,strokeWidth:2,transform:"translate(-2.525 -.094)"},u.createElement("ellipse",{cx:17.36,cy:18.06,rx:4.594,ry:4.596}),u.createElement("ellipse",{cx:59.71,cy:18.06,rx:4.594,ry:4.596})))})),be=()=>(0,s.jsxs)($.X,{containerWidth:"xlarge",padding:"normal",sx:{overflow:"visible",minHeight:"calc(100vh - 45px)"},children:[(0,s.jsxs)($.X.Header,{children:[(0,s.jsx)(Q.m,{children:(0,s.jsxs)(Q.m.TitleArea,{variant:"large",children:[(0,s.jsx)(Q.m.Title,{children:"Billing"}),(0,s.jsx)(Q.m.Description,{children:"PREVIEW"})]})}),(0,s.jsx)(f.Z,{children:(0,s.jsxs)(ve.Z,{children:[(0,s.jsx)(f.Z,{children:"This feature is being developed."}),(0,s.jsxs)(f.Z,{mt:3,children:["Follow progress on"," ",(0,s.jsx)(U.Z,{href:"https://twitter.com/DatalayerIO",target:"_blank",children:"https://twitter.com/DatalayerIO"}),"."]})]})})]}),(0,s.jsx)($.X.Content,{children:(0,s.jsx)(ke,{size:200})})]}),je=()=>(0,s.jsxs)($.X,{containerWidth:"xlarge",padding:"normal",sx:{overflow:"visible",minHeight:"calc(100vh - 45px)"},children:[(0,s.jsxs)($.X.Header,{children:[(0,s.jsx)(Q.m,{children:(0,s.jsxs)(Q.m.TitleArea,{variant:"large",children:[(0,s.jsx)(Q.m.Title,{children:"Content"}),(0,s.jsx)(Q.m.Description,{children:"PREVIEW"})]})}),(0,s.jsx)(f.Z,{children:(0,s.jsxs)(ve.Z,{children:[(0,s.jsx)(f.Z,{children:"This feature is being developed."}),(0,s.jsxs)(f.Z,{mt:3,children:["Follow progress on"," ",(0,s.jsx)(U.Z,{href:"https://twitter.com/DatalayerIO",target:"_blank",children:"https://twitter.com/DatalayerIO"}),"."]})]})})]}),(0,s.jsx)($.X.Content,{children:(0,s.jsx)(ke,{size:200})})]}),Ce=()=>(0,s.jsxs)($.X,{containerWidth:"xlarge",padding:"normal",sx:{overflow:"visible",minHeight:"calc(100vh - 45px)"},children:[(0,s.jsxs)($.X.Header,{children:[(0,s.jsx)(Q.m,{children:(0,s.jsxs)(Q.m.TitleArea,{variant:"large",children:[(0,s.jsx)(Q.m.Title,{children:"Credits"}),(0,s.jsx)(Q.m.Description,{children:"PREVIEW"})]})}),(0,s.jsx)(f.Z,{children:(0,s.jsxs)(ve.Z,{children:[(0,s.jsx)(f.Z,{children:"This feature is being developed."}),(0,s.jsxs)(f.Z,{mt:3,children:["Follow progress on"," ",(0,s.jsx)(U.Z,{href:"https://twitter.com/DatalayerIO",target:"_blank",children:"https://twitter.com/DatalayerIO"}),"."]})]})})]}),(0,s.jsx)($.X.Content,{children:(0,s.jsx)(ke,{size:200})})]});var Se=n(21809);const Me=e=>{const{boxPanel:t}=e;return(0,s.jsx)("div",{style:{position:"relative"},children:(0,s.jsx)(f.Z,{className:"jp-LabShell",sx:{position:"relative","& .dla-Jupyter-Notebook":{height:1e3,maxHeight:1e3,width:"100%"},"& .jp-MainAreaWidget":{width:"100%",height:"100%"},"& .jp-Toolbar":{width:"100% !important"},"& .jp-NotebookPanel-notebook":{width:"100% !important",height:"100%"},"& .lm-mod-hidden":{display:"unset !important"}},children:(0,s.jsx)(a.Lumino,{children:t})})})},Ee=()=>{const{jupyterLabAdapter:e,serviceManager:t}=(0,O.ZP)(),{enqueueToast:n}=ce(),[r,i]=(0,u.useState)(),[a,o]=(0,u.useState)(),[l,c]=(0,u.useState)(),[d,h]=(0,u.useState)();(0,u.useEffect)((()=>{e&&(async()=>{const t=await e.notebook("test.ipynb");h(t)})().catch(console.error)}),[e]);const p=()=>{i(Array.from(t.local.kernels.running())),o(Array.from(t.local.sessions.running())),c(t.remote.servers.get())};return(0,se.useInterval)((()=>{t&&t.remote&&p()}),5e3),(0,s.jsxs)(f.Z,{sx:{width:"xlarge",padding:2},children:[(0,s.jsx)(me,{}),(0,s.jsx)(Se.Z,{children:"Debugging Section"}),t&&t.local&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(f.Z,{children:"Local Jupyter Server"}),(0,s.jsxs)(f.Z,{children:[t.local.serverSettings.baseUrl," -"," ",t.local.serverSettings.wsUrl]}),(0,s.jsxs)(f.Z,{mt:3,children:[(0,s.jsx)(f.Z,{children:"Local Kernels [ id | name | last_activity | execution_state | connections ]"}),r?.map((e=>(0,s.jsx)(f.Z,{children:(0,s.jsxs)(f.Z,{children:[e.id," | ",e.name," | ",e.last_activity," |"," ",e.execution_state," | ",e.connections,(0,s.jsx)(U.Z,{sx:{marginLeft:1},href:"",onClick:s=>{var r;s.preventDefault(),r=e.id,t.local.kernels.shutdown(r).then((()=>{n(`Kernel ${r} is terminated.`,{variant:"info"}),console.log(`Kernel ${r} is terminated.`),p()}))},children:"delete"})]})},e.id)))]}),(0,s.jsxs)(f.Z,{mt:3,children:[(0,s.jsx)(f.Z,{children:"Local Sessions [ id | name | path | type | kernel_id | kernel_name ]"}),a?.map((e=>(0,s.jsx)(f.Z,{children:(0,s.jsxs)(f.Z,{children:[e.id," | ",e.name," | ",e.path," |"," ",e.type," | ",e.kernel?.id," |"," ",e.kernel?.name,(0,s.jsx)(U.Z,{href:"",sx:{marginLeft:1},onClick:s=>{var r;s.preventDefault(),r=e.id,t.local.sessions.shutdown(r).then((()=>{n(`Session ${r} is terminated.`,{variant:"info"}),console.log(`Session ${r} is terminated.`),p()}))},children:"delete"})]})},e.id)))]})]}),t&&t.remote&&l&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(f.Z,{mt:3,children:"Remote Jupyter Server"}),(0,s.jsxs)(f.Z,{children:[t.remote.serverSettings.baseUrl," -"," ",t.remote.serverSettings.wsUrl]}),(0,s.jsxs)(f.Z,{mt:3,children:[(0,s.jsx)(f.Z,{children:"Remote Kernels [ id | name | last_activity | execution_state | connections ]"}),l.map((e=>(0,s.jsx)(f.Z,{children:(0,s.jsxs)(f.Z,{children:[e.id," | ",e.name," | ",e.last_activity," |"," ",e.execution_state," | ",e.connections,(0,s.jsx)(U.Z,{sx:{marginLeft:1},href:"",onClick:s=>{var r;s.preventDefault(),r=e.id,t.remote?.servers.shutdown(r).then((()=>{n(`Kernel ${r} is terminated.`,{variant:"info"}),console.log(`Kernel ${r} is terminated.`),p()}))},children:"delete"})]})},e.id)))]})]}),d&&(0,s.jsx)(Me,{boxPanel:d})]})},Fe=()=>(0,s.jsx)($.X,{containerWidth:"xlarge",padding:"normal",sx:{overflow:"visible",minHeight:"calc(100vh - 45px)"},children:(0,s.jsx)($.X.Content,{children:(0,s.jsx)("iframe",{src:"https://jupyter-kernels.datalayer.tech",style:{width:"100%",height:"1000px",border:0}})})}),De=()=>(0,s.jsxs)($.X,{containerWidth:"xlarge",padding:"normal",sx:{overflow:"visible",minHeight:"calc(100vh - 45px)"},children:[(0,s.jsxs)($.X.Header,{children:[(0,s.jsx)(Q.m,{children:(0,s.jsxs)(Q.m.TitleArea,{variant:"large",children:[(0,s.jsx)(Q.m.Title,{children:"Environments"}),(0,s.jsx)(Q.m.Description,{children:"PREVIEW"})]})}),(0,s.jsx)(f.Z,{children:(0,s.jsxs)(ve.Z,{children:[(0,s.jsx)(f.Z,{children:"This feature is being developed."}),(0,s.jsxs)(f.Z,{mt:3,children:["Follow progress on"," ",(0,s.jsx)(U.Z,{href:"https://twitter.com/DatalayerIO",target:"_blank",children:"https://twitter.com/DatalayerIO"}),"."]})]})})]}),(0,s.jsx)($.X.Content,{children:(0,s.jsx)(ke,{size:200})})]}),Re=()=>(0,s.jsxs)($.X,{containerWidth:"xlarge",padding:"normal",sx:{overflow:"visible",minHeight:"calc(100vh - 45px)"},children:[(0,s.jsxs)($.X.Header,{children:[(0,s.jsx)(Q.m,{children:(0,s.jsxs)(Q.m.TitleArea,{variant:"large",children:[(0,s.jsx)(Q.m.Title,{children:"Kernels"}),(0,s.jsx)(Q.m.Description,{children:"PREVIEW"})]})}),(0,s.jsx)(f.Z,{children:(0,s.jsxs)(ve.Z,{children:[(0,s.jsx)(f.Z,{children:"This feature is being developed."}),(0,s.jsxs)(f.Z,{mt:3,children:["Follow progress on"," ",(0,s.jsx)(U.Z,{href:"https://twitter.com/DatalayerIO",target:"_blank",children:"https://twitter.com/DatalayerIO"}),"."]})]})})]}),(0,s.jsx)($.X.Content,{children:(0,s.jsx)(ke,{size:200})})]}),Ne=()=>(0,s.jsxs)($.X,{containerWidth:"xlarge",padding:"normal",sx:{overflow:"visible",minHeight:"calc(100vh - 45px)"},children:[(0,s.jsxs)($.X.Header,{children:[(0,s.jsx)(Q.m,{children:(0,s.jsxs)(Q.m.TitleArea,{variant:"large",children:[(0,s.jsx)(Q.m.Title,{children:"Pools"}),(0,s.jsx)(Q.m.Description,{children:"PREVIEW"})]})}),(0,s.jsx)(f.Z,{children:(0,s.jsxs)(ve.Z,{children:[(0,s.jsx)(f.Z,{children:"This feature is being developed."}),(0,s.jsxs)(f.Z,{mt:3,children:["Follow progress on"," ",(0,s.jsx)(U.Z,{href:"https://twitter.com/DatalayerIO",target:"_blank",children:"https://twitter.com/DatalayerIO"}),"."]})]})})]}),(0,s.jsx)($.X.Content,{children:(0,s.jsx)(ke,{size:200})})]});var Ie=n(4633),Pe=n(54915),Te=n(61726);const Oe=[{navigation:"Overview",icon:k.vJ3,href:"#overview"},{navigation:"Details",icon:k.Rg1,counter:3,href:"#projects"},{navigation:"Cards",icon:k.H0r,counter:"12",href:"#repositories"},{navigation:"Stars",icon:k.r7p,counter:"3",href:"#stars"},{navigation:"Activity",icon:k.sOM,counter:67,href:"#activity"}],Le=()=>{const{user:e}=(0,i.useStore)(),[t,n]=(0,u.useState)(0);return(0,s.jsxs)(f.Z,{sx:{display:"flex",flexDirection:"row",gap:3,alignItems:"flex-start"},children:[(0,s.jsxs)(f.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start",height:"100%"},children:[(0,s.jsx)(Ie.Z,{size:256,src:"https://avatars.githubusercontent.com/u/5007189?s=200&v=4",alt:"avatar"}),(0,s.jsxs)(f.Z,{children:[(0,s.jsxs)(f.Z,{sx:{paddingY:3},children:[(0,s.jsx)(Pe.Z,{as:"h1",sx:{fontSize:24},children:e?.displayName}),(0,s.jsx)(Pe.Z,{as:"h1",sx:{fontSize:20,fontWeight:300},children:e?.handle})]}),(0,s.jsx)(f.Z,{sx:{display:"flex",flexDirection:"column",color:"fg.onEmphasis"},children:(0,s.jsx)(G.r,{block:!0,children:"Edit Profile"})})]})]}),(0,s.jsxs)(f.Z,{sx:{flexGrow:1},children:[(0,s.jsx)(Te.J,{"aria-label":"Repository",children:Oe.map(((e,r)=>(0,s.jsx)(Te.J.Item,{icon:e.icon,"aria-current":r===t?"page":void 0,onSelect:e=>{e.preventDefault(),n(r)},counter:e.counter,href:e.href,children:e.navigation},e.navigation)))}),(0,s.jsx)(f.Z,{sx:{border:"1px solid",marginTop:2,borderColor:"border.default",borderRadius:"12px",height:"300px",width:"80%",padding:4},children:(0,s.jsx)(J.Z,{children:" "})})]})]})},Ze=()=>(0,s.jsxs)($.X,{containerWidth:"xlarge",padding:"normal",sx:{overflow:"visible",minHeight:"calc(100vh - 45px)"},children:[(0,s.jsx)($.X.Header,{children:(0,s.jsx)(Q.m,{children:(0,s.jsx)(Q.m.TitleArea,{variant:"large",children:(0,s.jsx)(Q.m.Title,{children:"Profile"})})})}),(0,s.jsx)($.X.Content,{children:(0,s.jsx)(Le,{})})]}),Ae=()=>(0,s.jsxs)($.X,{containerWidth:"xlarge",padding:"normal",sx:{overflow:"visible",minHeight:"calc(100vh - 45px)"},children:[(0,s.jsxs)($.X.Header,{children:[(0,s.jsx)(Q.m,{children:(0,s.jsxs)(Q.m.TitleArea,{variant:"large",children:[(0,s.jsx)(Q.m.Title,{children:"Servers"}),(0,s.jsx)(Q.m.Description,{children:"PREVIEW"})]})}),(0,s.jsx)(f.Z,{children:(0,s.jsxs)(ve.Z,{children:[(0,s.jsx)(f.Z,{children:"This feature is being developed."}),(0,s.jsxs)(f.Z,{mt:3,children:["Follow progress on"," ",(0,s.jsx)(U.Z,{href:"https://twitter.com/DatalayerIO",target:"_blank",children:"https://twitter.com/DatalayerIO"}),"."]})]})})]}),(0,s.jsx)($.X.Content,{children:(0,s.jsx)(ke,{size:200})})]}),ze=()=>(0,s.jsxs)($.X,{containerWidth:"xlarge",padding:"normal",sx:{overflow:"visible",minHeight:"calc(100vh - 45px)"},children:[(0,s.jsx)($.X.Header,{children:(0,s.jsx)(Q.m,{children:(0,s.jsx)(Q.m.TitleArea,{variant:"large",children:(0,s.jsx)(Q.m.Title,{children:"Settings"})})})}),(0,s.jsx)($.X.Content,{children:(0,s.jsx)(i.DatalayerIdentity,{})})]}),Ke=()=>(0,s.jsxs)($.X,{containerWidth:"xlarge",padding:"normal",sx:{overflow:"visible",minHeight:"calc(100vh - 45px)"},children:[(0,s.jsxs)($.X.Header,{children:[(0,s.jsx)(Q.m,{children:(0,s.jsxs)(Q.m.TitleArea,{variant:"large",children:[(0,s.jsx)(Q.m.Title,{children:"Usage"}),(0,s.jsx)(Q.m.Description,{children:"PREVIEW"})]})}),(0,s.jsx)(f.Z,{children:(0,s.jsxs)(ve.Z,{children:[(0,s.jsx)(f.Z,{children:"This feature is being developed."}),(0,s.jsxs)(f.Z,{mt:3,children:["Follow progress on"," ",(0,s.jsx)(U.Z,{href:"https://twitter.com/DatalayerIO",target:"_blank",children:"https://twitter.com/DatalayerIO"}),"."]})]})})]}),(0,s.jsx)($.X.Content,{children:(0,s.jsx)(ke,{size:200})})]}),Ve=e=>{const{embeddedInJupyter:t=!1}=e,{jupyterLabAdapter:f,serviceManager:_,setJupyterLabAdapter:w,setServiceManager:y}=(0,O.ZP)(),{user:v,logUser:x,token:k}=(0,i.useStore)(),{configuration:b}=(0,r.useDatalayerStore)(),[j,C]=(0,u.useState)(null),[S,M]=(0,u.useState)(""),[E,F]=(0,u.useState)("light");return(0,u.useEffect)((()=>{t||x()}),[]),(0,u.useEffect)((()=>{if(!t)if(!f&&k){const e=e=>{w(e)},t=(0,s.jsx)(a.JupyterLabApp,{extensionPromises:(!1,{extensionPromises:[n.e(2800).then(n.t.bind(n,12800,23)),n.e(6640).then(n.t.bind(n,6640,23)).then((e=>e.default.filter((({id:e})=>!e.endsWith(":sessionDialogs"))))),n.e(5635).then(n.t.bind(n,15635,23)),n.e(1587).then(n.t.bind(n,61587,23)),n.e(7625).then(n.t.bind(n,27625,23)),n.e(6427).then(n.t.bind(n,26427,23)),n.e(3599).then(n.t.bind(n,13599,23)).then((e=>e.default.filter((({id:e})=>!e.endsWith(":manager"))))),n.e(1019).then(n.t.bind(n,91019,23)),n.e(7806).then(n.t.bind(n,17806,23)).then((e=>e.default)),n.e(7737).then(n.t.bind(n,57737,23)),n.e(1254).then(n.t.bind(n,51254,23)),n.e(8802).then(n.t.bind(n,58802,23)),n.e(7176).then(n.t.bind(n,77176,23)).then((e=>e.default.filter((({id:e})=>!e.includes(":language-server"))))),n.e(9845).then(n.t.bind(n,59845,23)),n.e(9448).then(n.t.bind(n,79448,23)).then((e=>e.default.filter((({id:e})=>!(e.includes(":language-server")||e.endsWith(":update-raw-mimetype")))))),n.e(5547).then(n.t.bind(n,5547,23)),n.e(3619).then(n.t.bind(n,33619,23)),n.e(1841).then(n.t.bind(n,31841,23)),n.e(2040).then(n.t.bind(n,52040,23)),n.e(6521).then(n.t.bind(n,46521,23)),n.e(4721).then(n.t.bind(n,44721,23))]}).extensionPromises,extensions:[l,o,m],headless:!0,disabledExtensions:[],onJupyterLab:e});C(t)}else C(null)}),[t,_,k,f]),(0,u.useEffect)((()=>{t||f&&!_&&y(f.jupyterLab.serviceManager)}),[t,f]),(0,u.useEffect)((()=>{t||_&&(0,g.Ad)(_,b,k)}),[_,b,k]),(0,u.useEffect)((()=>{if(!t)return e({matches:window.matchMedia("(prefers-color-scheme: dark)").matches}),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e),()=>{window.matchMedia("(prefers-color-scheme: dark)").removeEventListener("change",e)};{const e=f?.service("@jupyterlab/apputils-extension:themes");if(e)return n(e),e.themeChanged.connect(n),()=>{e.themeChanged.disconnect(n)}}function e({matches:e}){F(e?"dark":"light")}function n(e){F(e.theme&&!e.isLight(e.theme)?"dark":"light")}}),[f]),(0,s.jsx)(c.ZP,{theme:d.Z,colorMode:E,children:(0,s.jsx)(h.Z,{children:v?(0,s.jsxs)(a.Jupyter,{startDefaultKernel:!1,disableCssLoading:!0,collaborative:!1===b?.whiteLabel,theme:d.Z,colorMode:E,lite:!1===b?.whiteLabel,children:[(0,s.jsxs)(p.Routes,{children:[(0,s.jsx)(p.Route,{path:"/",element:(0,s.jsx)(T,{children:(0,s.jsx)(me,{})})}),(0,s.jsx)(p.Route,{path:"/jupyter/kernels",element:(0,s.jsx)(T,{children:(0,s.jsx)(me,{})})}),!1===b?.whiteLabel&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(p.Route,{path:"/jupyter/kernels/debug",element:(0,s.jsx)(T,{children:(0,s.jsx)(Ee,{})})}),(0,s.jsx)(p.Route,{path:"/jupyter/kernels/kernels",element:(0,s.jsx)(T,{children:(0,s.jsx)(Re,{})})}),(0,s.jsx)(p.Route,{path:"/jupyter/kernels/pools",element:(0,s.jsx)(T,{children:(0,s.jsx)(Ne,{})})}),(0,s.jsx)(p.Route,{path:"/jupyter/kernels/environments",element:(0,s.jsx)(T,{children:(0,s.jsx)(De,{})})}),(0,s.jsx)(p.Route,{path:"/jupyter/kernels/content",element:(0,s.jsx)(T,{children:(0,s.jsx)(je,{})})}),(0,s.jsx)(p.Route,{path:"/jupyter/kernels/servers",element:(0,s.jsx)(T,{children:(0,s.jsx)(Ae,{})})}),(0,s.jsx)(p.Route,{path:"/jupyter/kernels/billing",element:(0,s.jsx)(T,{children:(0,s.jsx)(be,{})})})]}),(0,s.jsx)(p.Route,{path:"/jupyter/kernels/usage",element:(0,s.jsx)(T,{children:(0,s.jsx)(Ke,{})})}),(0,s.jsx)(p.Route,{path:"/jupyter/kernels/credits",element:(0,s.jsx)(T,{children:(0,s.jsx)(Ce,{})})}),(0,s.jsx)(p.Route,{path:"/jupyter/kernels/settings",element:(0,s.jsx)(T,{children:(0,s.jsx)(ze,{})})}),!1===b?.whiteLabel&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(p.Route,{path:"/jupyter/kernels/profile",element:(0,s.jsx)(T,{children:(0,s.jsx)(Ze,{})})}),(0,s.jsx)(p.Route,{path:"/jupyter/kernels/docs",element:(0,s.jsx)(T,{children:(0,s.jsx)(Fe,{})})})]}),(0,s.jsx)(p.Route,{path:"/jupyter/kernels/login",element:(0,s.jsx)(He,{whiteLabel:b?.whiteLabel})}),!1===b?.whiteLabel&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(p.Route,{path:"/jupyter/kernels/logout",element:(0,s.jsx)(T,{children:(0,s.jsx)(i.Logout,{homeRoute:"/jupyter/kernels"})})}),(0,s.jsx)(p.Route,{path:"/jupyter/kernels/about",element:(0,s.jsx)(T,{children:(0,s.jsx)(ye,{version:S})})})]})]}),j]}):(0,s.jsxs)(p.Routes,{children:[(0,s.jsx)(p.Route,{path:"/",element:(0,s.jsx)(He,{whiteLabel:b?.whiteLabel})}),(0,s.jsx)(p.Route,{path:"/jupyter/kernels",element:(0,s.jsx)(He,{whiteLabel:b?.whiteLabel})}),(0,s.jsx)(p.Route,{path:"/jupyter/kernels/login",element:(0,s.jsx)(He,{whiteLabel:b?.whiteLabel})}),!1===b?.whiteLabel&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(p.Route,{path:"/jupyter/kernels/join",element:(0,s.jsx)(T,{children:(0,s.jsx)(i.JoinForm,{joinConfirmRoute:"/jupyter/kernels/join/confirm"})})}),(0,s.jsx)(p.Route,{path:"/jupyter/kernels/join/confirm",element:(0,s.jsx)(T,{children:(0,s.jsx)(i.JoinConfirm,{loginRoute:"/jupyter/kernels/login",joinWelcomeRoute:"/jupyter/kernels/join/welcome"})})}),(0,s.jsx)(p.Route,{path:"/jupyter/kernels/join/welcome",element:(0,s.jsx)(T,{children:(0,s.jsx)(i.JoinWelcome,{loginRoute:"/jupyter/kernels/login"})})})]}),(0,s.jsx)(p.Route,{path:"/jupyter/kernels/password",element:(0,s.jsx)(T,{children:(0,s.jsx)(i.NewPasswordForm,{passwordConfirmRoute:"/jupyter/kernels/password/confirm"})})}),(0,s.jsx)(p.Route,{path:"/jupyter/kernels/password/confirm",element:(0,s.jsx)(T,{children:(0,s.jsx)(i.NewPasswordConfirm,{loginRoute:"/jupyter/kernels/login",passwordWelcomeRoute:"/jupyter/kernels/password/welcome"})})}),(0,s.jsx)(p.Route,{path:"/jupyter/kernels/password/welcome",element:(0,s.jsx)(T,{children:(0,s.jsx)(i.NewPasswordWelcome,{loginRoute:"/jupyter/kernels/login"})})})]})})})},We=Ve;function He({whiteLabel:e=!1}){return(0,s.jsx)(T,{children:(0,s.jsx)(i.LoginForm,{heading:e?"Log in":"Log in to Datalayer",homeRoute:"/jupyter/kernels",passwordRoute:"/jupyter/kernels/password",joinRoute:e?void 0:"/jupyter/kernels/join",joinConfirmRoute:e?void 0:"/jupyter/kernels/join/confirm"})})}},62248:(e,t,n)=>{n.d(t,{p:()=>g});var s=n(74512),r=n(57531),i=n(19893),a=n(32126),o=n(36858),l=n(11790),c=n(18310),d=n(46722),h=n(86642),u=n(66029),p=n(83513),m=n(65693);function g(e){const{manager:t,onSubmit:n,openDocument:g,startKernel:f}=e,_=t.environments.get(),{user:w}=(0,r.useStore)(),{jupyterLabAdapter:y}=(0,p.ZP)(),[v,x]=(0,u.useState)(_[0].name??""),[k,b]=(0,u.useState)(!1),[j,C]=(0,u.useState)(!1),[S,M]=(0,u.useState)(""),E=(0,u.useCallback)((e=>{x(e.target.value)}),[x]),F=(0,u.useCallback)((async()=>{if(v){M(""),C(!0);const e=_.find((e=>e.name===v)),s={name:v,language:e?.language??"",location:"remote",displayName:e?.displayName};if(f??1)try{const e=await t.servers.startNew({name:v},{username:w?.handle,handleComms:!0});if(y?.jupyterLab){const t={kernelId:e.id,kernelName:e.name};if(g)"notebook"===g&&(0,m.l)({app:y.jupyterLab,options:t});else if(k){const e=_.find((e=>e.name===v))?.example;e&&(0,m.l)({app:y.jupyterLab,name:v,url:e,options:t})}}}catch(e){const t="Failed to create the remote kernel";console.error(t,e),M(t)}finally{C(!1)}n(s)}}),[t,v,n,k,y]),D=(0,u.useCallback)((e=>{e.preventDefault(),b(!k)}),[k]);return(0,s.jsx)(h.V,{title:"Kernel",onClose:()=>{n(null)},footerButtons:[{buttonType:"default",onClick:()=>{n(null)},content:"Cancel",disabled:j},{buttonType:"primary",onClick:F,content:j?(0,s.jsx)(i.Z,{size:"small"}):f??1?"Launch a Kernel":"Assign from the Environment",disabled:j,autoFocus:!0}],children:(0,s.jsxs)(a.Z,{as:"form",children:[(0,s.jsxs)(o.Z,{children:[(0,s.jsx)(o.Z.Label,{children:"Environment"}),(0,s.jsx)(l.Z,{disabled:0===_.length,value:v,onChange:E,children:_.map((e=>(0,s.jsxs)(l.Z.Option,{value:e.name,children:[e.name,e.description&&(0,s.jsxs)(s.Fragment,{children:[" - ",(0,s.jsx)("span",{children:e.description})]})]},e.name)))})]}),!g&&y?.jupyterLab&&(0,s.jsxs)(o.Z,{sx:{paddingTop:"10px"},children:[(0,s.jsx)(o.Z.Label,{children:"Open example notebook"}),(0,s.jsx)(c.Z,{disabled:!_.find((e=>e.name===v))?.example,checked:k,onClick:D})]}),S&&(0,s.jsx)(d.Z,{variant:"danger",children:S})]})})}},56542:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Lt});var s={};n.r(s),n.d(s,{changeCurrentWorkingDirectory:()=>K,listVariables:()=>Z,loadVariables:()=>z,saveVariables:()=>A});var r=n(74512),i=n(4539),a=n(1339);const o=new a.zZ({name:"@datalayer/icons:cloud",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 896 896" fill="currentColor" aria-hidden="true">\n  <path d="M747.4 354.7C701.6 233.9 584.9 148 448.2 148S194.8 233.8 149 354.6C63.3 377.1 0 455.1 0 548c0 110.5 89.5 200 199.9 200h496.2C806.5 748 896 658.5 896 548c0-92.7-63.1-170.7-148.6-193.3zm36.3 281a123.07 123.07 0 01-87.6 36.3H199.9c-33.1 0-64.2-12.9-87.6-36.3A123.3 123.3 0 0176 548c0-28 9.1-54.3 26.2-76.3a125.7 125.7 0 0166.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10c54.3 14.5 92.1 63.8 92.1 120 0 33.1-12.9 64.3-36.3 87.7z"/>\n</svg>\n'}),l=new a.zZ({name:"@datalayer/icons:cloud-upload",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 1024 1024" fill="currentColor" aria-hidden="true">\n  <path d="M518.3 459a8 8 0 00-12.6 0l-112 141.7a7.98 7.98 0 006.3 12.9h73.9V856c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V613.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 459z"/>\n  <path d="M811.4 366.7C765.6 245.9 648.9 160 512.2 160S258.8 245.8 213 366.6C127.3 389.1 64 467.2 64 560c0 110.5 89.5 200 199.9 200H304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8h-40.1c-33.7 0-65.4-13.4-89-37.7-23.5-24.2-36-56.8-34.9-90.6.9-26.4 9.9-51.2 26.2-72.1 16.7-21.3 40.1-36.8 66.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10C846.1 454.5 884 503.8 884 560c0 33.1-12.9 64.3-36.3 87.7a123.07 123.07 0 01-87.6 36.3H720c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h40.1C870.5 760 960 670.5 960 560c0-92.7-63.1-170.7-148.6-193.3z"/>\n</svg>\n'}),c=new a.zZ({name:"@datalayer/icons:circle-white",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72 72" fill="currentColor" aria-hidden="true">\n  <circle cx="36" cy="36" r="28" fill="#fff"/>\n  <circle cx="36" cy="36" r="28" fill="none" stroke="#000" stroke-linejoin="round" stroke-width="2"/>\n</svg>\n'});var d=n(57531),h=n(67048),u=n(56653),p=n(96129),m=n(1865),g=n(91295),f=n(8826),_=n(67370),w=n(62086),y=n(40158),v=n(34882),x=n(29482),k=n(62248),b=n(83513),j=n(66029);const C={small:16,medium:32,large:64},S=j.forwardRef((function({title:e,titleId:t,size:n,...s},r){return j.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 72 72",fill:"currentColor","aria-hidden":"true",ref:r,width:n?"string"==typeof n?C[n]:n:"16px","aria-labelledby":t},s),e?j.createElement("title",{id:t},e):null,j.createElement("path",{fill:"none",stroke:"#000",strokeLinejoin:"round",strokeMiterlimit:10,strokeWidth:2,d:"M19.582 55.606c.484.178 1.03.297 1.575.297.849 0 1.697-.297 2.425-.772l30-15.98.303-.296c.788-.772 1.212-1.723 1.212-2.792 0-1.07-.425-2.08-1.212-2.792l-.303-.297-30-16.098c-1.091-.832-2.667-1.01-4-.475-1.516.594-2.485 2.079-2.485 3.683v31.84c0 1.603.97 3.088 2.485 3.682z"}))}));var M=n(74901),E=n(19118);function F(e){const{commands:t}=e;return(0,r.jsx)(E.h,{icon:S,"aria-label":"Run the cell",variant:"invisible",size:"small",title:"Run the cell and select the next one.",onClick:e=>{e.preventDefault(),t.execute("notebook:run-cell-and-select-next",{toolbar:!0})}})}class D{commands;constructor(e,t){this.commands=t,this._panel=e,this._panel.content.model?.cells.changed.connect(this.updateConnectedCell,this),this._panel.content.modelChanged.connect((()=>{this._panel.content.model?.cells.changed.connect(this.updateConnectedCell,this)}))}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,M.Signal.clearData(this))}updateConnectedCell(e,t){t.oldValues.forEach((e=>{this._removeAction(e)})),Promise.all(t.newValues.map((e=>this._addAction(e))))}async _addAction(e){const t=this._panel.content.widgets.find((t=>t.model===e));if(t){await t.ready;const n=y.ReactWidget.create((0,r.jsx)(F,{commands:this.commands,model:t.model}));n.addClass("dla-cell-action"),this._cellActions.has(e)&&this._cellActions.get(e)?.dispose(),this._cellActions.set(e,t),this._panel.disposed.connect((()=>{this._cellActions.delete(e),n.dispose()})),t.layout.addWidget(n)}}_removeAction(e){this._cellActions.get(e)?.dispose()}_isDisposed=!1;_cellActions=new WeakMap;_panel}class R{commands;constructor(e){this.commands=e}createNew(e,t){const n=new D(e,this.commands);return this._extensions.set(e,n),e.disposed.connect((()=>{this._extensions.delete(e)})),n}_extensions=new WeakMap}const N={id:"@datalayer/jupyter-kernels:cell-action",description:"Cell action item",optional:[w.ITranslator],autoStart:!0,activate:(e,t)=>{e.docRegistry.addWidgetExtension("Notebook",new R(e.commands))}};var I=n(32850),P=n(59689),T=n(63879),O=n(96697),L=n(97930);function Z(){return"\ndef _list_variables():\n    import json\n    from types import BuiltinFunctionType, BuiltinMethodType, FunctionType, MethodType, MethodWrapperType, ModuleType, TracebackType\n\n    _FORBIDDEN_TYPES = [type, BuiltinFunctionType, BuiltinMethodType, FunctionType, MethodType, MethodWrapperType, ModuleType, TracebackType]\n    try:\n        from IPython.core.autocall import ExitAutocall\n        _FORBIDDEN_TYPES.append(ExitAutocall)\n    except ImportError:\n        pass\n    _exclude = tuple(_FORBIDDEN_TYPES)\n\n    _all = frozenset(globals())\n    _vars = {}\n    for _n in _all:\n        _v = globals()[_n]\n        \n        if not (\n            _n.startswith('_') or\n            isinstance(_v, _exclude) or\n            # Special IPython variables\n            (_n == 'In' and isinstance(_v, list)) or\n            (_n == 'Out' and isinstance(_v, dict))\n        ):\n            _vars[_n] = type(_v).__qualname__\n\n    return json.dumps(_vars)\n\n_list_variables()"}function A(e){return`\ndef _pickle_variables():\n    from base64 import encodebytes\n    import json\n    import pickle\n    _names = {${e.map((e=>`"${e}"`)).join(",")}}\n    _data = {}\n    for _n in _names:\n        try:\n            _v = globals()[_n]\n            dump = pickle.dumps(_v)\n            _data[_n] = encodebytes(dump).decode("ascii")\n        except:\n            ...\n\n    return json.dumps(_data)\n\n_pickle_variables()\n`}function z(e){return`\ndef _load_variables():\n    from base64 import decodebytes\n    import json\n    import pickle\n    _data = json.loads(${e})\n    _loaded = []\n    for _n, _v in _data.items():\n        try:\n            dump = decodebytes(_v.encode("ascii"))\n            globals()[_n] = pickle.loads(dump)\n            _loaded.append(_n)\n        except:\n            ...\n    return json.dumps(_loaded)\n\n_load_variables()\n`}function K(e){return`\ndef _change_current_directory():\n    import os\n    from pathlib import Path\n    _local_content_mount_point = Path(Path.home() / ${e.split("/").map((e=>`"${e}"`)).join(" / ")})\n    _local_content_mount_point.mkdir(parents=True, exist_ok=True)\n    os.chdir(_local_content_mount_point)\n\n    assert Path.cwd() == _local_content_mount_point\n\n_change_current_directory()\n`}class V{static $language=new Map;static register(e,t){this.$language.set(e,t)}static supports(e){return this.$language.has(e)}_language;constructor(e){if(!V.$language.has(e))throw new Error(`${e} is not supported.`);this._language=e}get language(){return this._language}changeCurrentWorkingDirectory(e){return V.$language.get(this.language).changeCurrentWorkingDirectory(e)}listVariables(){return V.$language.get(this.language).listVariables()}loadVariables(e){return V.$language.get(this.language).loadVariables(e)}saveVariables(e){return V.$language.get(this.language).saveVariables(e)}}V.register("python",s);const W=new WeakMap;class H{static serviceManager=null;static getForeignCell(e){return W.get(e)}static run(e,t,n,s){if(!e.model||!e.activeCell)return Promise.resolve(!1);const r=B.getState(e),i=B.runSelected(e,t,n,s);return B.handleRunState(e,r,!1),i}static runCells(e,t,n,s,r){if(!e.model)return Promise.resolve(!1);const i=B.getState(e),a=B.runCells(e,t,n,s,r);return B.handleRunState(e,i,!1),a}static runAll(e,t,n,s){if(!e.model||!e.activeCell)return Promise.resolve(!1);const r=B.getState(e),i=e.widgets.length,a=B.runCells(e,e.widgets,t,n,s);return e.activeCellIndex=i,e.deselectAll(),B.handleRunState(e,r,!0),a}static runAllAbove(e,t,n,s){const{activeCell:r,activeCellIndex:i,model:a}=e;if(!a||!r||i<1)return Promise.resolve(!1);const o=B.getState(e),l=B.runCells(e,e.widgets.slice(0,e.activeCellIndex),t,n,s);return e.deselectAll(),B.handleRunState(e,o,!0),l}static runAllBelow(e,t,n,s){if(!e.model||!e.activeCell)return Promise.resolve(!1);const r=B.getState(e),i=e.widgets.length,a=B.runCells(e,e.widgets.slice(e.activeCellIndex),t,n,s);return e.activeCellIndex=i,e.deselectAll(),B.handleRunState(e,r,!0),a}static async runAndAdvance(e,t,n,s){if(!e.model||!e.activeCell)return Promise.resolve(!1);const r=B.getState(e),i=B.runSelected(e,t,n,s),a=e.model;return e.activeCellIndex===e.widgets.length-1?(a.sharedModel.insertCell(e.widgets.length,{cell_type:e.notebookConfig.defaultCell,metadata:"code"===e.notebookConfig.defaultCell?{trusted:!0}:{}}),e.activeCellIndex++,!1===e.activeCell?.inViewport&&await(0,m.signalToPromise)(e.activeCell.inViewportChanged,200).catch((()=>{})),e.mode="edit"):e.activeCellIndex++,B.handleRunState(e,r,!0),i}static async runAndInsert(e,t,n,s){if(!e.model||!e.activeCell)return Promise.resolve(!1);const r=B.getState(e),i=B.runSelected(e,t,n,s);return e.model.sharedModel.insertCell(e.activeCellIndex+1,{cell_type:e.notebookConfig.defaultCell,metadata:"code"===e.notebookConfig.defaultCell?{trusted:!0}:{}}),e.activeCellIndex++,!1===e.activeCell?.inViewport&&await(0,m.signalToPromise)(e.activeCell.inViewportChanged,200).catch((()=>{})),e.mode="edit",B.handleRunState(e,r,!0),i}}var $,B;!function(e){e[e.QUEUED=0]="QUEUED",e[e.STARTING_KERNEL=1]="STARTING_KERNEL",e[e.IMPORTING=2]="IMPORTING",e[e.EXECUTING=3]="EXECUTING",e[e.EXPORTING=4]="EXPORTING",e[e.UNKNOWN=5]="UNKNOWN",e[e.DONE=6]="DONE",e[e.ERROR=7]="ERROR"}($||($={}));class U{cell;sessionContext;metadata;constructor({cell:e,sessionContext:t,metadata:n}){this.cell=e,this.sessionContext=t,this.metadata=n}get connection(){return this.sessionContext?.session?.kernel??void 0}processCell(){return Promise.resolve(!1)}}class J extends U{_connection;_isDisposed=!1;_kernelSpec;_processed=null;_state=$.QUEUED;_stateChanged=new M.Signal(this);_variablesIn;_variableOut;constructor(e){super(e);const t=this.cell.model.getMetadata("datalayer")??{};this._kernelSpec=t.kernel,this._variablesIn=Array.isArray(t.in)?t.in:[],this._variableOut="string"==typeof t.out?t.out:""}get connection(){return this._connection}get isDisposed(){return this._isDisposed}get state(){return this._state}setState(e){this._state!==e&&(this._state=e,this._stateChanged.emit(this._state))}get stateChanged(){return this._stateChanged}dispose(){this._isDisposed||(this._isDisposed=!0,this._connection?.dispose(),M.Signal.clearData(this))}async processCell(){let e;await this.setupKernel();try{this._processed=new L.PromiseDelegate,this._processCell().then((e=>{this._processed?.resolve(e)})).catch((e=>{this._processed?.reject(e)})),e=await this._processed.promise}finally{await this.teardownKernel()}return e}async _processCell(){if(!this._connection)throw this.setState($.ERROR),new Error(`Failed to process a foreign cell '${this.cell.model.id}'.`);if(this._variablesIn.length){if(!this.sessionContext)throw this.setState($.ERROR),new Error("Unable to import variables; no document kernel available.");this.setState($.IMPORTING);const e=this.sessionContext.specsManager.specs.kernelspecs[this.sessionContext.session.kernel.model.name];if(!await q(e.language,this.sessionContext.session.kernel,this._variablesIn,this._connection))throw this.setState($.ERROR),new Error(`Failed to transfer ${this._variablesIn.join(", ")} from ${this._connection.location} - ${this._connection.name} (${this._connection.id})`)}this.setState($.EXECUTING);const e=await T.CodeCell.execute(this.cell,{session:{kernel:this._connection}},this.metadata);if(console.debug(`@datalayer/jupyter-kernels: Capture cell ${this.cell.model.id} execution`,e),this.metadata.deletedCells&&(this.metadata.deletedCells.length=0),!e)return!1;if("ok"===e.content.status){if(this._variableOut){if(!this.sessionContext)throw this.setState($.ERROR),new Error("Unable to export variables; no document kernel available.");this.setState($.EXPORTING);const e=this.sessionContext.specsManager.specs.kernelspecs[this.sessionContext.session.kernel.model.name];if(!await q(e.language,this._connection,[this._variableOut],this.sessionContext.session.kernel))throw this.setState($.ERROR),new Error(`Failed to transfer ${this._variableOut} from ${this._connection.location} - ${this._connection.name} (${this._connection.id})`)}return this.setState($.DONE),!0}throw this.setState($.ERROR),new I.KernelError(e.content)}async setupKernel(){if(!H.serviceManager)throw this.setState($.ERROR),new Error("No service manager available");this.setState($.STARTING_KERNEL),this._connection&&(this._connection.id===this._kernelSpec.id&&this._connection.name===this._kernelSpec.name&&(this._connection.location??"local")===kernelDescription.location||this._connection.dispose(),this._connection.isDisposed&&(this._connection?.connectionStatusChanged.disconnect(this.onConnectionChanged,this),this._connection?.statusChanged.disconnect(this.onKernelStatusChanged,this),this._connection=void 0));const e=!1!==this._kernelSpec.params?.persistent;switch(this._connection?.status){case"idle":case"busy":case"autorestarting":case"restarting":case"starting":break;default:{this._connection?.dispose(),this._connection?.connectionStatusChanged.disconnect(this.onConnectionChanged,this),this._connection?.statusChanged.disconnect(this.onKernelStatusChanged,this),this._connection=void 0;const t=["browser","local"].includes(this._kernelSpec.location)?H.serviceManager[this._kernelSpec.location]?.kernels:H.serviceManager.remote?.servers;e&&this._kernelSpec.id&&(this._connection=t?.connectTo({model:{id:this._kernelSpec.id,name:this._kernelSpec.name},handleComms:!0})),this._connection||(this._connection=await(t?.startNew({name:this._kernelSpec.name}))),this._connection&&(this._connection?.connectionStatusChanged.connect(this.onConnectionChanged,this),this._connection?.statusChanged.connect(this.onKernelStatusChanged,this),this._connection.location=this._kernelSpec.location,e&&(this._kernelSpec.id=this._connection.id,this.cell.model.setMetadata("datalayer",Object.assign(this.cell.model.getMetadata("datalayer")??{},{kernel:this._kernelSpec}))))}}if(!this._connection)throw this.setState($.ERROR),new Error(`Unable to start a kernel for cell ${this.cell.model.id} with ${JSON.stringify(this._kernelSpec)}`)}async teardownKernel(){!1===this._kernelSpec.params?.persistent&&(this._connection&&!this._connection.isDisposed&&(this._connection.shutdown(),this._connection.dispose()),this._connection?.connectionStatusChanged.disconnect(this.onConnectionChanged,this),this._connection?.statusChanged.disconnect(this.onKernelStatusChanged,this),this._connection=void 0)}onConnectionChanged(){"disconnected"===this._connection?.connectionStatus&&this._processed?.reject("Kernel has been disconnected")}onKernelStatusChanged(){["dead","terminating"].includes(this._connection?.status??"")&&this._processed?.reject(`Kernel status '${this._connection?.status}' is not appropriate`)}}async function q(e,t,n,s){const r=new V(e),i=await new h.KernelExecutor({connection:t}).execute(r.saveVariables(n)),a=i.get(0)?.data["text/plain"]??"";if(!a)return!1;{const e=await new h.KernelExecutor({connection:s}).execute(r.loadVariables(a)),t=e.get(0)?.data["text/plain"]||"[]",i=JSON.parse(t.slice(1,t.length-1));if(!n.every((e=>i.includes(e))))return!1;console.debug(`@datalayer/jupyter-kernels: Successfully transfer ${n.join(", ")}`)}return!0}!function(e){const t=I.NotebookActions.executed,n=I.NotebookActions.executionScheduled,s=I.NotebookActions.selectionExecuted;async function r(e,r,o,l,c){const d=r[-1];e.mode="command";try{const h=await Promise.all(r.map((s=>async function(e,s,r,o,l){const c=await async function({notebook:e,cell:s,sessionContext:r}){if("code"!==s.model.type)return!1;const o={deletedCells:e.model?.deletedCells??[],recordTiming:e.notebookConfig.recordTiming},l=!!(s.model.getMetadata("datalayer")??{}).kernel,c=new(l?J:U)({cell:s,sessionContext:r,metadata:o});if(l){W.set(s.model,c);const e=()=>{W.delete(s.model),c.dispose()};s.disposed.connect(e),r?.disposed.connect(e)}return async function(e,s){const r=new L.PromiseDelegate;i.has(e)||i.set(e,[]);const o=i.get(e),l=0===o.length;return n.emit({notebook:e,cell:s.cell}),s.cell.model.sharedModel.transact((()=>{s.cell.model.clearExecution()}),!1),s.cell.setPrompt("*"),o.push({cell:s,done:r}),l&&a(o).catch((e=>{console.error("Fail to start processing the cell queue",e)})),r.promise.then((()=>{t.emit({notebook:e,cell:s.cell,success:!0})})).catch((()=>{t.emit({notebook:e,cell:s.cell,success:!1})})),r.promise}(e,c)}({notebook:e,cell:s,sessionContext:r});if(c)return!0;const d=(l=l||w.nullTranslator).load("jupyterlab");switch(s.model.type){case"markdown":s.rendered=!0,s.inputHidden=!1,t.emit({notebook:e,cell:s,success:!0});break;case"code":if(r){if(r.isTerminating){await(0,p.showDialog)({title:d.__("Kernel Terminating"),body:d.__("The kernel for %1 appears to be terminating. You can not run any cell for now.",r.session?.path),buttons:[p.Dialog.okButton()]});break}if(r.pendingInput)return await(0,p.showDialog)({title:d.__("Cell not executed due to pending input"),body:d.__("The cell has not been executed to avoid kernel deadlock as there is another pending input! Submit your pending input and try again."),buttons:[p.Dialog.okButton()]}),!1;if(r.hasNoKernel&&await r.startKernel()&&o&&await o.selectKernel(r),r.hasNoKernel)return s.model.sharedModel.transact((()=>{s.model.clearExecution()})),!0;const i=e.model?.deletedCells??[];n.emit({notebook:e,cell:s});let a=!1;try{const t={deletedCells:i,recordTiming:e.notebookConfig.recordTiming};console.debug(`@datalayer/jupyter-kernels: Process normally cell ${s.model.id}`);const n=await T.CodeCell.execute(s,r,t)??void 0;i.splice(0,i.length),a=(()=>{if(s.isDisposed)return!1;if(!n)return!0;if("ok"===n.content.status){const t=n.content;return t.payload&&t.payload.length&&function(e,t,n){const s=e.payload?.filter((e=>"set_next_input"===e.source))[0];if(!s)return;const r=s.text;if(s.replace)return void n.model.sharedModel.setSource(r);const i=t.model.sharedModel,a=t.model.cells,o=(0,O.findIndex)(a,(e=>e===n.model));-1===o?i.insertCell(i.cells.length,{cell_type:"code",source:r,metadata:{trusted:!1}}):i.insertCell(o+1,{cell_type:"code",source:r,metadata:{trusted:!1}})}(t,e,s),!0}throw new I.KernelError(n.content)})()}catch(n){if(!s.isDisposed&&!n.message.startsWith("Canceled"))throw t.emit({notebook:e,cell:s,success:!1,error:n}),n;a=!1}return a&&t.emit({notebook:e,cell:s,success:!0}),a}s.model.sharedModel.transact((()=>{s.model.clearExecution()}),!1)}return Promise.resolve(!0)}(e,s,o,l,c))));return!e.isDisposed&&(s.emit({notebook:e,lastCell:d}),e.update(),h.every((e=>e)))}catch(t){if(!t.message||!t.message.startsWith("KernelReplyNotOK"))throw t;return r.map((e=>{"code"===e.model.type&&null===e.model.executionCount&&e.setPrompt("")})),s.emit({notebook:e,lastCell:d}),e.update(),!1}}e.getState=function(e){return{wasFocused:e.node.contains(document.activeElement),activeCellId:e.activeCell?.model.id??null}},e.handleRunState=async function(e,t,n=!1){const{activeCell:s,activeCellIndex:r}=e;n&&s&&await e.scrollToItem(r,"smart",0).catch((e=>{})),(t.wasFocused||"edit"===e.mode)&&e.activate()},e.runCells=r,e.runSelected=function(e,t,n,s){e.mode="command";let i=e.activeCellIndex;const a=e.widgets.filter(((t,n)=>{const s=e.isSelectedOrActive(t);return s&&(i=n),s}));return e.activeCellIndex=i,e.deselectAll(),r(e,a,t,n,s)};const i=new WeakMap;async function a(e){const t=e[0];if(!t)return Promise.resolve();const{done:n,cell:s}=t;try{const t=await s.processCell();n.resolve(t),e.shift(),a(e).catch((e=>{console.error("Error processing cell queue")}))}catch(t){for(n.reject(t);e.length;)e.shift()?.done.reject("Canceled")}}}(B||(B={}));var X=n(68148),G=n(32126),Y=n(36858),Q=n(34500),ee=n(70818),te=n(86642),ne=n(61295),se=n(94156),re=n(62005);function ie(e){const{actions:t,disabled:n,filterKernel:s,preference:i,serviceManager:a,selection:o,setSelection:l,translator:c,variant:d}=e,[h,u]=(0,j.useState)(ae(a,i?.id,c,s)),p=(0,j.useMemo)((()=>(c??w.nullTranslator).load("jupyterlab")),[c]),m={maxHeight:"large",width:"cell"===d?"small":"auto"};return(0,j.useEffect)((()=>{const e=()=>{u(ae(a,i?.id,c,s))};return a.browser?.kernels.runningChanged.connect(e),a.browser?.kernelspecs.specsChanged.connect(e),a.browser?.sessions.runningChanged.connect(e),a.local.kernels.runningChanged.connect(e),a.local.kernelspecs.specsChanged.connect(e),a.local.sessions.runningChanged.connect(e),a.remote?.servers.changed.connect(e),a.remote?.environments.changed.connect(e),()=>{a.browser?.kernels.runningChanged.disconnect(e),a.browser?.kernelspecs.specsChanged.disconnect(e),a.browser?.sessions.runningChanged.disconnect(e),a.local.kernels.runningChanged.disconnect(e),a.local.kernelspecs.specsChanged.disconnect(e),a.local.sessions.runningChanged.disconnect(e),a.remote?.servers.changed.disconnect(e),a.remote?.environments.changed.disconnect(e)}}),[a,i,c,s]),(0,r.jsxs)(se.P,{children:["cell"===d?(0,r.jsx)(se.P.Anchor,{children:(0,r.jsx)(E.h,{disabled:n||null===h,icon:()=>(0,r.jsx)(ne.Z,{}),"aria-label":p.__("Assign a Kernel"),size:"small",variant:"invisible"})}):(0,r.jsxs)(se.P.Button,{variant:"default",disabled:n||null===h,children:[(0,r.jsx)(re.Z,{fontWeight:"bold",children:p.__("Kernel:")})," "+(o?.displayName??p.__("No Kernel"))]}),(0,r.jsx)(se.P.Overlay,{...m,width:"medium",sx:{overflowY:"auto"},side:"cell"===d?"outside-left":"outside-right",children:(0,r.jsxs)(X.S,{selectionVariant:"single",children:[Object.entries(h??{}).map((([e,t])=>(0,r.jsx)(X.S.Group,{title:e,children:t.map((e=>(0,r.jsx)(X.S.Item,{selected:e.location===o?.location&&(e.id??e.name)===(o?.id??o?.name),onSelect:()=>{l(e)},children:e.id?`${e.displayName} - ${e.id.slice(0,7)}`:e.displayName},e.name)))},e))),(0,r.jsx)(X.S.Divider,{}),(0,r.jsxs)(X.S.Group,{title:"Assign other Kernel",children:["cell"===d&&(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(X.S.Item,{selected:null===o,onSelect:()=>{l(null)},children:p.__("Assign the Notebook Kernel")},"null")}),t&&(0,r.jsx)(r.Fragment,{children:t})]},"assign-other-kernel")]})})]})}function ae(e,t,n,s=(()=>!0)){const r=e.local.kernelspecs.specs,i=e.local.sessions.running();if(!r)return null;const a=(n=n??w.nullTranslator).load("jupyterlab"),o={},l=Array.from(i).filter((e=>e.kernel&&e.kernel.id!==t&&r.kernelspecs[e.kernel.name])).map((e=>{const t=r.kernelspecs[e.kernel.name];return{id:e.kernel.id,name:t.name,language:t.language,displayName:e.name||m.PathExt.basename(e.path),location:"local"}})).concat(Array.from(e.browser?.sessions.running()??[]).filter((e=>e.kernel&&e.kernel.id!==t)).map((t=>{const n=e.browser.kernelspecs.specs.kernelspecs[t.kernel.name];return{id:t.kernel.id,name:n.name,language:n.language,displayName:t.name||m.PathExt.basename(t.path),location:"browser"}}))).filter(s).map((e=>e.id)),c=Array.from(e.kernels.running()).filter((e=>!l.includes(e.id))).map((e=>{const t=r.kernelspecs[e.name];return{id:e.id,name:t.name,language:t.language,displayName:t.display_name,location:"local"}})).concat((e.remote?.servers.get()??[]).filter((e=>!l.includes(e.id))).map((t=>{const n=e.remote.environments.get().find((e=>e.name===t.environment_name));return{id:t.id,name:n.name,language:n.language,displayName:n.displayName,location:"remote"}}))).concat(Array.from(e.browser?.kernels.running()??[]).filter((e=>!l.includes(e.id))).map((t=>{const n=e.browser.kernelspecs.specs.kernelspecs[t.name];return{id:t.id,name:n.name,language:n.language,displayName:n.display_name,location:"browser"}}))).filter(s);c.length&&(o["Assign a Running Kernel"]=c);const d=e.remote?.environments.get().map((e=>({name:e.name,language:e.language,displayName:e.displayName,location:"remote"}))).filter(s)??[];d.length&&(o[a.__("Assign a new Kernel from a Remote Environment")]=d);const h=Object.values(r.kernelspecs).filter((e=>!!e)).map((e=>({name:e.name,language:e.language,displayName:e.display_name,location:"local"}))).filter(s);h.length&&(o[a.__("Assign a new Kernel from a Local Environment")]=h);const u=Object.values(e.browser?.kernelspecs.specs?.kernelspecs??{}).filter((e=>!!e)).map((e=>({name:e.name,language:e.language,displayName:e.display_name,location:"browser"}))).filter(s);return u.length&&(o[a.__("Browser")]=u),o}function oe(e){const{model:t,preference:n,serviceManager:s,sessionContext:i,translator:a}=e,[o,l]=(0,j.useState)([]),[c,d]=(0,j.useState)(),[u,p]=(0,j.useState)(!1),[m,g]=(0,j.useState)(!1),f=(0,j.useMemo)((()=>(a??w.nullTranslator).load("jupyterlab")),[a]);(0,j.useEffect)((()=>{const e=e=>{const t=e.getMetadata("datalayer")??{};t.in&&!L.JSONExt.deepEqual(o,t.in)&&l(t.in),t.out&&t.out!==c&&d(t.out)};return e(t),t.metadataChanged.connect(e),()=>{t.metadataChanged.disconnect(e)}}),[t]);const _=(0,j.useCallback)((e=>!(!e.id||"remote"!==e.location||n?.language&&e.language!==n?.language)),[n]),y=(0,j.useCallback)((e=>{const n=t.getMetadata("datalayer")??{kernel:null};null===e?(delete n.kernel,t.setMetadata("datalayer",n)):t.setMetadata("datalayer",Object.assign(n,{kernel:e}))}),[t]),v=(0,j.useCallback)((()=>g(!1)),[]),x=(0,j.useCallback)((()=>g(!0)),[]),b=(0,j.useCallback)((()=>{const e=t.getMetadata("datalayer")??{};o.length?e.in=o:delete e.in,c?e.out=c:delete e.out,t.setMetadata("datalayer",{...e}),v()}),[o,c]),C=(0,j.useCallback)((()=>{p(!0)}),[]),S=(0,j.useCallback)((e=>{e&&(e.params={...e.params,persistent:!1},y(e)),p(!1)}),[y]),M=(0,j.useCallback)((async()=>{if(!i)return[];const e=i.session.kernel,t=i.specsManager.specs.kernelspecs[e.model.name],n=new V(t.language),s=(await new h.KernelExecutor({connection:e}).execute(n.listVariables())).get(0).data["text/plain"];if(s){const e=JSON.parse(s.slice(1,s.length-1));return Object.keys(e??{})}return[]}),[n,i]),E=(0,j.useCallback)((async()=>Array.from(t.sharedModel.source.matchAll(/^((?<output>[A-z][\w]*)\s*=[^=]|\((?<walrus>[A-z][\w]*)\s*:=[^=)]+\))/gm)).map((e=>e.groups?.output??e.groups?.walrus??"")).filter((e=>!!e))),[t]),F=t.getMetadata("datalayer")??{};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ie,{filterKernel:_,preference:n,serviceManager:s,selection:F.kernel?F.kernel:null,setSelection:y,variant:"cell",actions:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(X.S.Item,{disabled:!s.remote,onSelect:C,title:s.remote?"Assign a Temporary Kernel for this Notebook Cell.":"You are not connected with Datalayer.",children:f.__("Assign a Temporary Kernel on each cell run")}),V.supports(n?.language??"")&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(X.S.Divider,{}),(0,r.jsx)(X.S.Item,{onSelect:x,children:f.__("Define Cell Variables transfer")})]})]}),translator:a}),m&&(0,r.jsx)(te.V,{title:f.__("Define Cell Variables to transfer"),onClose:()=>g(!1),footerButtons:[{buttonType:"default",content:f.__("Cancel"),onClick:v},{buttonType:"primary",content:f.__("Set variables"),onClick:b,autoFocus:!0}],children:(0,r.jsx)(le,{inputs:o,getInputOptions:i?M:void 0,setInputs:l,output:c??void 0,getOutputOptions:E,setOutput:d,translator:a})}),u&&(0,r.jsx)(k.p,{manager:s.remote,onSubmit:S,openDocument:"cell",startKernel:!1})]})}function le(e){const{getInputOptions:t,inputs:n,setInputs:s,getOutputOptions:i,output:a,setOutput:o,translator:l}=e,c=(0,j.useMemo)((()=>(l??w.nullTranslator).load("jupyterlab")),[l]),[d,h]=(0,j.useState)(!!t),[u,p]=(0,j.useState)(null),[m,g]=(0,j.useState)(n.map((e=>({id:e,text:e,selected:!0})))),[f,_]=(0,j.useState)("");(0,j.useEffect)((()=>{const e=n.filter((e=>!m.find((t=>t.text===e))));e.length&&g([...m,...e.map((e=>({id:e,text:e,selected:!0})))])}),[n]),(0,j.useEffect)((()=>{const e=m.filter((e=>e.selected)).map((e=>e.text));L.JSONExt.deepEqual(n,e)||s(e)}),[m]),(0,j.useEffect)((()=>{t?t().then((e=>{const t=m.map((e=>e.text));g([...m,...e.sort().filter((e=>!t.includes(e))).map((e=>({id:e,text:e,selected:!1})))]),h(!1)})):h(!1)}),[t]),(0,j.useEffect)((()=>{i&&Promise.all([i(),t?.()]).then((([e,t])=>{p(e.sort().concat((t??[]).sort()).reduce(((e,t)=>(e.includes(t)||e.push(t),e)),[]).map((e=>({id:e,text:e,selected:!1}))))})).catch((e=>{console.error("Failed to get the cell output candidates",e),p([])}))}),[i,t]);const y=(0,j.useCallback)((e=>{e.currentTarget&&_(e.currentTarget.value)}),[]),v=(0,j.useCallback)((e=>{e.currentTarget&&o(e.currentTarget.value)}),[]);return(0,r.jsxs)(G.Z,{as:"form",sx:{p:3},children:[(0,r.jsxs)(Y.Z,{children:[(0,r.jsx)(Y.Z.Label,{id:"cell-input-variables",children:c.__("Inputs")}),(0,r.jsxs)(Q.Z,{children:[(0,r.jsx)(Q.Z.Input,{as:ee.Z,tokens:m.filter((e=>e.selected)),onTokenRemove:e=>{const t=m.findIndex((t=>t.id===e));t>=0&&(m.splice(t,1),g([...m]))},onChange:y}),(0,r.jsx)(Q.Z.Overlay,{children:(0,r.jsx)(Q.Z.Menu,{addNewItem:f&&!m.find((e=>e.text===f))?{id:f,text:c.__("Add '%1'",f),handleAddItem:e=>{(e=>{const t=m.find((t=>t.id===e.id));t?(t.selected=!0,g([...m])):g([...m,e])})({...e,text:f,selected:!0}),_("")}}:void 0,items:m,selectedItemIds:m.filter((e=>e.selected)).map((e=>e.id)),onSelectedChange:e=>{Array.isArray(e)||(e=[e]);const t=e.map((e=>e.id));g([...m.map((e=>t.includes(e.id)?Object.assign(e,{selected:!0}):Object.assign(e,{selected:!1})))])},"aria-labelledby":"cell-input-variables",selectionVariant:"multiple",emptyStateText:c.__("No available variables."),loading:d})})]})]}),(0,r.jsxs)(Y.Z,{children:[(0,r.jsx)(Y.Z.Label,{id:"cell-output-variables",children:c.__("Output")}),(0,r.jsxs)(Q.Z,{children:[(0,r.jsx)(Q.Z.Input,{value:a,onChange:v}),(0,r.jsx)(Q.Z.Overlay,{children:(0,r.jsx)(Q.Z.Menu,{items:u??[],selectedItemIds:a?[a]:[],"aria-labelledby":"cell-output-variables",loading:i&&!u,emptyStateText:c.__("No available variables.")})})]})]})]})}const ce=new L.Token("@datalayer/jupyter-kernels:multi-service-manager"),de=new L.Token("@datalayer/jupyter-kernels:browser-router"),he=new L.Token("@datalayer/jupyter-kernels:plugin"),ue={small:16,medium:32,large:64},pe=j.forwardRef((function({title:e,titleId:t,size:n,colored:s,...r},i){return j.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 122.88 115.33",fill:s?"currentColor":["#fff","#fffff","white","#FFF","#FFFFFF"].includes("currentColor")?"white":"currentColor","aria-hidden":"true",width:n?"string"==typeof n?ue[n]:n:"16px",ref:i,"aria-labelledby":t},r),e?j.createElement("title",{id:t},e):null,j.createElement("path",{d:"M76.98 97.89c-3.62 4.01-7.79 7.99-12.51 11.94 1.28-.17 2.56-.38 3.81-.62 3.42-.69 6.71-1.7 9.89-3.08.82-.35 1.62-.72 2.41-1.1.59.76 1.25 1.42 1.96 1.98.77.61 1.59 1.09 2.45 1.45-1.58.85-3.2 1.62-4.86 2.34a55.262 55.262 0 01-10.9 3.39c-3.74.76-7.61 1.14-11.59 1.14-3.98 0-7.82-.38-11.59-1.14-3.7-.73-7.26-1.83-10.76-3.32-.03 0-.1-.03-.14-.07a62.287 62.287 0 01-9.82-5.33 54.495 54.495 0 01-8.51-6.99 52.856 52.856 0 01-6.99-8.51c-2.08-3.08-3.84-6.37-5.33-9.82a55.262 55.262 0 01-3.39-10.9A60.34 60.34 0 010 57.66c0-3.98.38-7.82 1.14-11.59.73-3.7 1.83-7.26 3.32-10.76 0-.03.03-.1.07-.14 1.49-3.49 3.29-6.75 5.33-9.82 2.04-3.08 4.39-5.92 6.99-8.51 2.59-2.63 5.43-4.95 8.51-6.99 3.08-2.08 6.36-3.84 9.82-5.33 3.53-1.52 7.16-2.63 10.9-3.39C49.81.38 53.69 0 57.66 0c3.98 0 7.82.38 11.59 1.14 3.7.73 7.26 1.83 10.76 3.32.03 0 .1.03.14.07 3.46 1.49 6.75 3.29 9.82 5.33 3.08 2.04 5.92 4.39 8.51 6.99 2.63 2.59 4.95 5.43 6.99 8.51 2.08 3.08 3.84 6.37 5.33 9.82 1.52 3.53 2.63 7.16 3.39 10.9.43 2.12.74 4.28.93 6.48l-5.23-1.39c-.16-1.38-.37-2.74-.64-4.09-.69-3.42-1.7-6.71-3.08-9.89-.86-2.04-1.83-3.98-2.91-5.85H86.38c3 5.13 5.16 10.23 6.47 15.32l-5.68-1.51c-1.48-4.56-3.71-9.16-6.71-13.81H60.19v9.39c-.36.21-.72.46-1.07.74a8.25 8.25 0 00-1.73 1.83 9.07 9.07 0 00-1.06 2.11c-.27.77-.43 1.54-.49 2.29-.05.64-.03 1.3.07 1.95.08.54.2 1.07.38 1.59l.05.14c.04.11.08.22.12.32.06.17.11.27.13.32l.02-.01 3.63 8.17h-.06v23.8H70.8l2.24 5.05H60.19v17.78c5.65-4.64 10.5-9.32 14.54-14.01l2.25 5.09zm38.16.08c-.34.34-.74.6-1.16.79-.44.2-.91.32-1.38.36a3.99 3.99 0 01-1.53-.17c-.48-.15-.94-.4-1.35-.74L98.63 88.8l-3.81 9.35c-.32.78-.7 1.5-1.13 2.15a8.62 8.62 0 01-1.44 1.68c-.41.36-.86.67-1.33.9-.47.23-.95.38-1.45.45-.58.08-1.16.04-1.72-.12-.54-.16-1.06-.42-1.56-.81-.4-.31-.77-.71-1.12-1.19-.32-.44-.61-.96-.88-1.56-7.22-16.27-15.83-33.78-22.27-50.16a3.137 3.137 0 01-.02-2.15c.09-.25.21-.5.36-.72.08-.11.16-.22.26-.31.08-.08.17-.16.27-.23.18-.14.37-.26.57-.36l.05-.02c.19-.09.39-.16.58-.2l.09-.02c.18-.04.36-.06.54-.07.21-.01.41.01.61.04l.21.03c17.64 4.38 35.38 9.38 52.98 14.05.63.17 1.19.38 1.68.62.53.27.98.57 1.35.91.46.42.81.9 1.05 1.41.25.53.38 1.1.39 1.69v.01c.01.5-.06 1-.21 1.5s-.38.98-.68 1.45c-.37.58-.85 1.16-1.43 1.69-.56.52-1.22 1.01-1.95 1.46-2.89 1.7-5.77 3.5-8.64 5.24l11.05 9.47c.4.35.72.76.94 1.21l.03.08c.21.45.34.92.38 1.41.04.49-.01 1-.16 1.5-.14.47-.37.93-.69 1.34-1.69 2.08-4.52 5.72-6.39 7.45zm-2.9-3.63l5.35-6.28-13-11.14-.07-.07c-.06-.06-.13-.13-.18-.19a1.61 1.61 0 01-.21-.3c-.33-.54-.4-1.16-.26-1.73.14-.57.5-1.09 1.04-1.41 3.76-2.07 7.64-4.66 11.35-6.89.43-.26.81-.55 1.13-.84.3-.28.55-.56.72-.83.07-.11.12-.2.15-.29-.08-.06-.17-.11-.3-.17-.19-.09-.44-.17-.73-.25L67.51 50.77 88.39 97.8c.12.26.24.49.37.68l.03.05c.07.09.13.17.18.22.08-.04.16-.11.26-.2.24-.21.48-.5.7-.84.24-.36.46-.79.65-1.27l5-12.28.05-.1c.04-.08.08-.16.12-.23l.03-.05c.05-.08.11-.16.18-.24a2.293 2.293 0 013.23-.26l13.05 11.06zm-61.35 15.49c-8.16-6.85-14.7-13.77-19.54-20.79H15.39c1.52 2.08 3.22 4.01 5.05 5.85 2.39 2.39 4.95 4.5 7.75 6.36 2.77 1.87 5.78 3.49 9.03 4.88.03.03.07.03.1.07 3.15 1.31 6.4 2.35 9.79 3.01 1.25.24 2.53.45 3.8.62h-.02zM12.07 83.99h16.05c-4.46-7.82-6.88-15.77-7.16-23.8H5.12c.14 2.77.45 5.43.97 8.06.69 3.42 1.69 6.71 3.08 9.89.86 2.04 1.83 3.98 2.9 5.85zM5.12 55.14h15.95c.59-7.89 3.22-15.81 7.89-23.8H12.07c-1.07 1.87-2.04 3.8-2.91 5.85-.03.03-.03.07-.07.1-1.31 3.15-2.35 6.4-3.01 9.79-.51 2.63-.86 5.29-.96 8.06zm10.24-28.85h16.85c4.81-6.92 11.14-13.87 19.03-20.86-1.42.17-2.8.38-4.15.66-3.42.69-6.71 1.7-9.89 3.08a55.79 55.79 0 00-9.03 4.88c-2.8 1.87-5.36 3.98-7.75 6.36-1.83 1.83-3.53 3.77-5.05 5.85l-.01.03zM64.1 5.43c7.92 6.99 14.25 13.94 19.03 20.86h16.85c-1.52-2.08-3.22-4.01-5.05-5.85-2.39-2.39-4.95-4.5-7.75-6.37-2.77-1.87-5.78-3.49-9.03-4.88-.03-.03-.07-.03-.1-.07-3.15-1.31-6.4-2.35-9.79-3.01-1.38-.28-2.77-.48-4.15-.66v-.02h-.01zm-3.91 3.29v17.57h16.74c-4.39-5.81-9.96-11.66-16.74-17.57zm-5.05 98.1V89.04H37.53c4.53 5.95 10.41 11.9 17.61 17.78zm0-22.83v-23.8H26.01c.31 7.99 3.01 15.91 7.99 23.8h21.14zm0-28.85v-23.8H34.87c-5.19 8.06-8.09 15.98-8.75 23.8h29.02zm0-28.85V8.72c-6.78 5.92-12.35 11.76-16.74 17.57h16.74z"}))})),me={small:16,medium:32,large:64},ge=j.forwardRef((function({title:e,titleId:t,size:n,colored:s,...r},i){return j.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",className:"icon",viewBox:"0 0 1024 1024",fill:s?"currentColor":["#fff","#fffff","white","#FFF","#FFFFFF"].includes("currentColor")?"white":"currentColor",width:n?"string"==typeof n?me[n]:n:"16px","aria-hidden":"true",ref:i,"aria-labelledby":t},r),e?j.createElement("title",{id:t},e):null,j.createElement("path",{d:"M956.9 845.1L896.4 632V168c0-17.7-14.3-32-32-32h-704c-17.7 0-32 14.3-32 32v464L67.9 845.1C60.4 866 75.8 888 98 888h828.8c22.2 0 37.6-22 30.1-42.9zM200.4 208h624v395h-624V208zm228.3 608l8.1-37h150.3l8.1 37H428.7zm224 0l-19.1-86.7c-.8-3.7-4.1-6.3-7.8-6.3H398.2c-3.8 0-7 2.6-7.8 6.3L371.3 816H151l42.3-149h638.2l42.3 149H652.7z"}))}));var fe=n(67095),_e=n(85128);const we={browser:pe,local:ge,remote:ne.Z};function ye(e){const{model:t}=e,[n,s]=(0,j.useState)(""),[i,a]=(0,j.useState)(null),[o,l]=(0,j.useState)(""),[c,d]=(0,j.useState)(""),[h,u]=(0,j.useState)(""),[p,m]=(0,j.useState)(H.getForeignCell(t)??null),[g,f]=(0,j.useState)($.UNKNOWN);(0,j.useEffect)((()=>{const e=()=>{const n=t.getMetadata("datalayer")?.kernel;if(n){const e=we[n.location];a(e?(0,j.createElement)(e,{title:n.location}):null),s(n.displayName??"Unknown kernel")}else a(null),s("");const r=t.getMetadata("execution");if(!r||!L.JSONExt.isObject(r))return o&&l(""),c&&d(""),void(h&&u(""));const i=r["iopub.status.busy"],p=i?new Date(i):null,m=r["shell.execute_reply.started"]||r["iopub.execute_input"],g=m?new Date(m):null,f=r.execution_failed,_=r["shell.execute_reply"]??f,w=_?new Date(_):null,y=_&&!r["iopub.execute_input"],v=setInterval((()=>{if(o.startsWith("Execution started at")){if(t.getMetadata("execution").execution_failed)return clearInterval(v),void e();if(g){const e=ke(new Date,g);d(`${e} ${h?`(${h})`:""}`)}}else clearInterval(v)}),100);let x="";if(y)x="";else if(w&&g){const e=ke(w,g);u(e),x=f?"Failed":"Last executed",x&&(x+=` at ${xe(w,"yyy-MM-dd HH:mm:ss")}`),x+=` in ${e}`}else g?x=`Execution started at ${xe(g,"yyy-MM-dd HH:mm:ss")}`:p&&(h&&d(`N/A (${h})`),x=`Execution queued at ${xe(p,"yyy-MM-dd HH:mm:ss")}`);o!==x&&l(x)},n=(e,{notebook:n,cell:s})=>{if(s.model===t){const e=H.getForeignCell(t)??null;f($.QUEUED),m(e)}},r=(e,{cell:n,success:s,error:r})=>{p||n.model!==t||f(s?$.DONE:$.ERROR)};return e(),t.metadataChanged.connect(e),"code"===t.type&&(I.NotebookActions.executionScheduled.connect(n),I.NotebookActions.executed.connect(r)),()=>{t.metadataChanged.disconnect(e),"code"===t.type&&(I.NotebookActions.executionScheduled.disconnect(n),I.NotebookActions.executed.disconnect(r))}}),[t]),(0,j.useEffect)((()=>{const e=(e,t)=>{f(t)};return p?.stateChanged.connect(e),()=>{p?.stateChanged.disconnect(e)}}),[p]);let _=!1,w=100,y="accent.emphasis",v="";switch(g){case $.QUEUED:v="💤 Queued",w=0;break;case $.UNKNOWN:w=0;break;case $.DONE:v="✅ Succeeded",y="success.emphasis";break;case $.ERROR:v="❌ Failed",y="danger.emphasis";break;case $.EXECUTING:v="⚡ Running…",_=!0,w=40;break;case $.EXPORTING:v="📤 Exporting data…",_=!0,w=90;break;case $.IMPORTING:v="📥 Importing data…",_=!0,w=30;break;case $.STARTING_KERNEL:v="🔥 Starting the kernel…",_=!0,w=20}return(0,r.jsxs)("div",{className:"dla-cell-footer",children:[g!==$.UNKNOWN&&(0,r.jsx)("div",{children:(0,r.jsx)(fe.k,{progress:w,bg:y,animated:_,barSize:"small"})}),(0,r.jsxs)("div",{children:[v,t.getMetadata("execution")?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{children:o}),(0,r.jsx)("span",{style:{minWidth:"12px"}}),(0,r.jsx)("span",{children:c})]}):(0,r.jsx)("span",{}),(0,r.jsxs)("span",{className:"dla-cell-footer-kernel",children:[i,n]})]})]})}class ve{constructor(e){this._panel=e,this._panel.content.model?.cells.changed.connect(this.updateConnectedCell,this),this._panel.content.modelChanged.connect((()=>{this._panel.content.model?.cells.changed.connect(this.updateConnectedCell,this)}))}get settings(){return this._settings}set settings(e){L.JSONExt.deepEqual(this._settings,e)||(this._settings=e,this.updateConnectedCell(this._panel.context.model.cells,{type:"set",newIndex:0,newValues:Array.from(this._panel.context.model.cells),oldIndex:0,oldValues:Array.from(this._panel.context.model.cells)}))}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,M.Signal.clearData(this))}updateConnectedCell(e,t){t.oldValues.forEach((e=>{this._removeFooter(e)})),Promise.all(t.newValues.map((e=>this._addFooter(e))))}async _addFooter(e){if("code"===e.type){const t=this._panel.content.widgets.find((t=>t.model===e));if(t){await t.ready;const n=y.ReactWidget.create((0,r.jsx)(P.ZP,{theme:h.jupyterTheme,children:(0,r.jsx)(ye,{model:e})}));this._cellFooters.has(e)&&this._cellFooters.get(e)?.dispose(),this._cellFooters.set(e,t);const s=()=>{this._cellFooters.delete(e),n.dispose()};t.disposed.connect(s),this._panel.disposed.disconnect(s),v.Widget.attach(n,t.inputArea.editorWidget.node)}}}_removeFooter(e){this._cellFooters.get(e)?.dispose()}_isDisposed=!1;_cellFooters=new WeakMap;_panel;_settings={dateFormat:"yyy-MM-dd HH:mm:ss",showDate:!0,showLiveExecutionTime:!0}}const xe=(e,t="yyy-MM-dd HH:mm:ss")=>(0,_e.format)(e,t),ke=(e,t)=>{const n=36e5,s=864e5;let r=(0,_e.differenceInMilliseconds)(e,t);if(r<1e3)return`${r}ms`;const i=Math.floor(r/s);r%=s;const a=Math.floor(r/n);r%=n;const o=Math.floor(r/6e4);r%=6e4;let l="";return i&&(l+=`${i}d `),(i||a)&&(l+=`${a}h `),(i||a||o)&&(l+=`${o}m `),i||(l+=`${(r/1e3).toFixed(a?0:2)}s`),l.trim()};class be{constructor(e,t){this._tracker=e,t.load("@datalayer/jupyter-kernels:plugin").then((e=>{this._updateSettings(e),e.changed.connect(this._updateSettings.bind(this)),t.load("@jupyterlab/notebook-extension:tracker").then((e=>e.set("recordTiming",!0)),(e=>{console.error("@datalayer/jupyter-kernels: Could not force metadata recording.",e)}))})).catch((e=>{console.error("@datalayer/jupyter-kernels: Could not load settings",e)}))}createNew(e,t){const n=new ve(e);return this._extensions.set(e,n),e.disposed.connect((()=>{this._extensions.delete(e)})),n}_updateSettings(e){const t={showLiveExecutionTime:e.get("showLiveExecutionTime").composite,showDate:e.get("showDate").composite},n=e.get("dateFormat").composite,s=(e=>{const t=new Date;try{return(0,_e.format)(t,e),{isValid:!0}}catch(e){return{isValid:!1,message:e.message}}})(n);s.isValid?t.dateFormat=n:(t.dateFormat="yyy-MM-dd HH:mm:ss",(0,p.showErrorMessage)("Invalid date format in Execute Time extension setting",s.message??"")),this._settings={...this._settings,...t},this._tracker.forEach((e=>{const t=this._extensions.get(e);t&&(t.settings={...this._settings})}))}_tracker;_extensions=new WeakMap;_settings={showLiveExecutionTime:!0,showDate:!0,dateFormat:"yyy-MM-dd HH:mm:ss"}}const je={id:"@datalayer/jupyter-kernels:cell-executor",description:"Handle kernel per cells.",requires:[ce,I.INotebookTracker],optional:[p.IToolbarWidgetRegistry,w.ITranslator],autoStart:!0,activate:(e,t,n,s,i)=>{H.serviceManager=t,I.NotebookActions.run=H.run,I.NotebookActions.runAll=H.runAll,I.NotebookActions.runAllAbove=H.runAllAbove,I.NotebookActions.runAllBelow=H.runAllBelow,I.NotebookActions.runAndAdvance=H.runAndAdvance,I.NotebookActions.runAndInsert=H.runAndInsert,I.NotebookActions.runCells=H.runCells,s?.addFactory("Cell","dla-kernel-picker",(e=>{const s=n.find((t=>!(!t.model||!Array.from(t.model.cells).find((t=>t===e.model)))));return"code"!==e.model.type?new v.Widget:y.ReactWidget.create((0,r.jsx)(P.ZP,{theme:h.jupyterTheme,children:(0,r.jsx)(oe,{model:e.model,preference:s?.sessionContext?{id:s.sessionContext.session?.kernel?.id,language:s.sessionContext.specsManager.specs?.kernelspecs[s.sessionContext.session?.kernel?.name??""]?.language}:void 0,serviceManager:t,sessionContext:s?.sessionContext,translator:i??void 0})}))}))}},Ce={id:"@datalayer/jupyter-kernels:cell-footer",description:"Cell footer with Datalayer kernel information",requires:[I.INotebookTracker,_.ISettingRegistry],optional:[w.ITranslator],autoStart:!0,activate:(e,t,n,s)=>{e.docRegistry.addWidgetExtension("Notebook",new be(t,n))}};var Se=n(53004),Me=n(87717),Ee=n(2998),Fe=n(24680),De=n(89620),Re=n(43250);function Ne({checkbox:e,footerButtons:t,setChecked:n}){const[s,i]=(0,j.useState)(),{containerRef:a}=(0,De.v)({bindKeys:Fe.Qw.ArrowHorizontal|Fe.Qw.Tab,focusInStrategy:"closest"});return(0,r.jsxs)(te.V.Footer,{className:"dla-dialog-footer",ref:a,children:[e&&(0,r.jsxs)(Y.Z,{layout:"horizontal",children:[(0,r.jsx)(Re.Z,{className:e.className??"",checked:s,defaultChecked:e.checked,onChange:e=>{i(e.target.checked),n(e.target.checked)},title:e.caption??""}),(0,r.jsx)(Y.Z.Label,{children:e.label??""})]}),(0,r.jsx)("div",{className:"dla-dialog-footer-spacer"}),t&&(0,r.jsx)(te.V.Buttons,{buttons:t})]})}class Ie extends y.ReactWidget{body;checkbox;buttons;host;dialogTitle;_closing=new L.PromiseDelegate;_result={button:null,isChecked:null,value:null};constructor(e={}){super(),this.host=e.host??document.body,this.body=e.body??(()=>null),this.checkbox=e.checkbox??null,this.buttons=e.buttons??[p.Dialog.cancelButton(),p.Dialog.okButton()],this.dialogTitle=e.title}close=()=>{v.Widget.detach(this),this._closing.resolve()};async launch(){return v.Widget.attach(this,this.host),await this._closing.promise,this._result}render(){return(0,r.jsx)(P.ZP,{theme:h.jupyterTheme,children:(0,r.jsx)(te.V,{onClose:this.close,footerButtons:this.buttons.map(((e,t)=>({buttonType:"default"===e.displayType?e.accept?"primary":"default":"danger",onClick:()=>{this.handleButton(t)},content:e.label,"aria-label":e.ariaLabel,autoFocus:e.accept}))),renderBody:this._renderBody,renderFooter:this._renderFooter,title:this.dialogTitle})})}handleButton=e=>{this.setButton(this.buttons[e]),this.close()};setButton=e=>{this._result.button=e};setChecked=e=>{this._result.isChecked=e};setValue=e=>{e instanceof Error?this._closing.reject(e):this._result.value=e};_renderBody=e=>(0,r.jsx)(te.V.Body,{children:(0,j.createElement)(this.body,{...e,setValue:this.setValue})});_renderFooter=e=>(0,r.jsx)(Ne,{...e,checkbox:this.checkbox,setChecked:this.setChecked})}var Pe,Te,Oe=n(18310),Le=n(52746),Ze=n(16419),Ae=n(14675);function ze(e){const{className:t,translator:n,selectedVariables:s,setSelectVariable:i,transferVariables:a,setTransferVariable:o,kernelVariables:l}=e,c=(0,j.useMemo)((()=>(n??w.nullTranslator).load("jupyterlab")),[n]),d=Object.keys(l??{}).length,h=[{header:c.__("Name"),field:"name",rowHeader:!0},{header:c.__("Type"),field:"type"},{id:"select",maxWidth:"70px",header:()=>(0,r.jsx)(E.h,{"aria-label":s.length===d?c.__("Deselect all"):c.__("Select all"),title:s.length===d?c.__("Deselect all"):c.__("Select all"),icon:s.length===d?y.checkIcon.react:()=>(0,r.jsx)("span",{}),variant:"default",size:"small",onClick:e=>{e.preventDefault(),s.length===d?i([]):i(Object.keys(l??{}))}}),renderCell:e=>{const t=s.includes(e.name);return(0,r.jsx)(E.h,{"aria-label":t?c.__("Deselect: %1",e.name):c.__("Select: %1",e.name),title:t?c.__("Deselect: %1",e.name):c.__("Select: %1",e.name),icon:t?y.checkIcon.react:()=>(0,r.jsx)("span",{}),variant:"default",size:"small",onClick:t=>{t.preventDefault();const n=s.findIndex((t=>t===e.name));if(n>=0){const e=[...s];e.splice(n,1),i(e)}else i([...s,e.name])}})}}];return(0,r.jsxs)(G.Z,{className:t,sx:{paddingTop:"10px"},children:[(0,r.jsx)(re.Z,{id:"kernel-toggle-variables",fontWeight:"bold",children:c.__("Transfer variables")}),(0,r.jsx)(Oe.Z,{checked:a,onClick:()=>{o(!a)},"aria-labelledby":"kernel-toggle-variables"}),a&&(0,r.jsxs)(Le.i.Container,{sx:{flex:"1 1 auto"},children:[(0,r.jsx)(Le.i.Title,{as:"h2",id:"dla-kernel-variables",children:c.__("Kernel variables")}),(0,r.jsx)(Le.i.Subtitle,{as:"p",id:"dla-kernel-variables-subtitle",children:c.__("The list of transferable kernel variables.")}),l?Object.keys(l??{}).length?(0,r.jsx)(Ze.w,{"aria-labelledby":"dla-kernel-variables","aria-describedby":"dla-kernel-variables-subtitle",data:Object.entries(l??{}).map((([e,t],n)=>({id:n,name:e,type:t}))).sort(((e,t)=>e.name>t.name?1:-1)),columns:h,cellPadding:"condensed"}):(0,r.jsx)(G.Z,{sx:{gridArea:"table"},children:(0,r.jsx)(Ae.Z,{border:!0,children:(0,r.jsx)(Ae.Z.Heading,{children:c.__("No eligible variables.")})})}):(0,r.jsx)(Le.i.Skeleton,{"aria-labelledby":"dla-kernel-variables","aria-describedby":"dla-kernel-variables-subtitle",columns:h,rows:5})]})]})}function Ke(e){const[t,n]=(0,j.useState)(null),[s,i]=(0,j.useState)(!1),[a,o]=(0,j.useState)(!1),[l,c]=(0,j.useState)(!1),[d,u]=(0,j.useState)(!1),[p,m]=(0,j.useState)(),[g,f]=(0,j.useState)([]),{multiServiceManager:_,sessionContext:w,setValue:y,translator:v}=e;(0,j.useEffect)((()=>{const e=w.specsManager.specs?.kernelspecs;if(w.session?.kernel?.name&&e){const t=Object.values(e).find((e=>e?.name===w.session.kernel.name));t&&(n({name:t.name,id:w.session.kernel.id,location:w.location,language:t.language,displayName:w.kernelDisplayName}),i(V.supports(t.language)))}}),[w]);const x=(0,j.useCallback)((async()=>{if(d)return Promise.resolve();u(!0);const e=w.session.kernel,t=w.specsManager.specs.kernelspecs[e.model.name],n=new V(t.language),s=(await new h.KernelExecutor({connection:e}).execute(n.listVariables())).get(0).data["text/plain"];if(s)if(m(JSON.parse(s.slice(1,s.length-1))),g.length){const e=Object.keys(p??{});f(g.filter((t=>e.includes(t))))}else f(Object.keys(p??{}));else m({})}),[d,p,g]),k=(0,j.useCallback)((e=>{L.JSONExt.deepEqual(g,e)||f(e)}),[g]),b=(0,j.useCallback)((e=>{l!==e&&(e&&x().catch((e=>{console.error("Failed to list the kernel variable",e),u(!1)})),c(e))}),[l]),C=(0,j.useCallback)((e=>{null!==e?t?.displayName===e.displayName&&t?.id===e.id||(n({...e}),o(V.supports(e.language))):null!==t&&(n(null),o(!1))}),[t]);(0,j.useEffect)((()=>{y({kernel:t?{name:["browser","remote"].includes(t.location)?`${t.location}-${t.name}`:t.name,id:t.id}:null,selectedVariables:g})}),[t,g]);const{kernelPreference:{canStart:S}}=w;return(0,r.jsxs)(G.Z,{className:"dla-kernel-picker",children:[(0,r.jsx)(ie,{disabled:!1===S,preference:{id:w.session?.id,kernelDisplayName:w.kernelPreference.shouldStart?w.kernelDisplayName:void 0},serviceManager:_,translator:v,selection:t,setSelection:C}),s&&a&&(0,r.jsx)(ze,{translator:v,selectedVariables:g,setSelectVariable:k,transferVariables:l,setTransferVariable:b,kernelVariables:p})]})}function Ve(e){const{specs:t,preference:n}=e,{name:s,language:r,canStart:i,autoStartDefault:a}=n;if(!t||!1===i)return null;const o=a?t.default:null;if(!s&&!r)return o;for(const e in t.kernelspecs)if(e===s)return s;if(!r)return o;const l=[];for(const e in t.kernelspecs){const n=t.kernelspecs[e]?.language;r===n&&l.push(e)}if(1===l.length){const e=l[0];return console.warn("No exact match found for "+e+", using kernel "+e+" that matches language="+r),e}return o}class We{constructor(e,t){this.translator=e.translator||w.nullTranslator,this._trans=this.translator.load("jupyterlab"),this._path=e.path??L.UUID.uuid4(),this._type=e.type??"",this._name=e.name??"",this._setBusy=e.setBusy,this._kernelPreference=e.kernelPreference??{},this._serviceManager=t}get session(){return this._session??null}get path(){return this._path}get type(){return this._type}get name(){return this._name}get location(){return this._location}get kernelChanged(){return this._kernelChanged}get sessionChanged(){return this._sessionChanged}get statusChanged(){return this._statusChanged}get pendingInput(){return this._pendingInput}get connectionStatusChanged(){return this._connectionStatusChanged}get iopubMessage(){return this._iopubMessage}get unhandledMessage(){return this._unhandledMessage}get propertyChanged(){return this._propertyChanged}get kernelPreference(){return this._kernelPreference}set kernelPreference(e){if(!L.JSONExt.deepEqual(e,this._kernelPreference)){const t=this._kernelPreference;this._kernelPreference=e,this._preferenceChanged.emit({name:"kernelPreference",oldValue:t,newValue:L.JSONExt.deepCopy(e)})}}get kernelPreferenceChanged(){return this._preferenceChanged}get isReady(){return this._isReady}get ready(){return this._ready.promise}get isTerminating(){return this._isTerminating}get isRestarting(){return this._isRestarting}get kernelManager(){switch(this._location){case"browser":return this._serviceManager.browser.kernels;case"local":return this._serviceManager.local.kernels;default:return this._serviceManager.remote.servers.getServices(this._location).kernels}}get serviceManager(){return this._serviceManager}get sessionManager(){switch(this._location){case"browser":return this._serviceManager.browser.sessions;case"local":return this._serviceManager.local.sessions;default:return this._serviceManager.remote.servers.getServices(this._location).sessions}}get specsManager(){switch(this._location){case"browser":return this._serviceManager.browser.kernelspecs;case"local":return this._serviceManager.local.kernelspecs;default:return this._serviceManager.remote.servers.getServices(this._location).kernelspecs}}get hasNoKernel(){return this.kernelDisplayName===this.noKernelName}get kernelDisplayName(){const e=this.session?.kernel;return this._pendingKernelName===this.noKernelName?this.noKernelName:this._pendingKernelName?this.specsManager.specs?.kernelspecs[this._pendingKernelName]?.display_name??this._pendingKernelName:e?this.specsManager.specs?.kernelspecs[e.name]?.display_name??e.name:this.noKernelName}get kernelDisplayStatus(){const e=this.session?.kernel;return this._isTerminating?"terminating":this._isRestarting?"restarting":this._pendingKernelName===this.noKernelName?"unknown":!e&&this._pendingKernelName?"initializing":e||this.isReady||!1===this.kernelPreference.canStart||!1===this.kernelPreference.shouldStart?("connected"===e?.connectionStatus?e?.status:e?.connectionStatus)??"unknown":"initializing"}get prevKernelName(){return this._prevKernelName}get isDisposed(){return this._isDisposed}get disposed(){return this._disposed}get noKernelName(){return this._trans.__("No Kernel")}dispose(){this._isDisposed||(this._isDisposed=!0,this._disposed.emit(),this._session&&(this.kernelPreference.shutdownOnDispose&&this.sessionManager.shutdown(this._session.id).catch((e=>{console.error(`Kernel not shut down ${e}`)})),this._session.dispose(),this._session=null),this._dialog&&this._dialog.dispose(),this._busyDisposable&&(this._busyDisposable.dispose(),this._busyDisposable=null),M.Signal.clearData(this))}async startKernel(){const e=this.kernelPreference;if(!e.autoStartDefault&&!1===e.shouldStart)return!0;let t;if(e.id)t={id:e.id};else{const n=Ve({specs:this.specsManager.specs,sessions:this.sessionManager.running(),preference:e});n&&(t={name:n})}if(t)try{return await this._changeKernel(t),!1}catch(e){}return!0}async restartKernel(){const e=this.session?.kernel||null;if(!this._isRestarting){this._isRestarting=!0,this._isReady=!1,this._statusChanged.emit("restarting");try{await(this.session?.kernel?.restart()),this._isReady=!0}catch(e){console.error(e)}this._isRestarting=!1,this._statusChanged.emit(this.session?.kernel?.status||"unknown"),this._kernelChanged.emit({name:"kernel",oldValue:e,newValue:this.session?.kernel||null})}}async changeKernel(e={}){if(this.isDisposed)throw new Error("Disposed");return await this._initStarted.promise,this._changeKernel(e)}async shutdown(){if(!this.isDisposed&&this._initializing)return await this._initStarted.promise,this._pendingSessionRequest="",this._pendingKernelName=this.noKernelName,this._shutdownSession()}async initialize(){if(this._initializing)return this._initPromise.promise;this._initializing=!0;const e=await this._initialize();return e||(this._isReady=!0,this._ready.resolve(void 0)),this._pendingSessionRequest||this._initStarted.resolve(void 0),this._initPromise.resolve(e),e}async _initialize(){const e=this.sessionManager;await e.ready,await e.refreshRunning();const t=(0,O.find)(e.running(),(e=>e.path===this._path));if(t)try{const n=e.connectTo({model:t});this._handleNewSession(n)}catch(e){return this._handleSessionError(e),Promise.reject(e)}return await this._startIfNecessary()}async _shutdownSession(){const e=this._session,t=this._isTerminating,n=this._isReady;this._isTerminating=!0,this._isReady=!1,this._statusChanged.emit("terminating");try{await(e?.shutdown()),this._isTerminating=!1,e?.dispose(),this._session=null;const t=e?.kernel||null;this._statusChanged.emit("unknown"),this._kernelChanged.emit({name:"kernel",oldValue:t,newValue:null}),this._sessionChanged.emit({name:"session",oldValue:e,newValue:null})}catch(s){this._isTerminating=t,this._isReady=n;const r=e?.kernel?.status;throw void 0===r?this._statusChanged.emit("unknown"):this._statusChanged.emit(r),s}}async _startIfNecessary(){const e=this.kernelPreference;return!this.isDisposed&&!this.session?.kernel&&!1!==e.shouldStart&&!1!==e.canStart&&this.startKernel()}async _changeKernel(e={}){let t;if(e.id){if(await this.serviceManager.local.kernels.refreshRunning(),(0,O.find)(this.serviceManager.local.kernels.running(),(t=>t.id===e.id))&&(t="local"),!t&&this.serviceManager.remote){await this.serviceManager.remote.servers.refresh();const n=this.serviceManager.remote.servers.get().find((t=>t.id===e.id));n&&(t=n.jupyter_pod_name)}!t&&this.serviceManager.browser&&(await this.serviceManager.browser.kernels.refreshRunning(),(0,O.find)(this.serviceManager.browser.kernels.running(),(t=>t.id===e.id))&&(t="browser"))}if(!t)switch(e.name?.split("-",1)[0]){case"browser":t="browser";break;case"remote":t="remote";break;default:t="local"}const n=this._location===t;if(this._location=t,e.name&&("local"!==this._location&&(e.name=e.name.replace(/^(remote-|browser-)/,"")),this._pendingKernelName=e.name),this._session||this._kernelChanged.emit({name:"kernel",oldValue:null,newValue:null}),this._pendingSessionRequest||this._initStarted.resolve(void 0),n&&this._session&&!this._isTerminating)try{return console.log("--- Reusing session and changing the kernel with a model",this._session,e),await this._session.changeKernel(e),this._session.kernel}catch(e){throw this._handleSessionError(e),e}const s=m.PathExt.dirname(this._path),r=this._pendingSessionRequest=m.PathExt.join(s,L.UUID.uuid4());try{if(this._statusChanged.emit("starting"),"remote"===this._location){const t=await(this.serviceManager.remote?.servers.startNew({name:e.name}));if(t){e.id=t.model.id;const n=await(this.serviceManager.remote?.servers.findById(t.model.id));n&&(this._location=n.jupyter_pod_name),t.dispose()}}const t=await this.sessionManager.startNew({path:r,type:this._type,name:this._name,kernel:e});return this._pendingSessionRequest!==t.path?(await t.shutdown(),t.dispose(),null):(await t.setPath(this._path),await t.setName(this._name),this._session&&!this._isTerminating&&await this._shutdownSession(),this._handleNewSession(t))}catch(e){throw this._handleSessionError(e),e}}_handleNewSession(e){if(this.isDisposed)throw Error("Disposed");return this._isReady||(this._isReady=!0,this._ready.resolve(void 0)),this._session&&this._session.dispose(),this._session=e,this._pendingKernelName="",e&&(this._prevKernelName=e.kernel?.name??"",e.disposed.connect(this._onSessionDisposed,this),e.propertyChanged.connect(this._onPropertyChanged,this),e.kernelChanged.connect(this._onKernelChanged,this),e.statusChanged.connect(this._onStatusChanged,this),e.connectionStatusChanged.connect(this._onConnectionStatusChanged,this),e.pendingInput.connect(this._onPendingInput,this),e.iopubMessage.connect(this._onIopubMessage,this),e.unhandledMessage.connect(this._onUnhandledMessage,this),e.path!==this._path&&this._onPropertyChanged(e,"path"),e.name!==this._name&&this._onPropertyChanged(e,"name"),e.type!==this._type&&this._onPropertyChanged(e,"type")),this._sessionChanged.emit({name:"session",oldValue:null,newValue:e}),this._kernelChanged.emit({oldValue:null,newValue:e?.kernel||null,name:"kernel"}),this._statusChanged.emit(e?.kernel?.status||"unknown"),e?.kernel||null}async _handleSessionError(e){this._handleNewSession(null);let t="",n="";try{t=e.traceback,n=e.message}catch(e){}await this._displayKernelError(n,t)}async _displayKernelError(e,t){const n=(0,r.jsxs)("div",{children:[e&&(0,r.jsx)("pre",{children:e}),t&&(0,r.jsx)("details",{className:"jp-mod-wide",children:(0,r.jsx)("pre",{children:t})})]}),s=this._dialog=new p.Dialog({title:this._trans.__("Error Starting Kernel"),body:n,buttons:[p.Dialog.okButton()]});await s.launch(),this._dialog=null}_onSessionDisposed(){if(this._session){const e=this._session;this._session=null;const t=this._session;this._sessionChanged.emit({name:"session",oldValue:e,newValue:t})}}_onPropertyChanged(e,t){switch(t){case"path":this._path=e.path;break;case"name":this._name=e.name;break;case"type":this._type=e.type;break;default:throw new Error(`unrecognized property ${t}`)}this._propertyChanged.emit(t)}_onKernelChanged(e,t){this._kernelChanged.emit(t)}_onStatusChanged(e,t){if("dead"===t){const t=e.kernel?.model;if(t?.reason){const e=t.traceback||"";this._displayKernelError(t.reason,e)}}this._setBusy&&("busy"===t?this._busyDisposable||(this._busyDisposable=this._setBusy()):this._busyDisposable&&(this._busyDisposable.dispose(),this._busyDisposable=null)),this._statusChanged.emit(t)}_onConnectionStatusChanged(e,t){this._connectionStatusChanged.emit(t)}_onPendingInput(e,t){this._pendingInput=t}_onIopubMessage(e,t){"shutdown_reply"===t.header.msg_type&&this.session.kernel.removeInputGuard(),this._iopubMessage.emit(t)}_onUnhandledMessage(e,t){this._unhandledMessage.emit(t)}_path="";_name="";_type="";_prevKernelName="";_kernelPreference;_isDisposed=!1;_location="local";_disposed=new M.Signal(this);_session=null;_ready=new L.PromiseDelegate;_initializing=!1;_initStarted=new L.PromiseDelegate;_initPromise=new L.PromiseDelegate;_isReady=!1;_isTerminating=!1;_isRestarting=!1;_kernelChanged=new M.Signal(this);_preferenceChanged=new M.Signal(this);_sessionChanged=new M.Signal(this);_statusChanged=new M.Signal(this);_connectionStatusChanged=new M.Signal(this);translator;_trans;_pendingInput=!1;_iopubMessage=new M.Signal(this);_unhandledMessage=new M.Signal(this);_propertyChanged=new M.Signal(this);_dialog=null;_setBusy;_busyDisposable=null;_serviceManager;_pendingKernelName="";_pendingSessionRequest=""}!function(e){e.getDefaultKernel=function(e){const{preference:t}=e,{shouldStart:n}=t;return!1===n?null:Ve(e)}}(We||(We={}));class He{constructor(e={},t){this._translator=e.translator??w.nullTranslator,this._multiServiceManager=t}async selectKernel(e){if(e.isDisposed)return Promise.resolve();const t=this._translator.load("jupyterlab");let n=t.__("Cancel");e.hasNoKernel&&(n=e.kernelDisplayName);const s=e.kernelPreference.autoStartDefault,i="boolean"==typeof s,a=new Ie({title:t.__("Assign a Kernel for %1",e.name),body:t=>(0,r.jsx)(Ke,{sessionContext:e,multiServiceManager:this._multiServiceManager,setValue:t.setValue,translator:this._translator}),buttons:[p.Dialog.cancelButton({label:n}),p.Dialog.okButton({label:t.__("Assign"),ariaLabel:t.__("Assign Kernel")})],checkbox:i?{label:t.__("Always start the preferred kernel"),caption:t.__("Remember my choice and always start the preferred kernel"),checked:s}:null}),o=await a.launch();if(e.isDisposed||!o.button.accept)return;i&&null!==o.isChecked&&(e.kernelPreference={...e.kernelPreference,autoStartDefault:o.isChecked});const{kernel:l,selectedVariables:c}=await(o.value??Promise.resolve({kernel:null,selectedVariables:[]}));if(null!==l||e.hasNoKernel||(await e.shutdown(),p.Notification.success("Kernel stopped.")),l){let n,s="";if(c.length){n=p.Notification.emit("Saving the variables…","in-progress",{autoClose:!1});try{s=await async function(e,t){if(t.length){const n=e.session.kernel,s=e.specsManager.specs.kernelspecs[n.model.name],r=new V(s.language);return(await new h.KernelExecutor({connection:n}).execute(r.saveVariables(t))).get(0).data["text/plain"]}return""}(e,c)}catch(e){return n&&p.Notification.update({id:n,message:"Failed to save the variables",type:"error",autoClose:!1}),void console.error(e)}}n&&p.Notification.update({id:n,message:"Starting the new kernel…"});const r=await e.changeKernel(l);if(r){let i;try{const t=e.specsManager.specs.kernelspecs[r.model.name];i=new V(t.language)}catch(e){return console.warn("Kernel snippets not supported.",e),void(n&&p.Notification.update({id:n,message:"Kernel is ready",type:"success",autoClose:3e3}))}"remote"===e.location&&await new h.KernelExecutor({connection:r}).execute(i.changeCurrentWorkingDirectory("content/local"));try{const r=[];if(s){n&&p.Notification.update({id:n,message:"Importing the variables…"});const t=(await new h.KernelExecutor({connection:e.session.kernel}).execute(i.loadVariables(s))).get(0).data["text/plain"]||"[]",a=JSON.parse(t.slice(1,t.length-1));r.push(...c.filter((e=>!a.includes(e))))}n&&p.Notification.update({id:n,message:"Kernel is ready",type:r.length?"warning":"success",autoClose:3e3,actions:r.length?[{label:t.__("Warnings"),callback:()=>{(0,p.showDialog)({title:t.__("Warning"),body:`The following variables were not transferred: ${r.join(", ")}`,buttons:[p.Dialog.warnButton({label:t.__("Dismiss")})]})},displayType:"warn"}]:void 0})}catch(e){console.error(e),n&&p.Notification.update({id:n,message:"Fail to import the variables",type:"error"})}}}}async restart(e){const t=this._translator.load("jupyterlab");if(await e.initialize(),e.isDisposed)throw new Error("session already disposed");const n=e.session?.kernel;if(!n&&e.prevKernelName)return await e.changeKernel({name:e.prevKernelName}),!0;if(!n)throw new Error("No kernel to restart");const s=p.Dialog.warnButton({label:t.__("Restart"),ariaLabel:t.__("Confirm Kernel Restart")}),r=await(0,p.showDialog)({title:t.__("Restart Kernel?"),body:t.__("Do you want to restart the kernel of %1? All variables will be lost.",e.name),buttons:[p.Dialog.cancelButton({ariaLabel:t.__("Cancel Kernel Restart")}),s]});return!n.isDisposed&&!!r.button.accept&&(await e.restartKernel(),!0)}_translator;_multiServiceManager}class $e{constructor(e){const t=this._manager=e.manager;this.translator=e.translator||w.nullTranslator,this._trans=this.translator.load("jupyterlab"),this._factory=e.factory,this._dialogs=e.sessionDialogs??new p.SessionContextDialogs({translator:e.translator}),this._opener=e.opener||Pe.noOp,this._path=this._manager.contents.normalize(e.path),this._lastModifiedCheckMargin=e.lastModifiedCheckMargin||500;const n=this._manager.contents.localPath(this._path),s=this._factory.preferredLanguage(m.PathExt.basename(n)),r=this._manager.contents.getSharedModelFactory(this._path),i=r?.createNew({path:n,format:this._factory.fileFormat,contentType:this._factory.contentType,collaborative:this._factory.collaborative});this._model=this._factory.createNew({languagePreference:s,sharedModel:i,collaborationEnabled:r?.collaborative??!1}),this._readyPromise=t.ready.then((()=>this._populatedPromise.promise));const a=m.PathExt.extname(this._path);this.sessionContext=new We({sessionManager:t.sessions,specsManager:t.kernelspecs,path:n,type:".ipynb"===a?"notebook":"file",name:m.PathExt.basename(n),kernelPreference:e.kernelPreference||{shouldStart:!1},setBusy:e.setBusy},t),this.sessionContext.propertyChanged.connect(this._onSessionChanged,this),t.contents.fileChanged.connect(this._onFileChanged,this),this.urlResolver=new Ee.RenderMimeRegistry.UrlResolver({path:this._path,contents:t.contents})}get pathChanged(){return this._pathChanged}get fileChanged(){return this._fileChanged}get saveState(){return this._saveState}get disposed(){return this._disposed}get lastModifiedCheckMargin(){return this._lastModifiedCheckMargin}set lastModifiedCheckMargin(e){this._lastModifiedCheckMargin=e}get model(){return this._model}sessionContext;get path(){return this._path}get localPath(){return this._manager.contents.localPath(this._path)}get contentsModel(){return this._contentsModel?{...this._contentsModel}:null}get factoryName(){return this.isDisposed?"":this._factory.name}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,this.sessionContext.dispose(),this._model.dispose(),this._model.sharedModel.dispose(),this._disposed.emit(void 0),M.Signal.clearData(this))}get isReady(){return this._isReady}get ready(){return this._readyPromise}get canSave(){return!(!this._contentsModel?.writable||this._model.collaborative)}urlResolver;async initialize(e){e?await this._save():await this._revert(),this.model.sharedModel.clearUndoHistory()}rename(e){return this.ready.then((()=>this._manager.ready.then((()=>this._rename(e)))))}async save(){await this.ready,await this._save()}async saveAs(){await this.ready;const e=this._manager.contents.localPath(this.path),t=await Pe.getSavePath(e);if(this.isDisposed||!t)return;const n=this._manager.contents.driveName(this.path),s=""===n?t:`${n}:${t}`;if(s===this._path)return this.save();try{await this._manager.ready,await this._manager.contents.get(s),await this._maybeOverWrite(s)}catch(e){if(!e.response||404!==e.response.status)throw e;await this._finishSaveAs(s)}}async download(){const e=await this._manager.contents.getDownloadUrl(this._path),t=document.createElement("a");t.href=e,t.download="",document.body.appendChild(t),t.click(),document.body.removeChild(t)}async revert(){await this.ready,await this._revert()}createCheckpoint(){const e=this._manager.contents;return this._manager.ready.then((()=>e.createCheckpoint(this._path)))}deleteCheckpoint(e){const t=this._manager.contents;return this._manager.ready.then((()=>t.deleteCheckpoint(this._path,e)))}restoreCheckpoint(e){const t=this._manager.contents,n=this._path;return this._manager.ready.then((()=>e?t.restoreCheckpoint(n,e):this.listCheckpoints().then((s=>{if(!this.isDisposed&&s.length)return e=s[s.length-1].id,t.restoreCheckpoint(n,e)}))))}listCheckpoints(){const e=this._manager.contents;return this._manager.ready.then((()=>e.listCheckpoints(this._path)))}addSibling(e,t={}){const n=this._opener;return n&&n(e,t),new Me.DisposableDelegate((()=>{e.close()}))}_onFileChanged(e,t){if("rename"!==t.type)return;let n=t.oldValue&&t.oldValue.path,s=t.newValue&&t.newValue.path;if(s&&0===this._path.indexOf(n||"")){let e=t.newValue;n!==this._path&&(s=this._path.replace(new RegExp(`^${n}/`),`${s}/`),n=this._path,e={last_modified:t.newValue?.created,path:s}),this._updateContentsModel({...this._contentsModel,...e}),this._updatePath(s)}}_onSessionChanged(e,t){if("path"!==t)return;const n=this._manager.contents.driveName(this.path);let s=this.sessionContext.session.path;n&&(s=`${n}:${s}`),this._updatePath(s)}_updateContentsModel(e){const t=e.writable&&!this._model.collaborative,n={path:e.path,name:e.name,type:e.type,writable:t,created:e.created,last_modified:e.last_modified,mimetype:e.mimetype,format:e.format},s=this._contentsModel?.last_modified??null;this._contentsModel=n,s&&n.last_modified===s||this._fileChanged.emit(n)}_updatePath(e){if(this._path===e)return;this._path=e;const t=this._manager.contents.localPath(e),n=m.PathExt.basename(t);if(this.sessionContext.session?.path!==t&&this.sessionContext.session?.setPath(t),this.sessionContext.session?.name!==n&&this.sessionContext.session?.setName(n),this.urlResolver.path!==e&&(this.urlResolver.path=e),this._contentsModel&&(this._contentsModel.path!==e||this._contentsModel.name!==n)){const t={...this._contentsModel,name:n,path:e};this._updateContentsModel(t)}this._pathChanged.emit(e)}async _populate(){if(this._isPopulated=!0,this._isReady=!0,this._populatedPromise.resolve(void 0),await this._maybeCheckpoint(!1),this.isDisposed)return;const e=this._model.defaultKernelName||this.sessionContext.kernelPreference.name;this.sessionContext.kernelPreference={...this.sessionContext.kernelPreference,name:e,language:this._model.defaultKernelLanguage},this.sessionContext.initialize().then((e=>{e&&this._dialogs.selectKernel(this.sessionContext)}))}async _rename(e){const t=this.localPath.split("/");t[t.length-1]=e;let n=m.PathExt.join(...t);const s=this._manager.contents.driveName(this.path);s&&(n=`${s}:${n}`),await this._manager.contents.rename(this.path,n)}async _save(){this._saveState.emit("started");const e=this._createSaveOptions();try{await this._manager.ready;const t=await this._maybeSave(e);if(this.isDisposed)return;this._model.dirty=!1,this._updateContentsModel(t),this._isPopulated||await this._populate(),this._saveState.emit("completed")}catch(e){const{name:t}=e;if("ModalCancelError"===t||"ModalDuplicateError"===t)throw e;const n=this._manager.contents.localPath(this._path),s=m.PathExt.basename(n);throw this._handleError(e,this._trans.__("File Save Error for %1",s)),this._saveState.emit("failed"),e}}_revert(e=!1){const t={type:this._factory.contentType,content:null!==this._factory.fileFormat,...null!==this._factory.fileFormat?{format:this._factory.fileFormat}:{}},n=this._path,s=this._model;return this._manager.ready.then((()=>this._manager.contents.get(n,t))).then((e=>{if(!this.isDisposed){if(e.content)if("json"===e.format)s.fromJSON(e.content);else{let t=e.content;-1!==t.indexOf("\r\n")?(this._lineEnding="\r\n",t=t.replace(/\r\n/g,"\n")):-1!==t.indexOf("\r")?(this._lineEnding="\r",t=t.replace(/\r/g,"\n")):this._lineEnding=null,s.fromString(t)}return this._updateContentsModel(e),s.dirty=!1,this._isPopulated?void 0:this._populate()}})).catch((async e=>{const t=this._manager.contents.localPath(this._path),n=m.PathExt.basename(t);throw this._handleError(e,this._trans.__("File Load Error for %1",n)),e}))}_maybeSave(e){const t=this._path;return this._manager.contents.get(t,{content:!1}).then((n=>{if(this.isDisposed)return Promise.reject(new Error("Disposed"));const s=this._lastModifiedCheckMargin,r=this.contentsModel?.last_modified,i=r?new Date(r):new Date,a=new Date(n.last_modified);return r&&a.getTime()-i.getTime()>s?this._timeConflict(i,n,e):this._manager.contents.save(t,e)}),(n=>{if(n.response&&404===n.response.status)return this._manager.contents.save(t,e);throw n}))}async _handleError(e,t){await(0,p.showErrorMessage)(t,e)}_maybeCheckpoint(e){let t=Promise.resolve(void 0);return this.canSave?(t=e?this.createCheckpoint().then():this.listCheckpoints().then((e=>{if(!this.isDisposed&&!e.length&&this.canSave)return this.createCheckpoint().then()})),t.catch((e=>{if(!e.response||403!==e.response.status)throw e}))):t}_timeConflict(e,t,n){const s=new Date(t.last_modified);if(console.warn(`Last saving performed ${e} while the current file seems to have been saved ${s}`),this._timeConflictModalIsOpen){const e=new Error("Modal is already displayed");return e.name="ModalDuplicateError",Promise.reject(e)}const r=this._trans.__('"%1" has changed on disk since the last time it was opened or saved.\nDo you want to overwrite the file on disk with the version open here,\nor load the version on disk (revert)?',this.path),i=p.Dialog.okButton({label:this._trans.__("Revert"),actions:["revert"]}),a=p.Dialog.warnButton({label:this._trans.__("Overwrite"),actions:["overwrite"]});return this._timeConflictModalIsOpen=!0,(0,p.showDialog)({title:this._trans.__("File Changed"),body:r,buttons:[p.Dialog.cancelButton(),i,a]}).then((e=>{if(this._timeConflictModalIsOpen=!1,this.isDisposed)return Promise.reject(new Error("Disposed"));if(e.button.actions.includes("overwrite"))return this._manager.contents.save(this._path,n);if(e.button.actions.includes("revert"))return this.revert().then((()=>t));const s=new Error("Cancel");return s.name="ModalCancelError",Promise.reject(s)}))}_maybeOverWrite(e){const t=this._trans.__('"%1" already exists. Do you want to replace it?',e),n=p.Dialog.warnButton({label:this._trans.__("Overwrite"),accept:!0});return(0,p.showDialog)({title:this._trans.__("File Overwrite?"),body:t,buttons:[p.Dialog.cancelButton(),n]}).then((t=>this.isDisposed?Promise.reject(new Error("Disposed")):t.button.accept?this._manager.contents.delete(e).then((()=>this._finishSaveAs(e))):void 0))}async _finishSaveAs(e){this._saveState.emit("started");try{await this._manager.ready;const t=this._createSaveOptions();await this._manager.contents.save(e,t),await this._maybeCheckpoint(!0),this._saveState.emit("completed")}catch(e){if("Cancel"===e.message||"Modal is already displayed"===e.message)throw e;const t=this._manager.contents.localPath(this._path),n=m.PathExt.basename(t);return this._handleError(e,this._trans.__("File Save Error for %1",n)),void this._saveState.emit("failed")}}_createSaveOptions(){let e=null;return"json"===this._factory.fileFormat?e=this._model.toJSON():(e=this._model.toString(),this._lineEnding&&(e=e.replace(/\n/g,this._lineEnding))),{type:this._factory.contentType,format:this._factory.fileFormat,content:e}}translator;_isReady=!1;_isDisposed=!1;_isPopulated=!1;_trans;_manager;_opener;_model;_path="";_lineEnding=null;_factory;_contentsModel=null;_readyPromise;_populatedPromise=new L.PromiseDelegate;_pathChanged=new M.Signal(this);_fileChanged=new M.Signal(this);_saveState=new M.Signal(this);_disposed=new M.Signal(this);_dialogs;_lastModifiedCheckMargin=500;_timeConflictModalIsOpen=!1}!function(e){e.getSavePath=function(e,n){const s=(n=n||w.nullTranslator).load("jupyterlab"),r=p.Dialog.okButton({label:s.__("Save"),accept:!0});return(0,p.showDialog)({title:s.__("Save File As…"),body:new t(e),buttons:[p.Dialog.cancelButton(),r]}).then((e=>{if(e.button.accept)return e.value??void 0}))},e.noOp=function(){};class t extends v.Widget{constructor(e){super({node:n(e)})}getValue(){return this.node.value}}function n(e){const t=document.createElement("input");return t.value=e,t}}(Pe||(Pe={}));class Be{constructor(e){this.translator=e.translator||w.nullTranslator,this.registry=e.registry,this.services=e.manager,this._dialogs=e.sessionDialogs??new p.SessionContextDialogs({translator:e.translator}),this._isConnectedCallback=e.isConnectedCallback||(()=>!0),this._opener=e.opener,this._when=e.when||e.manager.ready;const t=new g.DocumentWidgetManager({registry:this.registry,translator:this.translator});t.activateRequested.connect(this._onActivateRequested,this),t.stateChanged.connect(this._onWidgetStateChanged,this),this._widgetManager=t,this._setBusy=e.setBusy}registry;services;get activateRequested(){return this._activateRequested}get autosave(){return this._autosave}set autosave(e){if(this._autosave!==e){const t=this._autosave;this._autosave=e,this._contexts.forEach((t=>{const n=Te.saveHandlerProperty.get(t);n&&(!0!==e||n.isActive?!1===e&&n.isActive&&n.stop():n.start())})),this._stateChanged.emit({name:"autosave",oldValue:t,newValue:e})}}get autosaveInterval(){return this._autosaveInterval}set autosaveInterval(e){if(this._autosaveInterval!==e){const t=this._autosaveInterval;this._autosaveInterval=e,this._contexts.forEach((t=>{const n=Te.saveHandlerProperty.get(t);n&&(n.saveInterval=e||120)})),this._stateChanged.emit({name:"autosaveInterval",oldValue:t,newValue:e})}}get confirmClosingDocument(){return this._widgetManager.confirmClosingDocument}set confirmClosingDocument(e){if(this._widgetManager.confirmClosingDocument!==e){const t=this._widgetManager.confirmClosingDocument;this._widgetManager.confirmClosingDocument=e,this._stateChanged.emit({name:"confirmClosingDocument",oldValue:t,newValue:e})}}get lastModifiedCheckMargin(){return this._lastModifiedCheckMargin}set lastModifiedCheckMargin(e){if(this._lastModifiedCheckMargin!==e){const t=this._lastModifiedCheckMargin;this._lastModifiedCheckMargin=e,this._contexts.forEach((t=>{t.lastModifiedCheckMargin=e})),this._stateChanged.emit({name:"lastModifiedCheckMargin",oldValue:t,newValue:e})}}get renameUntitledFileOnSave(){return this._renameUntitledFileOnSave}set renameUntitledFileOnSave(e){if(this._renameUntitledFileOnSave!==e){const t=this._renameUntitledFileOnSave;this._renameUntitledFileOnSave=e,this._stateChanged.emit({name:"renameUntitledFileOnSave",oldValue:t,newValue:e})}}get stateChanged(){return this._stateChanged}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,M.Signal.clearData(this),this._contexts.forEach((e=>this._widgetManager.closeWidgets(e))),this._widgetManager.dispose(),this._contexts.length=0)}cloneWidget(e){return this._widgetManager.cloneWidget(e)}closeAll(){return Promise.all(this._contexts.map((e=>this._widgetManager.closeWidgets(e)))).then((()=>{}))}closeFile(e){const t=this._contextsForPath(e).map((e=>this._widgetManager.closeWidgets(e)));return Promise.all(t).then((e=>{}))}contextForWidget(e){return this._widgetManager.contextForWidget(e)}copy(e,t){return this.services.contents.copy(e,t)}createNew(e,t="default",n){return this._createOrOpenDocument("create",e,t,n)}deleteFile(e){return this.services.sessions.stopIfNeeded(e).then((()=>this.services.contents.delete(e))).then((()=>(this._contextsForPath(e).forEach((e=>this._widgetManager.deleteWidgets(e))),Promise.resolve(void 0))))}duplicate(e){const t=m.PathExt.dirname(e);return this.services.contents.copy(e,t)}findWidget(e,t="default"){const n=m.PathExt.normalize(e);let s=[t];if("default"===t){const e=this.registry.defaultWidgetFactory(n);if(!e)return;s=[e.name]}else null===t&&(s=this.registry.preferredWidgetFactories(n).map((e=>e.name)));for(const e of this._contextsForPath(n))for(const t of s)if(null!==t){const n=this._widgetManager.findWidget(e,t);if(n)return n}}newUntitled(e){return"file"===e.type&&(e.ext=e.ext||".txt"),this.services.contents.newUntitled(e)}open(e,t="default",n,s){return this._createOrOpenDocument("open",e,t,n,s)}openOrReveal(e,t="default",n,s){const r=this.findWidget(e,t);return r?(this._opener.open(r,{type:t,...s}),r):this.open(e,t,n,s??{})}overwrite(e,t){const n=`${t}.${L.UUID.uuid4()}`,s=()=>this.rename(n,t);return this.rename(e,n).then((()=>this.deleteFile(t))).then(s,s)}rename(e,t){return this.services.contents.rename(e,t)}_findContext(e,t){const n=this.services.contents.normalize(e);return(0,O.find)(this._contexts,(e=>e.path===n&&e.factoryName===t))}_contextsForPath(e){const t=this.services.contents.normalize(e);return this._contexts.filter((e=>e.path===t))}_createContext(e,t,n){const s=new $e({opener:(e,t)=>{this._widgetManager.adoptWidget(s,e),this._opener.open(e,t)},manager:this.services,factory:t,path:e,kernelPreference:n,setBusy:this._setBusy,sessionDialogs:this._dialogs,lastModifiedCheckMargin:this._lastModifiedCheckMargin,translator:this.translator}),r=new g.SaveHandler({context:s,isConnectedCallback:this._isConnectedCallback,saveInterval:this.autosaveInterval});return Te.saveHandlerProperty.set(s,r),s.ready.then((()=>{this.autosave&&r.start()})),s.disposed.connect(this._onContextDisposed,this),this._contexts.push(s),s}_onContextDisposed(e){O.ArrayExt.removeFirstOf(this._contexts,e)}_widgetFactoryFor(e,t){const{registry:n}=this;if("default"===t){const s=n.defaultWidgetFactory(e);if(!s)return;t=s.name}return n.getWidgetFactory(t)}_createOrOpenDocument(e,t,n="default",s,r){const i=this._widgetFactoryFor(t,n);if(!i)return;const a=i.modelName||"text",o=this.registry.getModelFactory(a);if(!o)return;const l=this.registry.getKernelPreference(t,i.name,s);let c,d=Promise.resolve(void 0);if("open"===e)c=this._findContext(t,o.name)||null,c||(c=this._createContext(t,o,l),d=this._when.then((()=>c.initialize(!1))));else{if("create"!==e)throw new Error(`Invalid argument 'which': ${e}`);c=this._createContext(t,o,l),d=this._when.then((()=>c.initialize(!0)))}const h=this._widgetManager.createWidget(i,c);return this._opener.open(h,{type:i.name,...r}),d.catch((e=>{console.error(`Failed to initialize the context with '${o.name}' for ${t}`,e),h.close()})),h}_onActivateRequested(e,t){this._activateRequested.emit(t)}_onWidgetStateChanged(e,t){"confirmClosingDocument"===t.name&&this._stateChanged.emit(t)}translator;_activateRequested=new M.Signal(this);_contexts=[];_opener;_widgetManager;_isDisposed=!1;_autosave=!0;_autosaveInterval=120;_lastModifiedCheckMargin=500;_renameUntitledFileOnSave=!0;_when;_setBusy;_dialogs;_isConnectedCallback;_stateChanged=new M.Signal(this)}!function(e){e.saveHandlerProperty=new Se.AttachedProperty({name:"saveHandler",create:()=>{}})}(Te||(Te={}));var Ue,Je=n(83895),qe=n(66274),Xe=n(41074),Ge=n(45683),Ye=n(77177),Qe=n(68827),et=n(19767),tt=n(76797),nt=n(24608),st=n.n(nt),rt=n(38332);!function(e){e.createConsole="@datalayer/jupyter-kernels:new-browser-console",e.createNotebook="@datalayer/jupyter-kernels:new-browser-notebook"}(Ue||(Ue={}));const it={id:"@datalayer/jupyter-kernels:browser-localforage",autoStart:!1,requires:[i.IDatalayer],provides:Ye.ILocalForage,activate:async(e,t)=>(await vt(t),{localforage:st()})},at={id:"@datalayer/jupyter-kernels:browser-localforage-memory-storage",autoStart:!0,requires:[Ye.ILocalForage],activate:async(e,t)=>{JSON.parse(m.PageConfig.getOption("enableMemoryStorage")||"false")&&(console.warn("Memory storage fallback enabled: contents and settings may not be saved"),await(0,Ye.ensureMemoryStorage)(t.localforage))}},ot={id:"@datalayer/jupyter-kernels:browser-contents",requires:[Ye.ILocalForage],autoStart:!1,provides:Xe.IContents,activate:(e,t)=>{const n=m.PageConfig.getOption("contentsStorageName"),s=JSON.parse(m.PageConfig.getOption("contentsStorageDrivers")||"null"),{localforage:r}=t,i=new Xe.Contents({storageName:n,storageDrivers:s,localforage:r});return e.started.then((()=>i.initialize().catch(console.warn))),i}},lt={id:"@datalayer/jupyter-kernels:browser-contents-routes",autoStart:!0,requires:[de,Xe.IContents],activate:(e,t,n)=>{t.get("/api/contents/(.+)/checkpoints",(async(e,t)=>{const s=await n.listCheckpoints(t);return new Response(JSON.stringify(s))})),t.post("/api/contents/(.+)/checkpoints/(.*)",(async(e,t,s)=>{const r=await n.restoreCheckpoint(t,s);return new Response(JSON.stringify(r),{status:204})})),t.post("/api/contents/(.+)/checkpoints",(async(e,t)=>{const s=await n.createCheckpoint(t);return new Response(JSON.stringify(s),{status:201})})),t.delete("/api/contents/(.+)/checkpoints/(.*)",(async(e,t,s)=>{const r=await n.deleteCheckpoint(t,s);return new Response(JSON.stringify(r),{status:204})})),t.get("/api/contents(.*)",(async(e,t)=>{const s={content:"1"===e.query?.content},r=await n.get(t,s);return r?new Response(JSON.stringify(r)):new Response(null,{status:404})})),t.post("/api/contents(.*)",(async(e,t)=>{const s=e.body,r=s?.copy_from;let i;return i=r?await n.copy(r,t):await n.newUntitled(s),i?new Response(JSON.stringify(i),{status:201}):new Response(null,{status:400})})),t.patch("/api/contents(.*)",(async(e,t)=>{const s=e.body?.path??"";t="/"===t[0]?t.slice(1):t;const r=await n.rename(t,s);return new Response(JSON.stringify(r))})),t.put("/api/contents/(.+)",(async(e,t)=>{const s=e.body,r=await n.save(t,s);return new Response(JSON.stringify(r))})),t.delete("/api/contents/(.+)",(async(e,t)=>(await n.delete(t),new Response(null,{status:204}))))}};class ct{constructor(e){const t=e?.workerUrl??m.URLExt.join(m.PageConfig.getBaseUrl(),Qe.WORKER_NAME);this.initialize(t).catch(console.warn)}get registrationChanged(){return this._registrationChanged}get enabled(){return null!==this._registration}get ready(){return this._ready.promise}async initialize(e){const{serviceWorker:t}=navigator;let n=null;if(t?t.controller&&(n=await t.getRegistration(t.controller.scriptURL)||null,console.info("JupyterLite ServiceWorker was already registered")):console.warn("ServiceWorkers not supported in this browser"),!n&&t)try{const s=await t.getRegistrations();await Promise.all(s.map((e=>e.unregister()))),console.info("Existing JupyterLite ServiceWorkers unregistered"),console.info("Registering new JupyterLite ServiceWorker",e),n=await t.register(e,{scope:m.PageConfig.getBaseUrl()}),console.info("JupyterLite ServiceWorker was successfully registered")}catch(e){console.warn(e),console.warn(`JupyterLite ServiceWorker registration unexpectedly failed: ${e}`)}this.setRegistration(n),n?this._ready.resolve(void 0):this._ready.reject(void 0)}setRegistration(e){this._registration=e,this._registrationChanged.emit(this._registration)}_registration=null;_registrationChanged=new M.Signal(this);_ready=new L.PromiseDelegate}const dt={id:"@datalayer/jupyter-kernels:browser-service-worker",autoStart:!1,provides:Qe.IServiceWorkerManager,requires:[i.IDatalayer],activate:async(e,t)=>(await vt(t),new ct({workerUrl:m.URLExt.join(m.PageConfig.getBaseUrl(),"jupyter_kernels/service-worker",Qe.WORKER_NAME)}))},ht={id:"@datalayer/jupyter-kernels:emscripten-filesystem",autoStart:!1,requires:[ce,de],optional:[Qe.IServiceWorkerManager],provides:Xe.IBroadcastChannelWrapper,activate:(e,t,n,s)=>{const{contents:r}=t.browser??{};if(!r)throw new Error("Unable to activate emscripten-filesystem plugin without the browser service manager.");const i=new Xe.BroadcastChannelWrapper({contents:r}),a="Kernel filesystem and JupyterLite contents";function o(e,t){t&&console.warn(t),e&&console.warn(e),t||e?console.warn(`${a} will NOT be synced`):console.info(`${a} will be synced`)}return s?s.ready.then((()=>{i.enable(),o()})).catch((e=>{o("JupyterLite ServiceWorker failed to become available",e)})):o("JupyterLite ServiceWorker not available"),i}},ut={id:"@datalayer/jupyter-kernels:browser-kernels",autoStart:!1,provides:Ge.IKernels,requires:[Ge.IKernelSpecs],activate:(e,t)=>new Ge.Kernels({kernelspecs:t})},pt={id:"@datalayer/jupyter-kernels:browser-kernels-routes",autoStart:!0,requires:[de,Ge.IKernels],activate:(e,t,n)=>{t.get("/api/kernels",(async e=>{const t=await n.list();return new Response(JSON.stringify(t))})),t.post("/api/kernels/(.*)/restart",(async(e,t)=>{const s=await n.restart(t);return new Response(JSON.stringify(s))})),t.delete("/api/kernels/(.*)",(async(e,t)=>{const s=await n.shutdown(t);return new Response(JSON.stringify(s),{status:204})}))}},mt={id:"@datalayer/jupyter-kernels:browser-kernelspec",autoStart:!1,provides:Ge.IKernelSpecs,requires:[i.IDatalayer],optional:[w.ITranslator,f.ILauncher],activate:async(e,t,n,s)=>{await vt(t);const r=new Ge.KernelSpecs,i=(n??w.nullTranslator).load("datalayer");if(s){let e=null,t=new Me.DisposableSet;new tt.Poll({factory:async()=>{const n=r.specs;L.JSONExt.deepEqual(e,n)||(t.dispose(),e=n,t=new Me.DisposableSet,Object.values(e?.kernelspecs??{}).map((e=>{if(e){const n=e.resources["logo-svg"]||e.resources["logo-64x64"];t.add(s.add({command:Ue.createConsole,args:{isLauncher:!0,kernelName:`browser-${e.name}`},category:i.__("Console"),kernelIconUrl:n,metadata:{kernel:L.JSONExt.deepCopy(e.metadata||{})}})),t.add(s.add({command:Ue.createNotebook,args:{isLauncher:!0,kernelName:`browser-${e.name}`},category:i.__("Notebook"),kernelIconUrl:n,metadata:{kernel:L.JSONExt.deepCopy(e.metadata||{})}}))}})))}})}return r}},gt={id:"@datalayer/jupyter-kernels:browser-kernelspec-routes",autoStart:!0,requires:[de,Ge.IKernelSpecs],activate:(e,t,n)=>{t.get("/api/kernelspecs",(async e=>{const{specs:t}=n;if(!t)return new Response(null);const s={},r=t.kernelspecs;Object.keys(r).forEach((e=>{const t=r[e],{resources:n}=t??{};s[e]={name:e,spec:t,resources:n}}));const i={default:t.default,kernelspecs:s};return new Response(JSON.stringify(i))}))}},ft={id:"@datalayer/jupyter-kernels:browser-sessions",autoStart:!1,provides:et.ISessions,requires:[Ge.IKernels],activate:(e,t)=>new et.Sessions({kernels:t})},_t={id:"@datalayer/jupyter-kernels:browser-sessions-routes",autoStart:!0,requires:[de,et.ISessions],activate:(e,t,n)=>{t.get("/api/sessions/(.+)",(async(e,t)=>{const s=await n.get(t);return new Response(JSON.stringify(s),{status:200})})),t.get("/api/sessions",(async e=>{const t=await n.list();return new Response(JSON.stringify(t),{status:200})})),t.patch("/api/sessions(.*)",(async(e,t)=>{const s=e.body,r=await n.patch(s);return new Response(JSON.stringify(r),{status:200})})),t.delete("/api/sessions/(.+)",(async(e,t)=>(await n.shutdown(t),new Response(null,{status:204})))),t.post("/api/sessions",(async e=>{const t=e.body,s=await n.startNew(t);return new Response(JSON.stringify(s),{status:201})}))}};class wt{constructor(e){this._stream=new M.Stream(this),this._serverSettings=e.serverSettings}async emit(e){}dispose(){}get isDisposed(){return!0}get stream(){return this._stream}get serverSettings(){return this._serverSettings}_stream;_serverSettings}const yt=[ot,lt,{id:"@datalayer/jupyter-kernels:browser-manager",requires:[ce,i.IDatalayer],optional:[w.ITranslator,u.ILabStatus],provides:de,autoStart:!1,activate:async(e,t,n,s,r)=>{await vt(n);const i=(s??w.nullTranslator).load("jupyterlab"),a=new Qe.Router,o={...qe.ServerConnection.makeSettings(),WebSocket:rt.WebSocket,fetch:async(e,t)=>{if(!(e instanceof Request))throw Error("Request info is not a Request");try{return a.route(e)}catch(n){if(n.message.startsWith("Cannot route"))return console.log(`No browser route for ${e.method} ${e.url}`),fetch(e,t);throw n}}},l=t.browser=new qe.ServiceManager({standby:"never",serverSettings:o,events:new wt({serverSettings:o})});let c=0;return e.commands.addCommand(Ue.createConsole,{label:e=>{const t=e.kernelName||"";if(e.isLauncher&&t&&l.kernelspecs){const e=t.startsWith("browser-")?t.slice(8):t;return l.kernelspecs.specs?.kernelspecs[e]?.display_name??e}return e.isPalette||e.isContextMenu?i.__("New Console"):i.__("Console")},caption:i.__("Create a new console"),icon:e=>e.isPalette?void 0:y.consoleIcon,execute:n=>{const s=c++;let a=n.path;return a||(a=m.PathExt.join(n.basePath||"",`console-browser-${s}-${L.UUID.uuid4()}`)),n.sessionContext=new We({sessionManager:t.sessions,specsManager:t.kernelspecs,path:t.contents.localPath(a),name:n.name||i.__("Console %1",s),type:"console",kernelPreference:n.kernelPreference,setBusy:r?()=>r.setBusy():void 0},t),e.commands.execute("console:create",n)}}),e.commands.addCommand(Ue.createNotebook,{label:e=>{const t=e.kernelName||"";if(e.isLauncher&&t&&l.kernelspecs){const e=t.startsWith("browser-")?t.slice(8):t;return l.kernelspecs.specs?.kernelspecs[e]?.display_name??e}return e.isPalette||e.isContextMenu?i.__("New Notebook"):i.__("Notebook")},caption:i.__("Create a new notebook"),icon:e=>e.isPalette?void 0:y.notebookIcon,execute:t=>e.commands.execute("notebook:create-new",t)}),a}},ht,ut,pt,mt,gt,at,it,dt,ft,_t];async function vt(e){if(await e.ready,!1!==e.configuration.configuration?.whiteLabel)throw new Error("Browser kernel is not included in white labelled package.")}const xt=new a.zZ({name:"@datalayer/icons:browser",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 122.88 115.33" fill="currentColor" aria-hidden="true">\n  <path d="M76.98 97.89c-3.62 4.01-7.79 7.99-12.51 11.94 1.28-.17 2.56-.38 3.81-.62 3.42-.69 6.71-1.7 9.89-3.08.82-.35 1.62-.72 2.41-1.1.59.76 1.25 1.42 1.96 1.98.77.61 1.59 1.09 2.45 1.45-1.58.85-3.2 1.62-4.86 2.34a55.262 55.262 0 01-10.9 3.39c-3.74.76-7.61 1.14-11.59 1.14-3.98 0-7.82-.38-11.59-1.14-3.7-.73-7.26-1.83-10.76-3.32-.03 0-.1-.03-.14-.07a62.287 62.287 0 01-9.82-5.33 54.495 54.495 0 01-8.51-6.99 52.856 52.856 0 01-6.99-8.51c-2.08-3.08-3.84-6.37-5.33-9.82a55.262 55.262 0 01-3.39-10.9A60.34 60.34 0 010 57.66c0-3.98.38-7.82 1.14-11.59.73-3.7 1.83-7.26 3.32-10.76 0-.03.03-.1.07-.14 1.49-3.49 3.29-6.75 5.33-9.82 2.04-3.08 4.39-5.92 6.99-8.51 2.59-2.63 5.43-4.95 8.51-6.99 3.08-2.08 6.36-3.84 9.82-5.33 3.53-1.52 7.16-2.63 10.9-3.39C49.81.38 53.69 0 57.66 0c3.98 0 7.82.38 11.59 1.14 3.7.73 7.26 1.83 10.76 3.32.03 0 .1.03.14.07 3.46 1.49 6.75 3.29 9.82 5.33 3.08 2.04 5.92 4.39 8.51 6.99 2.63 2.59 4.95 5.43 6.99 8.51 2.08 3.08 3.84 6.37 5.33 9.82 1.52 3.53 2.63 7.16 3.39 10.9.43 2.12.74 4.28.93 6.48l-5.23-1.39c-.16-1.38-.37-2.74-.64-4.09-.69-3.42-1.7-6.71-3.08-9.89-.86-2.04-1.83-3.98-2.91-5.85H86.38c3 5.13 5.16 10.23 6.47 15.32l-5.68-1.51c-1.48-4.56-3.71-9.16-6.71-13.81H60.19v9.39c-.36.21-.72.46-1.07.74a8.25 8.25 0 00-1.73 1.83 9.07 9.07 0 00-1.06 2.11c-.27.77-.43 1.54-.49 2.29-.05.64-.03 1.3.07 1.95.08.54.2 1.07.38 1.59l.05.14c.04.11.08.22.12.32.06.17.11.27.13.32l.02-.01 3.63 8.17h-.06v23.8H70.8l2.24 5.05H60.19v17.78c5.65-4.64 10.5-9.32 14.54-14.01l2.25 5.09zm38.16.08c-.34.34-.74.6-1.16.79-.44.2-.91.32-1.38.36a3.99 3.99 0 01-1.53-.17c-.48-.15-.94-.4-1.35-.74L98.63 88.8l-3.81 9.35c-.32.78-.7 1.5-1.13 2.15a8.62 8.62 0 01-1.44 1.68c-.41.36-.86.67-1.33.9-.47.23-.95.38-1.45.45-.58.08-1.16.04-1.72-.12-.54-.16-1.06-.42-1.56-.81-.4-.31-.77-.71-1.12-1.19-.32-.44-.61-.96-.88-1.56-7.22-16.27-15.83-33.78-22.27-50.16a3.137 3.137 0 01-.02-2.15c.09-.25.21-.5.36-.72.08-.11.16-.22.26-.31.08-.08.17-.16.27-.23.18-.14.37-.26.57-.36l.05-.02c.19-.09.39-.16.58-.2l.09-.02c.18-.04.36-.06.54-.07.21-.01.41.01.61.04l.21.03c17.64 4.38 35.38 9.38 52.98 14.05.63.17 1.19.38 1.68.62.53.27.98.57 1.35.91.46.42.81.9 1.05 1.41.25.53.38 1.1.39 1.69v.01c.01.5-.06 1-.21 1.5s-.38.98-.68 1.45c-.37.58-.85 1.16-1.43 1.69-.56.52-1.22 1.01-1.95 1.46-2.89 1.7-5.77 3.5-8.64 5.24l11.05 9.47c.4.35.72.76.94 1.21l.03.08c.21.45.34.92.38 1.41.04.49-.01 1-.16 1.5-.14.47-.37.93-.69 1.34-1.69 2.08-4.52 5.72-6.39 7.45zm-2.9-3.63l5.35-6.28-13-11.14-.07-.07c-.06-.06-.13-.13-.18-.19a1.61 1.61 0 01-.21-.3c-.33-.54-.4-1.16-.26-1.73.14-.57.5-1.09 1.04-1.41 3.76-2.07 7.64-4.66 11.35-6.89.43-.26.81-.55 1.13-.84.3-.28.55-.56.72-.83.07-.11.12-.2.15-.29-.08-.06-.17-.11-.3-.17-.19-.09-.44-.17-.73-.25L67.51 50.77 88.39 97.8c.12.26.24.49.37.68l.03.05c.07.09.13.17.18.22.08-.04.16-.11.26-.2.24-.21.48-.5.7-.84.24-.36.46-.79.65-1.27l5-12.28.05-.1c.04-.08.08-.16.12-.23l.03-.05c.05-.08.11-.16.18-.24a2.293 2.293 0 013.23-.26l13.05 11.06zm-61.35 15.49c-8.16-6.85-14.7-13.77-19.54-20.79H15.39c1.52 2.08 3.22 4.01 5.05 5.85 2.39 2.39 4.95 4.5 7.75 6.36 2.77 1.87 5.78 3.49 9.03 4.88.03.03.07.03.1.07 3.15 1.31 6.4 2.35 9.79 3.01 1.25.24 2.53.45 3.8.62h-.02zM12.07 83.99h16.05c-4.46-7.82-6.88-15.77-7.16-23.8H5.12c.14 2.77.45 5.43.97 8.06.69 3.42 1.69 6.71 3.08 9.89.86 2.04 1.83 3.98 2.9 5.85zM5.12 55.14h15.95c.59-7.89 3.22-15.81 7.89-23.8H12.07c-1.07 1.87-2.04 3.8-2.91 5.85-.03.03-.03.07-.07.1-1.31 3.15-2.35 6.4-3.01 9.79-.51 2.63-.86 5.29-.96 8.06zm10.24-28.85h16.85c4.81-6.92 11.14-13.87 19.03-20.86-1.42.17-2.8.38-4.15.66-3.42.69-6.71 1.7-9.89 3.08a55.79 55.79 0 00-9.03 4.88c-2.8 1.87-5.36 3.98-7.75 6.36-1.83 1.83-3.53 3.77-5.05 5.85l-.01.03zM64.1 5.43c7.92 6.99 14.25 13.94 19.03 20.86h16.85c-1.52-2.08-3.22-4.01-5.05-5.85-2.39-2.39-4.95-4.5-7.75-6.37-2.77-1.87-5.78-3.49-9.03-4.88-.03-.03-.07-.03-.1-.07-3.15-1.31-6.4-2.35-9.79-3.01-1.38-.28-2.77-.48-4.15-.66v-.02h-.01zm-3.91 3.29v17.57h16.74c-4.39-5.81-9.96-11.66-16.74-17.57zm-5.05 98.1V89.04H37.53c4.53 5.95 10.41 11.9 17.61 17.78zm0-22.83v-23.8H26.01c.31 7.99 3.01 15.91 7.99 23.8h21.14zm0-28.85v-23.8H34.87c-5.19 8.06-8.09 15.98-8.75 23.8h29.02zm0-28.85V8.72c-6.78 5.92-12.35 11.76-16.74 17.57h16.74z"/>\n</svg>\n'}),kt=new a.zZ({name:"@datalayer/icons:laptop-simple",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 1024 1024" fill="currentColor" aria-hidden="true">\n  <path d="M956.9 845.1L896.4 632V168c0-17.7-14.3-32-32-32h-704c-17.7 0-32 14.3-32 32v464L67.9 845.1C60.4 866 75.8 888 98 888h828.8c22.2 0 37.6-22 30.1-42.9zM200.4 208h624v395h-624V208zm228.3 608l8.1-37h150.3l8.1 37H428.7zm224 0l-19.1-86.7c-.8-3.7-4.1-6.3-7.8-6.3H398.2c-3.8 0-7 2.6-7.8 6.3L371.3 816H151l42.3-149h638.2l42.3 149H652.7z"/>\n</svg>\n'});var bt=n(9859),jt=n(33142),Ct=n(12828);const St="jp-mod-kernel";var Mt;!function(e){e.kernelNewConsole="running:kernel-new-console",e.kernelNewNotebook="running:kernel-new-notebook",e.kernelOpenSession="running:kernel-open-session",e.kernelShutDown="running:kernel-shut-down",e.showPanel="running:show-panel"}(Mt||(Mt={}));const Et={activate:function(e,t,n,s,r,i){const a=t.load("jupyterlab"),l=new bt.RunningSessionManagers,c=new bt.RunningSessions(l,t);return c.id="jp-running-sessions",c.title.caption=a.__("Running Terminals and Kernels"),c.title.icon=y.runningIcon,c.node.setAttribute("role","region"),c.node.setAttribute("aria-label",a.__("Running Sessions section")),r&&r.add(c,"running-sessions"),i&&(0,Ct.w)(l,t,i),s.ready.finally((()=>{!1===s.configuration.configuration?.whiteLabel?function(e,t,n,s){n.ready.then((()=>async function(e,t,n,s){const{commands:r,contextMenu:i}=e,a=new M.Signal({}),l=new tt.Throttler((()=>a.emit()),100),c=s.load("jupyterlab"),d=()=>l.invoke().catch((e=>{console.error("Failed to refresh the running kernels.",e)}));n.local.kernels.runningChanged.connect(d),n.local.sessions.runningChanged.connect(d);const h=()=>{d(),n.remote?.servers.changed.connect(d)};h(),n.remoteChanged.connect(h);const u=()=>{d(),n.browser?.kernels.runningChanged.connect(d),n.browser?.sessions.runningChanged.connect(d)};u(),n.browserChanged.connect(u),t.add({name:c.__("Kernels"),running:()=>{const e=[new Dt({commands:r,location:"local",kernelspecs:n.local.kernelspecs,kernels:n.local.kernels,sessions:n.local.sessions,trans:c})];return n.remote||e.push(Object.freeze({label:()=>"remote",labelTitle:()=>"Click to connect",detail:()=>"Disconnected",icon:()=>o,open:()=>{r.execute("@datalayer/jupyter-kernels:create-widget")}})),n.browser&&e.push(new Dt({commands:r,location:"browser",kernelspecs:n.browser?.kernelspecs,kernels:n.browser?.kernels,sessions:n.browser?.sessions,trans:c})),e},shutdownAll:()=>Promise.all([n.local.kernels.shutdownAll(),n.remote?.servers.shutdownAll(),n.browser?.kernels.shutdownAll()]),refreshRunning:()=>Promise.all([n.local.kernels.refreshRunning(),n.local.sessions.refreshRunning(),n.remote?.servers.refresh(),n.browser?.kernels.refreshRunning(),n.browser?.sessions.refreshRunning()]),runningChanged:a,shutdownLabel:c.__("Shut Down Kernel"),shutdownAllLabel:c.__("Shut Down All"),shutdownAllConfirmationText:c.__("Are you sure you want to permanently shut down all running kernels?")});const p=e=>e.classList.contains(St);r.addCommand(Mt.kernelNewConsole,{icon:y.consoleIcon,label:c.__("New Console for Kernel"),execute:t=>{const n=e.contextMenuHitTest(p),s=t.id??n?.dataset.context;if(s)return r.execute("console:create",{kernelPreference:{id:s}})}}),r.addCommand(Mt.kernelNewNotebook,{icon:y.notebookIcon,label:c.__("New Notebook for Kernel"),execute:t=>{const n=e.contextMenuHitTest(p),s=t.id??n?.dataset.context;if(s)return r.execute("notebook:create-new",{kernelId:s})}}),r.addCommand(Mt.kernelOpenSession,{icon:e=>"console"===e.type?y.consoleIcon:"notebook"===e.type?y.notebookIcon:void 0,isEnabled:({path:e,type:t})=>!!t||void 0!==e,label:({name:e,path:t})=>e||m.PathExt.basename(t||c.__("Unknown Session")),execute:({path:e,type:t})=>{if(!t||void 0===e)return;const n="console"===t?"console:open":"docmanager:open";return r.execute(n,{path:e})}}),r.addCommand(Mt.kernelShutDown,{icon:y.closeIcon,label:c.__("Shut Down Kernel"),execute:t=>{const s=e.contextMenuHitTest(p),r=t.id??s?.dataset.context;if(r)return Promise.all([n.local.kernels.findById(r).then((()=>n.local.kernels.shutdown(r))),n.remote?.servers.findById(r).then((()=>n.remote?.servers.shutdown(r))),n.browser?.kernels.findById(r).then((()=>n.browser?.kernels.shutdown(r)))])}});const g=[];i.opened.connect((async()=>{const t=i.menu.items.find((e=>"submenu"===e.type&&"jp-contextmenu-connected-sessions"===e.submenu?.id))?.submenu??null;if(!t)return;g.forEach((e=>e.dispose())),g.length=0,t.clearItems();const s=e.contextMenuHitTest(p),r=s?.dataset.context;if(!r)return;const a=Mt.kernelOpenSession;for(const e of Array.from(n.local.sessions.running()).concat(Array.from(n.browser?.sessions.running()??[])))if(r===e.kernel?.id){const{name:n,path:s,type:r}=e;g.push(t.addItem({command:a,args:{name:n,path:s,type:r}}))}}))}(e,t,n,s))).catch((e=>{console.error("The services manager failed to initialize.",e)}))}(e,l,n,t):(0,jt.i)(l,t,e)})),e.shell.add(c,"left",{rank:200,type:"Sessions and Tabs"}),e.commands.addCommand(Mt.showPanel,{label:a.__("Sessions and Tabs"),execute:()=>{e.shell.activateById(c.id)}}),l},id:"@datalayer/jupyter-kernels:running",description:"Provides the running session managers.",provides:bt.IRunningSessionManagers,requires:[w.ITranslator,ce,i.IDatalayer],optional:[u.ILayoutRestorer,u.ILabShell],autoStart:!0},Ft={browser:xt,local:kt,remote:o};class Dt{commands;kernelspecs;kernels;sessions;trans;constructor({commands:e,location:t,kernelspecs:n,kernels:s,sessions:r,trans:i}){this.commands=e,this.context=t,this.kernelspecs=n,this.kernels=s,this.sessions=r,this.trans=i}get children(){return Array.from(this.kernels.running()).map((e=>new Rt({commands:this.commands,kernel:e,kernels:this.kernels,sessions:this.sessions,spec:this.kernelspecs.specs?.kernelspecs[e.name],trans:this.trans})))}get className(){return this.kernels.running().next().done?"dla-kernels-empty-group":"dla-kernels-group"}context;open(){"remote"===this.context&&this.commands.execute("@datalayer/jupyter-kernels:create-widget")}shutdown(){this.kernels.shutdownAll().catch((e=>{console.error(`Failed to shutdown all kernels on ${this.context} location.`,e)}))}icon(){return Ft[this.context]}label(){return this.context}detail(){switch(this.context){case"browser":return function(){const e=e=>e.test(navigator.userAgent);return e(/opr\//i)?"Opera":e(/edg/i)?"Microsoft Edge":e(/chrome|chromium|crios/i)?"Google Chrome":e(/firefox|fxios/i)?"Mozilla Firefox":e(/safari/i)?"Apple Safari":e(/trident/i)?"Microsoft Internet Explorer":e(/ucbrowser/i)?"UC Browser":e(/samsungbrowser/i)?"Samsung Browser":"Unknown browser"}();case"local":case"remote":try{return new URL(this.kernels.serverSettings.baseUrl).hostname}catch(e){return""}}return""}}class Rt{constructor(e){this.className=St,this.commands=e.commands,this.kernel=e.kernel,this.context=this.kernel.id,this.kernels=e.kernels,this.sessions=e.sessions,this.spec=e.spec||null,this.trans=e.trans}className;context;commands;kernel;kernels;sessions;spec;trans;get children(){const e=[],t=Mt.kernelOpenSession,{commands:n}=this;for(const s of this.sessions.running())if(this.kernel.id===s.kernel?.id){const{name:r,id:i,path:a,type:o}=s;e.push({className:"ITEM_CLASS",context:this.kernel.id,open:()=>{n.execute(t,{name:r,path:a,type:o})},icon:()=>"console"===o?y.consoleIcon:"notebook"===o?y.notebookIcon:y.jupyterIcon,label:()=>r,labelTitle:()=>a,detail:()=>i})}return e}shutdown(){return this.kernels.shutdown(this.kernel.id)}icon(){const{spec:e}=this;return e&&e.resources?e.resources["logo-svg"]||e.resources["logo-64x64"]||e.resources["logo-32x32"]:y.jupyterIcon}label(){const{kernel:e,spec:t}=this;return t?.display_name||e.name}labelTitle(){const{trans:e}=this,{id:t}=this.kernel,n=[`${this.label()}: ${t}`];for(const t of this.sessions.running())if(this.kernel.id===t.kernel?.id){const{path:s,type:r}=t;n.push(e.__("%1\nPath: %2",r,s))}return n.join("\n\n")}detail(){return this.kernel.id}}var Nt;!function(e){e.createWidget="@datalayer/jupyter-kernels:create-widget",e.launchRemoteKernel="@datalayer/jupyter-kernels:launch-remote"}(Nt||(Nt={}));const It={id:"@datalayer/jupyter-kernels:manager",description:"Provides the document manager.",provides:g.IDocumentManager,requires:[g.IDocumentWidgetOpener,p.ISessionContextDialogs],optional:[w.ITranslator,u.ILabStatus,u.JupyterLab.IInfo],activate:(e,t,n,s,r,i)=>{const{docRegistry:a}=e,o=s??w.nullTranslator,l=e.restored.then((()=>{}));return new Be({registry:a,manager:e.serviceManager,opener:t,when:l,setBusy:(r&&(()=>r.setBusy()))??void 0,sessionDialogs:n,translator:o??w.nullTranslator,isConnectedCallback:()=>!i||i.isConnected})}},Pt={id:"@datalayer/jupyter-kernels:service-manager",description:"Overrides the Jupyter service manager.",provides:ce,autoStart:!0,activate:e=>{const t=new Je.iq(e.serviceManager);return e.serviceManager=t,t}},Tt={id:"@datalayer/jupyter-kernels:sessionDialogs",description:"Provides the session context dialogs.",provides:p.ISessionContextDialogs,optional:[w.ITranslator],requires:[ce],autoStart:!0,activate:async(e,t,n)=>(document.body.dataset.portalRoot="true",new He({translator:n??w.nullTranslator},t))},Ot={id:"@datalayer/jupyter-kernels:plugin",autoStart:!0,requires:[i.IDatalayer,ce],optional:[_.ISettingRegistry,p.ICommandPalette,f.ILauncher,u.ILayoutRestorer],provides:he,activate:(e,t,n,s,i,a,u)=>{const{jupyterLabAdapter:g,serviceManager:f,setJupyterLabAdapter:_,setServiceManager:w}=b.SE.getState();g||_(h.JupyterLabAppAdapter.create(e)),f||w(n);let j=!1;const C=e=>{if(!e)return;if(!j){j=!0;const t=e.launcherCategory;i?.addItem({command:E,category:t});const n=e=>{const n=e.get("showInLauncher").composite;a&&n&&a.add({command:E,category:t,rank:5.4})};s&&s.load(Ot.id).then((e=>{console.log(`${Ot.id} settings loaded:`,e.composite),n(e),e.changed.connect(n)})).catch((e=>{console.error(`Failed to load settings for ${Ot.id}.`,e)}));const{token:r,logUser:o}=d.jpIAMStore.getState();r||o()}const{token:t}=d.jpIAMStore.getState();(0,Je.Ad)(n,e,t),d.jpIAMStore.subscribe(((t,s)=>{t.token&&t.token!==s.token&&(0,Je.Ad)(n,e,t.token)}))};C(t.configuration.configuration),t.configuration.configurationChanged.connect(((e,t)=>{C(t)}));const{commands:S}=e,M=new p.WidgetTracker({namespace:"jupyter-kernels"}),E=Nt.createWidget;return S.addCommand(E,{caption:"Show Jupyter Kernels",label:"Jupyter Kernels",icon:c,execute:()=>{const t=y.ReactWidget.create((0,r.jsx)(x.Z,{loadConfig:!1}));t.addClass("dla-Container");const n=new p.MainAreaWidget({content:t});n.title.label="Jupyter Kernels",n.title.icon=c,e.shell.add(n,"main"),M.add(n)}}),u&&u.restore(M,{command:E,name:()=>"@datalayer/jupyter-kernels"}),S.addCommand(Nt.launchRemoteKernel,{label:"Launch a Remote Kernel",caption:"Launch a Notebook with a Remote Kernel",icon:e=>e.isLauncher?y.notebookIcon:o,execute:async()=>{if(n.remote){const e=y.ReactWidget.create((0,r.jsx)(h.Jupyter,{startDefaultKernel:!1,disableCssLoading:!0,children:(0,r.jsx)(k.p,{manager:n.remote,onSubmit:async()=>{e.dispose(),await n.kernels.refreshRunning()},openDocument:"notebook"})}));v.Widget.attach(e,document.body),await(0,m.signalToPromise)(e.disposed)}else await S.execute(Nt.createWidget)}}),a&&a.add({command:Nt.launchRemoteKernel,category:"Notebook",kernelIconUrl:`data:image/svg+xml,${l.svgstr}`,rank:-1,args:{isLauncher:!0}}),console.log(`JupyterLab plugin ${Ot.id} is activated.`),{}}},Lt=[Ot,It,Pt,Tt,Et,N,je,Ce,...yt]},83895:(e,t,n)=>{n.d(t,{iq:()=>m,Ad:()=>g});var s=n(74901),r=n(1865),i=n(66274),a=n(97930),o=n(76797);function l(e,t,n){return i.ServerConnection.makeSettings({baseUrl:e,wsUrl:n||e.replace(/^http/,"ws"),token:t,appendToken:!0,init:{mode:"cors",credentials:"include",cache:"no-store"}})}function c(e,t,n){if(0!==e.indexOf(n.baseUrl))throw new Error("Can only be used for notebook server requests");"no-store"===(t.cache??n.init.cache)&&(e+=(/\?/.test(e)?"&":"?")+(new Date).getTime());const s=new n.Request(e,{...n.init,...t});let r=!1;if(n.token&&(r=!0,s.headers.append("Authorization",`Bearer ${n.token}`)),"undefined"!=typeof document){const e=function(e){let t="";try{t=document.cookie}catch(e){return}const n=t.match("\\b_xsrf=([^;]*)\\b");return n?.[1]}();void 0!==e&&(r=!0,s.headers.append("X-XSRFToken",e))}return!s.headers.has("Content-Type")&&r&&s.headers.set("Content-Type","application/json"),n.fetch.call(null,s).catch((e=>{throw new i.ServerConnection.NetworkError(e)}))}class d extends i.BaseManager{_changed=new s.Signal(this);_connectionFailure=new s.Signal(this);_environments=new Array;_isReady=!1;_poll;_ready=new a.PromiseDelegate;constructor({serverSettings:e,standby:t}){super({serverSettings:e}),this._poll=new o.Poll({auto:!1,factory:()=>this.requestEnvironments(),frequency:{interval:61e3,backoff:!0,max:3e5},name:"@datalayer/jupyter-kernels:EnvironmentsManager#environments",standby:t??"when-hidden"}),this._ready.promise.then((async()=>{await this._poll.start(),await this._poll.tick,this._isReady=!0})),this.requestEnvironments().then((()=>{this._ready.resolve()})).catch((e=>{console.error("Failed to fetch the remote environments.",e),this._ready.reject(e)}))}get changed(){return this._changed}get connectionFailure(){return this._connectionFailure}get isReady(){return this._isReady}get ready(){return this._ready.promise}dispose(){this.isDisposed||(this._poll.dispose(),super.dispose())}get(){return[...this._environments]}async refresh(){await this._poll.refresh(),await this._poll.tick}async requestEnvironments(){let e;try{e=await c(r.URLExt.join(this.serverSettings.baseUrl,"/api/operator/v1/jupyter/environments"),{},this.serverSettings)}catch(e){return void this._connectionFailure.emit(e)}if(!e.ok)throw i.ServerConnection.ResponseError.create(e);{const t=await e.json();t.success&&(a.JSONExt.deepEqual(this._environments,t.environments)||(this._environments=t.environments,this._changed.emit([...this._environments])))}}}class h{_isDisposed=!1;_ready;constructor({serverSettings:e,standby:t}){this.serverSettings=e;const n=this.kernels=new i.KernelManager({serverSettings:e,standby:t});this.kernelspecs=new i.KernelSpecManager({serverSettings:e,standby:t}),this.sessions=new i.SessionManager({kernelManager:n,serverSettings:e,standby:t}),this._ready=Promise.all([this.kernels.ready,this.kernelspecs.ready,this.sessions.ready]).then((()=>{}))}get isDisposed(){return this._isDisposed}kernels;kernelspecs;get ready(){return this._ready}serverSettings;sessions;dispose(){this.isDisposed||(this._isDisposed=!0,this.sessions.dispose(),this.kernels.dispose(),this.kernelspecs.dispose())}}class u extends i.BaseManager{_connectionFailure=new s.Signal(this);_kernels=new Array;_isReady=!1;_poll;_ready=new a.PromiseDelegate;_changed=new s.Signal(this);_kernelServers=new Map;constructor({serverSettings:e,standby:t}){super({serverSettings:e}),this._poll=new o.Poll({auto:!1,factory:()=>this.requestKernels(),frequency:{interval:61e3,backoff:!0,max:3e5},name:"@datalayer/jupyter-kernels:KernelManager#kernels",standby:t??"when-hidden"}),this._ready.promise.then((async()=>{await this._poll.start(),await this._poll.tick,this._isReady=!0})),this.requestKernels().then((()=>{this._ready.resolve()})).catch((e=>{console.error("Failed to fetch the remote kernel servers.",e),this._ready.reject(e)}))}get connectionFailure(){return this._connectionFailure}get isReady(){return this._isReady}get ready(){return this._ready.promise}get changed(){return this._changed}dispose(){this.isDisposed||(this._poll.dispose(),super.dispose())}get(){return[...this._kernels]}getServices(e){return this._kernelServers.get(e)}async refresh(){await this._poll.refresh(),await this._poll.tick}async startNew(e,t){if(this.isDisposed)throw new Error("Manager is disposed.");const n=await c(r.URLExt.join(this.serverSettings.baseUrl,`/api/operator/v1/jupyter/environment/${e.name}/kernel`),{method:"POST"},this.serverSettings);if(!n.ok)throw i.ServerConnection.ResponseError.create(n);const s=await n.json();if(!s.success||!s.kernel){const t=`Failed to create a kernel for the environment ${e.name}`;throw console.error(t,s),new Error(t)}const a=s.kernel.jupyter_pod_name,o=new h({serverSettings:l(s.kernel.ingress,s.kernel.token),standby:this._poll.standby});this._kernelServers.set(a,o),await o.ready;const d=o.kernels,u=Date.now();for(;d.running().next().done&&Date.now()-u<1e4;)await d.refreshRunning();const p=d.running().next();if(!p.done){const e=p.value;return d.connectTo({...t,model:e})}throw new Error(`No kernel running on server '${a}'.`)}async findById(e){for(const t of this._kernels)if(t.id===e)return t;await this.refresh();for(const t of this._kernels)if(t.id===e)return t}connectTo(e){const{model:{id:t}}=e;let n;for(const e of this._kernels)if(e.id===t){n=e;break}if(n){const t=this._kernelServers.get(n.jupyter_pod_name);if(t)return t.kernels.connectTo(e)}throw new Error("Unable to find the kernel.")}async shutdown(e){const t=await this.findById(e);if(t){const n=this._kernelServers.get(t.jupyter_pod_name);await(n?.kernels.shutdown(e)),await c(r.URLExt.join(this.serverSettings.baseUrl,`/api/operator/v1/jupyter/kernel/${t.jupyter_pod_name}`),{method:"DELETE"},this.serverSettings),n?.dispose(),this._kernelServers.delete(t.jupyter_pod_name)}}async shutdownAll(){await Promise.all(Array.from(this._kernelServers.entries()).map((async([e,t])=>{await t.kernels.shutdownAll(),await c(r.URLExt.join(this.serverSettings.baseUrl,`/api/operator/v1/jupyter/kernel/${e}`),{method:"DELETE"},this.serverSettings),t.dispose()}))),this._kernelServers.clear()}async requestKernels(){let e;try{e=await c(r.URLExt.join(this.serverSettings.baseUrl,"/api/operator/v1/jupyter/kernels"),{},this.serverSettings)}catch(e){return void this._connectionFailure.emit(e)}if(!e.ok)throw i.ServerConnection.ResponseError.create(e);{const t=await e.json();if(!t.success){const e="Failed to list the running kernel servers.";throw console.error(e,t),new Error(e)}{const e=t.kernels,n=e.map((e=>e.jupyter_pod_name)),s=Array.from(this._kernelServers.keys());for(const t of e)if(!s.includes(t.jupyter_pod_name)){const e=new h({serverSettings:l(t.ingress,t.token),standby:this._poll.standby});this._kernelServers.set(t.jupyter_pod_name,e),await e.ready}const r=await Promise.all(Array.from(this._kernelServers.entries()).map((async([t,s])=>{if(n.includes(t)){const n=s.kernels.running().next();if(!n.done)return{...e.find((e=>e.jupyter_pod_name===t)),...n.value};console.warn(`Kernel in pod ${t} died.`)}else await s.kernels.shutdownAll(),s.dispose(),this._kernelServers.delete(t),console.info(`Removing ghost server ${t}`)})));this._kernels=r.filter((e=>!!e))}}}}class p{_isDisposed=!1;_isReady=!1;_ready;constructor({serverSettings:e,standby:t}){this.serverSettings=e,this.environments=new d({serverSettings:e,standby:t}),this.servers=new u({serverSettings:e,standby:t}),this._ready=Promise.all([this.environments.ready,this.servers.ready]).then((()=>{})),this._ready.then((()=>{this._isReady=!0}))}environments;servers;serverSettings;get isDisposed(){return this._isDisposed}get isReady(){return this._isReady}get ready(){return this._ready}dispose(){this.isDisposed||(this._isDisposed=!0,this.environments.dispose(),this.servers.dispose())}}class m{_browserServices;_localServices;_remoteServices;_browserChanged=new s.Signal(this);_remoteChanged=new s.Signal(this);constructor(e){this._localServices=e}get browser(){return this._browserServices}set browser(e){this._browserServices=e,this._browserChanged.emit(this._browserServices)}get browserChanged(){return this._browserChanged}get local(){return this._localServices}get remote(){return this._remoteServices}set remote(e){this._remoteServices=e,this._remoteChanged.emit(this._remoteServices)}get remoteChanged(){return this._remoteChanged}get isReady(){return this._localServices.isReady}get ready(){return this._localServices.ready}get connectionFailure(){return this._localServices.connectionFailure}get isDisposed(){return this._localServices.isDisposed}get builder(){return this._localServices.builder}get contents(){return this._localServices.contents}get events(){return this._localServices.events}get serverSettings(){return this._localServices.serverSettings}get sessions(){return this._localServices.sessions}get kernels(){return this._localServices.kernels}get kernelspecs(){return this._localServices.kernelspecs}get settings(){return this._localServices.settings}get terminals(){return this._localServices.terminals}get user(){return this._localServices.user}get workspaces(){return this._localServices.workspaces}get nbconvert(){return this._localServices.nbconvert}dispose(){this._localServices.dispose()}}async function g(e,t,n){e.remote?.serverSettings.baseUrl===t?.apiServerUrl&&n||e.remote&&(e.remote.dispose(),e.remote=void 0),n&&t?.apiServerUrl&&!e.remote&&(e.remote=new p({serverSettings:l(t.apiServerUrl,n)}))}},83513:(e,t,n)=>{n.d(t,{SE:()=>i,ZP:()=>a});var s=n(19992),r=n(75489);const i=(0,s.M)(((e,t)=>({setJupyterLabAdapter:t=>{e((e=>({jupyterLabAdapter:t})))},tab:0,getIntTab:()=>Math.floor(t().tab),setTab:t=>e((e=>({tab:t}))),serviceManager:void 0,setServiceManager:t=>{e((e=>({serviceManager:t})))},showDisclaimer:!0,setShowDisclaimer:t=>{e((e=>({showDisclaimer:t})))}}))),a=function(e){return(0,r.useStore)(i,e)}},65693:(e,t,n)=>{n.d(t,{l:()=>s});const s=async({app:e,name:t,url:n,options:s})=>{const r=await e.commands.execute("notebook:create-new",s);if(t&&r.context.rename(t+".ipynb"),n){const e=await fetch(n),t=(await e.text()).replaceAll("\n","\n");r.context.model.fromJSON({...JSON.parse(t)})}}}}]);