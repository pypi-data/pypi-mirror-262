"use strict";(self.webpackChunk_datalayer_jupyter_iam=self.webpackChunk_datalayer_jupyter_iam||[]).push([[8660],{21780:(e,t,r)=>{r.d(t,{Dt:()=>f,c7:()=>d,hV:()=>m,mB:()=>u,vF:()=>h});var a=r(89697),n=r.n(a),l=r(53761),s=r(67048);const i="DATALAYER_IAM_USER_KEY",o="DATALAYER_IAM_TOKEN_KEY",c="refresh_token",d=e=>{if(e){const t={handle:e.handle,firstName:e.firstName,lastName:e.lastName,email:e.email,displayName:e.displayName,joinDate:e.joinDate,roles:e.roles};window.localStorage.setItem(i,JSON.stringify(t))}else window.localStorage.removeItem(i)},h=()=>{const e=window.localStorage.getItem(i);if(e)try{const t=JSON.parse(e);return t.joinDate=new Date(t.joinDate),t}catch(e){return l.aK}return l.aK},u=e=>{if(e){if(localStorage.setItem(o,e),e!==l.q$)try{n()(e)}catch(e){console.error(e)}}else window.localStorage.removeItem(o)},m=()=>window.localStorage.getItem(o)||l.q$;function f(){return(0,s.getCookie)(c)}},90299:(e,t,r)=>{r.d(t,{w:()=>b});var a=r(74512),n=r(4539),l=r(66029);const s={small:16,medium:32,large:64},i=l.forwardRef((function({title:e,titleId:t,size:r,colored:a,...n},i){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:a?"none":["#fff","#fffff","white","#FFF","#FFFFFF"].includes("none")?"white":"currentColor",viewBox:"0 0 16 16","aria-hidden":"true",width:r?"string"==typeof r?s[r]:r:"16px",ref:i,"aria-labelledby":t},n),e?l.createElement("title",{id:t},e):null,l.createElement("path",{fill:a?"#757575":["#fff","#fffff","white","#FFF","#FFFFFF"].includes("#757575")?"white":"currentColor",d:"M0 12.667V16h3.333l9.83-9.83L9.83 2.837 0 12.667zm15.74-9.074a.885.885 0 000-1.253L13.66.26a.885.885 0 00-1.253 0l-1.626 1.626 3.333 3.333 1.626-1.626z"}))}));var o=r(32126),c=r(75734),d=r(19118),h=r(19893),u=r(46722),m=r(45455),f=r(34500),p=r(44619),x=r(52746),j=r(16419),g=r(14675),v=r(86642),y=r(80107),w=r(57306),k=r(53761),M=r(83513);function b(){const{apiRequest:e}=(0,w.h)({loginRoute:null}),{user:t}=(0,M.ZP)(),[r,s]=(0,l.useState)(null),[m,f]=(0,l.useState)(null),p=(0,l.useCallback)((()=>{t?e({method:"POST",url:`${(0,y.v6)()}/api/iam/v1/users`,body:{namingPattern:"*"}}).then((e=>{e.success?s(e.users.map((e=>{const t=(0,k.b0)(e);return t.id=t.uid,t}))):console.error("Failed to fetch users",e.message)})).catch((e=>{console.error("Failed to fetch users",e)})):s(null)}),[t,s]);(0,l.useEffect)((()=>{p()}),[t]);const v=(0,l.useCallback)((t=>{if(f(null),!m||!t)return;const r=[...m.roles];Promise.all([...t.filter((e=>!r.includes(e))).map((t=>e({method:"PUT",url:`${(0,y.v6)()}/api/iam/v1/user/${m.handle}/role`,body:{role:t}}))),...r.filter((e=>!t.includes(e))).map((t=>e({method:"DELETE",url:`${(0,y.v6)()}/api/iam/v1/user/${m.handle}/role/${t}`})))]).catch((e=>{console.error(`Failed to update some roles for user ${m.handle}`,e)})).finally((()=>{p()}))}),[m,p]);return(t?.roles??[]).includes(n.UserRoles.SystemAdministrator)?(0,a.jsxs)(o.Z,{children:[(0,a.jsxs)(x.i.Container,{children:[(0,a.jsx)(x.i.Title,{as:"h2",id:"manage-users",children:"Users"}),r?.length?(0,a.jsx)(j.w,{"aria-labelledby":"manager-users",data:r,columns:[{header:"Handle",field:"handle",maxWidth:"200px"},{header:"Name",field:"displayName",maxWidth:"200px"},{header:"UID",field:"uid",maxWidth:"260px"},{header:"Origin",field:"origin",maxWidth:"200px"},{header:"Roles",field:"roles",renderCell:e=>(0,a.jsxs)(o.Z,{sx:{display:"inline-flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[e.roles.map((e=>(0,a.jsx)(c.Z,{text:e}))),(0,a.jsx)(d.h,{"aria-label":"Edit the user roles",icon:i,size:"small",onClick:()=>{f(e)}})]})}]}):(0,a.jsx)(o.Z,{sx:{gridArea:"table"},children:r?(0,a.jsxs)(g.Z,{border:!0,children:[(0,a.jsx)(g.Z.Heading,{children:"Users"}),(0,a.jsx)(g.Z.Description,{children:(0,a.jsx)(o.Z,{sx:{textAlign:"center"},children:(0,a.jsx)(o.Z,{children:"No users register."})})})]}):(0,a.jsx)(o.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"140px"},children:(0,a.jsx)(h.Z,{})})})]}),m&&(0,a.jsx)(Z,{user:m,onSubmit:v})]}):(0,a.jsx)(u.Z,{variant:"danger",children:"You are not authorized to access this resource."})}const z=Object.values(n.UserRoles).map(((e,t)=>({text:e,id:t.toString()})));function Z({user:e,onSubmit:t}){const[r,n]=(0,l.useState)(e.roles.map((e=>z.find((t=>t.text===e))))),s=r.map((e=>e.id)),[i,c]=(0,l.useState)(s),d=e=>{n(r.filter((t=>t.id!==e))),c(i.filter((t=>t!==e)))};return(0,a.jsx)(v.V,{title:`Edit user ${e.handle} roles`,onClose:()=>{t(null)},footerButtons:[{buttonType:"default",onClick:()=>{t(null)},content:"Cancel"},{buttonType:"primary",onClick:()=>{t(r.map((e=>e.text)))},content:"Apply",autoFocus:!0}],children:(0,a.jsx)(o.Z,{as:"form",children:(0,a.jsxs)(m.Z,{children:[(0,a.jsx)(m.Z.Label,{id:"user-roles-input"}),(0,a.jsxs)(f.Z,{children:[(0,a.jsx)(f.Z.Input,{as:p.Z,tokens:r,onTokenRemove:d}),(0,a.jsx)(f.Z.Overlay,{children:(0,a.jsx)(f.Z.Menu,{items:z,selectedItemIds:i,onSelectedChange:e=>{if(Array.isArray(e))if(c(e.map((e=>e.id))),e.length<i.length){const t=e.map((({id:e})=>e)),r=s.filter((e=>!t.includes(e)));for(const e of r)d(e)}else n(e.map((({id:e,text:t})=>({id:e,text:t}))))},selectionVariant:"multiple","aria-labelledby":"user-roles-input"})})]})]})})})}},4833:(e,t,r)=>{r.d(t,{q:()=>u});var a=r(74512),n=r(32126),l=r(19893),s=r(46722),i=r(66029),o=r(80107),c=r(83513),d=r(6892),h=r(57306);function u(){const{apiRequest:e}=(0,h.h)({loginRoute:null}),{token:t}=(0,c.oR)(),[r,u]=(0,i.useState)(void 0);(0,i.useEffect)((()=>{t?e({method:"GET",url:`${(0,o.v6)()}/api/iam/v1/user`}).then((e=>{u(e?.profile??null)})):u(null)}),[t]);const m=r?{color:"",display_name:`${r.user_first_name_t||""} ${r.user_last_name_t||""}`.trim(),initials:((r.user_first_name_t||" ").charAt(0)+(r.user_last_name_t||" ").charAt(0)).toLocaleUpperCase().trim(),name:r.user_handle_s,username:r.user_handle_s,avatar_url:r.avatar_url_s,origin:r.origin_s}:null;return void 0===r?(0,a.jsx)(n.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"40px"},children:(0,a.jsx)(l.Z,{})}):r?(0,a.jsxs)(n.Z,{children:[(0,a.jsx)(d.tO,{identity:m,displayToken:!1}),(0,a.jsx)(d.i6,{roles:r.roles_ss})]}):(0,a.jsx)(s.Z,{variant:"warning",children:"Unable to get the user identity"})}},6892:(e,t,r)=>{r.d(t,{jz:()=>j,tO:()=>f,i6:()=>m,p9:()=>x});var a=r(74512),n=r(66029);const l={small:16,medium:32,large:64},s=n.forwardRef((function({title:e,titleId:t,size:r,colored:a,...s},i){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 900 900",fill:a?"currentColor":["#fff","#fffff","white","#FFF","#FFFFFF"].includes("currentColor")?"white":"currentColor","aria-hidden":"true",width:r?"string"==typeof r?l[r]:r:"16px",ref:i,"aria-labelledby":t},s),e?n.createElement("title",{id:t},e):null,n.createElement("path",{fill:a?"currentColor":["#fff","#fffff","white","#FFF","#FFFFFF"].includes("currentColor")?"white":"currentColor",d:"M452.306 0C300.946 0 92 95.504 92 343.998v2.548C93.733 593.918 345.386 900 452.306 900c107.327 0 360.306-307.509 360.306-556.002C812.612 95.504 603.665 0 452.306 0zM128.183 365.912c176.331 0 303.738 124.348 303.738 310.872-184.485 0-303.738-119.253-303.738-310.872zm654.36 0c0 191.62-121.698 310.872-309.852 310.872 0-186.524 129.955-310.872 309.853-310.872z"}))}));var i=r(21809),o=r(32935),c=r(17719),d=r(75734),h=r(62005),u=r(32126);const m=e=>{const{permissions:t,roles:r}=e;return(0,a.jsxs)(a.Fragment,{children:[t&&(0,a.jsx)(i.Z,{children:(0,a.jsx)(h.Z,{as:"h3",children:"Permissions"})}),r&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.Z,{children:(0,a.jsx)(h.Z,{as:"h3",children:"Roles"})}),(0,a.jsx)(u.Z,{children:(0,a.jsx)("ul",{children:r.map((e=>(0,a.jsx)("li",{children:(0,a.jsx)(h.Z,{children:e})},e)))})})]})]})},f=e=>{const{identity:t,displayToken:r=!0}=e,n=t?.color?x(t.color):void 0;return t&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.Z,{children:(0,a.jsx)(h.Z,{as:"h3",children:"Identity"})}),(0,a.jsxs)(u.Z,{sx:{display:"flex"},children:[(0,a.jsx)(u.Z,{children:(0,a.jsx)(o.Z,{sx:{width:100},children:(0,a.jsx)(c.Z,{square:!0,src:t.avatar_url?`${t.avatar_url}?v=4&s=200&d=${j}`:decodeURIComponent(j),sx:{width:100,height:100}})})}),(0,a.jsx)(u.Z,{ml:3,children:(0,a.jsxs)(u.Z,{sx:{display:"grid",gridTemplateColumns:"1fr 2fr",rowGap:3,columnGap:3,maxWidth:500},children:[(0,a.jsx)(u.Z,{sx:{p:1},children:(0,a.jsx)(h.Z,{sx:{fontWeight:"bold"},children:"Name"})}),(0,a.jsx)(u.Z,{sx:{p:1},children:(0,a.jsx)(h.Z,{children:t.display_name})}),(0,a.jsx)(u.Z,{sx:{p:1},children:(0,a.jsx)(h.Z,{sx:{fontWeight:"bold"},children:"Initials"})}),(0,a.jsx)(u.Z,{sx:{p:1},children:(0,a.jsx)(h.Z,{children:t.initials})}),(0,a.jsx)(u.Z,{sx:{p:1},children:(0,a.jsx)(h.Z,{sx:{fontWeight:"bold"},children:"Username"})}),(0,a.jsx)(u.Z,{sx:{p:1},children:(0,a.jsx)(h.Z,{children:t.username})}),t.origin&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.Z,{sx:{p:1},children:(0,a.jsx)(h.Z,{sx:{fontWeight:"bold"},children:"Provider"})}),(0,a.jsx)(u.Z,{sx:{p:1},children:(0,a.jsx)(h.Z,{children:t.origin})})]})]})})]}),r&&(0,a.jsx)(u.Z,{mt:3,children:(0,a.jsx)(d.Z,{text:t.display_name,color:n,size:"large",leadingVisual:s,sx:{backgroundColor:n}})})]})},p={"--jp-collaborator-color1":"#ffad8e","--jp-collaborator-color2":"#dac83d","--jp-collaborator-color3":"#72dd76","--jp-collaborator-color4":"#00e4d0","--jp-collaborator-color5":"#45d4ff","--jp-collaborator-color6":"#e2b1ff","--jp-collaborator-color7":"#ff9de6"},x=e=>p[e.replaceAll("var(","").replaceAll(")","")],j=encodeURIComponent("https://avatars.githubusercontent.com/u/70511875?s=200&v=4")},80107:(e,t,r)=>{r.d(t,{NG:()=>n,v6:()=>l,vD:()=>s});const a={iamServerUrl:"https://dev1.datalayer.tech"},n=e=>{a.iamServerUrl=e},l=()=>a.iamServerUrl,s=e=>{if(e)return void n(e);let t=Object.create({});const r=document.getElementById("datalayer-config-data");return r&&(t=JSON.parse(r.textContent||""),t.iamServer&&n(t.iamServer)),t}},57306:(e,t,r)=>{r.d(t,{h:()=>s});var a=r(20948),n=r(80107),l=r(83513);const s=({loginRoute:e="/"}={})=>{const{clearAuth:t,token:r}=(0,l.oR)(),s=e?(0,a.s)():()=>{throw new Error("Unauthorized")},i=async a=>{const n=a.token??r,l={Accept:"application/json","Content-Type":"application/json"};n&&(l.Authorization=`Bearer ${n}`);const i=await fetch(a.url,{method:a.method,headers:l,body:a.body?JSON.stringify(a.body):void 0,credentials:n?"include":"omit"});if(i.status<200||i.status>=300){if(401!==i.status)throw new Error(i.status.toString());console.log("Jupyter IAM has received a 401 return code."),t(),s(e)}return await i.json()};return{apiRequest:i,me:async e=>{const t=(await i({url:`${(0,n.v6)()}/api/iam/v1/me`,method:"GET",token:e})).me;return t?{uid:t.uid,handle:t.handle,email:t.email,firstName:t.first_name,lastName:t.last_name,displayName:t.display_name,joinDate:void 0,roles:t.roles}:null}}}},20948:(e,t,r)=>{r.d(t,{s:()=>n});var a=r(64309);const n=()=>{const e=(0,a.useNavigate)();return(t,r=null,a=!0)=>{r&&r.preventDefault(),window.scrollTo(0,0),document.body.scrollTop=0,e(t)}}},88660:(e,t,r)=>{r.r(t),r.d(t,{IJupyterIAM:()=>U,default:()=>W});var a=r(97930),n=r(56653),l=r(96129),s=r(8826),i=r(67370),o=r(4539);const c=new(r(1339).zZ)({name:"@datalayer/icons:passport-control",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72 72" fill="currentColor" aria-hidden="true">\n  <path fill="#92d3f5" d="M16.274 61.9s-1.8-13.9 10.2-13.9c3.2 2.1 5.9 3.6 9 3.6h-.1c3.1 0 6.3-1.6 9.5-3.7 11.6 0 9.6 13.9 9.8 14"/>\n  <path fill="#61b2e4" d="M44.844 47.285a18.274 18.274 0 01-8.87 3.514c13.1.4 13.1 7.1 13.8 11.1h5.1s1.97-14.614-10.03-14.614z"/>\n  <path fill="#92d3f5" d="M50.074 19.5c1.2.3.4 2.5-.4 3.5l-2.2 2.7h-.1a8.625 8.625 0 00-1.9-2l-.6-.4a15.38 15.38 0 001.3-1.2h-21.1a9.832 9.832 0 001.5 1.2l-.8.5a8.292 8.292 0 00-1.8 1.8l-.1-.1-2-2.4c-.8-1-1.6-3.2-.4-3.5 5.7-1.5 6-7.9 14.3-7.9s8.6 6.3 14.3 7.8zm-14.2.4c2.1 0 2.5-3.9 2.5-3.9a4.31 4.31 0 00-5-.1c-.1 0 .3 4 2.5 4z"/>\n  <path fill="#fcea2b" d="M35.874 19.9c-2.1 0-2.5-3.9-2.5-3.9a4.01 4.01 0 015 .1c0-.1-.4 3.8-2.5 3.8z"/>\n  <path fill="#61b2e4" d="M42.674 13.8s.9 8.2-2.6 8.2l5.3.3 1.7 3s3.7-1.9 3.6-5.2c.1 0-7.2-4.2-8-6.3z"/>\n  <path fill="#3f3f3f" d="M33.774 25.6a16.173 16.173 0 01-7.2-2.4c-.6-.4-1-.8-1.5-1.2h21.1a4.894 4.894 0 01-1.3 1.2 11.584 11.584 0 01-3.7 1.8 18.327 18.327 0 01-7.4.6z"/>\n  <g fill="#92d3f5">\n    <path d="M44.474 48.1l-3.7 8.8-2.6-2.7-2.5-2.6h.1c2.9-.1 5.6-1.5 8.7-3.5zM35.574 51.6l-2.6 2.7-2.6 2.6-3.6-8.9c3.1 2.1 5.8 3.5 8.8 3.6z"/>\n  </g>\n  <path fill="#fcea2b" d="M47.03 48.169L41.547 62h5.477l5.169-11.645s-2.768-2.698-5.163-2.186"/>\n  <path fill="#d0cfce" d="M11.822 39.203h10.557v14.976H11.822z"/>\n  <g>\n    <path fill="#fcea2b" d="M46.874 33.3l.1-.1c-.7 7-5.5 12.5-11.3 12.5-5.9 0-10.6-5.5-11.3-12.6a12.562 12.562 0 019.3-7.4 18.327 18.327 0 007.4-.6c3.1.3 5.8 8.2 5.8 8.2zm-5.1-3.2a2 2 0 10-2 2 2.006 2.006 0 002-2zm-8 0a2 2 0 10-2 2 2.006 2.006 0 002-2z"/>\n  </g>\n  <g fill="#f4aa41">\n    <path d="M46.974 33.2l-.1.1s-2.7-8-5.8-8.2a10.643 10.643 0 003.7-1.8l.7.5a8.625 8.625 0 011.9 2c1.2 1.7 2 4.3-.4 7.4zM24.474 33a.774.774 0 00-.1.3c-2.6-3.3-1.6-6-.3-7.7a8.641 8.641 0 011.8-1.8l.8-.6a16.173 16.173 0 007.2 2.4 12.573 12.573 0 00-9.4 7.4z"/>\n  </g>\n  <g>\n    <path fill="none" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M46.99 48.521l-5.216 12.45M51.611 50.681l-4.549 10.316"/>\n    <g fill="none" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">\n      <path d="M22.378 48.744a11.998 11.998 0 014.396-.745c3.2 2.1 5.9 3.5 8.9 3.6h.1c3 0 5.6-1.4 8.7-3.5.1 0 .1-.1.2-.1 12 0 10 13 10 13M16.774 61a16.229 16.229 0 01.603-6.819"/>\n      <path d="M26.774 47.999l3.7 8.9 2.6-2.7 2.5-2.6M38.174 54.199l-2.6-2.6M44.474 47.999v.1l-3.7 8.8-2.6-2.7"/>\n    </g>\n    <path d="M26.774 60.4h-5.8a1 1 0 110-2h5.8a.945.945 0 011 1 1.002 1.002 0 01-1 1zM35.774 40.1a6.921 6.921 0 01-3.4-.9.962.962 0 01.9-1.7 5.154 5.154 0 005.1 0 .962.962 0 11.9 1.7 7.594 7.594 0 01-3.5.9zM41.774 30.1a2 2 0 11-2-2 2.006 2.006 0 012 2zM33.774 30.1a2 2 0 11-2-2 2.006 2.006 0 012 2z"/>\n    <path d="M35.774 46.7c-6.4 0-11.7-5.9-12.3-13.8l2-.2c.5 6.7 5 11.9 10.3 11.9s9.7-5 10.3-11.7c0-.5.1-1 .1-1.5h2a9.702 9.702 0 01-.1 1.7c-.7 7.8-6 13.6-12.3 13.6z"/>\n    <path d="M24.374 34.3a.91.91 0 01-.8-.4 7.231 7.231 0 01-1.8-5.7 8.31 8.31 0 013.4-5.2l.7-.5a1 1 0 011.2 1.6l-.8.6a6.163 6.163 0 00-2.6 3.9 4.367 4.367 0 00.5 2.7 13.119 13.119 0 019.5-6.6.903.903 0 011.1.9.945.945 0 01-.9 1.1 10.854 10.854 0 00-8.7 7 .871.871 0 01-.8.6z"/>\n    <path d="M36.074 26.8c-4.7 0-9.2-1.5-11.7-4a.913.913 0 01-.2-1.1.961.961 0 01.9-.6h21.1a.961.961 0 01.9.6 1.073 1.073 0 01-.1 1.1c-2 2.4-5.7 3.9-10 4zm-7.8-3.7a17.89 17.89 0 008.6 1.7 13.836 13.836 0 006.5-1.7z"/>\n    <path d="M47.474 26.8a1.421 1.421 0 01-.6-.2.972.972 0 01-.1-1.4l2.2-2.7a4.061 4.061 0 00.8-1.9c-2.6-.7-4.1-2.3-5.6-3.8-2-2-3.9-4-8.3-4-4.5 0-6.3 1.9-8.3 4-1.5 1.5-3 3.1-5.6 3.8a3.701 3.701 0 00.8 1.9l2 2.4a.993.993 0 01-1.5 1.3l-2-2.4c-.7-.8-1.6-2.6-1.2-3.9a1.764 1.764 0 011.3-1.2 10.908 10.908 0 004.8-3.3c2.1-2.1 4.4-4.6 9.7-4.6s7.7 2.4 9.7 4.6c1.4 1.4 2.7 2.8 4.8 3.3a1.952 1.952 0 011.3 1.2c.4 1.3-.5 3.1-1.2 3.9l-2.2 2.7a1.91 1.91 0 01-.8.3z"/>\n    <path d="M46.974 34.3h-.2a.969.969 0 01-.8-.7c-1-3-3.3-7.4-4.9-7.5a.903.903 0 01-.9-1.1.955.955 0 011.1-.9c2.7.2 4.8 4.3 5.9 7a4.418 4.418 0 00.4-2.5 6.163 6.163 0 00-2.6-3.9l-.7-.6a.993.993 0 011.3-1.5l.7.5a7.947 7.947 0 013.3 5.2 7.231 7.231 0 01-1.8 5.7 1.135 1.135 0 01-.8.3zM35.874 20.9c-2.9 0-3.5-4.3-3.5-4.8a1.086 1.086 0 01.4-.9c2-1.5 5-1.2 6.3.1a1.135 1.135 0 01.3.8c-.1.5-.6 4.8-3.5 4.8zm0-2c.8 0 1.2-1.5 1.4-2.4a3.397 3.397 0 00-2.8 0c.2 1 .7 2.4 1.4 2.4zM39.774 28.1a2 2 0 11-2 2 2.006 2.006 0 012-2zM31.774 28.1a2 2 0 11-2 2 2.006 2.006 0 012-2z"/>\n    <path fill="none" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M22.379 48.744v-9.541H11.822v14.976h5.549"/>\n    <path fill="none" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.371 54.179h5.008v-5.435"/>\n  </g>\n</svg>\n'});var d=r(1865),h=r(66274);async function u(e="",t={}){const r=h.ServerConnection.makeSettings(),a=d.URLExt.join(r.baseUrl,"jupyter_iam",e);let n;try{n=await h.ServerConnection.makeRequest(a,t,r)}catch(e){throw new h.ServerConnection.NetworkError(e)}let l=await n.text();if(l.length>0)try{l=JSON.parse(l)}catch(e){console.log("Not a JSON response body.",n)}if(!n.ok)throw new h.ServerConnection.ResponseError(n,l.message||l);return l}var m=r(74512),f=r(67048),p=r(66029),x=r(59689),j=r(59606),g=r(32126),v=r(61726);const y={small:16,medium:32,large:64},w=p.forwardRef((function({title:e,titleId:t,size:r,...a},n){return p.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 72 72",fill:"currentColor","aria-hidden":"true",ref:n,width:r?"string"==typeof r?y[r]:r:"16px","aria-labelledby":t},a),e?p.createElement("title",{id:t},e):null,p.createElement("path",{fill:"#92d3f5",d:"M16.274 61.9s-1.8-13.9 10.2-13.9c3.2 2.1 5.9 3.6 9 3.6h-.1c3.1 0 6.3-1.6 9.5-3.7 11.6 0 9.6 13.9 9.8 14"}),p.createElement("path",{fill:"#61b2e4",d:"M44.844 47.285a18.274 18.274 0 01-8.87 3.514c13.1.4 13.1 7.1 13.8 11.1h5.1s1.97-14.614-10.03-14.614z"}),p.createElement("path",{fill:"#92d3f5",d:"M50.074 19.5c1.2.3.4 2.5-.4 3.5l-2.2 2.7h-.1a8.625 8.625 0 00-1.9-2l-.6-.4a15.38 15.38 0 001.3-1.2h-21.1a9.832 9.832 0 001.5 1.2l-.8.5a8.292 8.292 0 00-1.8 1.8l-.1-.1-2-2.4c-.8-1-1.6-3.2-.4-3.5 5.7-1.5 6-7.9 14.3-7.9s8.6 6.3 14.3 7.8zm-14.2.4c2.1 0 2.5-3.9 2.5-3.9a4.31 4.31 0 00-5-.1c-.1 0 .3 4 2.5 4z"}),p.createElement("path",{fill:"#fcea2b",d:"M35.874 19.9c-2.1 0-2.5-3.9-2.5-3.9a4.01 4.01 0 015 .1c0-.1-.4 3.8-2.5 3.8z"}),p.createElement("path",{fill:"#61b2e4",d:"M42.674 13.8s.9 8.2-2.6 8.2l5.3.3 1.7 3s3.7-1.9 3.6-5.2c.1 0-7.2-4.2-8-6.3z"}),p.createElement("path",{fill:"#3f3f3f",d:"M33.774 25.6a16.173 16.173 0 01-7.2-2.4c-.6-.4-1-.8-1.5-1.2h21.1a4.894 4.894 0 01-1.3 1.2 11.584 11.584 0 01-3.7 1.8 18.327 18.327 0 01-7.4.6z"}),p.createElement("g",{fill:"#92d3f5"},p.createElement("path",{d:"M44.474 48.1l-3.7 8.8-2.6-2.7-2.5-2.6h.1c2.9-.1 5.6-1.5 8.7-3.5zM35.574 51.6l-2.6 2.7-2.6 2.6-3.6-8.9c3.1 2.1 5.8 3.5 8.8 3.6z"})),p.createElement("path",{fill:"#fcea2b",d:"M47.03 48.169L41.547 62h5.477l5.169-11.645s-2.768-2.698-5.163-2.186"}),p.createElement("path",{fill:"#d0cfce",d:"M11.822 39.203h10.557v14.976H11.822z"}),p.createElement("g",null,p.createElement("path",{fill:"#fcea2b",d:"M46.874 33.3l.1-.1c-.7 7-5.5 12.5-11.3 12.5-5.9 0-10.6-5.5-11.3-12.6a12.562 12.562 0 019.3-7.4 18.327 18.327 0 007.4-.6c3.1.3 5.8 8.2 5.8 8.2zm-5.1-3.2a2 2 0 10-2 2 2.006 2.006 0 002-2zm-8 0a2 2 0 10-2 2 2.006 2.006 0 002-2z"})),p.createElement("g",{fill:"#f4aa41"},p.createElement("path",{d:"M46.974 33.2l-.1.1s-2.7-8-5.8-8.2a10.643 10.643 0 003.7-1.8l.7.5a8.625 8.625 0 011.9 2c1.2 1.7 2 4.3-.4 7.4zM24.474 33a.774.774 0 00-.1.3c-2.6-3.3-1.6-6-.3-7.7a8.641 8.641 0 011.8-1.8l.8-.6a16.173 16.173 0 007.2 2.4 12.573 12.573 0 00-9.4 7.4z"})),p.createElement("g",null,p.createElement("path",{fill:"none",stroke:"#000",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M46.99 48.521l-5.216 12.45M51.611 50.681l-4.549 10.316"}),p.createElement("g",{fill:"none",stroke:"#000",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2},p.createElement("path",{d:"M22.378 48.744a11.998 11.998 0 014.396-.745c3.2 2.1 5.9 3.5 8.9 3.6h.1c3 0 5.6-1.4 8.7-3.5.1 0 .1-.1.2-.1 12 0 10 13 10 13M16.774 61a16.229 16.229 0 01.603-6.819"}),p.createElement("path",{d:"M26.774 47.999l3.7 8.9 2.6-2.7 2.5-2.6M38.174 54.199l-2.6-2.6M44.474 47.999v.1l-3.7 8.8-2.6-2.7"})),p.createElement("path",{d:"M26.774 60.4h-5.8a1 1 0 110-2h5.8a.945.945 0 011 1 1.002 1.002 0 01-1 1zM35.774 40.1a6.921 6.921 0 01-3.4-.9.962.962 0 01.9-1.7 5.154 5.154 0 005.1 0 .962.962 0 11.9 1.7 7.594 7.594 0 01-3.5.9zM41.774 30.1a2 2 0 11-2-2 2.006 2.006 0 012 2zM33.774 30.1a2 2 0 11-2-2 2.006 2.006 0 012 2z"}),p.createElement("path",{d:"M35.774 46.7c-6.4 0-11.7-5.9-12.3-13.8l2-.2c.5 6.7 5 11.9 10.3 11.9s9.7-5 10.3-11.7c0-.5.1-1 .1-1.5h2a9.702 9.702 0 01-.1 1.7c-.7 7.8-6 13.6-12.3 13.6z"}),p.createElement("path",{d:"M24.374 34.3a.91.91 0 01-.8-.4 7.231 7.231 0 01-1.8-5.7 8.31 8.31 0 013.4-5.2l.7-.5a1 1 0 011.2 1.6l-.8.6a6.163 6.163 0 00-2.6 3.9 4.367 4.367 0 00.5 2.7 13.119 13.119 0 019.5-6.6.903.903 0 011.1.9.945.945 0 01-.9 1.1 10.854 10.854 0 00-8.7 7 .871.871 0 01-.8.6z"}),p.createElement("path",{d:"M36.074 26.8c-4.7 0-9.2-1.5-11.7-4a.913.913 0 01-.2-1.1.961.961 0 01.9-.6h21.1a.961.961 0 01.9.6 1.073 1.073 0 01-.1 1.1c-2 2.4-5.7 3.9-10 4zm-7.8-3.7a17.89 17.89 0 008.6 1.7 13.836 13.836 0 006.5-1.7z"}),p.createElement("path",{d:"M47.474 26.8a1.421 1.421 0 01-.6-.2.972.972 0 01-.1-1.4l2.2-2.7a4.061 4.061 0 00.8-1.9c-2.6-.7-4.1-2.3-5.6-3.8-2-2-3.9-4-8.3-4-4.5 0-6.3 1.9-8.3 4-1.5 1.5-3 3.1-5.6 3.8a3.701 3.701 0 00.8 1.9l2 2.4a.993.993 0 01-1.5 1.3l-2-2.4c-.7-.8-1.6-2.6-1.2-3.9a1.764 1.764 0 011.3-1.2 10.908 10.908 0 004.8-3.3c2.1-2.1 4.4-4.6 9.7-4.6s7.7 2.4 9.7 4.6c1.4 1.4 2.7 2.8 4.8 3.3a1.952 1.952 0 011.3 1.2c.4 1.3-.5 3.1-1.2 3.9l-2.2 2.7a1.91 1.91 0 01-.8.3z"}),p.createElement("path",{d:"M46.974 34.3h-.2a.969.969 0 01-.8-.7c-1-3-3.3-7.4-4.9-7.5a.903.903 0 01-.9-1.1.955.955 0 011.1-.9c2.7.2 4.8 4.3 5.9 7a4.418 4.418 0 00.4-2.5 6.163 6.163 0 00-2.6-3.9l-.7-.6a.993.993 0 011.3-1.5l.7.5a7.947 7.947 0 013.3 5.2 7.231 7.231 0 01-1.8 5.7 1.135 1.135 0 01-.8.3zM35.874 20.9c-2.9 0-3.5-4.3-3.5-4.8a1.086 1.086 0 01.4-.9c2-1.5 5-1.2 6.3.1a1.135 1.135 0 01.3.8c-.1.5-.6 4.8-3.5 4.8zm0-2c.8 0 1.2-1.5 1.4-2.4a3.397 3.397 0 00-2.8 0c.2 1 .7 2.4 1.4 2.4zM39.774 28.1a2 2 0 11-2 2 2.006 2.006 0 012-2zM31.774 28.1a2 2 0 11-2 2 2.006 2.006 0 012-2z"}),p.createElement("path",{fill:"none",stroke:"#000",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M22.379 48.744v-9.541H11.822v14.976h5.549"}),p.createElement("path",{fill:"none",stroke:"#000",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.371 54.179h5.008v-5.435"})))}));var k=r(21809),M=r(11048),b=r(62005),z=r(5917);const Z={small:16,medium:32,large:64},_=p.forwardRef((function({title:e,titleId:t,size:r,colored:a,...n},l){return p.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 243.75 243.75",fill:a?"currentColor":["#fff","#fffff","white","#FFF","#FFFFFF"].includes("currentColor")?"white":"currentColor","aria-hidden":"true",width:r?"string"==typeof r?Z[r]:r:"16px",ref:l,"aria-labelledby":t},n),e?p.createElement("title",{id:t},e):null,p.createElement("g",{fill:a?"#fff":["#fff","#fffff","white","#FFF","#FFFFFF"].includes("#fff")?"white":"currentColor",strokeWidth:2.928,transform:"translate(0 -308.268)"},p.createElement("circle",{cx:121.875,cy:430.143,r:120.411,stroke:"#000"}),p.createElement("path",{fillRule:"evenodd",stroke:"#000",strokeLinecap:"round",strokeLinejoin:"round",d:"M119.675 477.588l.253-140.166c-73.532 5.11-86.696 84.242-28.25 114.7l.61 25.34z"}),p.createElement("path",{fillRule:"evenodd",stroke:"#000",d:"M120.07 482.652H93.813c-2.945 4.667-3.575 8.04 2.748 13.127-6.62.865-6.378 8.548-2.9 10.686-4.242 1.556-5.282 8.727 6.869 7.937l1.625 5.486c.733 2.113 1.746 2.545 2.76 2.973l10.458-.086c1.992-.72 4.299-2.105 4.39-5.015z"}),p.createElement("path",{fillRule:"evenodd",stroke:"#f75c59",strokeLinecap:"round",strokeLinejoin:"round",d:"M124.291 477.462l-.469-139.95c73.532 5.11 86.696 84.458 28.25 114.916l-.61 25.34z"}),p.createElement("path",{fillRule:"evenodd",stroke:"#f75c59",d:"M125.32 482.957l-.306 32.361c1.317 11.059 11.072 8.629 10.99-.61v-31.751zM139.957 482.957l-.305 32.361c1.317 11.059 11.072 8.629 10.99-.61v-31.751z"}),p.createElement("path",{fillRule:"evenodd",stroke:"#f8d05b",d:"M112.412 477.238l-16.948-73.934c-4.23-19.168-16.974-14.783-11.444-.557 6.267 10.896 28.39 21.763 33.582 6.106-4.523-5.743-6.628-12.59 1.333-16.65"}),p.createElement("path",{fillRule:"evenodd",stroke:"#f75c59",strokeLinejoin:"round",d:"M131.627 399.814c1.778-4.471 12.628-9.482 19.487-14.062 7.117 3.213 17.741 13.145 12.804 25.555-1.265 4.901-28.05 4.544-30.224 2.137-4.481-4.606-3.115-10.024-2.067-13.63zM128.198 428.251c-.91 7.576-.577 13.909-.763 20.76 3.425.788 7.262.337 11.082-.062-2.75-6.95-5.704-13.748-10.319-20.698z"})))})),E=e=>{const{version:t}=e,[r,a]=(0,p.useState)(!1);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(k.Z,{as:"h2",children:(0,m.jsxs)(g.Z,{display:"flex",children:[(0,m.jsx)(g.Z,{mr:1,children:(0,m.jsx)(w,{size:32})}),(0,m.jsxs)(g.Z,{children:["Jupyter IAM",(0,m.jsx)(M.Z,{sx:{marginLeft:1},children:t})]})]})}),(0,m.jsx)(g.Z,{children:(0,m.jsx)(b.Z,{children:"Identity and Access Management for Jupyter."})}),(0,m.jsx)(g.Z,{mt:3,children:r?(0,m.jsx)(_,{size:300,onClick:e=>a(!1)}):(0,m.jsx)("img",{src:"https://assets.datalayer.tech/releases/datalayer-0.3.0-black-snake_1024.png",onClick:e=>a(!0),style:{width:"100%"}})}),(0,m.jsx)(g.Z,{children:(0,m.jsx)(z.Z,{href:"https://datalayer.tech/docs/releases/0.3.0-black-snake",target:"_blank",children:(0,m.jsx)(b.Z,{as:"h4",children:"Datalayer 0.3.0 Black Snake Release"})})}),(0,m.jsx)(g.Z,{children:(0,m.jsx)(z.Z,{href:"https://github.com/datalayer/jupyter-iam",target:"_blank",children:(0,m.jsx)(b.Z,{as:"h4",children:"Source code"})})})]})};var F=r(94834),C=r(83513),S=r(4833),I=r(6892);const R=e=>{const{adapter:t}=e,[r,a]=(0,p.useState)();return(0,p.useEffect)((()=>{if(t){const e=t.jupyterLab.serviceManager.user;a(e)}})),(0,m.jsx)(m.Fragment,{children:r&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(I.tO,{identity:r.identity}),(0,m.jsx)(I.i6,{permissions:r.permissions})]})})},A=e=>{const{user:t}=(0,C.oR)(),{adapter:r}=e,[a,n]=(0,p.useState)(1);let l=null;switch(a){case 1:l=(0,m.jsx)(S.q,{});break;case 2:l=(0,m.jsx)(R,{adapter:r})}return(0,m.jsx)(m.Fragment,{children:(0,m.jsxs)(g.Z,{sx:{display:"flex"},children:[(0,m.jsx)(g.Z,{children:(0,m.jsxs)(F.$,{sx:{"> *":{paddingTop:"0px"}},children:[t&&(0,m.jsx)(F.$.Item,{"aria-current":1===a?"page":void 0,onClick:e=>n(1),children:"Datalayer"}),(0,m.jsx)(F.$.Item,{"aria-current":2===a?"page":void 0,onClick:e=>n(2),children:"JupyterLab"})]})}),(0,m.jsx)(g.Z,{ml:3,sx:{width:"100%"},children:l})]})})};var L=r(90299);const $=e=>{const{adapter:t}=e,{user:r}=(0,C.oR)(),[a,n]=(0,p.useState)(0),[l,s]=(0,p.useState)("");return(0,p.useEffect)((()=>{u("config").then((e=>{s(e.version)})).catch((e=>{console.error(`Error while accessing the jupyter server jupyter_iam extension.\n${e}`)}))})),(0,m.jsx)(m.Fragment,{children:(0,m.jsx)(x.ZP,{children:(0,m.jsx)(j.Z,{children:(0,m.jsxs)(g.Z,{children:[(0,m.jsx)(g.Z,{children:(0,m.jsxs)(v.J,{"aria-label":"iam",children:[(0,m.jsx)(v.J.Item,{"aria-label":"iam-home","aria-current":0===a?"page":void 0,onSelect:e=>{e.preventDefault(),n(0)},children:"Providers"}),(r?.roles??[]).includes(o.UserRoles.SystemAdministrator)&&(0,m.jsx)(v.J.Item,{"aria-label":"iam-users","aria-current":1===a?"page":void 0,onSelect:e=>{e.preventDefault(),n(1)},children:"Manage users"}),(0,m.jsx)(v.J.Item,{"aria-label":"iam-about","aria-current":2===a?"page":void 0,icon:()=>(0,m.jsx)(w,{colored:!0}),onSelect:e=>{e.preventDefault(),n(2)},children:"About"})]})}),(0,m.jsxs)(g.Z,{m:3,children:[0===a&&t&&(0,m.jsx)(A,{adapter:t}),1===a&&(r?.roles??[]).includes(o.UserRoles.SystemAdministrator)&&(0,m.jsx)(L.w,{}),2===a&&(0,m.jsx)(E,{version:l})]})]})})})})};class N extends l.ReactWidget{_app;constructor(e){super(),this._app=e,this.addClass("dla-Container")}render(){return(0,m.jsx)($,{adapter:f.JupyterLabAppAdapter.create(this._app)})}}var T=r(80107);const D="@datalayer/jupyter-iam:plugin",U=new a.Token(D);var J;!function(e){e.create="create-jupyter-iam-widget"}(J||(J={}));const O={id:D,autoStart:!0,requires:[l.ICommandPalette,o.IDatalayer],optional:[i.ISettingRegistry,s.ILauncher,n.ILayoutRestorer],provides:U,activate:(e,t,r,a,n,s)=>{const i={useStore:C.oR};let o=!1;const d=r=>{if(r&&((0,T.NG)(r.apiServerUrl),!o&&!r.whiteLabel)){const i=J.create;o=!0;const d=r.launcherCategory;t.addItem({command:i,category:d});const h=e=>{const t=e.get("showInLauncher").composite;n&&t&&n.add({command:i,category:d,rank:4.1})};a&&a.load(O.id).then((e=>{console.log(`${O.id} settings loaded:`,e.composite),h(e),e.changed.connect(h)})).catch((e=>{console.error(`Failed to load settings for ${O.id}.`,e)}));const{commands:u}=e,m=new l.WidgetTracker({namespace:"jupyter-iam"});s&&s.restore(m,{command:i,name:()=>"jupyter-iam"}),u.addCommand(i,{caption:"Show Jupyter IAM",label:"Jupyter IAM",icon:c,execute:()=>{const t=new N(e),r=new l.MainAreaWidget({content:t});r.title.label="Jupyter IAM",r.title.icon=c,e.shell.add(r,"main"),m.add(r)}})}};return d(r.configuration.configuration),r.configuration.configurationChanged.connect(((e,t)=>{d(t)})),u("config").then((e=>{console.log(e)})).catch((e=>{console.error(`Error while accessing the jupyter server jupyter_iam extension.\n${e}`)})),console.log(`JupyterLab plugin ${O.id} is activated.`),i}},W=O},53761:(e,t,r)=>{r.d(t,{q$:()=>l,aK:()=>n,b0:()=>s});const a=(e,t)=>e?t?e+" "+t:e:t??"",n=void 0,l=void 0;function s(e){return{uid:e.uid,handle:e.user_handle_s,email:e.user_email_s,firstName:e.user_first_name_t,lastName:e.user_last_name_t,displayName:a(e.user_first_name_t,e.user_last_name_t),joinDate:e.join_ts_dt?new Date(e.join_ts_dt):void 0,roles:e.roles_ss,origin:e.origin_s}}},83513:(e,t,r)=>{r.d(t,{Ck:()=>o,ZP:()=>d,oR:()=>c});var a=r(75489),n=r(19992),l=r(80107),s=r(21780),i=r(53761);const o=(0,n.M)(((e,t)=>({socialLogin:{},addSocialLogin:(t,r)=>{e((e=>({socialLogin:{...e.socialLogin,[t]:r}})))},user:i.aK,token:i.q$,logUser:()=>{const r=(0,s.vF)(),a=(0,s.hV)();r&&a&&fetch(`${(0,l.v6)()}/api/iam/v1/me`,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${a}`},credentials:"include"}).then((n=>{n.ok?e((e=>({user:r,token:a}))):401===n.status&&(console.info("Invalid stored token"),t().clearAuth())})).catch((e=>{console.error("Failed to fetch user identity",e)}))},clearAuth:()=>{(0,s.c7)(),(0,s.mB)(),e((e=>({user:i.aK,token:i.q$})))},setAuth:(r,a)=>{const n=t();n.user===r&&n.token===a||((0,s.c7)(r),(0,s.mB)(a),e((e=>({user:r,token:a}))))}})));function c(e){return(0,a.useStore)(o,e)}const d=c}}]);